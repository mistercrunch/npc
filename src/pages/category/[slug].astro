---
import Layout from '../../layouts/Layout.astro'
import Breadcrumbs from '../../components/Breadcrumbs.astro'
import { loadEzines, getCategory } from '../../lib/ezines'

const { slug } = Astro.params
const category = getCategory(slug!)

if (!category) {
  return Astro.redirect('/404')
}

const data = loadEzines()
const ezines = category.ezines
  .map(id => ({ id, ...data.ezines[id] }))
  .filter(e => e.name)
---

<Layout title={`${category.name} - PhileZ`} description={category.description}>
  <Breadcrumbs items={[
    { label: 'Home', href: '/' },
    { label: category.name }
  ]} />

  <h1>{category.name}</h1>
  <p style="color: #888; margin-bottom: 2rem;">{category.description}</p>

  <div class="ezine-grid">
    {ezines.map(ezine => (
      <a href={`/ezine/${ezine.id}`} class="ezine-card">
        <h3>{ezine.name}</h3>
        {ezine.tagline && <div class="tagline">{ezine.tagline}</div>}
        {ezine.description && <p>{ezine.description}</p>}
        <div class="meta">
          {ezine.years && <span>{ezine.years}</span>}
          {ezine.years && ezine.issues && <span> â€¢ </span>}
          {ezine.issues && <span>{ezine.issues} issues</span>}
        </div>
      </a>
    ))}
  </div>
</Layout>
