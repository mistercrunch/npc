[::............................o( cRACK )o............................::]

1. Manual del cracking [1/2]
INDICE
------

Entrega #1 0. NOTA DEL AUTOR.
           1. GUIA DE ENSAMBLADOR (ASM) ENFOCADA AL CRACKING.
Entrega #2 2. CONFIGURACION Y USO DE SOFTICE.
           3. NUESTRO PRIMER CRACKING.

 ------------------------------------
| 2. CONFIGURACION Y USO DE SOFTICE. |
 ------------------------------------ ---------------------------------------
Contenido:
    2.1. Configuracion de SoftIce
    2.2. Uso y teclas de SofIce
    2.3. Comandos importantes para el Cracking

2.1. CONFIGURACION DE SOFTICE
-----------------------------
Para comenzar a usar SoftIce para Windows 95 (gracias a NuMega), tenemos que
ver si se cargan las librerias; para ello comprueba que el fichero WINICE.DAT
en el apartado "Examples of export symbols that can be included for Chicago"
no tengan delante el punto y coma, y verifica que las rutas de los ficheros
a tu windows sean correctas.
Si quieres tener menos memoria ocupada, quita los puntos y comas solo a
KERNEL32.DLL, USER32.DLL y GDI32.DLL que son los mas importantes.
Logicamente tendras que reiniciar el ordenador y volver a cargar SoftIce.

2.2. USO Y TECLAS DE SOFTICE
----------------------------
La pantalla de SoftIce es parecida a la siguiente (por lo menos en la ver. 2,
porque la v3.2 cambia):
     -------------------
    | Ventana Registros | R - editar ; Aqui estan los valores de los registros
    |-------------------|              
    |  Ventana  Datos   | D - ver  E - editar  ; Es donde vemos la memoria
    |-------------------|                        hex. y dec. y la direccion
    |  Ventana Codigo   | U - ver  A - Inserta ; Vemos el codigo en ASM
    |-------------------|                        conforme se va ejecutando
    | Ventana  Comandos |            ; Aqui pondremos los comandos
     -------------------
Otras teclas importantes son:
    F5 / Ctrl+D  -> Ejecuta
    F10          -> Paso a Paso
    F11          -> Funcion en Funcion
    t            -> traza una llamada

2.3. COMANDOS PARA EL CRACKING
------------------------------
Bueno, para explicar los comandos que mas usaremos (que son muy pocos) voy a
deciros el proceso generico para el cracking de un programa.
Bien, resulta que cuando a un programa le damos a la opcion del menu REGISTER
(aparece en muchos programas), sale una ventana que nos pide, por ejemplo, el
nombre y el codigo.
Pues nuestra tarea sera interceptar el lugar en donde el programa compara
nuestro codigo con el generado por el mismo para comprobar si es correcto o
erroneo.
Facil, eh? pues si, los programas sencillos si.
Primera pregunta, ¨como interceptar cuando el programa recoge dichos datos?
Para ello hay que colocar un BreakPoint.
Un BP sirve para detener el programa y ver el codigo ASM en la funcion que
nosotros le digamos.
Por ejemplo que se detenga cuando recoga el codigo que introducimos.
Las dos funciones mas usadas para recoger las cadenas que introducimos son:
    GetDlgItemTextA   y   GetWindowTextA

Bueno, para ver como se usa y como se crackea (que es el tema que nos ocupa)
pasemos al siguiente apartado.

 -----------------------------
| 3. NUESTRO PRIMER CRACKING. | (from ED!SON tutorial)
 ----------------------------- ----------------------------------------------
Antes de arrancar W95 o W98, tenemos que arrancar en DOS y ejecutar WINICE
el cual se encargara de arrancar el Windows.

3.1. PROTECCION POR NUMERO
--------------------------
 - Target: Task Lock 3.00
 - Protection Type: Una simple proteccion de introduzca un numero
 - Tool Needed: SoftIce 2.0 o sup.

* PASO 1: Ejecutar el programa TaskLock ;)
* PASO 2: Buscar la opcion REGISTER. Introducir un numero al azar y pulsar OK.
* PASO 3: Ohh! no es correcto :(  (todavia)  ;)
* PASO 4: Volver a poner un numero y antes de pulsar Ok hay que colocar un
          BreakPoint (BP)
          Para ello pasaremos a SoftIce pulsando Ctrl+D y pondremos:
          BPX GetWindowTextA
          pulsamos ENTER y saldremos de SoftIce pulsando de nuevo Ctrl+D
          y ahora si,
          pulsamos OK y...
          :(
* PASO 5: ein! otra vez ese estupido mensaje de numero incorrecto !!!
          Bueno, esta claro que la funcion que usa para coger el numero no
          es GetWindowTextA
          Bueno, ponemos otra vez el numerito y pulsamos de nuevo Ctrl+D
          Ahora borraremos el BrakPoint de antes que no vale para nada con
          el comando
          BC 0   (es 0 porque es el primero. Si tuvieramos varios BP,
          podriamos listarlos con BL y ver el numero que es, en nuestro caso,
          con BL pondria  00)  BPX USER32!GetWindowsTextA C=01
          Bueno, ahora probaremos con
          BPX GetDlgItemTextA
          damos a enter y salimos (Ctrl+D)
          pulsamos OK y...
          :)
* PASO 6: Bingo!!! ahora estamos dentro de SoftIce :)
          Estamos al comienzo de la funcion GetDlgItemTextA, pero para ver
          desde donde es llamada pulsamos
          F11
          Ahora debes desconectar el BP, pon
          bd 0  (si necesitas activarlo despues, que no lo necesitaremos
                es be 0)
* PASO 7: La primera linea que aparece es:
          CALL   [USER32!GetDlgItemTextA]
          Pero que hay antes??
          Para ello pulsaremos unas cuantas veces CTRL+flechaarriba hasta ver
          lo siguiente:

          RET                             ; final de la func. anterior
          PUSH EBP                        ; comienzo de la funcion
          MOV  EBP, ESP                   ; ...
          SUB  ESP, 0000009C              ; ...
          PUSH ESI                        ; ...
        > LEA  EAX, [EBP-34]              ; EAX=EBP-34
          PUSH EDI                        ; ...
          MOVE ESI, ECX                   ; ...
          PUSH 32                         ; Guarda: la long. max.
        > PUSH EAX                        ; Guarda: direccion del buffer :)
          PUSH 000003F4                   ; Guarda: ...
          PUSH DWORD PTR [ESI+1C]         ; Guarda: ...
          CALL [USER32!GetDlgItemTextA]   ; coge el texto y comienza la func.

        Los PUSH, como dije, son para guardar valores para su uso posterior :)
        Las lineas importantes les he puesto un > delante; observemoslas.
        Vemos que el buffer de texto se guarda en EAX y cuanto vale EAX?
        EAX=EBP-34
        Bien, ahora ponemos   d ebp-34   para ver la memoria en ese valor.
        Jeje, vemos en la ventana de Datos el numero que hemos puesto :)

*PASO 8: Ahora, lo que hay que hacer es buscar donde se hace la comparacion
         entre nuestro codigo y el codigo bueno. Para ello hay que ir paso por
         paso de instrucciones pulsando F10 hasta encontrar algo relacionado
         con EBP-34 (que es en donde esta nuestro numero). Tras unos pocos F10
         nos encontramos lo siguiente:

          > LEA  EAX, [EBP+FFFFFF64]      ; EAX=EBP-9C
            LEA  ECX, [EBP-34]            ; ECX=EBP-34 (Ahora nuestro numero
            PUSH EAX                      ; Guarda EAX.           esta en ECX)
            PUSH ECX                      ; Guarda ECX
          > CALL 00403DD0                 ; Llama a una funcion
            ADD  ESP, 08                  ; ...
            TEST EAX, EAX                 ; Chequea el resultado de la funcion
            JNZ 00402BC0                  ; Salta si no es 0

         Yo veo claramente como se recoge una variable en EAX, otra en ECX
         (nuestro numero), se llama a una funcion ( que suponemos que es la
         que genera el numero bueno) y despues es comparada.

         Bien, entonces ¨que se esconde bajo EAX (EBP+FFFFFF64) ? pues si, el
         numero correcto. Ponemos
         D EAX
         y aparecera el numerito en la ventana de Datos ;)
         Ahora lo que tenemos que hacer es ponerle dicho numerito en el
         programa cuando lo pida y ya esta :)

 ----------
| 4. URLs. |
 ---------- -----------------------------------------------------------------
Tengo que decir que dentro de poco hare un hueco en internet para ayudaros
a los problemillas que tengais.
La URL sera http://members.tripod.com/~antikton/cracking/

Bueno, ahora os pongo las URLs de los programas que he usado:
    - SoftIce:  Busca en http://astalavista.box.sk
                o dentro de poco en mi pagina web.
    - TaskLock: Busca en http://www.filez.com
                o en otro buscador de FTP
                o dentro de poco en mi web.

 -----------------------
| 5. CIERRE DE EDICION. |
 ----------------------- ----------------------------------------------------
Bueno, en esta articulo hemos  aprendido  asembler (enfocado al cracking),
el manejo de SoftIce y a crackear un programa basado en proteccion por
numero. No esta mal para ser el primer numero, pero ya iremos progresando poco
a poco y a ver si alguien me echa una mano (antikton@rocketmail.com)

Si no habeis entendido algo (porque no me haya expresado bien) o necesitais
cualquier cosa, o teneis una sugerencia o lo que sea (dar animos para que
saquemos el siguiente numero, si no, no lo saco), hazmelo saber mandandome
un e-mail a

antikton@iname.com

                                        byez ;)

Web   : http://come.to/antikton
e-mail: antikton@iname.com

Gracias a Antikton (RareGazZ)
---------------------------------------------------------[ph3-04.txt]--