<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< DP 3 >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
**** [ Ramseso ][ ramseso@yahoo.com ] *************** { HARDWARE } *******
--------------------------------------------------------------------------

         __
        |  |   .-----.
        |  |_  |     |
        |____| |__|__|
 
         __     __           ___
        |  |_. |__| .-----. / __|
        |   _| |  | |  _  | \__ \
        |____| |__| |_____| |___/
                                              por ramseso
                                              <ramseso@yahoo.com>


Bueno, viendo que con esto de la navidad y tal, la gente esta un poco dormida
y con pocas ganas de escribir, yo me he decidido a hacerlo, asi que aqui
teneis, un pequeno articulo que pretende explicar que es la bios y como
funciona. Bueno, espero que os guste y os sirva. ;-)


1.- DEFINICION
==============

La Bios es el elemento encargado de establecer la conexion entre el hardware
y el software. Cuando se enciende el ordenador hay que establecer cuales son
los recursos disponibles y donde se encuentra el software del Sistema
Operativo. Estas funciones las realiza la Bios (Subrutinas basicas de
Entrada/Salida) a partir de cierta informacion que esta almacenada de forma
permanente en la placa base.

La Bios esta dividida en varios chips que se reparten entre los distintos
elementos hardware del ordenador:

# La Rom Bios es la Bios del sistema. Se trata de un chip que se encuentra en
  la placa base y que contiene un pequeno programa de arranque que chequea los
  recursos disponibles. Tambien contiene las rutinas de E/S que permiten al
  procesador comunicarse con el exterior mediante el mecanismo de las
  interrupciones.

# La Ram CMOS es la parte configurable de la BIOS. Contiene informacion basica
  sobre algunos recursos del sistema que son suceptibles de ser modificados
  como el disco duro, el tipo de disco flexible, etc. Esta informacion es
  almacenada en una RAM con tecnologia CMOS (bajo consumo) alimentada por una
  pila y que se encuentra en la placa base. [Nunca se os acabo una pila jeje]

# Rom de dispositivos. La mayoria de los dispositivos de E/S tienen su propia
  ROM para almacenar datos que necesitan para su correcto funcionamiento.
  Esta ROM suele estar includida en la tarjeta controladora del dispositivo.

# Zona de datos de la Bios. Toda la informacion de la BIOS no se almacena en
  la ROM sino que existe una zona de la RAM dedicada exclusivamente a guardar
  datos de la BIOS. Esta zona se encuentra en el segmento 40H de la memoria
  principal y cada byte tiene un significado especial segun aparece en la
  tabla siguiente, despues del siguiente parrafo. Cuando se arranca el
  sistema, la BIOS chequea el sistema y guarda la informacion obtenida en
  esta zona de la RAM para disponer de ella cuando sea preciso.

El contenido de la BIOS se ha estandarizado y el codigo ejecutable que
contiene es compatible en la mayoria de los fabricantes. Actualmente existen
dos grandes fabricantes de BIOS: AMI y Award. En ambos casos, cada BIOS tiene
una serie de caracteristicas que se deben conocer, como son: La fecha de
actualizacion, la identificacion de la BIOS, el tipo de placa base y
fabricante, el chipset que soporta, etc. Para obtener este tipo de informacion
podemos utilizar alguno de los programas comerciales existentes como CTBIOS.
Conocer este tipo de informacion puede ser importante si queremos conocer la
compatibilidad de nuestra placa base o las prestaciones que ofrece.

La rapidez con la que evolucionan los perifericos actuales hace que cada vez
se exija mas a la BIOS y hay que actualizarla cada cierto tiempo.
Afortunadamente dicen algunos, los fabricantes ofrecen la posibilidad de
actualizar la BIOS sin tener que cambiar de chip mediante un programa de
actualizacion que reescribe el codigo de la ROM (Awardflash, FlashAmiBios,
etc). Claro, claro, los fabricantes son muy listos, pues asi es como actua el
Chernobil, reescribiendo y jodiendo la ROM, para que luego digan.


 DESPLAZAMIENTO  |                     INFORMACION
-----------------|---------------------------------------------------------
10H (2 BYTES)    | Almacena las caracteristicas del equipo
13H (2 bytes)    | Tamano en Kb de la memoria convencional.
17H (2 bytes)    | Byte de estado del teclado.
1A H(2 bytes)    | Puntero al primer caracter del buffer de teclado.
1CH (2 bytes)    | Puntero al ultimo caracter del buffer de teclado.
4A (H2 bytes)    | Numero de columnas del modo de video activo.
50H (16 bytes)   | Un array de 8 palabras de 2 bytes que indican la fila
                 | (Byte mas significativo) y la columna (Byte menos
                 | significativo) del cursor en cada una de las 8 pagicas.
60H (2 bytes)    | Linea de comienzo (Byte mas significativo) y final (Menos
                 | significativo) del tamano del cursor.
62H              | Pagina de video activa
71H              | Indica si se ha pulsado la combinacion Ctrl-Break.
                 | (Se activa el bit mas significativo)
75H              | Numero de unidades fisicas de disco duro
84H              | Numero de filas de caracteres -1.
85H              | Altura de la matriz de caracteres de video expresada como
                 | el numero de lineas de barrido de cada matriz. Este numero
                 | es importante para definir el tamano y forma del cursor.
C0H              | Numero de dias desde el 1-1-80



2.- PROCESO DE ARRANQUE
=======================

Cuando se enciende el ordenador, la Bios realiza un diagnostico e inicializa
los componentes del sistema. Esta operacion se designa comunmente como POST
(Powr On Selft Test). Despues, el ordenador puede procesar el estado final
del boot y llamar al sistema operativo. Una secuencia tipica del POST incluye:

# Informacion basica acerca de la tarjeta de video, version de la BIOS de
video y memoria de video disponible.

# Version de la BIOS del sistema. Para AMI BIOS la identificacion de la Bios
tiene la siguiente estructura:

        ABBBNNNNMMDDYYX 


Donde A indica si es una bios con diagnostico (D) o con setup (S). El campo
BBB indica el tipo de chipset. NNNN se refiere al numero de referencia de la
BIOS. La fecha aparece en el formato Mes-Dia-Ano. El ultimo campo indica la
version de la BIOS del teclado (1,2, etc).

Para Award Bios, la nomenclatura utilizada es:

        XXXXXFFFF

Siendo XXXXX el chipset soportado. FF el fabricante de la placa (Q para QDI,
T para Teckram etc) y MM indica el modelo.

# La tercera etapa del POST consiste en un chequeo de la RAM del sistema.

# Por ultimo se llama al sistema Operativo.

Durante el proceso del POST se pueden detectar errores en la configuracion
del sistema. Los errores no fatales son aquellos que no impiden que la Bios
sigua diagnosticando el sistema y que posteriormente se carge el sistema
operativo (Por ejemplo, raton no detectado, no se encuentra disco duro, etc).
Los errores fatales son aquellos que detienen el proceso de diagnostico.
Usualmente, estos errores se comunican mediante una serie de beep y pueden
ser leidos en el puerto 80H. La identificacion de los beep es la que aparece
en la siguiente tabla.


BEEP |          SIGNIFICADO
 1   | Fallo en el refresco de memoria
 2   | Fallo en el circuito de paridad.
 3   | Fallo en la memoria base de 64KB.
 4   | Fallo en el temporizador del sistema.
 5   | Fallo en el procesador.
 6   | Fallo en el controlador del teclado.
 7   | Error en modo virtual.
 8   | Error en el test de memoria de video.
 9   | Fallo en el cheksum de la BIOS.


El codigo de la BIOS se localiza en la direccion FFFF:FFFE de la ROM. De esta
forma, cuando se conecta el ordenador, el puntero de instrucciones se situa
en esta direccion y comienza a ejecutarse el programa de diagnostico.


3.- RAM CMOS
============

La RAM CMOS es un chip controlado por un reloj en tiempo real que esta situado
en la placa base y tiene como funcion almacenar informacion sobre algunas
caracteristicas del sistema. Esta formado por una memoria RAM de 64 bytes con
tecnologia CMOS que debe estar alimentada constantemente, incluso cuando se
desconecta el ordenador. La informacion contenida en esta memoria es utilizada
en la etapa de POST para establecer el diagnostico del sistema.

La informacion contenida en la RAM CMOS la podemos agrupar en tres apartados.

# En primer lugar, los 10 bytes primeros guardan la informacion del reloj en
  tiempo real incluyendo la fecha y hora activa asi como la hora de la alarma.
  El mecanismo de alarma consiste en la posibilidad de ejecutar un determinado
  programa cuando el reloj del sistema alcanza la misma hora que la
  especificada en la alarma. Para activar la alarma hay que realizar tres
  procesos: En primer lugar hay que dejar residente en memoria el programa
  que queremos lanzar. En segundo lugar, apuntar el vector de interrupcion
  4AH a la direccion de comienzo del programa y en tercer lugar, conectar la
  alarma mediante la interrupcion 1AH (Funcion 6).

# Un segundo grupo de bytes contiene informacion sobre la configuracion del
  sistema como el tamano de la memoria convencional, tipo de disco, unidades
  de diskettes, etc.

# Por ultimo, existe un tercer grupo de 4 bytes (11-14) que contienen
  informacion de control.


Para acceder al contenido de la RAM CMOS se utilizan los puertos de
entrada/salida 70H y 71H. EL puerto 70H es un puerto de escritura en el que
se escribe el offset del valor de la memoria que se quiere utilizar. El puerto
71H es un puerto de lesctura/escritura que se utiliza para pasar el valor al
offset seleccionado en 70H. El contenido de algunos de los offset de la
memoria RAM CMOS vienen indicados en la siguiente tabla:

OFFSET(Hex) |      CONTENIDO
00          | Segundos de la hora activa.
01          | Segundos de la alarma.
02          | Minutos de la hora activa.
03          | Minutos de la alarma.
04          | Horas de la hora activa.
05          | Horas de la alarma
06          | Dia de la semana.
07          | Dia del mes.
08          | Mes actual.
09          | Ano actual.
10          | Tipo de las unidades de disco.
            | Bits 7-4 Unidad 1     Bits 3-0 unidad 2
            | 0= No hay; 1=360K, 2=1.2 Mb; 3= 720k; 4= 1.44Mb.
12          | Bios del disco duro. Bits 7-4 HD1 y bits 3-0 HD2.
            | (Si es FF buscar en el offset 19H para unidad1 y 1AH para la 2)
14          | Byte del equipo. Coincide con el de la zona de datos del BIOS.
15 (2 bytes)| Tamano en K de la memoria convencional.
17 /2 bytes)| Tamano en Kb de la memoria expandida.
2E          | Valor del checksum.
30          | Tamano en Kb de la memoria expandida libre

La informacion de la fecha y la hora aparece escrita en codigo BCD. Todos los
offset estan expresados en hexadecimal.

Desde un punto de vista practico, los valores mas interesantes corresponden
al tamano de la memoria y al tipo de unidades de disco del sistema. En el
caso de los discos duros, la CMOS RAM es el unico metodo para averiguar el
tipo de BIOS que soportan.


5.- EL TEMPORIZADOR DE BIOS
===========================

El metodo empleado por la BIOS para actualizar la hora es a traves del
temporizador. Se trata de un chip incluido en el chipset que emite una serie
de pulsos a intervalos regulares de tiempo. Cada vez que se emite un pulso,
se incrementa el contador de la BIOS y cuando se llega a una cantidad
especificada se aumenta el segundero de la RAM CMOS.

Estructuralmente esta formado por tres canales identicos. Cada canal dispone
de dos registros de 16 bits  el primero de los cuales es un latch que almacena
un valor constante (que puede ser cambiado mediante programacion) y el segundo
es un contador descendente. Los tres registros tienen una entrada que proviene
del reloj de la placa a una frecuencia constante de 1.193185 Hz. Este reloj
funciona como senal de control del contador de forma que a cada pulso se
decrementa su contenido. Cuando llega a cero se genera una salida en forma de
onda cuadrada. Cada uno de los tres canales tiene una funcion determinada:

# El canal_0 se utiliza para medir tiempo. El valor contenido en el latch es
  FFFFH de forma que emite un pulso cada 18,2 veces por segundo. Es utilizado
  por la BIOS para medir el tiempo. Se utiliza tambien para activar rutinas
  residentes en memoria.

# El canal_1 esta destinado al refresco de memoria generando las senales
  oportuna en los tiempos especificados. No es conveniente programarlo.

# El canal_2 esta conectado al altavoz de la placa de forma que, utilizando
  adecuadamente el contenido del latch, puede utilizarse para generar sonido.

Cada uno de los canales tiene un puerto de entrada (40H, 41H y 42H
respectivamente) que se utilizan para leer/escribir el contenido del latch.
Existe además un registro de control (43H) para establecer el modo de
programacion y el canal que vamos a utilizar.



Nota del Autor: Que cuando digo ano me refiero a eso que pasa cada vez que
                nos comemos las uvas, y no por donde las echamos ;-)



20/12/1999 por ramseso                       <ramseso@yahoo.com>

