			 __	 __      ___     _______
			/  /	|  |    /  /    |  ___  |
	********       /  /     |  |   /  /     | |   | |   ********
        ********      /  /___   |  |  /  /___   | |___| |   ********
		     /______/   |__| /______/   |_______|

	--·oO0	LINUX LOADER : "Una Herramienta Útil e Intersante;-))" 0Oo·--

	By Krip7iK



Jeje, al fin vais a saber lo ke es bueno (osea LINUX, no WINCHOWS), ya no
tendreis excusa para no utilizarlo!!!. Con este articulo solo pretendo
presentar cual es la potencia de LINUX, incluso en cosas ke pueden pasar tan
deapercibidas como el simple cargador del sistema. Este articulo va a hacer
las veces de ampliacion de lo ya explicado sobre la instalacion y manejo de
Linux por el amigo MORTIIS, y ademas se a¤adira algo de como aprovecharlo en
nuestra intencion de acceder a una makina a la que nos estan restringiendo el
acceso (pero eso al final... antes hacen falta unas nociones basicas!!).

Como he dicho comenzaremos con unas nociones muy basicas sobre lo que es LILO y
y como funciona, seguire con su configuracion y opciones, y terminare con
alguna aplicacion interesante ;)).

Comenzamos.... Como podeis leer en el titulo LILO se deriva de LInux LOader,
esto es Cargador de Linux. Muchos os preguntareis ¨¨y que cohones es ezo
pissa??, bueno, pues es simplemente el programa ke se encarga de hacer que el
Sistema Operativo ke keramos sea arrancado, se encarga de pasarle el control
del sistema a este. Si describimos por pasos, muy a grandes rasgos el arranque
de un computador podriamos dividirlo en los siguientes pasos:

        1) Inicializacion (se encarga la BIOS)

                1.1- Inicializacion de registros del microprocesador
		1.2- Checkeo del hard.
		1.3- Lectura de Master Boot Record`s (MBRs) en diferentes
		dispositivos: disco duro, disketera, CD-ROM (por orden
		especificado en la ROM BIOS).

        2) Ejecucion MBR.


El paso 2, es el ke nos interesa a nosotros, esto es, es en este paso donde
entran en juego los cargadores del Sistema, si bien, siendo rigurosos, estos
pueden estar no solo en el MBR, sino tambien en el sector de arranque de una
particion, como veremos mas adelante. Continuo... cuando se lee el MBR, se
comienza a ejecutar lo ke en el se encuentre, si es aki donde tenemos
instalado un cargador (por ejemplo LILO), este se ejecutara y mediante el
elegiremos ke Sistema Operativo deseamos arrancar, o simplemente pasara
directamente el control a un determinado sistema Operativo (lease, saltara a
la posicion de comienzo del S.O). Podriamos a¤adir que realmente lo que se
hace es pasar el control a la zona de arranque de la particion utilizada por
un sistema operativo concreto, de este modo podriamos tener un cargador en el
MBR, desde el cual al pasar el control a  una determinada particion produzca
el arranque de otro cargador en esta, posibilidad que LILO, con su
versatilidad de instalacion nos permite.

Bien, con esta somera explicacion (no muy rigurosa por cierto), espero ke ya
esteis en situacion de comprender la funcion de LILO, o al menos haber
entendido que es un cargador. LILO, presenta ciertas peculiaridades frente a
otros cargadores, el mas claro es ke es un cargador que permite seleccionar
distintos S.O. (no como los WINCHOFFS 95 o 98), es mas permite arrancar casi
cualquier S.O, o cualquiera me atreveria a decir, algo ke en principio no es
tan sencillo con otros cargadores como el de Win NT, o OS/2, aunque estos
tambien lo permiten; y la otra gran diferencia con la mayoria de los cargadores
existentes es su gran versatilidad y potencia en cuanto a opciones disponibles.

Una vez ya situados, pasemos a explicar la parte de configuracion de LILO que
a mi me toca, puesto que la primera configuracion suele realizarse desde el
programa de instalacion de LINUX, de lo cual ya se ha encargado MORTIIS. A
partir de aqui supondremos que tenemos nuestro LINUX instalado, funcionando,
tenemos privilegios de root (para poder editar ciertos archivos, mejor cierto
archivo), y sabemos editar archivos !!! (de esto espero ke se encarge MORTIIS,
si no, probad vi o joe, ke es mas sencillo).

Con estos requisitos cumplidos, vamos alla!!. La configuracion del LILO, no es
demasiado complicada, pero tampoco es algo para lelos, que se haga desde un
entorno grafico pinchando sobre iconitos (al menos yo no conozco ningun programa
de configuracion en entorno grafico para esto, ke seguro habra), de todos modos
a mi parecer seria malgastar ciclos de CPU, cuando todo esto se resume en
configurar un simple archivo: /etc/lilo.conf como ejemplo introductorio:



boot=/dev/hda
message=/boot/message
compact
default=linux
prompt
timeout=50
image=/boot/vmlinuz-2.0.35-2
	label=linux
	root=/dev/hda1
	read-only
	restricted
	password=mi_mega_passw0rd
other=/dev/hda3
	label=win
	alias=x
	single-key
	table=/dev/hda



	*Opciones generales:

Con este ejemplo en mente pasaremos a estudiar las posibilidades de LILO.
Haber como lo hago... bien, lo primero es lo primero, y en este caso decir al
LILO donde queremos que se instale, puesto que podemos hacer que se instale en
el MBR de un dispositivo (generalmente en el HD), o en el BOOT sector de una
particion. Como especificamos esto... bien sencillo, mediante el comando "boot=
dispositivo en cuestion", esto es, si queremos que el LILO sea instalado en el
MBR del hd primero, pondremos /dev/hda (como en el ejemplo), si lo queremos en
el 2º /dev/hdb, teniendo en cuenta que esa unidad debera estar contenida en el
arranke de la BIOS, de modo que pueda llegar a arrancarse!!. Si en cambio lo
que  deseamos es que LILO se instale en una particion de tal o cual unidad,
simplemente añadiremos a continuacion el nº de la particion donde deseemos
que se instale, por ejemplo, si queremos que se arranque cuando se lea el
master boot de la particion 2 del disco duro  primario, pondremos
boot=/dev/hda2. Esto ultimo nos puede ser util para que el cargador inicial del
sistema albergado en el MBR, sea otro, y cuando seleccionemos la opcion LINUX,
por ejemplo arranque el LILO, que a su vez nos permita elegir entre el arranque
de diferentes distribuciones, ejemplo que posiblemente ilustremos mas adelante.

Seguimos con una chorradita, pero que puede ser bastante util sobretodo si
nuestro sistema va a ser usado por mas gente... como el hermano pequeño.. o
quien sabe!!, se trata del "message=...." bien, aki es donde pondremos la
localizacion del archivo que queremos que aparezca en pantalla segun se
arranque el LILO, hay que tener en cuent que debe estar en texto puro y no
puede superar un longitud de 65535 bits, debido a limitaciones en el tamaño que
LILO puede ocupar. Junto a este comando otro importante es "prompt", que se
encarga de automaticamente presentarnos en pantalla el ...si.. el prompt ese de
LILO:, de no incluir este comando no apareceria el prompt a no ser que
presionaramos Shift, Ctrl o Alt.

Dejare algunos comandos para el final como "compact", con los que hare una
pequeña lista con breves descripciones ok?.

Entonces sigo... Si nos saltamos compact... encontramos "default=linux"; bien,
default nos sirve para indicar que se debe arrancar por defecto, en este caso
lo que LILO se encuentre con la etiqueta linux (como veremos adelante esta
etiqueta se corresponde con el arranque de ... si,si!! Linux!!) y "timeout", que
recibe como argumento el numero de decimas de segundo (50=5 seg.) que debe
esperar a recibir una opcion antes de arrancar la opcion por defecto.

Aunque no se vean, pues pueden ser omitidas tomando entonces unos valores por
defecto, hay otras dos opciones muy importantes:

"install="... cargador del sector de arranque, por defecto /boot/boot.b
"map="...fichero mapa, por omision usa /boot/map


---*A continuacion llegan las secciones de cada imagen:*---

Como se puede ver a simple vista, las imagenes de Linux se distinguen por ser
especificadas mediante "image= localizacion de la imagen"; mientras que el resto
son especificadas mediante "other= dispositivo donde se encuentra el otro
S.O."


	*Opciones para ambos tipos de imagenes:

Las mas comunes son "label=", utilizada para indicar la etiqueta por la que
sera identificado ese arranque, osea, lo que pondremos en el prompt para
arrancar el S.O. que referencie el comando image o other que antes
encontremos al subir de lineas.

El comando "alias=", no tiene mayar misterio... simplemente es un alias,
para el label (etiqueta que hayamos puesto a un determinado S.O., con lo
cual para arrancar un mismo sistema, podriamos hacerlo con distintas
palabras, simplemente añadiendolas como alias. Si tras el alias añadimos la
etiqueta "single-key", no habra ke pulsar enter tras pulsar la tecla
especificada en el alias. 

Tambien muy importante la etiqueta "table=", donde debemos indicar donde tiene
la tabla de particiones, lo que se debe pasar a dicho sistema operativo.

Recordar tambien, que si al arrancar simplemente pulsamos enter, o dejamos que
pase el timeout, se arrancara lo que se haya especificado en el default.

Con esto... quien me puede decir que habria que poner en el caso del sistema
al que pertenezca el lilo.conf que analizamos, para arrancar Linux??.... y
Winchoff???.... (Sol.:1)"linux" o simplemente pulsar enter;2)"win" o "x")


        *Opciones particulares de imagenes LINUX:

"image= "... Situacion de la imagen del kernel (ver el ejemplo como caso mas
frecuente; puede variar un poco el nombre del archivo, dependiendo del kernel)

"root= ".... Bien, aki es donde hay ke poner la direccion del dispositivo
donde se va a montar el directorio raiz del sistema linux.

"read-only" Indica ke se monte el sistema como solo lectura (en principio).

"restricted" Obliga a ke para pasar algun parametro al kernel haya ke indicar
un password... indicado en :

"passwd=" Er passwd. No demasiado efectivo, si pensamos que se guarda en el
archivo lilo.conf sin encriptar, aunque si nos borran este archivo o eliminan
esa linea del lilo.conf tras haber instalado el lilo... pues no hay nada que
hacer!!.

Lo de pasar parametros al kernel, es algo complicado de explicar, pero digamos
ke entre otras cosas nos permite seleccionar modos de arranque del sistema,
siendo un ejemplo bastante claro y tipico arrancar el linux en modo single
(generalmente cuando nos hemos cargado algo!!), lo que se haria añadiendo al
teclear la etiqueta del sistema linux (en nuestro caso linux), la opcion
kedando:

LILO: linux single

single==>para arrancar en modo monousuario.

Esto tambien se puede hacer incluyendo una etiqueta de la forma:
"append=" parametro a pasar al kernel en el archivo lilo.conf. Por ejemplo, se
podria poner algo como: append="hde=cdrom".


Mas Opciones en LILO:

Estoooo... me falta tiempo para acabar el articulo, y ya ke me parece algo
absurdo copiaros un listado ke podeis conseguir rapidamente los ke esteis
interesados, simplemente os indco donde conseguireis toda la informacion
suplementaria que necesiteis de un modo rapido y compacto, ... simple!!:

        man lilo (ke sorpresa eh??!!) o man lilo.conf (mas detallado).

Un ejemplo de alguna de estas opciones es el "compact", que veis en el archivo
ejemplo ke os he pegado por ahi arriba, este comando indica a LILO que debe
optimizar el tamaño del mapa que cree para ser arrancado, este mapa es el que
se instalara en el MBR (en nuestro caso).

Bien, creo ke dije ke iba a dar mas ejemplos, pero me parece que como ando
corto de tiempo..., lo dejo en vuestras manos!!, ya debeis estar en situacion
de crear vuestros propios Arranques personalizados  o no??

---->>> INSTALACIÓN; PARA QUE LOS CAMBIOS RULEN!!!

        Bien,bien... ya tengo el /etc/lilo.conf configurado, pero... como
hago yo ahora para que los cambios surtan efecto??, esto es.. como instalo
LILO, como lo copio al sector donde quiero que resida??... Pues muy simple,
solo hay que ejecutar el programa/comando de linux /sbin/lilo y ya esta!!,
tras ejecutarlo, nos devolvera las etiquetas de los sistemas que se podran
arrancar y nos indicara con un * cual se arranca por defecto, con esto
sabremos que ha sido instalado... simple no??. Pues ahora mas!!
 

	__PROBLEMAS/ERRORES__


Como ya he explicado al comienzo del articulo, este articulo, simplemente
pretende ayudar atodos los que llegan al mundo de Linux, a configurar en lo
posible su makina (en este caso el LILO), y si podemos... como veremos algo
mas adelante ver que cosas "interesantes" podemos hacer con lo que
aprendamos. Bien, en este afan por ayudar, incluyo este pequeño punto, que
en un momento determinado puede ayudarnos a comprender por que nuestro LILO,
no esta funcionando, y que con lo que sabemos y esta informacion podamos
resolver rapidamente el problema. Si bien, podremos encontrarnos con otros
muchos errores que aqui no tratare, pero a todo puede encontrarse una
respuesta y una solucion, bien buscando en los manuales de Linux, en la
informacion sobre linux en internet, o bien en cualquier red irc en los
canales dedicados a linux, como son #linux tanto en irc-hispano, como en
unionlatina (aunque este ultimo suele estar bastante vacio.. haber si nos
animamos eh gente!!!).

Entonces pasemos a describir estos errores. Lilo, debido a que tiene muy
limitado el espacio maximo que puede ocupar su codigo (limitacion que es la
que tambien afectaba a la longitud del mensaje que podia presentar LILO, y
cuyo origen es un tema que no me apetece abordar... aparte de que no soy
ningun experto en ello :)) ), bien, pues debido a esa limitacion en la
longitud de su codigo, cuando detecta un error, no nos puede dar un mensaje
detallado y descriptivo de lo que ha ocurrido, por lo cual hay algunos
errores bastante comunes que se indican mediante el truco que a continuacion
detallo. Este es el tipo de errores que solo voy a explicar, por ser los que
personalmente creo mas frecuentes, y por que ademas no se si Lilo por el
mismo nos indica de algun otro modo el que se ha cometido un error !!(creo
que si, pero estos errores que presento son los mas frecuentes).Bien, ...
como se las ingenia lilo, para con muy poco cogigo decirnos que hay un
error... simplemente, cuando lilo es arrancado este presenta en pantalla la
palabra LILO, pero... no siempre la presenta completa, no!!?, solo la
presenta completa, si no se ha cometido ningun error, y LILO ha sido cargado
y ejecutado satisfactoriamente; entonces, como ya podreis imaginar, lo que
hace LILO, para indicarnos uno u otro error, es parar esa impresion de
caracteres en uno u otro, de modo que nos podriamos encontrar con los
siguientes casos, que ahora detallo:

Si solo imprime:

 (NADA): LILO no ha sido instalado o no esta en la particion de arranque.

L : Seguramente debido a un error del disco de arranque o en la geometria del
disco.

LI : Fallo en la geometria del disco o mas seguramente que hayamos cambiado las
particiones sin reinstalar LILO (MUY TIPICO).

LIL : Posible fallo en la geometria o mas normalmente que hemos cambiado el
"kernel" del sistema sin volver a reinstalar LILO (A ver si reinstalamos LILO!!)

LILO : Everything Ok guy!!

Simplemente espero que esto os ayude a conseguir tener vuestro lilo
funcionando, y ahora leed a continuacion... quiza esto sea lo que mas os
guste...




--->>> UTILIDADES Interesantes!!!!:

Bien... esto es lo que muchos estariais esperando, me equivoco??, bueno, la
verdad es que si habeis leido con detenimiento todo lo anterior y pensais un
poco... muy poco quizas, os dareis cuenta del gran poder que tenemos si
controlamos el arranque de una maquina, mas aun si ademas del arranque en
esa maquina podemos controlar un sistema como Linux, que nos permitiria un
acceso a toda la informacion del sistema, si podemos configurar nuestro
Linux adecuadamente. Entonces... que buscamos??, controlar como root
(admin.) el sistema Linux que nos encontremos, no??, bien, para ello hay
multiples exploits y bugs que salen cada dia y al dia siguiente estan
parcheados, pero hay uno que es constante en el tiempo... si!!, y no es
culpa de Linux, no!!, se trata de... la ignorancia y/o descuido de los
administradores. Bien, eso es lo que nosotros trataremos de explotar. La
verdad es que de lo que voy a hablar no se puede tener demasiado control
como admin... pero bueno, siempre se puede hacer algo, aunque por otro lado
solo nos podra ser de utilidad en sistemas a los que tengamos un acceso al
arranque del sistema (generalmente acceso fisico), y que posean un sistema
linux, con su correspondiente LILO (si no hay LILO, pero si Linux... ya nos
las ingeniaremos... tranquilos!!).

Entonces comencemos con el tema!!. Como creo haber escrito por ahi arriba
(joder ke memoria tengo!!), a Linux le podemos pasar parametros al kernel
cuando arrancamos con LILO, como ejemplo esta el parametro "single", lo que hace
que nuestro linux se inicie en modo monousuario, y que dicho usuario tenga
privilegios de root a todos los efectos. Este modo de arranque sera el que a
nosotros nos resulte realmente atractivo ... o no??. Pero no todo es tan simple
como poner linux single en el prompt de LILO, puesto que si ke nos arrancara el
sistema con privilegios de root y sin pedir passwd, pero eso no quiere decir
que todo nuestro poder como root lo podamos comenzar a explotar en el mismo
momento de aparecer la shell... y eso??!?!. Eso se debe a ke (normalmente) el
sistema por defecto se arranca con privilegios de solo lectura para todos los
dispositivos de almacenamiento que se carguen (esto es los discos duros), con
lo cual... si podremos leer archivos y todo lo que queramos, pero no podremos
realizar cosas tan interesantes como instalar backdoors, troyanos, o crearnos
cuentas de root en dicha maquina. Que hacemos entonces??, muy simple, solo hay
que "remontar" el disco duro, algo que con un par de comandos queda solucionado:

bash# mount -n -o remount rw /
bash# mount /proc

Para mas ayuda ver el manual de mount simplemente usando:

#man mount

Bien, una vez hecho esto solo tendriamos que ir al archivo /etc/passwd y
añadir un usuario con UID 0, y sin passwd, ke sera el que luego nosotros
usemos como usuario con privilegios de root, esto se haria añadiendo una
linea tal que asi:

bash# echo thord::0:0:thord:/sbin:/bin/bash >> /etc/passwd

Nuestro nombre de usuario: thord
Passwd: Ninguna
UID: 0 == root!!!
GID: 0 == root!!!
Nombre real: thord (para ke parezca un daemon o algo asi!! (jeje!)
Directorio personal: /sbin (tambien para disimular)
Shell: bash por ejemplo no??, aki poned la ke mas os guste ksh, csh, sh ...

Esto seria lo mas rapido para luego poder usar como root el sistema con sus
plenas posibilidades, y entonces añadir las backdoors, o hacer lo ke
quisieramos. OJO!!, por ke luego deberiamos eliminar esa linea ke añadimos
en el /etc/passwd, asi como eliminar las otras huellas ke dejaramos (pero
este es otro tema, quiza para un proximo articulo... haber si alguien se
anima).

Asi visto, todo parece extremadamente sencillo, pero aquellos sistemas a los
que tengamos acceso no nos lo pondran tan facil generalmente. Como hemos
visto, se puede evitar que un usuario utilice la opcion single tan
facilmente, simplemente poniendo una clave para ello. Esta clave la
podriamos conseguir si pudieramos leer el archivo lilo.conf, ya ke no esta
encriptada. Esto ultimo se podria hacer de diversas maneras, una seria
consiguiendo privilegios para ello mediante algun otro bug o exploit, en
cuyo caso quiza todo esto ya no nos sirva para mucho; y el otro modo, seria
leyendo el sector desde el cual se arranca el LILO; esto se puede hacer con
programas que efectuen una lectura en modo raw del disco, y luego deberiamos
analizar lo leido hasta que encontraramos lo que buscamos (quiza demasiado
complicado no??).

No os preocupeis!!,... pensemos un poco, si no tenemos LILO, o no podemos
hallar la passwd del LILO, que podemos hacer??. Nos gustaria tener un LILO a
nuestra medida no??, bueno, pues creemos un LILO a nuestra medida y tratemos
de utilizarlo en la maquina que queremos. Crearemos ese LILO en un disquete
en nuestra makina (en casa vamos!!), del siguiente modo:

1)creamos el lilo.conf ke nos gustaria, pero le damos otro nombre 
ej./root/lilohack

2)lo instalamos en un disquete mediante lilo -C /root/lilohack

	Nota: el disquete puede estar incluso formateado en FAT

No se nos debe olvidar que en nuestro archivo lilohack debemos especificar que
queremos que se instale en /dev/fd0, y previamente deberemos saber donde esta
el root de al makina que deseamos hackear... pero esto suele ser facil por ke
el archivo fstab se puede ver.

	Ejemplo de archivo a usar:

boot=/dev/fd0
compact
default=linux
map=/boot/map (aki puede residir un fallo, si no nos coincide con la victima)
install=/boot/boot.b
prompt
timeout=50
image=/boot/vmlinuz-2.0.35-2 (informarse para usar el mismo que en la victima)
	label=linux
	alias=1
	single-key
        root=/dev/hda1 (direccion del root del la makina victima)
	read-only

3)Ya solo tenemos que usar nuestro disco para arrancar la makina victima y usar
la opcion single en el arranque como siempre!!!. 

4) No se os olvide despues de hacer lo que querais,dejar todo como estaba
antes... como ya sois root y podreis, ejecutar el comando lilo, para ke se
carge el lilo.conf ke habia en la makina antes... os evitareis posibles
problemas, ke kiza solo surgen cuando uno experimenta en casa... os puede
pasar como a mi (aun no se muy bien po ke??) ke al crear el disquete no grabe mi
lilo normal en mi MBR del disco duro... y un poco mas y no arranco, pero como
ya nos defendemos con LILO.... jeje!!

*) Pero no todo es tan bonito como lo pintan... bueno, lo pinto. Esto funciona
muy bien en nuestro propio ordenador, para arreglar nuestros problemitas, pero
a la hora de utilizarlo con otros ordenadores... bueno, lo mas normal es ke nos
de algun problema del tipo LIL o similares, por lo que para ke esto funciones
deberiamos conseguir mayor informacion como conseguirnos de algun modo el
archivo /boot/map o conseguir simular en nuestro ordenador la situacion del ke
keremos atacar, para crear un LILO que no nos de ningun problema; de todos
modos creo ke ya os he dado una base suficiente para que con esto, los manuales
del sistema y un poco de ingenio podais hacer grandes cosas.

*)Otra alternativa, seria simplemente crearnos un disco de sistema, desde el que
arranquemos, y si es de Linux mejor ke mejor, claro que esto ya es otra historia
y la verdad es que resulta algo obvio y cutre su utilidad y sus problemas no??.

Bien, pues con esto me despido, espero ke os sea de utilidad, y ke todo lo ke
consigais gracias a esto, no lo apliqueis con fines destructivos, sino
constructivos. Tambien redordar que todo lo que habeis podido leer en este
articulo es con FINES EDUCATIVOS EH!!.
