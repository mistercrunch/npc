.--[ @_2500Hz - Underground Scene - ]------------(http://pagina.de/2500Hz)--.
|                                                                           |
| Titulo : How to hacer Tunneling desde Win9x                               |
| Autor  : [CrAsH]]                                                         |
| Fecha  : 27/03/2000                                                       |
`-----------------------------------------------------(2500hz@mixmail.com)--´



 *-*-*-*-*-*-*-*-*-*
 * 1. Introducción *
 *-*-*-*-*-*-*-*-*-*

Bueno, el documento tan esperado desde hace meses Ni decir tengo que esta información sólo 
tiene própositos educativos, y no me responsabilizo del mal uso que le podais dar. 



 *-*-*-*-*-*-*-*-*-*-*-*-*
 *  2. Conceptualización *
 *-*-*-*-*-*-*-*-*-*-*-*-*

1. ¿ que es pptp? 
PPTP (Point-to-point tunneling protocol) es un protocolo de internet 
diseñado para proveer de la seguridad necesaria con la finalidad de crear y mantener 
una VPN sobre TCP/IP (TRansmision Control Protocol/Interface Protocol).
Es el protocolo para hacer un túnel que permite que se realicen 
las conexiones de Point-to-Point Protocol (PPP) a través de una red IP, creando 
una red privada virtual (VPN). 

2. ¿que es VPN? 
-AVPN Microsoft Virtual Private Networking Adapter Microsoft  
El principal propósito de las Redes Privadas Virtuales es el establecimiento de una 
conexión segura a una LAN ( Local Area Network) privada sobre una estandar no-segura 
conexión LAN o una conexión via internet.
pongamos un ejemplo, si tu estas trabajando en una oficina tu puedes acceder a la LAN de tu
oficina por medio de un 'tunel' del servidor VPN. una vez que te ha sconectado tu conexion 
es mas virtual que fisica, ya que no te encuentras fisicamente en la LAN de tu oficina, 
de ahi el termino VIRUTAL NETWORK.
HAy varias clases de redes VPN, pero la mas utilizada y la mas popupar es el PPTP, 
Microsoft fue uno de los primero es ofrecer este servicio como una parte del NT SERVER. 
EL adaptador de PPTP que ha crecido mas es el L2TP ( Layer 2 Tunneling Protocol)
 

3. Tunneling?¿?¿
El adaptador de red privada virtual de Microsoft permite a 
los PC conectarse a redes privadas a través de redes públicas como Internet. 
el pptp nos permite hacer tunneling una vez conectados a internet y obtener otra ip 
distinta a la que habiamos obtenido mediante la forma tradicional (llamando a un 
nodo de nuestro proveedor de inet) realmente
el pptp no es solo esto, y la explicacion que he puesto anteriormente es resumir al 
maximo el concepto de pptp, lo que teoricamente es mas util del pptp es la posibilidad 
de montar VPNs o lo que es lo mismo Redes Privadas Virtuales (Virtual Private Networks) 



 *-*-*-*-*-*-*-*-*-*-*-*-*-*-*
 *  3. COMO HACER TUNNELING  *
 *-*-*-*-*-*-*-*-*-*-*-*-*-*-*

3.1) CREAR EL ACCESO
Pongamos un ejemplo: supongamos que nos conectamos a través de teleline. Cuando nos 
conectamos a teleline lo que hacemos es  CASITA--> TELELINE -->ISP -->INTERNET
vemos los  diferentes estados que pasamos antes de entrar a internet: primero llamamos a 
nuestro nodo local alli entra en teleline, una vez alli el login y pass son mandados al 
netbuilder de su ISP o lo que es lo mismo una conexion TCP al puerto 1723 donde es 
comprobado el login y pass, si es correcto el ISP le tuneliza a internet es decir 
que realmente un usuario, primero de todo esta conectado a teleline, 
luego a su ISP y desde su ISP a internet.

procedimiento: vale nos vamos a inicio (esto parece Windows para tontos pero asi es mas 
claro xD): procesos:

--> panel de control 
--> SISTEMA-->
-->RED
-->configuracion
--> agregar
-->controlador
-->seleccionar adaptador de red (microsoft)
adaptadores de red (adaptador de red virtual privada de microsoft )  

y ya esta seguiis los pasos.. una vez instalado el adaptador y tras haber reiniciado os 
vais a control de acceso telefonico a redes: y os creais una conexion, la podeis llamar VPN
mismo, y procedeis a la instalacion de un nuevo acceso telefonico a redes: haceis doble 
click en realizar nueva conexion --> en en la opcion "modems" debereis seleccionar 
Adaptador de Microsoft para redes virtuales o Microsoft VPN adapter, lo poneis y nada 
seguis la instalacion, luego nos pedira que pongamos la IP del servidor de tunneles 
de nuestro ISP, pues nada lo ponemos y para finalizar el login y password.. 
pues hasta ahora el unico ISP que he visto que vaya bien es ENCOMIX, 
pues nada a pillarse unas cuantas cuentas y a probar :) pues nada ponemos 
login: 2500@encomix y password: 2300hz y ya esta creado nuestro acceso telefonico VPN :)


3.2)CONECTARNOS

Pues bien una vez creado nuestro acceso telefonico, conectamos con nuestra cuenta normal 
y corriente con la que utilizamos siempre.. por ejemplo una de teleline, una vez conectados
a inet ejecutamos nuestra conexion que habiamos llamado VPN yyyyyyyyy si tenemos suerte y
conectamos entraremos a internet y veremos como el iconito de conexión.. si... ese...
en el que aparece dos lucecitas verdes encendiendose y apagandose.. pues tendremos DOS 
iconitos de esos tan monos :P y entraremos a internet
con otra IP distinta a la que nos habia asignado nuestro proveedor inicial (en este ejemplo
teleline) :), asi conseguimos tener una ip de encomix :)


3.3) UTILIDADES

- Ante todo seguridad, por la encriptacion... aunque hace poco rompieron el logaritmo
que implemento microsoft... al parecer era bastante malo :)
- Las utilidades corre a la imaginacion de cada uno, podemos desde meter a saco clones
en el irc,  
-hasta volver a hacer tunneling de nuevo, para ir saltando y tal :) 
-Aquellos que conectan con 900s podran ocultar su verdadera ip que
resulta tan cantosa ( ipass o wcom...) así podremos conectarnos sin tener que usar wingates :)




 *-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
 * 4. ALGUNOS PROGRAMAS PARA HACER TUNNELING *
 *-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*

- TunnelBuilder ( company: NTS)
- TunnelMaster (NTS también) 



 *-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*
 * 5. Algunos datos interesantes *
 *-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*

  ----------------------
-= 5.1 -LIBRERIA DE VPN =-
 ------------------------

//==========================================================================;
//
//  Copyright (c) 1997	Microsoft Corporation.	All Rights Reserved.
//  Visual C++
//--------------------------------------------------------------------------;

#ifndef __IVPNotify__
#define __IVPNotify__

#ifdef __cplusplus
extern "C" {
#endif

/*
typedef struct _DDCOLORCONTROL
{
    DWORD 		dwSize;
    DWORD		dwFlags;
    LONG		lBrightness;
    LONG		lContrast;
    LONG		lHue;
    LONG 		lSaturation;
    LONG		lSharpness;
    LONG		lGamma;
    LONG		lEnable;
} DDCOLORCONTROL;
*/

// interface IVPBaseNotify
DECLARE_INTERFACE_(IVPBaseNotify, IUnknown)
{
public:
	// this function initializes the reconnection to the decoder. 
	STDMETHOD (RenegotiateVPParameters)(THIS_
					   ) PURE;

};

// interface IVPNotify
DECLARE_INTERFACE_(IVPNotify, IVPBaseNotify)
{
public:
    // function to set the mode (bob, weave etc)
    STDMETHOD (SetDeinterlaceMode)(THIS_ 
				   IN AMVP_MODE mode
				  ) PURE;

    // function to get the mode (bob, weave etc)
    STDMETHOD (GetDeinterlaceMode)(THIS_ 
				   OUT AMVP_MODE *pMode
				  ) PURE;


    /*
    // this function sets the overlay surface that the mixer is supposed to use.
    STDMETHOD (SetOverlaySurface)(THIS_ 
				  IN LPDIRECTDRAWSURFACE pOverlaySurface
				 ) PURE;

    // this function gets the overlay surface that the mixer is using
    STDMETHOD (GetOverlaySurface)(THIS_ 
				  OUT LPDIRECTDRAWSURFACE *ppOverlaySurface
				 ) PURE;

  // this functions sets the color-controls, if the chip supports it.
    STDMETHOD (SetColorControls)(THIS_ 
				 IN LPDDCOLORCONTROL pColorControl
				) PURE;

    // this functions also returns the capability of the hardware in the dwFlags
    // value of the struct.
    STDMETHOD (GetColorControls)(THIS_ 
				 OUT LPDDCOLORCONTROL *ppColorControl
				) PURE;
    */

};

// interface IVPVBINotify
DECLARE_INTERFACE_(IVPVBINotify, IVPBaseNotify)
{
public:
};

#ifdef __cplusplus
}
#endif


#endif // __IVPNotify__


    ---------------------------------------------
 -= 5.2 Datos generados en la transmision de pptp: =-
   ------------------------------------------------
; netpptp.inf
;
; INF for Point to Point Tunneling Protocol WAN Miniport Driver (NETPPTP.SYS)
;
; The NETPPTP driver is the "Virtual Private Networking Adapter"
;
; Copyright (c) 1997 Microsoft Corporation

[version]
CatalogFile=netpptp.cat
LayoutFile= Layout.inf, Layout1.inf, Layout2.inf
Signature="$CHICAGO$"
Class=Net
ClassGUID={4d36e972-e325-11ce-bfc1-08002be10318}
Provider=%V_MS%

[Manufacturer]
%V_MS%=PPTP

[PPTP]
%*PNP8386.DeviceDesc%=*PNP8386.ndi, *PNP8386 


;****************************************************************************
; PnP ID Adapter Specific Install Section
;****************************************************************************
[*PNP8386.ndi]
AddReg=*PNP8386.ndi.reg,PPTP.ndi.reg,PPTP.Gen.Params
DeviceID=*PNP8386
MaxInstance=1

[*PNP8386.ndi.reg]
HKR,Ndi,DeviceID,,"*PNP8386"  ; pnp id
HKR,Ndi,NetType,,1

;****************************************************************************
; Base Section
;****************************************************************************
[PPTP.ndi.reg]
HKR,,DevLoader,,*ndis
HKR,,DeviceVxDs,, netpptp.sys

; NDIS Info
HKR,NDIS,LogDriverName,,"pptp"
HKR,NDIS,MajorNdisVersion,HEX,03
HKR,NDIS,MinorNdisVersion,HEX,0A

; Interfaces
HKR,Ndi\Interfaces,DefUpper,,"ndiswan"
HKR,Ndi\Interfaces,DefLower,,"pptp"
HKR,Ndi\Interfaces,UpperRange,,"ndiswan"
HKR,Ndi\Interfaces,LowerRange,,"pptp"

; Required Components
HKR,Ndi\Compatibility,RequireAll,,"NDISWAN"

; Install sections
HKR,Ndi\Install,ndiswan,,"PPTP.ndiswan"

; Context help
HKR,Ndi,HelpText,,%PPTP_HELP%

; Uninstall sections
HKR,Ndi\Remove,ndiswan,,"PPTP.ndiswan.uninstall"

;****************************************************************************
; TAPI ISDN Configuration
;****************************************************************************
HKR,TAPI,ConfigFlags,1,00,00,00,00
HKR,TAPI,DeviceType,1,01,00,00,00
HKR,TAPI,DeviceCaps,1,14,00,00,00, 00,00,00,00, 02,00,00,00, 01,00,00,00, 01,00,00,00
HKR,TAPI\Line0,ConfigFlags,1,00,00,00,00
HKR,TAPI\Line0,LineCaps,1,1c,00,00,00, 00,00,00,00, 03,00,00,00, ff,00,00,00, 03,00,00,00, 
02,00,00,00, 02,00,00,00
HKR,TAPI\Line0,Properties,1,00,00,00,00, 00,00,00,00, 00,00,00,00
HKR,TAPI\Line0\Channel0,ConfigFlags,1,00,00,00,00
HKR,TAPI\Line0\Channel0,Properties,1,00,00,00,00, 00,00,00,00, 00,00,00,00
HKR,TAPI\Line0\Channel0,SPID,,""
HKR,TAPI\Line0\Channel0,Phone,,""
HKR,TAPI\Line0\Channel1,ConfigFlags,1,00,00,00,00
HKR,TAPI\Line0\Channel1,Properties,1,00,00,00,00, 00,00,00,00, 00,00,00,00
HKR,TAPI\Line0\Channel1,SPID,,""
HKR,TAPI\Line0\Channel1,Phone,,""


;****************************************************************************
; General Params
;****************************************************************************
[PPTP.Gen.Params]
; pptp constant values
HKR,,BoardType,,"Microsoft Virtual Private Networking Adapter"
HKR,,BoardName,,"Microsoft Virtual Private Networking Adapter"
HKR,,DeviceName,,"Microsoft VPN Adapter"
HKR,,ProviderInfo,,"Microsoft"
HKR,,DeviceType,,"PPTP"
HKR,,TunnelGreOverUdp,,0

;****************************************************************************
; Install Section
;****************************************************************************

; Install section for NDISWAN upper edge (only for WAN miniports)
[PPTP.ndiswan]
CopyFiles=PPTP.ndiswan.CopyFiles
AddReg=PPTP.Install

[PPTP.Install]
;****************************************************************************
; VPN Option Installed
;****************************************************************************
HKLM, SOFTWARE\Microsoft\Windows\CurrentVersion\Setup\OptionalComponents\VPN,Installed,,"1"


;****************************************************************************
; Uninstall Section
;****************************************************************************
[PPTP.ndiswan.uninstall]
AddReg=PPTP.Uninstall

[PPTP.Uninstall]
;****************************************************************************
; VPN Option Uninstalled
;****************************************************************************
HKLM, SOFTWARE\Microsoft\Windows\CurrentVersion\Setup\OptionalComponents\VPN,Installed,,"0"

;****************************************************************************
; CopyFiles Section
;****************************************************************************
[PPTP.ndiswan.CopyFiles]
netpptp.sys,,,32       ; 32 = no version conflict when target is newer


;****************************************************************************
; Destination Directories
;****************************************************************************
[DestinationDirs]
PPTP.ndiswan.CopyFiles  =11 ; System Directory

;****************************************************************************
; Localizable Strings
;****************************************************************************
[strings]
; Provider & Manufacturers
V_MS = "Microsoft"

; Device Descriptions 
*PNP8386.DeviceDesc = "Adaptador de red privada virtual de Microsoft"

; Context Help
PPTP_HELP = "El adaptador de red privada virtual de Microsoft permite a su PC 
conectarse a redes privadas a través de redes públicas como Internet."


--  [CrAsH]]  -- - -- - -- - -- - -- - -- - --   @_2500Hz - Underground Scene -
- -- - -- - -- - -- - -- - -- - -- - -- - -- - -- - -- - -- - -- - -- - -- - --
