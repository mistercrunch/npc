.------------------.
| CatHack #007 - 8 |
| 07x08 - Linux MS |
| lectures varies. |
`------------------'

////////////////////////////      /////////////////////////////////
&&                        &&      &&                             &&
&& LINUX MAXIMA SEGURETAT &&======&& Pancake es posa a llegir ;) &&
&&                        &&      &&                             &&
////////////////////////////      /////////////////////////////////


M'he decidit a escriure aquest article amb l'esperança que la gent s'animi
a llegir llibre sobre seguretat informatica i els comenti, en aquest cas,
us explicare per sobre el llibre "Linux Maxima Seguridad", un totxo de 800
planes i un CD de 300mb amb programes con proxys, el trinux i alguns
escaners com l'nmap. Pero en quant a hacking poca cosa hi ha en el CD. Mes
que res s'hi acumulen versions de programes i dimonis per millorar la
seguretat en un sistema linux.

Ara, el contingut del llibre, podriem separar-lo en dues parts ben
clares...1) La palla 2) L'interessant, la palla, com el seu nom indica, es
lo que sobra del llibre, son unes 200 planes on t'explica que es un
ordinador, que es una persona quan se senta davant d'un dels anteriorment
nombrats, i t'explica la seguretat que s'ha de pendre (inclinacio del cap, i
tecniques per evitar el cansanci de la vista) - (NO VA EN CONYA).

Per cert, no penso aprofondir en els temes, ja que sino estaria violant els
drets d'autor del llibre, aixi, i com que passem de mals rollos burocratics,
si us interessa el tema o el llibre, us el compreu o aprofondiu en ell.

La segona part, comença explicant el de sempre, l'administracio d'usuaris i
grups en que treballa Linux. Amb algunes petites novetats, com per exemple
ens parla del programa "vipw", que serveix per editar els usuaris del
sistema.

Tambe ens parla del programa "sudo" que serveix per permetre a usuaris
normals executar comandes d'administrador, (amb el permis d'aquest), el
fitxer de configuracio d'aquest es a: "/etc/sudoers".

Un dubte força torracollons es el que sens planteja quan treballem amb
SHADOW passwords, ja que si modifiquem el /etc/passwd tb cal modificar el
/etc/shadow o sigui que la caguem segur i el sistema es que bloquejat de per
vida. Llavors, que cal fer per treballar amb aquests llistats de passwords?
Doncs treballar amb els programes: "useradd", "userdel", "usermod", i per
comprovar els passwords caldra fer "pwck" (ens parla de la caducacio de
contes), aixo es pot modificar amb el programa "chage", i per acabar, ens
parla del mateix d'administrar usuaris, pero amb grups: "groupadd",
"groupdel", "groupmod".

Pero si el que volem es treure o posar el shadow en el nostre sistema, ho
podem fer amb les comandes "pwconv" i "pwunconv".

Cal anar en compte amb els SUID exploits, o sigui programes que tenen el
SUIDBIT i son propietaris del root, (es poden buscar fent "find / -perm
+4000" ). I ens parla del tipic fallo que primer el va patir el "ping" i ara
li toca patir-lo el "rlogin" allo tipic del

"export=RESOLV_HOST_CONF=/etc/shadow"
"rlogin /etc/shadow"

I llavors podem llegir el fitxer de passwords.

Ens parla de troyanos i demes, i del comando "sum", que serveix per
comprovar la integritat dels directoris, pero clar, cal primer fer-ho abans
de comprovar-ho :), per poder comprovar "l'abans" i el "despres".

Arribem a l'apartat d'sniffers, tant de terminal com de tcp, jo nomes penso
donar-vos algunes urls on trobar programetes interessants:

linsniffer ( esnifa l/p )
         http://agape.tridiliun.org/hack/network-sniffers/linsniffer
linux-sniffer ( igual que l'anterior pero mes complert, donant IPs )
         http://www.ryanspc.com/sniffers/linux_sniffer.c
HUNT ( no cal comentar-lo crec, tb serveix per hijacking i spoffing )
         http://www.cri.cz/kra/index.html
Sniffit ( esnifa tot i informa amb diagnostics de paquets )
         http://reptile.rug.ac.be/~coder/sniffit/sniffit.html
TTYsnoop ( esnifa una terminal tty ) - disponible en la debian...i d'altres.

Per detectar-los tenim diversos programes, primer el "ifconfig", pero aquest
ens pot portar problemes, ja que pot haver estat modificat per evitar
veure-ho. o sigui que podem potar pel "ifstatus" o el mitic "neped" dels
Apostols. que ens permet comprovar-ho remotament. Per altre banda, crec jo
que hauria de parlar del "promisc.c", ja que es simple i funciona sense
problemes.

Ara arribem a la tipica seccio de scanners de seguretat, programes que
chequejen sistemes, local o remotament en busca de posibles fallos de
seguretat. Aquests son:

COPS 
    http://metalab.unc.edu/pub/Linux/system/security/cops_104_linux.tgz
ISS
    http://www.atomicfrog.com/archives/exploits/crack-scan/iss.tar.gz
    http://iss.net
SATAN
    http://www.fish.com/satan
SAINT
    http://www.wwdsi.com/saint
NESSUS
    http://www.nessus.org
NMAP (escaner de ports)
    http://www.insecure.org/nmap
CGI-SCAN (jo prefereixo el whisker)
    http://www.hackersclub.com/km/files/c_scripts/cgichk-11b.c
DNS-WALK
    http://www.cis.ohio-state.edu/~barr/dnswalk/
EXSCAN
    http://exscan.netpedia.net/exscan.html
IDENTTCPSCAN (ens informa el UID dels dimonis cargats en un sistema)
    http://www.giga.or.at/pub/hacker/unix/identTCPscan.c.gz
JAKAL (salta firewalls)
    http://bob.urs2.net/computer_security/152cscripts/jakal.c
MDMRST (jo ho diu el nom MoDeM ReSeT)
    http://www.sekurity-net.com/newfiles/mdmrst.c
PROXY PORTSCAN
    http://www.sekurity-net.com/newfiles/ppscan.c
RHOSTS_DODGY
    http://gopher.metronet.com/70/0/perlinfo/scripts/admin/rhosts.dodgy.pl
TROJAN.PL (comprova la instal.lacio de troyanos)
    ftp://coast.cs.purdue.edu/pub/tools/unix/trojan/trojan.pl
SLOSCAN (portscan amb spoofing)
    http://www2.merton.ox.ac.uk/~security/bugtraq_199902/0173.html
SPOOFSCAN (sense comentaris)
    http://24.92.91.91/Members/pRocon/exploits/spoofscan.txt
XSCAN (busca clients X vulnerables)
    http://www.jabukie.com/unix_sousez/xscan.tar.gz

Per borrar els logs en un sistema podem utilitzar diversos programes com:
invisible.c, stealth.c, unwho.c, wtmp.c, marryv11.c.

Pagines on podem trobar exploits...

* www.psychicfriend.net/~cyber/_linux/convfontExp
* www.geek-girl.com/bugtraq/19972/0245.htm
* www.hoobie.net/security/exploits/hacking/intrudert.c
* samarac.hfactorx.org/Exploits/
* www.cry4dawn.com
* www.sekurity-net.com/exploits/

Si volem modificar el codi font (cf) del kernel de linux, podem trobar-lo a
"http://lxr.linux.no", aqui podrem seguir el cf mitjançant hipervincles, i
podrem arribar al que volem de manera rapida.

Un altre apartat força interessant es el que tracta dels buffers overflows,
i la manera de prevenir-los quan programem les nostres aplicacions, i ens
avisa que anem amb compte quan cridem a les funcions SYSTEM(); (es pot
utilitzar la barra vertical!!!), la funcio popen(); i la open();

Podem trobar un programa d'atac de password a traves de web a la direccio:
http://sunshine.sunshine.ro/FUN/New/hacking/brute_web.c

Spoofing:
=========
Potser aquest es l'apartat mes interessant de tot el llibre, ens ajuda a
entendre el que es aquesta tecnica, les maneres d'aprofitar-lo i de
detectar-lo.
                                  >---<

Per ultim us recordo que fotocopiar llibres es ilegal i que aquest text es
un simple comentari d'ell, si realment us interessa el tema us el compreu i
el llegiu perque val la pena (pel cap, no per la butxaca) pq val 8000
cuques. (uns 48 euros ;)

Em sap greu donar tanta informacio important de manera tant poc elaborada i
explicada, pero bueno, el que us he dit, compreu el llibre, o investigueu
pel vostre compte...que no us ho hem de donar tot mastegat :)

Doncs bé, quan es realitza una conexió: es realitza un esquema semblant
a aixo:

       .-.       SEQ       .-.
(1)   ( A )-------------> ( B )
       `-'                 `-'

       .-.       ACK       .-.
(2)   ( A ) <------------ ( B )
       `-' <-------------- `-'
                SEQ+1

       .-.       ACK+1     .-.
(3)   ( A ) ------------> ( B )
       `-'                 `-'

Es fa en tres parts:
--------------------

(1), envia un paquet demanant la conexió amb un nombre anomenat SEQ.

(2), la màquina respon el paquet reenviant a la direcció A, el nombre
     SEQ+1 i un altre nombre de seguretat anomenat ACK (generat per B)

(3), un cop realitzat aixo, només falta que A envii a B el paquet ACK
     sumant-li 1 en el seu valor.

-> Logicament si en algun dels pasos es respon un nombre no correcte,
   la conexió no es realitzarà.

L'spoofing intenta "endevinar" quin és el nombre ACK del servidor,
actualment, és força dificil poder endevinar-ho, ja que s'ha mirat molt,
pero al principi es veu que l'NT contestava els paquets fent ACK=SEQ+500.
I logicament era un pitorreu, i poder punxat conexions era bastant facil,
llavors només queda endevinar el port d'origen, el port de destí, i les
marques (que no son gaire utilitzades-només pel queso).

Podeu trobar força info i programes a:

MENDAX:
    http://esperosun.chungnam.ac.kr/~jmkim/hacking/1997/11/mendaxlinux.tgz

EINES:
   SPOOFIT.H
         www.firosoft.com/security/philez/utilities/iptools/spoofit.h
   SEQ_NUMBER.C
         http://sunshine.sunshine.ro/Fun/New/hacking/seq_number.c
   IPSPOOF
         http://www.ryanspc.com/spoof/ipspoof.c
   1644 (includes)
         www.insecure.org/sploits/ttcp.spoofing.problem.html

ARP SPOOFING:
   Per poder veure la direcció ARP d'una ethernet podem fer-ho aixi:
      arp -a victima.com
      arp -f /etc/ethers (per fer-ho pero amb una llista)
      arpwatch (Comprova automaticament).
   D'aquesta manera podem evitar atacs d'arp spoofing.

DNS SPOOFING:
   Emular ser un servidor DNS per donar IPs falses i poder punxar
   conexions per exemple a través d'un bouncer. És en teoria força
   facil de fer, aixo, encara que hem de conseguir poder en un
   servidor DNS i poder fer aixo.

   Podem trobar diversos programes:

   JIZZ: bob.urs2.net/computer_security/152cscripts/jizz.c
   ERECT: www.geocities.com/SilliconValley/Peaks/7837/explo/any-erec.txt
   SNOOF: www.c0p.org/security/feb/snoof.tgz

   Per evitar-ho podem trobar informació a:

   http://coast.cs.purdue.edu/pub/tools/unix/doc.2.0.tar.Z


SSH:
----

Una shell segura, aquesta és la principal funció de ssh, fer una xel ;)
accesible només pel root (en principi), mitjançant encriptació, podem
trobar-nos amb diversos fitxers de configuració, entre ells destaco:

  /etc/sshd_config

  /etc/ssh_host_key

Per moure fitxers a través de ssh, podem fer-ho amb els programes que
ens donen: Quan haguem de dirigir-nos a un origen o desti de servidor
ssh haurem de fer-ho aixi:  user@host:file

scp [origen] [desti]

I per administar les claus tenim diversos programes:

ssh-add : Ficar noves claus

ssh-agent : utilitzar claus RSA

ssh-keygen : generar claus RSA



FTP-BOUNCE:
-----------

Una tecnica molt interessant, ja que ens permet fer escanejos de ports
de forma anonima a través de servidors FTP, a més també ens serveix per
poder realitzar conexions i executar ordres a maquines remotes mitjançant
un condó, d'aquesta manera per exemple una maquina ftp pot enviar un
email.

Podeu trobar informació a les direccions:

www.hobbe.net/security/exploits/hacking/ftp-scan.c

hackerlink.or.id/files/exploits/apps/ftp/ftpBounceAttack.txt

<popnote>
Quan tingui temps prepararé un article sobre aquest tema...
</popnote>



SENDMAIL:
---------
Ens parla més que res d'alguns tipics fallos:

8.9.1 -> fallo en MIME
< 8.9 -> escriure un HELO d'1KB de tamany per 
8.8.4 -> dead.letter (/var/tmp/)
8.9.2 -> utilitzar el "against.c"

Sempre podem conseguir dades sobre els usuaris del servidor utilitzant
les comandes (sovint bloquejades) EXPN i VRFY.
per exemple:
  VRFY username
    ok....


RBL: Realtime-Blackhole list
----------------------------
Qui no ha estat mai fitxat per aquesta llista negra que et prohibeix
enviar emails???? doncs jo si :D i orgullós que n'estic.

Doncs bé probeu:

nslookup
   server: vector.columbus.rr.com
   add: 204.210.252.252
    -> set querytype=txt
    -> 4.3.2.1.rbl.maps.vix.com
          |         |
          |         `---- url de RBL
          |
          `------ IP inversa

si no us agrada teclejar tant sempre podeu visitar la pagina
   www.xnet.com/~emarshal/rblcheck
per tal de comprobar si hi esteu o no en la llista.

Si voleu configurar el vostre sendmail pq tingui aquesta
caracteristica ho heu de fer amb la linea:

  FEATURE(RBL)

dins de /etc/sendmail.conf

........

Doncs poca cosa més ens queda per comentar...que es un llibre molt
bonic, acompanyat d'un CD amb utilitats GPL (de codi obert), i us
deixo amb una petita llista de programes curiosos per si voleu
investigar per la vostra conta.

DANTE: socks proxy.
ICMPINFO: per controlar les dades ICMP.
IdentTCPscan: Scaner que ens dona l'UID dels serveis.
SocketScript: Conjunt de petits programes que ens faciliten la
    programació amb script inplementant comandes per treballar
    amb sockets...
    -> http://dev-planet.fastethernet.net/sscript.html <-
IPGRAB, IPPL, IPTRAF - monitors de xarxa.
RABBIT: accelerador de web.
NETBOOT: permet l'arranc desde ethernet.
LINUXROUTER (ODL): www.linuxrouter.org (eh brain!! :)


No se si seré capaç d'escriure tot el que ve a continuació...argh!!

Llistes de correu:
==================
  8lgm-list-request@8lgm.org
  bugtraq@netspace.org
  linux-alert-request@redhat.com
  majordomo@uow.edu.au (detecció d'intrusos)
  listserv@listserv.ntbugtraq.co

Noticies: NNTP
==============
  comp.os.linux.development.apps
  comp.os.linux.hardware
  comp.os.linux.networking
  comp.security.unix

Programacio:
============
  UNIX Security:
        www.shitefang.com/sup/secure-faq.html
  HowTo Find Security Holes:
        www.dnaco.net/~kragen/security-holes.html
  Buf Overflows:
        l0pht.com/advisories/bufero.html
  Smash the stack:
        reality.sgi.com/nate/machines/security/stack.nfo.txt
  CGI-Security:
        www.csclub.uwaterloo.ca/u/mlvanbie/cgisec/
  Comprova CGI-SEC:
        language.perl.com/news/latro-announce.html
  Linux Programming Guide:
        rlz.net.mediaone.net/usr/doc/LDP/lpg/lpg.html
  SOCKS:
        www.socks.nec.com/introduction.html


Exploits:
=========
  Apache: www.apache.org/info/known_bugs.html
  PacketStorm: www.genocide2600.com/~tattooman/main.shtml
  Xwindows_holes:
          ciac.llnl.gov/ciac/documents/CIAC-2316_securing_X_Windows.pdf
  Altres: www.fish.com/survey

Seguretat:
==========
  UNIX GURU UNIVERSE: www.ugu.com
  www.geek-girl.com/unix.html
  www.cert.org
  www.phrack.com
  www.hack-net.com/texts/2600FAQ.txt
  www.hideaway.net/linux.html (Linux&ODL)
  geekgirl.com/bugtraq
  IPv6: www.cs-ipv6.lancs.ac.uk/ipv6/systems/linux/faq/linux-ipv6-faq.html
  Socket FAQ: kipper.york.ac.uk/~vic/sock-faq/
  WordList:
      sdg.ncsa.uiuc.edu/~maq/Misc/WordLists.html
      ftp://coast.cs.purdue.edu/pub/dict/wordlists/
  RFC: info.internet.isi.edu:80/in-notes/rfc/files/
  

<popnote>
No he pogut probar totes les urls que us he donat, o sigui que potser
només funcionen un 10% de totes...sorry...m'he limitat a interpretar
el llibre.
</popnote>


                                        > El pasat es troba en el futur <
                                                              Pancake

                                            __.----(ºoº)---.__
                                            ___.---'   `---.__