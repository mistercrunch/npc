.------------------.
| CatHack #007 - 7 |
| 07x05 - registre |
| hack / windows   |
`------------------'


            PROTEGINT I DESPROTEGINT WINDOWS A TRAVES DEL REGISTRE

                           per Alex Castan Salinas
                              alex.castan@upc.es



Hola xiquets i xiquetes.

Si, ja se que el titol us fa gracia. "Seguretat a Windows? D'enca quan?" :)

Amb aquest article l'unic que pretenc es fer una petita introduccio al
registre de Windows i enumerar dos o tres trucs curiosos que poden servir per
protegir i desprotegir un sistema amb sistema operatiu Windows. Aquests trucs
son molt basics i nomes serveixen per parar els peus a gent sense cap mena de
coneixement informatic ni curiositat per aprendre. Hi han mil i una maneres de
saltar-se'ls (ho deixo a la vostre imaginacio).



EL REGISTRE DE WINDOWS
----------------------

A les primeres versions de Windows (3.x i anteriors) la configuracio del
hardware, del sistema operatiu i dels diferents programes es guardava a arxius
individuals amb extensio .INI. A les seguents versions de Windows (9x i NT)
s'utilitza una base de dades unificada i centralitzada, anomenada el registre
de configuracio, per guardar de forma jerarquica tota aquesta informacio. Com
a avantatges mes basics d'aquest nou sistema tenim:

 * La informacio configuracio esta centralitzada, enlloc d'en multiples
   fitxers localitzats per tot el disc.

 * Permet accedir local o remotament a aquesta informacio, tot aplicant unes
   normes de seguretat d'acces.

 * En sistemes multiusuari (NT) permet registrar informacio dels usuaris
   individuals.

Encara i aixi, els fitxers .INI continuen existint per mantenir la
compatibilitat amb les aplicacions de 16 bits.

Una imatge val mes que mil paraules, aixi que fem una ullada al registre
mitjancant una eina que proporciona el mateix sistema: l'editor del registre.
Aquesta eina apareixera quan escrivim 'regedit' o 'regedit32' a la linia de
comandes de Windows (Menu Inici -> Executar -> Regedit). Com veiem, la
informacio esta estructurada en forma d'arbre, com si de l'explorador de
Windows es tractes. Dins de cada carpeta (claus) ens podem trobar noves
carpetes (subclaus) o be valors amb les seves dades corresponents. Aquestes
dades poden ser de tipus binari, enters de quatre bytes, variables i text. Amb
l'editor del registre podem crear i esborrar claus, crear i esborrar valors,
modificar dades associades a valors i realitzar cerques dins el registre. Ha
de quedar clar, pero, que sempre que realitzem canvis al registre hem de
'refrescar-lo' prement la tecla F5 per tal que aquests canvis tinguin lloc. Si
aixo no funciona, haurem de reiniciar el sistema.

Una altre manera que tenim de modificar el registre es afegir la informacio a
un fitxer de text amb extensio .REG, que s'executara en fer doble clic sobre
ell o mitjancant la instruccio 'regedit /s fitxer.reg'. Aquesta ultima manera
es especialment interessant de cara a afegir la informacio automaticament cada
cop que es reinicii la maquina.

El fitxer .reg ha de tenir la seguent estructura:

+--------------------------+
| REGEDIT4                 |
|                          |
| ; comentari              |    -+
| [Aqui el nom d'una clau] |     |
| "valor"="dada"           |     +-> Aquestes linies es van repetint
| "valor"="dada"           |     | 
| ...                      |    -+
+--------------------------+



EL REGISTRE A WINDOWS NT 
------------------------

El registre a Windows NT esta format per cinc arbres principals:

 * HKEY_LOCAL_MACHINE. Conte la informacio del sistema de l'equip local, tant
   a nivell software com a nivell hardware: controladors de dispositius
   instal.lats i serveis del sistema (subarbre SYSTEM), hardware instal.lat
   (subarbre HARDWARE), software instal.lat (subarbre SOFTWARE), base de dades
   del sistema de seguretat (subarbre SECURITY) i comptes de grups i usuaris
   locals (subarbre SAM).

 * HKEY_CLASSES_ROOT. Conte l'associacio entre fitxers i objectes OLE. En
   realitat es un apuntador a l'arbre HKEY_LOCAL_MACHINE\Software\Classes.

 * HKEY_USERS. Conte dades de l'entorn de l'usuari actualment identificat a la
   maquina i de l'usuari per defecte, pero no dels usuaris que han accedit
   remotament a la maquina. Hi han dades per defecte (subarbre DEFAULT) i
   dades associades a identificadors d'usuaris (subarbres SID).

 * HKEY_CURRENT_USER. Conte dades de l'entorn de l'usuari actualment en sessio
   a la maquina. En realitat es un apuntador a l'arbre HKEY_USERS\SID_usuari.

 * HKEY_CURRENT_CONFIG. Conte la informacio de la configuracio actual del
   hardware. En realitat es un apuntador o drecera a l'arbre
   HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Hardware\Profiles\Current.

La informacio d'aquests arbres es guarda als fitxers dels directoris
c:\winnt\system32\config i c:\winnt\profiles\nom_usuari, o alla on s'hagi
instal.lat Windows NT (%systemroot%).



EL REGISTRE A WINDOWS 9x
------------------------

El registre a Windows 9x esta format per sis arbres principals:

 * HKEY_LOCAL_MACHINE. Conte la informacio del sistema de l'equip local, tant
   a nivell software com a nivell hardware: dades de diferents configuracions
   de hardware (subarbre CONFIG), dades dels dispositius instal.lats (subarbre
   ENUM), controladors de dispositius instal.lats i serveis del sistema
   (subarbre SYSTEM), dades del microprocessador i ports serie (subarbre
   HARDWARE), software instal.lat (subarbre SOFTWARE), dades de xarxa
   (subarbre NETWORK) i dades de seguretat de xarxa (subarbre SECURITY).

 * HKEY_CLASSES_ROOT. Conte l'associacio entre fitxers i objectes OLE. En
   realitat es un apuntador a l'arbre HKEY_LOCAL_MACHINE\Software\Classes.

 * HKEY_USERS. Conte dades de l'entorn dels usuaris de la maquina. Hi han
   dades de l'usuari per defecte (subarbre .DEFAULT) i preferencies associades
   a cada usuari (un subarbre per a cada usuari). Dins aquests subarbres
   d'usuari trobem els fitxers de so associats a esdeveniments (subarbre
   APPEVENT), dades del pannell de control (subarbre CONTROL PANEL), la
   disposicio del teclat (subarbre KEYBOARD LAYOUT), accessos a xarxa
   (subarbre NETWORK), informacio d'acces remot (subarbre REMOTE ACCESS) i les
   preferencies de cada programa (subarbre SOFTWARE).

 * HKEY_CURRENT_USER. Conte dades de l'entorn de l'usuari actualment en sessio
   a la maquina. En realitat es un apuntador a l'arbre HKEY_USERS\.Default o
   HKEY_USERS\Clau_usuari.

 * HKEY_CURRENT_CONFIG. Conte la informacio de la configuracio actual del
   hardware. En realitat es un apuntador a l'arbre HKEY_LOCAL_MACHINE\Config.

 * HKEY_DYN_DATA. Conte part d'informacio del registre que, degut a que
   aquesta canvia frequentment, es mante a memoria en lloc del disc dur
   (cache). Per exemple: els codis de problemes de hardware (subarbre CONFIG
   MANAGER) i dades de rendiment del sistema i la xarxa (subarbre PERFSTATS).

La informacio d'aquests arbres es guarda als fitxers c:\windows\user.dat i
c:\windows\system.dat, o alla on s'hagi instal.lat Windows (%windir%).



MODIFICANT EL REGISTRE
----------------------

Als seguents apartats veurem algunes modificacions que podem fer al registre
de Windows per tal de protegir o desprotegir el sistema. Les he posat en un
format tal que sigui senzill incloure-les en un fitxer .REG mitjancant copiar
i enganxar.



PROTEGINT/DESPROTEGINT WINDOWS NT A TRAVES DEL REGISTRE
-------------------------------------------------------

REGEDIT4

; NT: Inhabilitar l'acces remot al registre.
; [HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\SecurePipeServers]
; Seleccionar la clau "winreg", obrir 'Permissos' al menu de Seguretat i
; establir control total pels administradors i res pels altres.

; NT: Treure els subsitemes POSIX i OS2.
; [HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Session Manager\Subsystems]
; Esborrar les entrades per "OS2" i "POSIX"

; NT: Inhabilitar l'execucio de trojans a traves del registre.
; [HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion]
; Seleccionar "Run", "RunOnce", "Uninstall" i "AEDEBUG".
; Obrir 'Permisos' al menu de Seguretat i establir lectura per tothom.

; NT: Permetre compartir recursos nomes a administradors.
; [HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\LanmanServer\Shares]
; Seleccionar "Shares" i les seves subclaus, obrir 'Permisos' al menu de
; Seguretat, establir control total pels administradors i lectura pels altres.

; NT: Permetre instal.lar impressores nomes a administradors.
[HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Print\Providers\Lanman Print Services\Servers]
"AddPrinterDrivers"=dword:00000001

; NT: Inhabilitar compartir automaticament ADMIN$, C$, D$, etc.
[HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\LanmanServer\Parameters]
; A servidors (Windows NT Server):
"AutoShareServer"=dword:00000000
; A estacions de treball (Windows NT Workstation):
"AutoShareWks"=dword:00000000

; NT: Restringir informacio dels recursos compartits i de comptes mitjancant
;     connexions anonimes a IPC$.
[HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\LSA]
"RestrictAnonymous"=dword:00000001

; NT: Restringir acces a la xarxa mitjancant sessions nul.les.
; [HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters]
; Esborrar les entrades per "NullSessionPipes" i "NullSessionShares".

; NT: Desactivar la generacio de noms NTFS 8.3.
[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Filesystem]
"NtfsDisable8dot3NameGeneration"=dword:00000001

; NT: Activar signatures al servidor SMB.
[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters]
"RequireSecuritySignature"=dword:00000001
"EnableSecuritySignature"=dword:00000001

; NT: Activar signatures al client SMB.
[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Rdr\Parameters]
"RequireSecuritySignature"=dword:00000001
"EnableSecuritySignature"=dword:00000001

; NT: Eliminar vulnerabilitat "Pass the Hash" amb client SMB modificat.
[HKEY_LOCAL_MACHINE\System\CurrentControlSet\control\LSA]
"LMCompatibilityLevel"=dword:00000004

; NT: Eliminar vulnerabilitat LSA DoS (Phantom).
[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\Currentversion\AeDebug]
"Auto"="0"

; NT: Inhabilitar enrutat de IP origen.
[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters]
"DisableIPSourceRouting"=dword:0000001

; NT: Establir MDAC per operar en mode segur (1) o insegur (0).
[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\DataFactory\HandlerInfo]
"HandlerRequired"=dword:00000001

; NT: Inhabilitar l'autentificacio de l'administrador de xarxa (Lan Manager).
; 0 - Enviar les contrasenyes de Windows NT i de l'administrador de xarxa.
; 1 - Enviar les contrasenyes de Windows NT i de l'administrador de xarxa
;     si el  servidor les sol.licita.
; 2 - Enviar nomes la contrasenya de Windows NT.
[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\LSA]
"LMCompatibilityLevel"=dword:00000002

; NT: Inhabilitar el servei DCOM.
[HKEY_LOCAL_MACHINE\Software\Microsoft\Ole]
"EnableDCOM"="N"

; NT: Restringir l'acces dels usuaris nul i convidat
;     al registre d'esdeveniments d'aplicacio.
[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\EventLog\Application]
"RestrictGuestAccess=dword:00000001

; NT: Restringir l'acces dels usuaris nul i convidat
;     al registre d'esdeveniments de seguretat.
[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\EventLog\Security]
"RestrictGuestAccess=dword:00000001

; NT: Restringir l'acces dels usuaris nul i convidat
;     al registre d'esdeveniments de sistema.
[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\EventLog\System]
"RestrictGuestAccess=dword:00000001

; NT: Inhabilitar l'aparicio del nom de l'ultim usuari a la pantalla d'acces.
[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon]
"DontDisplayLastUserName"="1"

; NT: Inhabilitar el cache intern de contrasenyes.
[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon]
"CachedLogonsCount"="0"

; NT: Inhabilitar l'opcio d'apagar a la pantalla d'acces.
[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon]
"ShutdownWithoutLogon"="1"

; NT: Restringir l'acces al disquet a l'actual usuari interactiu.
[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon]
"AllocateFloppies"="1"

; NT: Restringir l'acces al CDROM a l'actual usuari interactiu.
[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon]
"AllocateCDRoms"="1"

; NT: Inhabilitar l'execucio de Autorun des de CDROM.
[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Cdrom]
"Autorun"=dword:00000000

; NT: Apagar automaticament aplicacions que no responen passats 20 segons.
[HKEY_USERS\.DEFAULT\Control Panel\Desktop]
"autoendtasks"="20000"

; NT: Netejar el fitxer de paginacio durant el tancament del sistema.
[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\SessionManager\Memory Management]
"ClearPageFileAtShutdown"=dword:00000001

; NT: No permetre als usuaris canviar els atributs de recursos compartits.
[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\SessionManager]
"ProtectionMode"=dword:00000001
"AdditionalBaseNamedObjectsProtectionMode"=dword:00000001

; NT: Auditar els canvis d'atributs de recursos compartits, backup i restore.
[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\LSA]
"AuditBaseObjects"=dword:00000001
"FullPrivilegeAuditing"=dword:00000001

; NT: Apagar el sistema quan la bitacola de seguretat es plena.
[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\LSA]
"CrashOnAuditFail"=dword:00000001

; NT: No permetre a les aplicacions d'usuari escoltar els ports TCP i UDP.
[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\NetBT\Parameters]
"EnablePortLocking"=dword:00000001

; NT: Protegir els atributs dels objectes del kernel.
[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\SessionManager]
"EnhancedSecurityLevel"=dword:00000001

; NT: Fer executar scripts CGI al servidor IIS
;     en el context del compte IUSR_computername.
[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\W3SVC\Parameters]
"CreateProcessAsUser"=dword:00000001

; NT: Permetre registrar les peticions correctes de pagines web a IIS.
[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\W3SVC\Parameters]
"LogSuccessfulRequests"=dword:00000001

; NT: Permetre registrar les peticions incorrectes de pagines web a IIS.
[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\W3SVC\Parameters]
"LogErrorRequests"=dword:00000001

; NT: Inhabilitar a IIS els atacs FTP bounce.
[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\MSFTPSVC\Parameters]
"EnablePortAttack"=dword:00000000

; NT: Activar salvapantallas amb contrasenya.
[HKEY_CURRENT_USER\Control Panel\Desktop]
"ScreenSaveTimeOut"="temps en segons fins que s'activa"
"ScreenSaveActive"="1"
"ScreenSaveIsSecure"="1"
"SCRNSAVE.EXE"="c:\winnt\system32\logon.scr"

; NT: Restriccions a les activitats dels usuaris.
; Veure mes endavant les restriccions a usuaris de Windows 9x.
; Tambe son aplicables a Windows NT. A mes a mes tenim:
[HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\System]
"DisableLockWorkstation"=dword:00000001
"DisableTaskMgr"=dword:00000001
"DisableChangePassword"=dword:00000001

; Recomanacions d'acces al registre:
; 
; Els grups 'Usuaris' i 'Tothom' no haurien de tenir acces a:
; HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\EventLog TREE 
; 
; Els grups 'Usuaris' i 'Tothom' haurien de tenir acces especial a:
; HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Profile List
; i a les operacions del registre: demanar valor, crear subclau,
; enumerar subclaus, notificar i control de lectura.
;
; Els grups 'Usuaris' i 'Tothom' haurien de tenir acces de lectura a:
; HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services
; HKEY_LOCAL_MACHINE\SOFTWARE\Classes
; HKEY_LOCAL_MACHINE\SOFTWARE\Windows 3.1 Migration Status
; HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\App Paths
; HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer
; HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Embedding
; HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run
; HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce
; HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall
; HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Type 1 Installer
; HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\AeDebug
; HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Compatibility
; HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\MCI
; HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\MCI Extenstions
; HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Drivers
; HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\FontDrivers
; HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\FontCache
; HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Fonts
; HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\FontMapper
; HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\FontSubstitutes
; HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\GRE_Initialize
; HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\WOW
; HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Ports



PROTEGINT/DESPROTEGINT WINDOWS 95, 98 i ME A TRAVES DEL REGISTRE
----------------------------------------------------------------

REGEDIT4

; 9x: Inhabilitar el cache intern de contrasenyes.
[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Network]
"DisablePwdCaching"=dword:00000001

; 9x: Emprar el servei d'actualitzacio de Windows sense registrar-se.
[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Welcome\RegWiz]
"RegDone"="1"

; 9x: Treure les icones dels discos a 'El meu PC'.
[HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer]
"NoDrives"=dword:03ffffff

; 9x: Treure totes les icones de l'escriptori.
[HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer]
"NoDesktop"=dword:00000001

; 9x: Treure icones de l'escriptori segons el seu identificador de classe.
;     El meu PC: {20D04FE0-3AEA-1069-A2D8-08002B30309D}
;     El meu maleti: {85BBD920-42AO-1069-A2E4-08002B30309D}
;     Escriptori: {00021400-0000-0000-C000-0000000000046}
;     Fonts: {BD84B380-8CA2-1069-AB1D-08000948534}
;     Historial: {FF393560-C2A7-11CF-BFF4-444553540000}
;     Impresores: {2227A280-3AEA-1069-A2DE-08002B30309D}
;     Marcat telefonic: {992CFFA0-F557-101A-88EC-00DD01CCC48}
;     Microsoft Network: {00028B00-0000-0000-C000-000000000046}
;     Panell de control: {21EC2020-3AEA-1069-A2DD-0B002B30309D}
;     Paperera de reciclatge: {645FF040-5081-101B-9F08-00AA002F954E}
;     Safata d'entrada: {00020D76-0000-0000-C000-000000000046}
;     Veinatge de xarxa: {208D2C60-3AEA-1069-A2D7-08002B30309D}
; esborrar [HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Desktop\NameSpace\CLSID_de_icona]

; 9x: Modificar icones de l'escriptori segons el seu identificador de classe.
[HKEY_CLASSES_ROOT\CLSID\CLSID_de_icona\ShellFolder]
; Per renombrar: "Attributes"=hex:50,01,00,20
; Per esborrar: "Attributes"=hex:60,01,00,20
; Per renombrar i esborrar: "Attributes"=hex:70,01,00,20
; Per tallar, copiar i pegar: "Attributes"=hex:47,01,00,20
; Per deixar-ho tal i com estava: "Attributes"=hex:40,01,00,20

; 9x: Guardar canvis de l'escriptori i protegir-lo de canvis al registre.
[HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer]
"NoSaveSettings"=dword:00000001

; 9x: Esborrar les opcions 'executar' i 'cercar' del menu d'inici.
[HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer]
"NoFind"=dword:00000001
"NoRun"=dword:00000001

; 9x: Afegir i treure opcions del menu contextual.
[HKEY_CLASSES_ROOT\Directory\Shell]
; Per treure una opcio, esborrar el nom de la clau.
; Per afegir una opcio, crear una nova clau amb el nom de l'opcio,
; dins crear una altre clau anomenada 'command', i
; dins el valor 'default' de 'command' escriure el nom del programa a cridar.

; 9x: Treure l'opcio d'apagar el sistema.
[HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer]
"NoClose"="1"

; 9x: Visualitzar un missatge cada cop que s'inicii el sistema.
[HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\WinLogon]
"LegalNoticeCaption"="text a la barra de menu"
"LegalNoticeText"="text a una petita finestra"

; 9x: Restriccions a les activitats dels usuaris.
; Com el nom es prou indicatiu i son moltes, no les comentare.
[HKEY_CURRENT_USER/Software/Microsoft/CurrentVersion/Policies/Explorer]
"NoDeletePrinter"=dword:00000001
"NoAddPrinter"=dword:00000001
"NoFind"=dword:00000001
"NoRun"=dword:00000001
"NoClose"=dword:00000001
"NoLogoff"=dword:00000001
"NoNetHood"=dword:00000001
"NoDesktop"=dword:00000001
"NoDrives"=dword:00000001
"NoDriveTypeAutoRun"=dword:00000095
"NoFavoritesMenu"=dword:00000001
"NoTrayContextMenu"=dword:00000001
"NoViewContextMenu"=dword:00000001
"NoRecentDocsMenu"=dword:00000001
"NoRecentDocsHistory"=dword:00000001
"ClearRecentDocsOnExit"=dword:00000001
"NoDesktopUpdate"=dword:00000001
"NoSetActiveDesktop"=dword:00000001
"NoFolderOptions"=dword:00000001
"NoSetFolders"=dword:00000001
"NoSetTaskbar"=dword:00000001
"NoSaveSettings"=dword:00000001
"DisableRegistryTools"=dword:00000001
"NoInternetIcon"=dword:00000001
[HKEY_CURRENT_USER/Software/Microsoft/CurrentVersion/Policies/System]
"NoDispCPL"=dword:00000001
"NoDispBackgroundPage"=dword:00000001
"NoDispScrsavPage"=dword:00000001
"NoDispAppearancePage"=dword:00000001
"NoDispSettingsPage"=dword:00000001
"NoSecCPL"=dword:00000001
"NoPwdPage"=dword:00000001
"NoAdminPaqe"=dword:00000001
"NoProfilePage"=dword:00000001
"NoDevMgrPage"=dword:00000001
"NoConfigPage"=dword:00000001
"NoFileSysPage"=dword:00000001
"NoVirtMemPage"=dword:00000001
[HKEY_CURRENT_USER/Software/Microsoft/CurrentVersion/Policies/Network]
"NoNetSetupSecurityPage"=dword:00000001
"NoNetSetup"=dword:00000001
"NoNetSetupIDPage"=dword:00000001
"NoNetSetupSecurityPage"=dword:00000001
"NoFileSharingControl"=dword:00000001
"NoPrintSharing"=dword:00000001
[HKEY_CURRENT_USER/Software/Microsoft/CurrentVersion/Policies/WinOldApp]
"Disabled"=dword:00000001
"NoRealMode"=dword:00000001



TRUCS PER SALTAR-SE LES PROTECCIONS
-----------------------------------

Un administrador pot haver imposat localment les restriccions que acabem de
veure, ja sigui directament sobre el registre, ja sigui mitjancant eines
administratives que venen amb NT o Windows 9x (amb Windows 98 ve l'eina
'PolEdit', que hi es a la carpeta 'Resource Kit' del CD i no s'instal.la per
defecte). Per saltar-nos les restriccions podem modificar de nou el registre
(si aquest no esta bloquejat) o inclus, en el cas de Windows 9x, esborrar els
fitxers c:\windows\user.dat i c:\windows\system.dat, que contenen la
informacio del registre, i reiniciar la maquina.

Si l'administrador ha imposat les restriccions remotament a traves del
servidor principal, llavors hem de buscar petits trucs que permetin saltar-se
aquestes restriccions sense tocar el registre. Com que la seguretat no es el
punt fort dels sistemes operatius Microsoft, de segur que trobareu molts
d'aquests trucs. Aqui van uns quants:

 * Si han tret l'opcio d'apagar el sistema podeu premer l'interruptor :-) o be
   executar des de la linia de comandes: 'C:\Windows\rundll.exe
   user.exe,exitwindowsexec' per reiniciar Windows o be 'C:\Windows\rundll.exe
   user.exe,exitwindows' per apagar Windows.

 * Si han tret l'acces a una carpeta, feu Menu Inici -> Executar ->
   nom_carpeta. Si tambe han tret l'opcio executar del menu d'inici, podeu
   crear una acces directe a qualsevol carpeta o fitxer, i despres canviar la
   ruta cap a la carpeta que realment voleu accedir a les propietats de
   l'acces directe. Tambe podeu anar al MS-DOS i escriure START nom_carpeta.
   Per cert: sabieu que per canviar la icona d'una carpeta basta amb crear
   dins la carpeta el fitxer folder.ini ocult i de nomes lectura amb el text

     [.ShellClassInfo]
     ICONFILE=Disc:\Cami\nom.extensio

 * Si han tret l'acces a l'explorador de Windows, podeu executar els fitxers
   winfile.exe i explorer.exe, encara que el navegador d'Internet tambe va
   molt be per explorar el sistema (escriviu com a adreca el nom de la unitat
   a accedir). Aquest ultim metode tambe va be quan han tret l'acces a una
   unitat de disc en concret (recordeu que l'acces a la disquetera es pot
   treure tambe mitjancant la BIOS).
   Per cert: sabieu que per canviar icona d'un disc basta amb crear dins el
   disc el fitxer autorun.inf amb el text

     [Autorun]
     ICON=Disc:\Cami\nom.extensio

 * Si han tret l'acces al MS-DOS, executeu o creeu un acces directe cap el
   fitxer command.com.

 * Si han tret l'opcio de cerca del menu d'inici i de l'explorador de Windows
   i voleu cercar un fitxer, sortiu al MS-DOS i executeu 'dir nomfitxer.ext /s'.

 * Si han tret l'opcio de cerca del menu d'inici i de l'explorador de Windows
   i voleu cercar un ordinador, sortiu al MS-DOS i executeu 'Net View' per
   veure el veinatge de xarxa, 'Net View \\NomOrdinador' per veure els
   recursos compartits d'un ordinador de la xarxa, i 'Net use x:
   \\NomOrdinador\RecursCompartit' per connectar el recurs compartit al disc
   de xarxa x:.

 * Si han tret l'opcio d'executar del menu d'inici, encara podeu executar
   programes de mil i una maneres. La mes curiosa per a mi es a traves d'un
   script de Visual Basic a Microsoft Word 97. Pregunteu-li a Pancake com.

 * Si han tret altre opcions o accessoris del menu d'inici, podeu executar el
   programa 'groupconv.exe' de Windows, que restaurara el menu d'inici
   original.

 * Si han tret l'acces a la carpeta d'impressores, encara podem provar
   d'instal.lar alguna impressora entrant al veinatge de xarxa i seleccionant
   el nostre ordinador. La carpeta d'impressores sera llavors accessible.

 * Si han tret l'acces al pannell de control, anem al menu d'inici i executem
   l'ajuda de Windows per tal de cercar ajuda a l'index sobre el pannell de
   control. Fixeu-vos que per cada opcio del pannell de control apareix un
   sobtopic a l'ajuda. Quan feu clic sobre el subtopic apareixera una petita
   pantalla d'ajuda amb un enllac cap aquella opcio del pannell de control.
   D'aquesta manera podreu accedir a les propietats d'entorn de xarxa, afegir
   i treure programes, etc.

 * Si han tret l'opcio de establir el fons de pantalla, podeu obrir la vostre
   imatge bitmap amb l'accessori 'Paint' i al menu 'Fitxer' escollir 'Establir
   com a fons de pantalla'. Aixo serveix nomes per a una sessio, pero.
   Per cert: sabieu que per canviar les pantalles d'inici i aturada basta amb
   editar, respectivament, els fitxers logo.sys, logos.sys i logow.sys, com si
   fossin imatges bitmap.

 * Hi han alguns valors de claus del registre que van especialment be per
   executar algun programa a inici del sistema:

   [HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run]
   [HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunOnce]
   [HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunOnceEx]
   [HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunServices]
   [HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunServicesOnce]

   A mes a mes hi han d'altres valors de claus al registre que permeten
   executar programes de manera mes amagada pero menys neta:

   Cridar un troia cada cop que s'executi un programa
   [HKEY_CLASSES_ROOT\exefile\shell\open\command]
   "arxiu_executable "%1" %*" en lloc de ""%1" %*"

   Cridar un troia cada cop que s'obri un fitxer amb determinada extensio
   [HKEY_CLASSES_ROOT\extensio\shell\open\command]
   "arxiu_executable "%1" %*" en lloc de ""%1" %*"

   Creant una nova entrada per un controlador de dispositiu
   [HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services]

   Modificant una entrada a 'instal.lar/desinstal.lar programes'
   [HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Uninstall]

   Si han tret l'acces al registre, encara i aixi podeu executar programes a
   l'inici de Windows, encara que d'una manera menys elegant i amagada:

   - Cridant a Windows com 'win arxiu_executable' dins 'autoexec.bat'
   - Incloent 'arxiu_executable' a 'winstart.bat'
   - Incloent 'LOAD=arxiu_executable' o 'RUN=arxiu_executable' a la seccio
     [windows] de 'win.ini'.
   - Incloent 'Shell=Explorer.exe arxiu_executable' a la seccio [boot] de
     'system.ini'.
   - Copiant o enllacant el programa a la carpeta 'C:\WINDOWS\menu
     inici\programes\inici'.



BIBLIOGRAFIA
------------

 * El registre de Windows:
    - Jo mateix.

 * El registre a Windows 9x i NT:
    - Llibre "Windows NT 4.0 Server: instalacion y gestion".
    - "The Registry Torn Apart" - http://blacksun.box.sk/reg.txt

 * Modificacions al registre de Windows 9x i NT:
    - Mil i un retalls a revistes d'informatica.
    - http://www.microsoft.com/technet/security/C2config.asp
    - http://hackerzlair.org/NT_security.reg
    - "Windows Tips and Tricks" - http://blacksun.box.sk/untold.html

 * Trucs per saltar-se les proteccions:
    - Jo mateix i d'altre gent.
    - "Autostart programs" - http://www.elfqrin.com/docs/autostart-win.html

 * I molt mes ... http://www.regedit.com

