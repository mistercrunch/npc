

SISTEMA OPERATIVO    :///Aix\\\ " El Unix de Ibm"


Etapas:

Etapa I :Nivel Basico
Etapa II: Nivel Superior 


Nivel : Basico

Niveles de aprendisaje:

a)- Introducción al Aix

b)- Archivos y Directorios

c)- El Shell 

d)- Los comandos mas usados 


iNTRODUCCION :

El sistema operativo AIX es la versión de UNIX  de IBM ,es un sistema multiusuario y multitarea, lo cual quiere decir que los recursos del sistema (procesador, disco, memoria, etc) pueden ser compartidos simultáneamente por varios usuarios, cada uno de los cuales puede tener en ejecución más de un proceso en un momento dado. Los usuarios pueden acceder al sistema desde la consola del mismo o bien desde terminales locales o remotas (acceso vía red).  
Cuando un usuario inicia una sesión de trabajo, AIX le obliga a identificarse con su código de cuenta y contraseña, de esta forma el sistema es capaz de identificar quién es el autor de cualquier operación (ej. creación de archivo, ejecución de programa, etc) y puede también restringir las posibles acciones del usuario. La seguridad es por lo tanto uno más de los aspectos que AIX tiene en consideración. 


ARCHIVOS Y DIRECTORIOS 
CONCEPTOS BÁSICOS 

Al igual que en otros sistemas operativos, en AIX un archivo es un conjunto de datos que pueden ser escritos y leídos por los usuarios mientras que un directorio no es más que una entidad que permite agrupar archivos. Los directorios se emplean, por lo tanto, para organizar los archivos del sistema.  

En AIX los archivos pueden ser de tres tipos:  

Regulares: almacenan información (ej. texto, programas, datos, ...) 
Directorios: son realmente archivos que almacenan información para acceder a otros archivos 
Especiales: cualquier dispositivo (ej. disco, terminal, tarjeta de sonido, ...) tiene un archivo asociado. También se encuentran en esta categoría los archivos FIFO (first-in, first-out) 
Los archivos tienen un nombre único dentro del directorio que los contiene y que ha de cumplir las siguientes reglas:  
Puede tener hasta 255 caracteres de longitud y puede contener letras, números y subrayados. 
AIX distingue entre mayúsculas y minúsculas (ej. Catalogo y catalogo son nombres distintos de archivo). 
Debe evitarse en nombres de archivos el uso de aquellos caracteres con un significado especial para el sistema operativo (ej. / \ " ' * ; - ? [ ] ( ) ~ ! $ { } < > # @ & |). 
Los archivos cuyo nombre comienza por . (punto) no aparecen en los listados de directorio a menos que se especifique la opción apropiada. 
El nombre / está reservado para denotar el directorio raiz. 
El nombre . (punto) está reservado para denotar el directorio en curso. 
El nombre .. (dos puntos) está reservado para denotar el directorio anterior al directorio en curso. 
Una ruta (o pathname) de un archivo no es más que su nombre precedido por los nombres de cada uno de los directorios que lo contienen. Una ruta es absoluta cuando se especifica partiendo del directorio raiz (/) y relativa cuando se especifica partiendo del directorio en curso. Cada nombre en una ruta de archivo se separa del siguiente por un / .  
Ejemplos:  
  

/unix archivo unix contenido en el directorio raiz 
/usr/bin/ls archivo ls contenido en el directorio /usr/bin 
usr/bin/ls archivo ls del directorio usr/bin contenido en el directorio en curso (si el directorio en curso es / equivale al ejemplo anterior) 
catalogo.txt archivo catalogo.txt contenido en el directorio en curso 
./catalogo.txt archivo catalogo.txt contenido en el directorio en curso 
../mensaje.txt archivo mensaje.txt contenido en el directorio anterior al directorio en curso 

PERMISOS DE ACCESO
Entre los atributos asociados a un archivo o directorio hay tres muy importantes desde el punto de vista de la seguridad:  
el propietario: usuario que creo el archivo 
el grupo: grupo de usuarios (en AIX un usuario pertenece a uno o varios grupos de usuarios) 
los permisos: flags que determinan qué usuarios pueden acceder al archivo y qué operaciones pueden realizar sobre él. 


Jerarquía de directorios de AIX
Cada directorio de la jerarquía almacena distintas clases de archivos, así por ejemplo:  
  

/home Contiene el directorio inicial de trabajo de cada usuario 
/usr/lib Contiene librerías 
/usr/bin Contiene comandos de usuario 
/usr/include Contiene ficheros de cabecera (*.h) 
/etc Contiene ficheros para el arranque y gestión del sistema 
/dev Contiene ficheros especiales para E/S de dispositivos 
/tmp Contiene ficheros temporales  

Si el usuario observa tras ejecutar el comando ls -l cuáles son los permisos de los directorios del sistema, verá que no tiene permiso para escribir en la mayoría de ellos, sólo el administrador del sistema (el usuario cuyo código de cuenta es root) puede hacerlo, con ello se evita el deterioro del sistema ocasionado por las acciones de los distintos usuarios.  
Cada usuario del sistema tiene en el directorio /home un subdirectorio del cual es propietario, ello le permite crear, borrar y renombrar los archivos y otros subdirectorios contenidos en él, así como otorgar permisos a otros usuarios para que puedan acceder a sus archivos. Por ejemplo, si el usuario José Martín tiene como código de cuenta jmartin, su directorio HOME será /home/jmartin. El directorio HOME de un usuario es, junto con el  /tmp, uno de los pocos lugares de la jerarquía de directorios de AIX en los cuales los usuarios no administradores pueden escribir.  

En los sistemas con un gran número de usuarios la cantidad de información que cada uno de ellos puede grabar en su directorio HOME suele estar limitada, esto se consigue estableciendo cuotas de disco. Las cuotas permiten distribuir el espacio de almacenamiento disponible entre los distintos usuarios del sistema, evitando así que uno de ellos haga un uso excesivo dejando sin espacio a los demás. Al rebasar  la cuota de disco asignada, el usuario obtendrá un mensaje de aviso (ej. "disk quota exceeded ..."), deberá entonces reducir el espacio consumido eliminando aquellos archivos que no sean de utilidad. El usuario podrá solicitar al administrador del sistema el incremento de la cuota de disco asignada en casos justificados.  



EL SHELL 
INTRODUCCIÓN 

El shell es un programa de AIX que tiene como misión recoger los comandos que el usuario introduce, ejecutar los programas asociados y mostrar finalmente los resultados. Cada una de las cuentas de los usuarios tiene asignado uno de los siguientes shells disponibles en el sistema:  

Bourne shell: comando bsh 
C shell:  comando csh 
Korn shell: comando ksh 
El Korn shell es el empleado en la mayoría de los casos al incluir las facilidades proporcionadas por los restantes, es por ello por lo que nos referiremos al Korn shell en el resto de este documento.  
El Korn shell ofrece un completo lenguaje de programación al usuario:  

ofrece sentencias de control de flujo tales como bucles y condicionales 
permite definir funciones 
permite definir variables alfanuméricas y numéricas y también arrays 
dispone de operaciones aritméticas y bases de numeración 
Esta sección no pretende transformar al lector en un experto programador del shell, sino mostrarle los conceptos mínimos que debe conocer sobre él como usuario del sistema. Para profundizar más en el conocimiento del Korn shell el usuario puede consultar la documentación en línea disponible en el sistema.  
  
EJECUCIÓN DE COMANDOS 

Cuando se ejecuta el shell de forma interactiva, el usuario introduce los comandos por el teclado y el shell muestra la salida de la ejecución y los errores que se produzcan por la pantalla de la terminal. Cada vez que espera un comando, el shell muestra un apuntador (prompt) que en AIX  es por defecto el símbolo $ (dollar), el usuario puede entonces escribir el comando a ejecutar.  

Algunos ejemplos de comandos que se pueden construir siguiendo la sintaxis del shell son:  

comando simple: formado por el pathname (ruta) de un archivo ejecutable y sus argumentos. Ejemplo: 
  
ls /usr/bin
El ejemplo anterior lista el contenido del directorio /usr/bin. 
pipeline: formado por una lista de comandos separados por el carácter |. En un pipeline, un comando toma como entrada la salida del comando anterior. Ejemplo: 
ls /usr/bin | more
En el pipeline anterior el comando more muestra  paginada la salida del listado. 
 
ejecución en segundo plano (background):  se ejecuta un comando concurrentemente con el shell sin necesidad de que éste espere a su terminación (el shell muestra de inmediato el prompt para que el usuario introduzca nuevos comandos). 
sleep 5 & 
En el ejemplo anterior el comando sleep espera 5 segundos antes de terminar su ejecución.  Al ejecutarlo en segundo plano el shell no espera a que termine.
Cuando se escribe el nombre de un archivo ejecutable sin especificar el directorio que lo contiene, el shell utiliza la variable PATH para buscar el archivo en los directorios que dicha variable especifique, es más, no buscará el archivo en el directorio en curso a menos que así se indique en dicha variable. Ejemplo:  
PATH=/usr/bin:/usr/local/bin/:.
Teniendo en cuenta la asignación anterior, si se ejecuta el archivo programa se intentará buscar primero en /usr/bin, si no se encuentra en /usr/local/bin y por último en el directorio en curso. Podremos conocer cuál es el valor de la variable PATH ejecutando el siguiente comando:  
echo $PATH
Si desde un programa ejecutado por el shell se quiere acceder a una variable definida por éste, la variable debe exportarse mediante el comando de shell export. Por ejemplo, una variable que se exporta para que siempre esté accesible desde cualquier programa es la variable PATH vista anteriormente:  
export PATH
La ejecución de un comando puede requerir al usuario la entrada de información (ej. introducir una cantidad). La vía de entrada estándar es el teclado, pero ésta se puede redirigir a cualquier otro archivo mediante el carácter < (menor que). Ejemplo:  
tr "[A-Z]" "[a-z]" < texto 
El comando anterior muestra por pantalla el contenido del archivo "texto" convertido a minúsculas. 
De la misma forma que se puede redirigir la fuente de entrada al ejecutar un comando, también se puede redirigir el destino de las líneas de salida producidas así como el de las líneas de errores producidos. Ejemplos:  

Redirección de la salida de un comando 
  ls /usr/bin > listado.txt  
  
Redirección de la salida de errores 
  ls /inexistente 2> errores.txt  
  
Redirección de la entrada y salida 
  tr "[A-Z]" "[a-z]" < texto > texto.min 

PERFILES DE USUARIOS Y SHELL SCRIPTS 

Archivo de perfil de un usuario
Puesto que cada usuario puede tener unas necesidades concretas, AIX ofrece a cada uno de ellos la posibilidad de crear un archivo de perfil que será ejecutado automáticamente por el shell de inicio del usuario al conectarse al sistema. El archivo de perfil contendrá una serie de comandos que permitirán adecuar el entorno de trabajo a las necesidades del usuario.  
Si el shell utilizado por el usuario es el Bourne (bsh) o Korn (ksh), el archivo de perfil está ubicado en su directorio HOME con el nombre .profile . Un uso habitual de este fichero es la modificación del valor por defecto de la variable PATH, para ello el usuario podría añadir las siguientes líneas:  

PATH=$PATH:/usr/local/bin  
export PATH
Para ver si existe este fichero y, en tal caso cuál es su contenido, se puede ejecutar el comando:  
cat $HOME/.profile  
NOTA: $HOME es una variable de shell que contiene el directorio  HOME del usuario 

Shell scripts
Cuando el usuario tiene que ejecutar una determinada serie de comandos con frecuencia puede ahorrar esfuerzo creando un shell script. Un shell script no es más que un archivo de texto que contiene una lista de comandos. Al ejecutar el shell script (escribiendo su nombre) se ejecutarán los comandos que contiene.  
Por ejemplo, el usuario podría crear un archivo de texto llamado traspaso con los siguientes comandos:  

DIR=catalogos  
OLD=viejo  
mkdir $DIR  
rm $OLD/*.o  
cp $OLD/*.txt $DIR
para poder ejecutar el shell script anterior el archivo traspaso debe tener permiso de ejecución (x). Este permiso se puede otorgar mediante el comando chmod. Ej.: 
chmod +x traspaso 
Para ejecutar el shell script se escribirá su nombre:  
"traspaso"

LOS COMANDOS MÁS EMPLEADOS 
GESTIÓN DE DIRECTORIOS Y ARCHIVOS 

ls: listar directorios y archivos  

Listar  todos los archivos contenidos en el directorio actual 
  ls 
  
Listar los archivos contenidos en los directorios /etc y /bin 
  ls /etc /bin 
  
Listar todos los archivos y subdirectorios que empiezan por "a" contenidos en el directorio actual 
  ls a* 
  
Listar los archivos del directorio anterior  y sus atributos (permisos,  propietario, etc) 
  ls -l .. 
  
Listar archivos ocultos (los que empiezan por . (punto)) 
  ls -a
mkdir:  crear directorios  
Crear el directorio catalogos  
  mkdir catalogos 
  
Crear los directorios c1 y c2  
  mkdir c1 c2 
  
Crear el directorio /u/alopez/c1 
  mkdir /u/alopez/c1
rmdir:  eliminar directorios (deben estar vacíos)  
Eliminar el directorio catalogos 
  rmdir catalogos 
  
Eliminar los directorios c1 y c2 
  rmdir c1 c2 
pwd: mostrar el directorio en curso  
cd: cambiar el directorio en curso  

El directorio actual pasa a ser el directorio catalogos   
  cd catalogos  
El directorio actual pasa a ser /bin   
  cd /bin  
El directorio actual pasa a ser el directorio HOME del usuario 
  cd
cp: copiar archivos y directorios  
Copiar el archivo catalogo1.txt como catalogo2.txt   
  cp catalogo1.txt catalogo2.txt  
  
Copiar al directorio /u/alopez/catalogos  los archivos que empiezan por catalogo y  acaban en ".txt" 
  cp catalogo*.txt /u/alopez/catalogos  
  
Copiar recursivamente toda la estructura de archivos y  subdirectorios  contenida en el directorio catalogos  bajo el directorio catalogos.old  
  cp -r catalogos catalogos.old 
mv: renombrar o mover archivos y directorios  
Renombrar el archivo catalogo1.txt como catalogo2.txt   
  mv catalogo1.txt catalogo2.txt  
  
Mover los archivos que empiezan por catalogo y  acaban en ".txt" al directorio /u/alopez/catalogos   
  mv catalogo*.txt /u/alopez/catalogos  
  
Renombrar el directorio catalogos por catalogos.old o  moverlo si catalogos.old es un directorio ya existente.  
  mv catalogos catalogos.old 
rm:  eliminar archivos  
Eliminar el archivo catalogo.txt   
  rm catalogo.txt  
  
Eliminar los archivos que empiezan por catalogo  y acaban  en  ".txt" 
  rm catalogo*.txt 
chmod:  cambiar los permisos de archivos y directorios  
No se asigna ningún permiso a grupo y otros   
  chmod go= a.txt 
  
Se asigna al grupo sólo permiso de lectura y ejecución   
  chmod g=rx a.txt 
  
Sobre los permisos existentes se añade para todos el de lectura   
  chmod a+r a.txt 
  
Sobre los permisos existentes se añade al grupo el de escritura  
  chmod g+w a.txt 
  
Se asigna al usuario sólo permiso de lectura y escritura  
  chmod u=rw a.txt 
  
Se asigna al usuario sólo permiso de lectura. Grupo y otros no tienen   
  chmod u=r,go= a.txt 
cat:  concatenar archivos o mostrar el contenido de archivos  
Mostrar el contenido del archivo a.txt   
  cat a.txt 
  
Concatenar los archivos que empiezan por "a"  y acaban  en ".txt" y depositar el resultado en el archivo b.txt  
  cat a*.txt > b.txt
COMANDOS MISCELÁNEOS
more:  paginar por la pantalla de la terminal el contenido de archivos  
 Mostrar el contenido del archivo  
  more a.txt 
  
Mostrar los archivos especificados  
  more a*.txt 
  
Concatenar los archivos y paginarlos 
  cat a*.txt | more
head:  mostrar las N (por defecto 10) primeras líneas de un archivo de texto  
Mostrar las diez primeras líneas del archivo  
  head a.txt 
  
Mostrar las 20 primeras líneas del archivo  
  head -20 a.txt
tail:  mostrar las N (por defecto 10)  últimas líneas de un archivo de texto  
Mostrar las diez últimas líneas del archivo  
  tail a.txt 
  
Mostrar las 20 últimas líneas del archivo 
  tail -20 a.txt
 wc:  contar el número de líneas, palabras y bytes de archivos de texto  
Mostrar el número de las líneas, palabras y bytes del archivo 
  wc a.txt  
  
Mostrar sólo el número de líneas 
  wc -l a
grep:  buscar en ficheros de texto las líneas que contienen (o no contienen) un patrón dado  
Mostrar las líneas que empiezan por la palabra Total   
  grep ^Total a.txt 
  
Mostrar las líneas que contienen la palabra Total   
  grep Total a.txt 
  
Mostrar las líneas que acaban con la palabra Total 
  grep Total$ a.txt 
  
Mostrar las líneas que no contienen Total  (-v=negar)  
  grep -v Total a.txt  
  
Mostrar las líneas que contienen la palabra total sin importar si se encuentra en mayúsculas o en minúsculas 
  grep -i total a.txt 
  
Mostrar las líneas que contienen la palabra total (sin distinguir mayúsculas de minúsculas) seguidas por 0 o más caracteres (.*) y al menos un dígito ([0-9]) 
  grep -i "total.*[0-9]" a.txt 
clear: borrar la pantalla de la terminal  
date: mostrar la fecha y hora del sistema  

exit: abandonar la ejecución del shell (si es el shell inicial de la sesión, se termina también la sesión). El shell también puede terminarse pulsando Ctrl-D. 

 
 
Item 2º   

Nivel: Superior 

Niveles: 

Insralacion , como crear un Sistema Irix , Configuraciones , Union con Kinux

Instalacion del Aix 

Requisitos
Para instalar AFS satisfactoriamente debe cumplir con los requisitos siguientes. 


Identidad de inicio de sesión
Inicie una sesión con la máquina que está instalando como superusuario root local. Cuando así se le indique, autentifíquese también ante AFS como usuario de administración admin. 


Requisitos generales
Debe tener la Distribución de binarios de AFS para cada uno de los tipos de sistema que esté instalando. A no ser que se le indique lo contrario, la Distribución de binarios incluye software para máquinas tanto servidor como cliente. Si está utilizando la versión en CD-ROM de la distribución, la máquina que está instalando tiene que poder acceder a los CD-ROM, ya sea mediante una unidad de CD local o por medio de un montaje NFS(R) de una unidad de CD conectada a una máquina a la que la red pueda acceder. 
Todas las máquinas AFS que pertenecen a una célula deben tener acceso entre ellas a través de la red. 
La máquina tiene que estar ejecutando la versión estándar, suministrada por el proveedor, del sistema operativo soportado por la versión actual de AFS. El sistema operativo ya tiene que estar instalado en la partición raíz de la máquina. 
El usuario debe estar familiarizado con el sistema operativo actual y con la configuración de discos de la máquina que está instalando. 
Todo el hardware y el software que no sea AFS de la máquina debe estar funcionando con normalidad. 
No se puede estar ejecutando ningún proceso crítico en la máquina que se está instalando, puesto que habrá que rearrancarla durante la instalación. 

Requisitos de una máquina servidor de archivos
La configuración de la célula es más sencilla si la primera máquina que se instale tiene la dirección IP más baja de todas las máquinas servidor de base de datos que actualmente piense instalar. Si más tarde configura una máquina que tiene una dirección IP inferior que una máquina servidor de base de datos, antes de la instalación deberá actualizar el archivo /usr/vice/etc/CellServDB en todas las máquinas cliente de la célula. Para obtener una explicación adicional, consulte el apartado Instalación del funcionamiento de servidor de base de datos. 
La partición montada en el directorio /usr debe tener como mínimo 18 MB de espacio en disco disponible para almacenar binarios de servidor AFS (almacenados, por convenio, en el directorio /usr/afs/bin). Si la máquina también es cliente, tiene que haber espacio adicional disponible en el disco local, tal como se explica en el apartado Requisitos de una máquina cliente. El juego completo de binarios de AFS todavía necesita más espacio, pero normalmente se almacenan en un volumen AFS, en lugar de hacerlo en el disco local de una máquina. 
Las bases de datos almacenadas en el directorio /usr/afs/db y los archivos de registro cronológico de procesos de servidor almacenados en el directorio /usr/afs/logs necesitan cantidades de espacio más significativas en la partición. Los requisitos exactos dependen de muchos factores, como por ejemplo el tamaño de la célula y la frecuencia con que se truncan los archivos de registro cronológico. 

Tiene que haber por lo menos una partición (o un volumen lógico, en caso de que el sistema operativo y AFS lo soporten) dedicada exclusivamente a almacenar volúmenes AFS. El número total y el tamaño de las particiones de servidor en todas las máquinas servidor de archivos de la célula determinan la cantidad de espacio que está disponible para archivos AFS. 

Requisitos de una máquina cliente
La partición montada en el directorio /usr debe tener como mínimo 4 MB de espacio en disco disponible para almacenar los binarios de cliente AFS y los archivos de bibliotecas del kernel (almacenados, por convenio, en el directorio /usr/vice/etc). El juego completo de binarios de AFS necesita más espacio, pero normalmente se almacenan en un volumen AFS, en lugar de hacerlo en el disco local de una máquina. Para la mayoría de tipos de sistema, las instrucciones hacen que sólo se copie el archivo de bibliotecas del kernel apropiado para la máquina que se está instalando. Si elige almacenar en el disco local todos los archivos de bibliotecas, el espacio necesario puede ser significativamente mayor. 
En una máquina cliente que utiliza antememoria de disco, en la partición de la antememoria (por convenio, montada en el directorio /usr/vice/cache) tiene que haber suficiente espacio libre para acomodar la antememoria. El tamaño mínimo recomendado para la antememoria es de 10 MB, pero las antememorias todavía más grandes suelen funcionar mejor. 
En una máquina cliente que utiliza antememoria de memoria, tienen que haber como mínimo 5 MB de memoria de máquina para dedicarlos a la gestión de la antememoria pero, de nuevo, si se dispone de más memoria se consigue un mejor rendimiento. Para obtener una explicación adicional, consulte los apartados del Instalación de máquinas cliente adicionales que tratan sobre la configuración de la antememoria. 

--------------------------------------------------------------------------------

Tipos de sistema soportados
En las IBM AFS Release Notes para cada release de AFS se listan los tipos de sistema soportados. A menudo, entre distintos releases de AFS se dispone de soporte para revisiones posteriores de un sistema operativo. El grupo de soporte del producto AFS puede ofrecerle más detalles. 

El objetivo de los grupos de desarrollo y soporte del producto AFS es dar soporte a un amplio rango de tipos de sistema conocidos. Además, cada vez que un proveedor de sistemas operativos entrega una nueva versión de disponibilidad general de un sistema operativo soportado, su objetivo será certificar que dicho sistema operativo da soporte a AFS durante un breve período de tiempo. El soporte se puede retrasar un poco si es necesario generar binarios completamente nuevos. 

No siempre es posible dar soporte a AFS en cada una de las versiones intermedias de un sistema operativo o para determinados tipos de procesador. En algunos casos, las limitaciones de las plataformas hacen que determinados funcionamientos de AFS (como, por ejemplo, el funcionamiento de servidor de archivos o de conversor de NFS/AFS) no estén disponibles en una o más plataformas. Para obtener una lista de las limitaciones, consulte las IBM AFS Release Notes o solicítela al grupo de soporte del producto AFS. 


--------------------------------------------------------------------------------

Acerca de la actualización del sistema operativo
Siempre que se actualice una máquina AFS con un sistema operativo distinto, se deben emprender varias acciones para mantener un funcionamiento correcto de AFS. Dichas acciones incluyen las siguientes, pero no están necesariamente limitadas a las mismas. 

Desmonte las particiones de servidor AFS (montadas en los directorios /vicepxx) de todas las máquinas servidor de archivos, a fin de impedir que el programa fsck suministrado por el proveedor se ejecute en ellas cuando se rearranque la máquina durante la instalación del nuevo sistema operativo. Antes de actualizar el sistema operativo, es prudente comentar los mandatos del archivo de inicialización de la máquina que vuelven a montar las particiones de servidor, a fin de impedir que éstas se vuelvan a montar hasta que se sustituya el programa fsck estándar por la versión modificada por AFS. Las instrucciones incluidas en esta guía para instalar máquinas servidor AFS explican cómo sustituir el programa fsck. 
Proteja las versiones modificadas por AFS de los mandatos y archivos de configuración, a fin de evitar que las versiones suministradas por el proveedor las sobregraben. Esto incluye vfsck (versión de fsck para AFS), binarios para los servicios remotos de UNIX, como por ejemplo inetd, y archivos de configuración tales como el del Módulo de autentificación conectable (PAM). Después de haber instalado satisfactoriamente el sistema operativo, recuerde que debe devolver los mandatos y archivos modificados por AFS a las ubicaciones en las que se accede a ellos durante un funcionamiento normal. 
Vuelva a formatear las particiones de servidor para acomodar información específica de AFS, en determinados casos. Las instrucciones de actualización que acompañan a los nuevos binarios de AFS para una plataforma afectada siempre detallan el procedimiento necesario. 

--------------------------------------------------------------------------------

La Distribución de binarios de AFS
La Distribución de binarios de AFS incluye un CD-ROM independiente para cada tipo de sistema soportado, que contiene todos los binarios y archivos de AFS para las máquinas servidor y cliente. Las instrucciones de esta guía especifican cuándo debe montarse el CD-ROM y qué archivos o directorios se deben copiar en el disco local o en el volumen de AFS. 


--------------------------------------------------------------------------------

Cómo continuar
Si está instalando la primera máquina AFS de la célula, prosiga en el Instalación de la primera máquina AFS. 

Si está instalando una máquina servidor de archivos adicional, o si está configurando o desautorizando una máquina servidor de base de datos, prosiga en el Instalación de máquinas servidor adicionales. 

Si está instalando una máquina cliente adicional, prosiga en el Instalación de máquinas cliente adicionales


Guía de iniciación rápida


--------------------------------------------------------------------------------

Instalación de la primera máquina AFS
En este capítulo se describe cómo instalar la primera máquina AFS en la célula, configurándola como máquina servidor de archivos y como máquina cliente. Después de completar todos los procedimientos descritos en este capítulo puede eliminar, si lo desea, el funcionamiento de cliente tal como se describe en el apartado Eliminación del funcionamiento de cliente. 

Para instalar máquinas servidor de archivos adicionales después de completar este capítulo, vea el Instalación de máquinas servidor adicionales. 

Para instalar máquinas cliente adicionales después de completar este capítulo, vea el Instalación de máquinas cliente adicionales. 


--------------------------------------------------------------------------------

Requisitos y decisiones de configuración
En las instrucciones que contiene este capítulo se da por supuesto que se cumple con los requisitos siguientes. 

El usuario está conectado a la consola de la máquina como superusuario root local 
En la máquina se está ejecutando una versión estándar de los sistemas operativos soportados por la versión actual de AFS 
Se puede acceder a los datos contenidos en los CD-ROM de AFS, ya sea mediante una unidad de CD local o por medio de un montaje NFS de una unidad de CD conectada a una máquina a la que la red puede acceder 
Mientras esté realizando la instalación de la primera máquina AFS, deberá tomar las siguientes decisiones relativas a la configuración. Para acelerar la propia instalación, es mejor tomar las decisiones antes de empezar. Si desea directrices detalladas, consulte el capítulo de la publicación IBM AFS Administration Guide que trata sobre la administración y configuración de células. 

Seleccione la primera máquina AFS 
Seleccione el nombre de célula 
Decida qué particiones o volúmenes lógicos se configurarán como particiones de servidor AFS, y elija los nombres de directorio en los que se montarán 
Decida si se utilizará el software estándar de autorización y autentificación de AFS o Kerberos, que se obtiene de otra fuente. En varios tipos de sistema, esta decisión determina la forma en que se incorpora AFS al sistema de autentificación de la máquina. Si desea utilizar Kerberos, póngase ahora en contacto con el grupo de soporte del producto AFS para averiguar cómo debe modificar el procedimiento de instalación. 
Decida qué tamaño tendrá la antememoria de cliente 
Decida cómo se configurarán los niveles superiores del espacio de archivos AFS de la célula 
Este capítulo se divide en tres amplios apartados que corresponden a las tres partes de que consta la instalación de la primera máquina AFS. Lleve a cabo todos los pasos en el orden en que aparecen. Cada apartado funcional empieza por un resumen de los procedimientos a realizar. Los apartados son los siguientes: 

Instalación del funcionamiento de servidor (empieza en el apartado Visión general: Instalación del funcionamiento de servidor) 
Instalación del funcionamiento de cliente (empieza en el apartado Visión general: Instalación del funcionamiento de cliente) 
Configuración del espacio de archivos de la célula, establecimiento de mecanismos adicionales de seguridad y habilitación del acceso a células externas (empieza en el apartado Visión general: Realización de la instalación de la primera máquina AFS) 

--------------------------------------------------------------------------------

Visión general: Instalación del funcionamiento de servidor
En la primera fase de instalación de la primera máquina de la célula se instala el funcionamiento de servidor de archivos y de servidor de base de datos, realizando los procedimientos siguientes: 

Elija qué máquina se instalará como primera máquina AFS 
Cree directorios relacionados con AFS en el disco local 
Incorpore las modificaciones de AFS en el kernel de la máquina 
Configure las particiones o volúmenes lógicos para almacenar volúmenes AFS 
En algunos tipos de sistema, instale y configure una versión modificada por AFS del programa fsck 
Si la máquina va a permanecer como máquina cliente, incorpore AFS al sistema de autentificación de la misma 
Inicie el Servidor Basic OverSeer (BOS) 
Defina el nombre de célula y la calidad de miembro de la célula por parte de la máquina 
Inicie los procesos de servidor de base de datos: Servidor de autentificación, Servidor de copia de seguridad, Servidor de protección y Servidor de ubicación de volúmenes (VL) 
Configure los mecanismos iniciales de seguridad 
Inicie el proceso fs, que incorpora tres procesos componentes: Servidor de archivos, Servidor de volúmenes y Recuperador 
Inicie el Servidor de actualización 
Inicie el proceso controlador (llamado runntp) para el Network Time Protocol Daemon, que sincroniza los relojes de las máquinas 

--------------------------------------------------------------------------------

Elección de la primera máquina AFS
La primera máquina AFS que instale debe disponer de suficiente espacio en disco para almacenar volúmenes AFS. Para aprovecharse mejor de las posibilidades de AFS, almacene los binarios de la parte de cliente y los archivos del usuario en volúmenes. Más adelante, cuando instale máquinas servidor de archivos adicionales en la célula, podrá distribuir estos volúmenes entre las distintas máquinas en que encajen. 

Estas instrucciones configuran la primera máquina AFS como máquina servidor de base de datos, la máquina de distribución de binarios para el tipo de sistema correspondiente y la máquina de control del sistema de la célula. Para obtener una descripción de estas funciones consulte la publicación IBM AFS Administration Guide. 

La instalación de máquinas adicionales resulta más sencilla si la primera máquina tiene la dirección IP más baja de todas las máquinas servidor de base de datos que actualmente piense instalar. Si más tarde instala el funcionamiento de servidor de base de datos en una máquina que tiene una dirección IP inferior, antes deberá actualizar el archivo /usr/vice/etc/CellServDB en todas las máquinas cliente de la célula. Para conocer más detalles, consulte el apartado Instalación del funcionamiento de servidor de base de datos. 


--------------------------------------------------------------------------------

Creación de directorios de AFS
Cree los directorios /usr/afs y /usr/vice/etc en el disco local para almacenar, respectivamente, archivos servidor y de cliente. Las instrucciones posteriores copian en ellos archivos procedentes del CD-ROM de AFS. Cree el directorio /cdrom como punto de montaje de los CD-ROM, en caso de que no exista todavía. 

      
   # mkdir /usr/afs
      
   # mkdir /usr/vice
      
   # mkdir /usr/vice/etc
   
   # mkdir /cdrom 
     


--------------------------------------------------------------------------------

Realización de procedimientos específicos de la plataforma
Varios de los procedimientos iniciales para instalar una máquina servidor de archivos difieren para cada tipo de sistema. Por razones de comodidad, en los apartados siguientes se agrupan para cada tipo de sistema: 

Incorpore las modificaciones de AFS en el kernel. 
El kernel de cada máquina AFS servidor de archivos y cliente debe incorporar extensiones de AFS. En las máquinas que utilizan un cargador dinámico de módulos del kernel, convencionalmente se altera el script de inicialización de la máquina de forma que cargue las extensiones de AFS durante cada rearranque. 

Configure las particiones o volúmenes lógicos de servidor para alojar volúmenes AFS. 
Cada máquina servidor de archivos AFS debe tener, como mínimo, una partición o un volumen lógico dedicados al almacenamiento de volúmenes AFS (por razones de comodidad, la documentación que se proporciona de ahora en adelante sólo hace referencia a particiones). Cada partición de servidor se monta en un directorio denominado /vicepxx, siendo xx una o dos letras minúsculas. Por convenio, las 26 primeras particiones se montan en los directorios denominados de /vicepa a /vicepz, la número 27 se monta en el directorio /vicepaa, y así sucesivamente hasta /vicepaz y /vicepba, continuando del mismo modo hasta el índice correspondiente el número máximo de particiones de servidor soportadas en la versión actual de AFS (que se especifica en las IBM AFS Release Notes). 

Los directorios /vicepxx deben residir en el directorio raíz de la máquina servidor de archivos, y no en uno de los subdirectorios del mismo (por ejemplo, /usr/vicepa no es una ubicación de directorio aceptable). 

También se pueden añadir o eliminar particiones de servidor en una máquina servidor de archivos existente. Si desea obtener instrucciones, consulte el capítulo de la publicación IBM AFS Administration Guide que trata sobre el mantenimiento de máquinas servidor. Nota: No todos los tipos de sistema de archivos soportados por un sistema operativo se soportan necesariamente como particiones de servidor AFS. Para conocer las posibles restricciones, consulte la publicación IBM AFS Release Notes.  


En algunos tipos de sistema, instale y configure un programa fsck modificado que reconozca las estructuras que utiliza el Servidor de archivos para organizar datos de volúmenes en particiones de servidor AFS. El programa fsck que se proporciona con el sistema operativo no entiende las estructuras de datos de AFS, por lo que las elimina trasladándolas al directorio lost+found. 
Si la máquina va a permanecer como máquina cliente AFS, modifique el sistema de autentificación de la máquina para que los usuarios obtengan una señal de AFS al inicio de sesión con el sistema de archivos local. La utilización de AFS resulta más fácil y conveniente para los usuarios si se efectúan las modificaciones en todas las máquinas cliente. De no hacerlo, los usuarios deben realizar un procedimiento de inicio de sesión en dos pasos (inicio de la sesión con el sistema de archivos local y, a continuación, emisión del mandato klog). Para obtener una explicación adicional de la autentificación de AFS, consulte el capítulo de la publicación IBM AFS Administration Guide que trata los temas de configuración y administración de células. 
Para continuar, siga con el apartado correspondiente: 

Cómo empezar en sistemas AIX 
Cómo empezar en sistemas Digital UNIX 
Cómo empezar en sistemas HP-UX 
Cómo empezar en sistemas IRIX 
Cómo empezar en sistemas Linux 
Cómo empezar en sistemas Solaris 

--------------------------------------------------------------------------------

Cómo empezar en sistemas AIX
Empiece por ejecutar el script de inicialización de AFS para llamar al recurso de extensión del kernel de AIX, el cual carga dinámicamente las modificaciones de AFS en el kernel. A continuación, utilice el programa SMIT para configurar particiones en las que almacenar volúmenes AFS y sustituya el asistente de programas fsck de AIX por una versión que maneje correctamente los volúmenes AFS. Si la máquina va a permanecer como máquina cliente AFS, incorpore AFS en el sistema de autentificación secundario de AIX. 


Carga de AFS en el kernel de AIX
El recurso de extensión del kernel de AIX es el cargador dinámico de kernel proporcionado por IBM Corporation. AIX no soporta la incorporación de modificaciones de AFS durante la creación de un kernel. 

Para que AFS funcione correctamente, se debe ejecutar el recurso de extensión del kernel cada vez que se rearranque la máquina, de forma que el script de inicialización de AFS (que se incluye en la distribución de AFS) lo invoque automáticamente. En este apartado se copia el script en la ubicación convencional y se edita para seleccionar las funciones adecuadas, en función de si también se va a ejecutar NFS o no. 

Después de editar el script, lo debe ejecutar para incorporar AFS en el kernel. En apartados posteriores se verificará que el script inicialice correctamente todos los componentes de AFS y luego se configurará el archivo inittab de AIX de forma que el script se ejecute automáticamente en los rearranques. 

Monte el CD-ROM de AFS para AIX en el directorio local /cdrom. Para obtener instrucciones sobre cómo montar los CD-ROM (ya sea local o remotamente por medio de NFS), consulte la documentación de AIX. A continuación, cambie de directorio tal como se indica. 
   
   # cd  /cdrom/rs_aix42/root.client/usr/vice/etc
   

Copie los archivos de bibliotecas del kernel AFS en el directorio local /usr/vice/etc/dkload y el script de inicialización de AFS en el directorio /etc. 
   
   # cp -rp  dkload  /usr/vice/etc
   
   # cp -p  rc.afs  /etc/rc.afs
    

Edite el script /etc/rc.afs, estableciendo la variable NFS tal como se indica. 
Si la máquina no va a funcionar como Conversor NFS/AFS, establezca la variable NFS de la forma siguiente: 

      
   NFS=$NFS_NONE

Si la máquina va a funcionar como Conversor de NFS/AFS y está ejecutando AIX 4.2.1 o posterior, establezca la variable NFS de la forma siguiente. Tenga en cuenta que NFS debe estar ya cargado en el kernel, lo que se lleva a cabo automáticamente en los sistemas que ejecutan AIX 4.1.1 y posterior, siempre que exista el archivo /etc/exports. 

   
   NFS=$NFS_IAUTH
   

Invoque al script /etc/rc.afs para cargar las modificaciones de AFS en el kernel. Puede hacer caso omiso de los mensajes de error relacionados con la imposibilidad de iniciar el Servidor BOS, el Gestor de antememoria o el cliente AFS. 
   
   # /etc/rc.afs
   


Configuración de particiones de servidor en sistemas AIX
Cada máquina servidor de archivos AFS debe tener como mínimo una partición o un volumen lógico dedicados al almacenamiento de volúmenes AFS. Cada partición de servidor se monta en un directorio denominado /vicepxx, siendo xx una o dos letras minúsculas. Los directorios /vicepxx deben residir en el directorio raíz de la máquina servidor de archivos, y no en uno de los subdirectorios del mismo (por ejemplo, /usr/vicepa no es una ubicación de directorio aceptable). Para obtener información adicional, consulte el apartado Realización de procedimientos específicos de la plataforma. 

Para configurar particiones de servidor en un sistema AIX, realice los procedimientos siguientes: 

Cree un directorio llamado /vicepxx para cada partición de servidor AFS que esté configurando (tiene que haber por lo menos una). Repita el mandato para cada una de las particiones. 
   
   # mkdir /vicepxx
   

Utilice el programa SMIT para crear un sistema de archivos de diario en cada partición que se vaya a configurar como partición de servidor AFS. 
Monte cada una de las particiones en uno de los directorios /vicepxx. Elija uno de los tres métodos siguientes: 
Utilice el programa SMIT 
Utilice el mandato mount -a para montar todas las particiones a la vez 
Utilice el mandato mount en cada una de las particiones, por turno 
Configure también las particiones de forma que se monten automáticamente en cada rearranque. Para obtener más información, consulte la documentación de AIX. 


Sustitución del asistente de programas fsck en sistemas AIX
En este apartado se efectúan modificaciones para garantizar que se ejecute el programa fsck apropiado en las particiones de servidor AFS. El programa fsck proporcionado con el sistema operativo nunca se debe ejecutar en particiones de servidor AFS. Dado que no reconoce las estructuras que utiliza el Servidor de archivos para organizar datos de volúmenes, elimina todos los datos. Una vez más: 

Nunca se debe ejecutar el programa fsck estándar en particiones de servidor AFS, porque descarta los volúmenes AFS. 

En los sistemas AIX no se sustituye el propio binario fsck, sino el archivo asistente de programas incluido en la distribución de AIX como /sbin/helpers/v3fshelper. 

Traslade el asistente de programas fsck de AIX a una ubicación segura e instale en su lugar la versión de la distribución de ASF. El CD-ROM de AFS debe seguir montado en el directorio /cdrom. 
   
   # cd /sbin/helpers
   
   # mv v3fshelper v3fshelper.noafs
   
   # cp -p /cdrom/rs_aix42/root.server/etc/v3fshelper v3fshelper
   
 

Si piensa mantener el funcionamiento de cliente en esta máquina después de completar la instalación, siga con el apartado Habilitación del inicio de sesión de AFS en sistemas AIX. De lo contrario, siga con el apartado Inicio del Servidor BOS. 

Habilitación del inicio de sesión de AFS en sistemas AIX
Nota: Si piensa eliminar el funcionamiento de cliente de esta máquina después de completar la instalación, sáltese esta sección y siga con el apartado Inicio del Servidor BOS.  

Siga las instrucciones indicadas en este apartado para incorporar las modificaciones de AFS al sistema de autentificación secundario de AIX. 

Emita el mandato ls para verificar que los programas afs_dynamic_auth y afs_dynamic_kerbauth están instalados en el directorio local /usr/vice/etc. 
   
   # ls /usr/vice/etc   

Si los archivos no existen, monte el CD-ROM de AFS para AIX (si aún no está montado), cambie de directorio de la forma indicada y cópielos. 

  
   # cd /cdrom/rs_aix42/root.client/usr/vice/etc
   
   # cp  -p  afs_dynamic*  /usr/vice/etc
   

Edite el archivo local /etc/security/user, efectuando cambios en las stanzas indicadas: 
En la stanza por omisión, establezca el atributo registry en DCE (y no en AFS), de la forma siguiente: 
   
   registry = DCE
   

En la stanza por omisión, establezca el atributo SYSTEM según se indica. 
Si la máquina sólo es un cliente AFS, establezca el valor siguiente: 

   
   SYSTEM = "AFS OR (AFS[UNAVAIL] AND compat[SUCCESS])"   

Si la máquina es un cliente AFS y DCE, establezca el valor siguiente (que debe aparecer en una sola línea del archivo): 

   
   SYSTEM = "DCE OR DCE[UNAVAIL] OR AFS OR (AFS[UNAVAIL]  \
       AND compat[SUCCESS])"
   

En la stanza root, establezca el atributo registry tal como se indica a continuación. Este atributo permite que el superusuario local root inicie sesiones únicamente con el sistema de archivos local, en base a la contraseña listada en el archivo de contraseñas local. 
   
   root:
         registry = files
   

Edite el archivo local /etc/security/login.cfg, creando o editando las stanzas indicadas: 
En la stanza DCE, establezca el atributo program tal como se indica a continuación. 
Si utiliza el Servidor de autentificación de AFS (proceso kaserver): 

   
   DCE:
        program = /usr/vice/etc/afs_dynamic_auth   

Si utiliza una implantación Kerberos de la autentificación de AFS: 

   
   DCE:
        program = /usr/vice/etc/afs_dynamic_kerbauth
   

En la stanza AFS, establezca el atributo program tal como se indica a continuación. 
Si utiliza el Servidor de autentificación de AFS (proceso kaserver): 

   
   AFS:
        program = /usr/vice/etc/afs_dynamic_auth   

Si utiliza una implantación Kerberos de la autentificación de AFS: 

   
   AFS:
        program = /usr/vice/etc/afs_dynamic_kerbauth
   

Siga con el apartado Inicio del Servidor BOS (o, si está consultando estas instrucciones mientras instala una máquina servidor de archivos adicional, regrese al apartado Inicio de los programas de servidor). 

--------------------------------------------------------------------------------

Cómo empezar en sistemas Digital UNIX
Empiece por crear las modificaciones de AFS en un nuevo kernel estático; Digital UNIX no soporta la carga dinámica. A continuación, cree particiones para almacenar volúmenes AFS y sustituya el programa fsck de Digital UNIX por una versión que maneje correctamente los volúmenes AFS. Si la máquina va a permanecer como máquina cliente AFS, incorpore AFS en la matriz Arquitectura de integración de la seguridad (SIA). 


Creación de AFS en el kernel de Digital UNIX
Utilice las instrucciones siguientes para crear modificaciones de AFS en el kernel de un sistema Digital UNIX. 

Cree una copia llamada AFS del archivo básico de configuración del kernel incluido en la distribución de Digital UNIX como /usr/sys/conf/nombre_máquina, siendo nombre_máquina el nombre de sistema principal de la máquina, todo él en mayúsculas. 
   
   # cd /usr/sys/conf
   
   # cp nombre_máquina AFS
   

Añada AFS a la lista de opciones del archivo de configuración que ha creado en el paso anterior, de forma que el resultado sea parecido al siguiente: 
          .                   .
          .                   .
       options               UFS
       options               NFS
       options               AFS
          .                   .
          .                   .
   

Añada una entrada para AFS en dos lugares del archivo /usr/sys/conf/files. 
Añada una línea para AFS en la lista OPTIONS (opciones), de forma que el resultado sea parecido al siguiente: 
             .                .      .
             .                .      .
      OPTIONS/nfs          optional nfs
      OPTIONS/afs          optional afs 
      OPTIONS/nfs_server   optional nfs_server
             .                .      .
             .                .      .
   

Añada una entrada para AFS en la lista MODULES (módulos), de forma que el resultado sea parecido al siguiente: 
             .                  .        .          .
             .                  .        .          .
      #
      MODULE/nfs_server	    optional nfs_server Binary
      nfs/nfs_server.c      module nfs_server optimize -g3
      nfs/nfs3_server.c	    module nfs_server optimize -g3
      #
      MODULE/afs            optional afs Binary
      afs/libafs.c          module afs
      #
   

Añada una entrada para AFS en dos lugares del archivo /usr/sys/vfs/vfs_conf.c. 
Añada AFS a la lista de sistemas de archivos definidos, de forma que el resultado sea parecido al siguiente: 
        .       .              
        .       .              
     #include <afs.h>
     #if defined(AFS) && AFS
            extern struct vfsops afs_vfsops;
     #endif  
        .       .              
        .       .              
   

Coloque una declaración de AFS en la ranura MOUNT_ADDON de la tabla vfssw[], de forma que el resultado sea parecido al siguiente: 
        .                          .              .
        .                          .              .
      &fdfs_vfsops,         "fdfs",   /* 12 = MOUNT_FDFS */
   #if	defined(AFS)
      &afs_vfsops,          "afs",
   #else
      (struct vfsops *)0,   "",       /* 13 = MOUNT_ADDON */
   #endif
   #if NFS && INFS_DYNAMIC   
       &nfs3_vfsops,        "nfsv3",  /* 14 = MOUNT_NFS3 */		
   

Monte el CD-ROM de AFS para Digital UNIX en el directorio local /cdrom. Para obtener instrucciones sobre cómo montar los CD-ROM (ya sea local o remotamente por medio de NFS), consulte la documentación de Digital UNIX. A continuación, cambie de directorio tal como se indica. 
   
   # cd /cdrom/alpha_dux40/root.client
   

Copie el script de inicialización de AFS en el directorio local para archivos de inicialización (por convenio, /sbin/init.d en las máquinas Digital UNIX). Observe la eliminación de la extensión .rc cuando se copia el script. 
   
   # cp usr/vice/etc/afs.rc  /sbin/init.d/afs
   

Copie el módulo del kernel AFS en el directorio local /usr/sys/BINARY. 
Si el kernel de la máquina soporta el funcionamiento de un servidor NFS: 

  
   # cp bin/libafs.o /usr/sys/BINARY/afs.mod   

Si el kernel de la máquina no soporta el funcionamiento de un servidor NFS: 

  
   # cp bin/libafs.nonfs.o /usr/sys/BINARY/afs.mod
   

Configure y cree el kernel. Responda a las posibles solicitudes pulsando <Intro>. El kernel resultante reside en el archivo /sys/AFS/vmunix. 
   
   # doconfig -c AFS
   

Cambie el nombre del archivo de kernel existente y copie el archivo nuevo, modificado por AFS, en la ubicación estándar. 
   
   # mv /vmunix /vmunix_noafs
   
   # cp /sys/AFS/vmunix /vmunix
   

Rearranque la máquina para empezar a utilizar el nuevo kernel y vuelva a iniciar una sesión como superusuario root. 
   
   # cd /
   
   # shutdown -r now
   
   login: root
   Contraseña: contraseña_root
   


Configuración de particiones de servidor en sistemas Digital UNIX
Cada máquina servidor de archivos AFS debe tener como mínimo una partición o un volumen lógico dedicados al almacenamiento de volúmenes AFS. Cada partición de servidor se monta en un directorio denominado /vicepxx, siendo xx una o dos letras minúsculas. Los directorios /vicepxx deben residir en el directorio raíz de la máquina servidor de archivos, y no en uno de los subdirectorios del mismo (por ejemplo, /usr/vicepa no es una ubicación de directorio aceptable). Para obtener información adicional, consulte el apartado Realización de procedimientos específicos de la plataforma. 

Cree un directorio llamado /vicepxx para cada partición de servidor AFS que esté configurando (tiene que haber por lo menos una). Repita el mandato para cada una de las particiones. 
   
   # mkdir /vicepxx
   

Añada una línea en el archivo de registro de sistemas de archivos /etc/fstab con el formato siguiente, para cada uno de los directorios que acabe de crear. La entrada correlaciona el nombre de directorio con la partición de disco que se deberá montar en él. 
   
   /dev/disco /vicepxx ufs rw 0 2

A continuación se muestra un ejemplo de la primera partición que se configura. 

   
   /dev/rz3a /vicepa ufs rw 0 2
   

Cree un sistema de archivos en cada partición que se vaya a montar en un directorio /vicepxx. Probablemente, el mandato siguiente resultará apropiado, pero consulte más información en la documentación de Digital UNIX. 
   
   # newfs -v /dev/disco
   

Monte cada partición emitiendo el mandato mount -a, para montar todas las particiones a la vez, o el mandato mount, para montar cada partición por turnos. 

Sustitución del programa fsck en sistemas Digital UNIX
En este apartado se efectúan modificaciones para garantizar que se ejecute el programa fsck apropiado en las particiones de servidor AFS. El programa fsck proporcionado con el sistema operativo nunca se debe ejecutar en particiones de servidor AFS. Dado que no reconoce las estructuras que utiliza el Servidor de archivos para organizar datos de volúmenes, elimina todos los datos. Una vez más: 

Nunca se debe ejecutar el programa fsck estándar en particiones de servidor AFS, porque descarta los volúmenes AFS. 

En sistemas Digital UNIX, los archivos /sbin/fsck y /usr/sbin/fsck son programas controladores. En lugar de sustituir cada uno de ellos, sustituya el binario real incluido en la distribución de Digital UNIX como /sbin/ufs_fsck y /usr/sbin/ufs_fsck. 

Instale el binario vfsck en los directorios /sbin y /usr/sbin. El CD-ROM de AFS debe seguir montado en el directorio /cdrom. 
   
   # cd /cdrom/alpha_dux40/root.server/etc
   
   # cp vfsck /sbin/vfsck
   
   # cp vfsck /usr/sbin/vfsck
   

Cambie el nombre de los binarios fsck de Digital UNIX y cree enlaces simbólicos con el programa vfsck. 
   
   # cd /sbin
   
   # mv ufs_fsck ufs_fsck.noafs
   
   # ln -s vfsck ufs_fsck
   
   # cd /usr/sbin
   
   # mv ufs_fsck ufs_fsck.noafs
   
   # ln -s vfsck ufs_fsck
   

Si piensa mantener el funcionamiento de cliente en esta máquina después de completar la instalación, siga con el apartado Habilitación del inicio de sesión de AFS en sistemas Digital UNIX. De lo contrario, siga con el apartado Inicio del Servidor BOS. 

Habilitación del inicio de sesión de AFS en sistemas Digital UNIX
Nota: Si piensa eliminar el funcionamiento de cliente de esta máquina después de completar la instalación, sáltese esta sección y siga con el apartado Inicio del Servidor BOS.  

En sistemas Digital UNIX, el script de inicialización de AFS incorpora automáticamente el archivo de bibliotecas de autentificación de AFS en la matriz Arquitectura de integración de seguridad (SIA) de la máquina, de forma que los usuarios que tienen perfiles de AFS obtienen una señal cuando inician una sesión. En este apartado se copia el archivo de bibliotecas en la ubicación apropiada. 

Para obtener más información sobre SIA, remítase a la página de consulta de Digital UNIX para matrix.conf, o bien consulte el apartado sobre seguridad en la documentación de Digital UNIX. Nota: Si la máquina ejecuta software cliente DCE y AFS, AFS se debe iniciar después que DCE. Consulte el script de inicialización de AFS para ver los enlaces simbólicos que se aconseja crear para obtener una clasificación correcta. Asimismo, el orden del script de arranque del sistema debe inicializar SIA antes que cualquier proceso de ejecución larga que utilice la autentificación.  


Lleva a cabo los pasos siguientes para habilitar el inicio de sesión de AFS. 

Monte el CD-ROM de AFS para Digital UNIX en el directorio local /cdrom, si no se ha montado todavía. Cambie de directorio tal como se indica. 
   
   # cd /cdrom/alpha_dux40/lib/afs
   

Copie el archivo de bibliotecas de autentificación de AFS apropiado en el directorio local /usr/shlib. 
Si utiliza el Servidor de autentificación de AFS (proceso kaserver) en la célula: 

   
   # cp  libafssiad.so  /usr/shlib   

Si utiliza una implantación Kerberos de la autentificación de AFS, cambie el nombre del archivo de bibliotecas al copiarlo: 

   
   # cp  libafssiad.krb.so  /usr/shlib/libafssiad.so
   

Siga con el apartado Inicio del Servidor BOS (o, si está consultando estas instrucciones mientras instala una máquina servidor de archivos adicional, regrese al apartado Inicio de los programas de servidor). 

--------------------------------------------------------------------------------

Cómo empezar en sistemas HP-UX
Empiece por crear las modificaciones de AFS en un nuevo kernel; HP-UX no soporta la carga dinámica. A continuación, cree particiones para almacenar volúmenes AFS e instale y configure el programa fsck modificado por AFS para que se ejecute en las particiones de servidor AFS. Si la máquina va a permanecer como máquina cliente AFS, incorpore AFS al Módulo de autentificación conectable (PAM) de la máquina. 


Creación de AFS en el kernel de HP-UX
Utilice las instrucciones siguientes para crear modificaciones de AFS en el kernel de un sistema HP-UX. 

Traslade los archivos relacionados con el kernel existentes a una ubicación segura. 
   
   # cp /stand/vmunix /stand/vmunix.noafs
   
   # cp /stand/system /stand/system.noafs
   

Monte el CD-ROM de HP-UX en el directorio local /cdrom. Para obtener instrucciones sobre cómo montar los CD-ROM (ya sea local o remotamente por medio de NFS), consulte la documentación de HP-UX. A continuación, cambie de directorio tal como se indica. 
   
   # cd /cdrom/hp_ux110/root.client
   

Copie el archivo de inicialización de AFS en el directorio local para archivos de inicialización (por convenio, /sbin/init.d en las máquinas HP-UX). Observe la eliminación de la extensión .rc cuando se copia el archivo. 
   
   # cp usr/vice/etc/afs.rc  /sbin/init.d/afs
   

Copie el archivo afs.driver en el directorio local /usr/conf/master.d, cambiando su nombre por afs a llevar a cabo la copia. 
     
   # cp  usr/vice/etc/afs.driver  /usr/conf/master.d/afs
   

Copie el módulo del kernel AFS en el directorio local /usr/conf/lib. 
Si el kernel de la máquina soporta el funcionamiento de servidor NFS: 

   
   # cp bin/libafs.a /usr/conf/lib   

Si el kernel de la máquina no soporta el funcionamiento de servidor NFS, cambie el nombre del archivo al copiarlo: 

   
   # cp bin/libafs.nonfs.a /usr/conf/lib/libafs.a
   

Incorpore el controlador de AFS en el kernel, utilizando para ello el programa SAM o una serie de mandatos individuales. 
Para utilizar el programa SAM: 
Invoque al programa SAM, especificando el nombre de sistema principal de la máquina local como nombre_sist_princ_local. Emergerá la interfaz gráfica de usuario SAM. 
   
   # sam -display nombre_sist_princ_local:0
   

Elija el icono Kernel Configuration y, a continuación, el icono Drivers. En la lista de controladores, seleccione afs. 
Abra el menú desplegable Actions y elija la opción Add Driver to Kernel. 
Abra de nuevo el menú Actions y elija la opción Create a New Kernel. 
Confirme las elecciones eligiendo Yes y OK cuando lo soliciten las ventanas emergentes posteriores. El programa SAM crea el kernel y rearranca el sistema. 
Inicie de nuevo una sesión como superusuario root. 
   
   login: root
   Contraseña: contraseña_root
   

Para utilizar mandatos individuales: 
Edite el archivo /stand/system, añadiendo una entrada para afs en la sección Subsystems. 
Cambie al directorio /stand/build y emita el mandato mk_kernel para crear el kernel. 
   
   # cd /stand/build
      
   # mk_kernel
   

Traslade el nuevo kernel a la ubicación estándar (/stand/vmunix), rearranque la máquina para empezarlo a utilizar y vuelva a iniciar una sesión como superusuario root. 
   
   # mv /stand/build/vmunix_test /stand/vmunix
      
   # cd /
      
   # shutdown -r now		
   
   login: root
   Contraseña: contraseña_root
   


Configuración de particiones de servidor en sistemas HP-UX
Cada máquina servidor de archivos AFS debe tener como mínimo una partición o un volumen lógico dedicados al almacenamiento de volúmenes AFS. Cada partición de servidor se monta en un directorio denominado /vicepxx, siendo xx una o dos letras minúsculas. Los directorios /vicepxx deben residir en el directorio raíz de la máquina servidor de archivos, y no en uno de los subdirectorios del mismo (por ejemplo, /usr/vicepa no es una ubicación de directorio aceptable). Para obtener información adicional, consulte el apartado Realización de procedimientos específicos de la plataforma. 

Cree un directorio llamado /vicepxx para cada partición de servidor AFS que esté configurando (tiene que haber por lo menos una). Repita el mandato para cada una de las particiones. 
   
   # mkdir /vicepxx
   

Utilice el programa SAM para crear un sistema de archivos en cada partición. Para obtener instrucciones, consulte la documentación de HP-UX. 
En algunos sistemas HP-UX que utilizan volúmenes lógicos, el programa SAM monta automáticamente las particiones. Si no lo ha hecho, monte cada una de las particiones emitiendo el mandato mount -a, para montar todas las particiones a la vez, o el mandato mount, para montar las particiones por turnos. 

Configuración del programa fsck modificado por AFS en sistemas HP-UX
En este apartado se efectúan modificaciones para garantizar que se ejecute el programa fsck apropiado en las particiones de servidor AFS. El programa fsck proporcionado con el sistema operativo nunca se debe ejecutar en particiones de servidor AFS. Dado que no reconoce las estructuras que utiliza el Servidor de archivos para organizar datos de volúmenes, elimina todos los datos. Una vez más: 

Nunca se debe ejecutar el programa fsck estándar en particiones de servidor AFS, porque descarta los volúmenes AFS. 

En los sistemas HP-UX existen varios archivos de configuración que se deben instalar, además del programa fsck modificado por AFS (binario vfsck). 

Cree el archivo de configuración de mandatos /sbin/lib/mfsconfig.d/afs. Utilice un editor de texto para colocar en él las dos líneas indicadas: 
   
   format_revision 1
   fsck            0        m,P,p,d,f,b:c:y,n,Y,N,q,
   

Cree un directorio de mandatos específico de AFS llamado /sbin/fs/afs y cambie a él. 
   
   # mkdir /sbin/fs/afs
   
   # cd  /sbin/fs/afs
   

Copie la versión modificada por AFS del programa fsck (binario vfsck) y los archivos relacionados del directorio de distribución en el nuevo directorio de mandatos específico de AFS. 
   
   # cp -p /cdrom/hp_ux110/root.server/etc/*  .
          

Cambie el nombre del binario vfsck por fsck y establezca de forma apropiada los bits de modalidad en todos los archivos del directorio /sbin/fs/afs. 
      
   # mv  vfsck  fsck
   
   # chmod  755  *
   

Edite el archivo /etc/fstab, cambiando el tipo de sistema de archivos para cada partición de servidor AFS de hfs por afs. Así se asegurará de que el programa fsck modificado por AFS se ejecute en las particiones apropiadas. 
La sexta línea del ejemplo siguiente de un archivo editado muestra una partición de servidor AFS, /vicepa. 

   
   /dev/vg00/lvol1 / hfs defaults 0 1
   /dev/vg00/lvol4 /opt hfs defaults 0 2
   /dev/vg00/lvol5 /tmp hfs defaults 0 2
   /dev/vg00/lvol6 /usr hfs defaults 0 2
   /dev/vg00/lvol8 /var hfs defaults 0 2
   /dev/vg00/lvol9 /vicepa afs defaults 0 2
   /dev/vg00/lvol7 /usr/vice/cache hfs defaults 0 2
   

Si piensa mantener el funcionamiento de cliente en esta máquina después de completar la instalación, siga con el apartado Habilitación del inicio de sesión de AFS en sistemas HP-UX. De lo contrario, siga con el apartado Inicio del Servidor BOS. 

Habilitación del inicio de sesión de AFS en sistemas HP-UX
Nota: Si piensa eliminar el funcionamiento de cliente de esta máquina después de completar la instalación, sáltese esta sección y siga con el apartado Inicio del Servidor BOS.  

En este punto se incorpora AFS al esquema del Módulo de autentificación conectable (PAM) del sistema operativo. PAM integra todos los mecanismos de autentificación en la máquina, incluyendo el inicio de sesión, con el fin de proporcionar la infraestructura de seguridad necesaria para un acceso autentificado a la máquina y desde ella. 

La explicación de PAM queda fuera del ámbito de este documento. Se supone que el usuario ya comprende la sintaxis y los significados de los valores del archivo de configuración de PAM (por ejemplo, cómo funciona la entrada other, el efecto de hacer que una entrada sea required, optional o sufficient, etc.). 

Las instrucciones siguientes explican cómo alterar las entradas del archivo de configuración de PAM para cada servicio en el que se desee utilizar la autentificación de AFS. Posiblemente otras configuraciones también funcionarían, pero las instrucciones especifican la configuración recomendada y comprobada. Nota: Las instrucciones especifican que se debe marcar cada entrada como optional. Sin embargo, el hecho de marcar algunos módulos como opcionales puede significar que éstos otorguen acceso al servicio correspondiente aunque el usuario no cumpla con todos los requisitos del módulo. Por ejemplo, en algunas revisiones del sistema operativo, si se marca como opcional el módulo que controla los inicios de sesión mediante una conexión de marcación, se permite a los usuarios iniciar sesiones sin proporcionar contraseña alguna. Para obtener una explicación de las limitaciones que se aplican a este sistema operativo, consulte las IBM AFS Release Notes. 
Asimismo, con algunas versiones del sistema operativo se deben instalar parches para que PAM interactúe correctamente con determinados programas de autentificación. Para conocer los detalles, consulte las IBM AFS Release Notes. 
 


Las entradas relacionadas con AFS recomendadas en el archivo de configuración de PAM pueden hacer uso de uno o más de los tres atributos siguientes. 


try_first_pass 
Se trata de un atributo estándar de PAM que se puede incluir en las entradas de un servicio posteriores a la primera; éste dirige el módulo que debe utilizar la contraseña proporcionada al primer módulo. Para el módulo AFS, significa que la autentificación de AFS es satisfactoria si la contraseña proporcionada al módulo listado en primer lugar es la contraseña de AFS correcta del usuario. Para obtener una explicación adicional de este atributo y de las alternativas del mismo, consulte la documentación sobre PAM del sistema operativo. 

ignore_root 
Este atributo, específico del módulo PAM de AFS, le hace ignorar no sólo al superusuario root local, sino también a cualquier usuario cuyo UID sea 0 (cero). 

setenv_password_expires 
Este atributo, específico del módulo PAM de AFS, establece la variable de entorno PASSWORD_EXPIRES según la fecha de caducidad de la contraseña de AFS del usuario, que está registrada en la Base de datos de autentificación. 
Lleve a cabo los pasos siguientes para habilitar el inicio de sesión de AFS. 

Monte el CD-ROM de AFS para HP-UX en el directorio /cdrom, si no está montado todavía. A continuación, cambie de directorio tal como se indica. 
  
   # cd /usr/lib/security
   

Copie el archivo de bibliotecas de autentificación de AFS en el directorio /usr/lib/security. Luego, cree un enlace simbólico en cuyo nombre no se mencione la versión. El hecho de omitir la versión elimina la necesidad de editar el archivo de configuración de PAM si, más adelante, se actualiza el archivo de bibliotecas. 
Si utiliza el Servidor de autentificación de AFS (proceso kaserver) en la célula: 

   
   # cp /cdrom/hp_ux110/lib/pam_afs.so.1  .
  
   # ln -s  pam_afs.so.1  pam_afs.so   

Si utiliza una implantación Kerberos de la autentificación de AFS: 

  
   # cp /cdrom/hp_ux110/lib/pam_afs.krb.so.1   .
  
   # ln -s pam_afs.krb.so.1 pam_afs.so
   

Edite la sección Authentication management del archivo de configuración PAM de HP-UX, por convenio /etc/pam.conf. Las entradas de esta sección tienen el valor auth en el segundo campo. 
En primer lugar, edite las entradas estándar, que hacen referencia al módulo PAM de HP-UX (habitualmente, el archivo /usr/lib/security/libpam_unix.1) en el cuarto campo. Para cada servicio en el que desee que se utilice la autentificación de AFS, edite el tercer campo de la entrada correspondiente de forma que contenga optional. El archivo pam.conf de la distribución de HP-UX suele incluir entradas estándar, por ejemplo, para los servicios login y ftp. 

Si hay servicios en los que desea que se utilice la autentificación de AFS pero para los cuales el archivo pam.conf no incluye todavía una entrada estándar, debe crear dicha entrada y colocar el valor optional en el tercer campo de la misma. Por ejemplo, el archivo pam.conf de HP-UX no suele incluir entradas estándar para los servicios remsh ni telnet. 

Seguidamente, cree una entrada relativa a AFS para cada servicio, colocándola inmediatamente debajo de la entrada estándar. El ejemplo siguiente muestra el aspecto de la sección Authentication Management después de haber editado o creado entradas para los servicios mencionados anteriormente. Observe que las entradas para AFS del ejemplo aparecen en dos líneas únicamente para que se puedan leer sin dificultad. 

   
   login   auth  optional  /usr/lib/security/libpam_unix.1
   login   auth  optional  /usr/lib/security/pam_afs.so      \
         try_first_pass  ignore_root  setenv_password_expires
   ftp     auth  optional  /usr/lib/security/libpam_unix.1
   ftp     auth  optional  /usr/lib/security/pam_afs.so      \
         try_first_pass  ignore_root
   remsh   auth  optional  /usr/lib/security/libpam_unix.1
   remsh   auth  optional  /usr/lib/security/pam_afs.so      \
         try_first_pass  ignore_root		
   telnet  auth  optional  /usr/lib/security/libpam_unix.1
   telnet  auth  optional  /usr/lib/security/pam_afs.so      \
         try_first_pass  ignore_root  setenv_password_expires
   

Si utiliza Common Desktop Environment (CDE) en la máquina y desea que los usuarios obtengan una señal de AFS al inicio de sesión, añada o edite también las cuatro entradas siguientes en la sección Authentication management. Observe que las entradas relativas a AFS del ejemplo aparecen en dos líneas únicamente para que se puedan leer sin dificultad. 
  
   dtlogin   auth  optional  /usr/lib/security/libpam_unix.1
   dtlogin   auth  optional  /usr/lib/security/pam_afs.so     \
         try_first_pass  ignore_root
   dtaction  auth  optional  /usr/lib/security/libpam_unix.1
   dtaction  auth  optional  /usr/lib/security/pam_afs.so     \
         try_first_pass  ignore_root
   

Siga con el apartado Inicio del Servidor BOS (o, si está consultando estas instrucciones mientras instala una máquina servidor de archivos adicional, regrese al apartado Inicio de los programas de servidor). 

--------------------------------------------------------------------------------

Cómo empezar en sistemas IRIX
Para incorporar AFS en el kernel en sistemas IRIX, elija uno de los dos métodos siguientes: 

Ejecute el script de inicialización de AFS para invocar al programa ml distribuido por Silicon Graphics, Incorporated (SGI), el cual carga dinámicamente las modificaciones de AFS en el kernel 
Cree un nuevo kernel estático 
A continuación, cree particiones para almacenar volúmenes AFS. No es necesario que sustituya el programa fsck de IRIX, puesto que SGI ya lo ha modificado para que maneje correctamente los volúmenes AFS. Si la máquina va a permanecer como máquina cliente AFS, verifique que el programa de utilidad de inicio de sesión IRIX instalado en la máquina brinda una señal de AFS. 

Como preparación para una carga dinámica o para una creación del kernel, lleve a cabo los procedimientos siguientes: 

Monte el CD-ROM de AFS para IRIX en el directorio /cdrom. Para obtener instrucciones sobre cómo montar los CD-ROM (ya sea local o remotamente por medio de NFS), consulte la documentación de IRIX. A continuación, cambie de directorio tal como se indica. 
   
   # cd  /cdrom/sgi_65/root.client
   

Copie el script de inicialización de AFS en el directorio local para archivos de inicialización (por convenio, /etc/init.d en las máquinas IRIX). Observe la eliminación de la extensión .rc cuando se copia el script. 
   
   # cp -p   usr/vice/etc/afs.rc  /etc/init.d/afs
   

Emita el mandato uname -m para determinar el tipo de placa de CPU de la máquina. El valor IPxx de la salida debe coincidir con uno de los tipos de placa de CPU listados en las IBM AFS Release Notes para la versión actual de AFS. 
   
   # uname -m
    

Empiece en el apartado Carga de AFS en el kernel de IRIX o en el apartado Creación de AFS en el kernel de IRIX. 

Carga de AFS en el kernel de IRIX
El programa ml es el cargador dinámico del kernel proporcionado por SGI para sistemas IRIX. Si lo utiliza en lugar de crear las modificaciones de AFS en un kernel estático, para que AFS funcione correctamente se deberá ejecutar el programa ml cada vez que se rearranque la máquina. Por consiguiente, el script de inicialización de AFS (incluido en el CD-ROM de AFS) lo invoca automáticamente si la variable de configuración afsml está activada. En este apartado se activa la variable y se ejecuta el script. 

En apartados posteriores se verificará que el script inicialice correctamente todos los componentes de AFS y luego se crearán los enlaces que incorporan AFS en la secuencia de arranque y cierre de IRIX. 

Cree el directorio local /usr/vice/etc/sgiload para alojar el archivo de bibliotecas del kernel AFS. 
   
   # mkdir /usr/vice/etc/sgiload
   

Copie el archivo de bibliotecas del kernel AFS adecuado en el directorio /usr/vice/etc/sgiload. La porción IPxx del nombre del archivo de bibliotecas debe coincidir con el valor devuelto previamente por el mandato uname -m. Elija también el archivo adecuado en función de si el kernel de la máquina soporta el funcionamiento de servidor NFS (se debe soportar NFS para que la máquina actúe como Conversor de NFS/AFS). Las máquinas de un solo procesador y de varios procesadores utilizan el mismo archivo de bibliotecas. 
(Puede elegir que se copien todos los archivos de bibliotecas del kernel en el directorio /usr/vice/etc/sgiload, pero en este caso necesitará una cantidad significativa de espacio). 

Si el kernel de la máquina soporta el funcionamiento de servidor NFS: 

   
   # cp -p  usr/vice/etc/sgiload/libafs.IPxx.o  /usr/vice/etc/sgiload   

Si el kernel de la máquina no soporta el funcionamiento de servidor NFS: 

   
   # cp -p  usr/vice/etc/sgiload/libafs.IPxx.nonfs.o   \
                   /usr/vice/etc/sgiload
   

Emita el mandato chkconfig para activar la variable de configuración afsml. 
   
   # /etc/chkconfig -f afsml on   

Si la máquina va a funcionar como Conversor de NFS/AFS y el kernel soporta el funcionamiento de servidor NFS, active la variable afsxnfs. 

   
   # /etc/chkconfig -f afsxnfs on
   

Ejecute el script /etc/init.d/afs para cargar extensiones de AFS en el kernel. El script invoca al mandato ml, determinando automáticamente qué archivo de bibliotecas del kernel se debe utilizar en base al tipo de CPU de esta máquina y al estado de activación de la variable afsxnfs. 
Puede hacer caso omiso de los mensajes de error relacionados con la imposibilidad de iniciar el Servidor BOS, el Gestor de antememoria o el cliente AFS. 

   
   # /etc/init.d/afs  start
   

Siga con el apartado Configuración de particiones de servidor en sistemas IRIX. 

Creación de AFS en el kernel de IRIX
Utilice las instrucciones siguientes para crear modificaciones de AFS en el kernel de un sistema IRIX. 

Copie el archivo de inicialización afs.sm del kernel en el directorio local /var/sysgen/system y el archivo maestro afs del kernel en el directorio local /var/sysgen/master.d. 
   
   # cp -p  bin/afs.sm  /var/sysgen/system
   
   # cp -p  bin/afs  /var/sysgen/master.d
   

Copie el archivo de bibliotecas del kernel AFS adecuado en el archivo loca /var/sysgen/boot/afs.al; la porción IPxx del nombre del archivo de bibliotecas debe coincidir con el valor devuelto previamente por el mandato uname -m. Elija también el archivo adecuado en función de si el kernel de la máquina soporta el funcionamiento de servidor NFS (se debe soportar NFS para que la máquina actúe como Conversor de NFS/AFS). Las máquinas de un solo procesador y de varios procesadores utilizan el mismo archivo de bibliotecas. 
Si el kernel de la máquina soporta el funcionamiento de servidor NFS: 

   
   # cp -p   bin/libafs.IPxx.a   /var/sysgen/boot/afs.a   

Si el kernel de la máquina no soporta el funcionamiento de servidor NFS: 

   
   # cp -p  bin/libafs.IPxx.nonfs.a  /var/sysgen/boot/afs.a
   

Emita el mandato chkconfig para desactivar la variable de configuración afsml. 
   
   # /etc/chkconfig -f afsml off   

Si la máquina va a funcionar como Conversor de NFS/AFS y el kernel soporta el funcionamiento de servidor NFS, active la variable afsxnfs. 

    
   # /etc/chkconfig -f afsxnfs on
   

Copie el archivo del kernel existente, /unix, en una ubicación segura. Compile el nuevo kernel, que se ha creado en el archivo /unix.install. Este archivo sobregrabará el archivo /unix existente cuando se rearranque la máquina en el paso siguiente. 
   
   # cp /unix /unix_noafs
   
   # autoconfig
   

Rearranque la máquina para empezar a utilizar el nuevo kernel y vuelva a iniciar una sesión como superusuario root. 
   
   # cd /
         
   # shutdown -i6 -g0 -y
   
   login: root
   Contraseña: contraseña_root
   


Configuración de particiones de servidor en sistemas IRIX
Cada máquina servidor de archivos AFS debe tener como mínimo una partición o un volumen lógico dedicados al almacenamiento de volúmenes AFS. Cada partición de servidor se monta en un directorio denominado /vicepxx, siendo xx una o dos letras minúsculas. Los directorios /vicepxx deben residir en el directorio raíz de la máquina servidor de archivos, y no en uno de los subdirectorios del mismo (por ejemplo, /usr/vicepa no es una ubicación de directorio aceptable). Para obtener información adicional, consulte el apartado Realización de procedimientos específicos de la plataforma. 

AFS soporta el uso de particiones tanto EFS como XFS para alojar volúmenes AFS. SGI alienta el uso de particiones XFS. 

Cree un directorio llamado /vicepxx para cada partición de servidor AFS que esté configurando (tiene que haber por lo menos una). Repita el mandato para cada una de las particiones. 
   
   # mkdir /vicepxx
   

Añada una línea en el archivo de registro de sistemas de archivos /etc/fstab con el formato siguiente, para cada una de las particiones (o volúmenes lógicos creados mediante el gestor de volúmenes XLV) que se deberán montar en uno de los directorios creados en el paso anterior. 
Para un volumen lógico o partición XFS: 

   
   /dev/dsk/disco  /vicepxx  xfs  rw,raw=/dev/rdsk/disco  0  0   

Para una partición EFS: 

   
   /dev/dsk/disco  /vicepxx  efs  rw,raw=/dev/rdsk/disco  0  0   

A continuación, mostramos ejemplos de una entrada para cada tipo de sistema de archivos: 

   
   /dev/dsk/dks0d2s6 /vicepa  xfs rw,raw=/dev/rdsk/dks0d2s6  0 0
   /dev/dsk/dks0d3s1 /vicepb  efs rw,raw=/dev/rdsk/dks0d3s1  0 0
   

Cree un sistema de archivos en cada partición que se vaya a montar en un directorio /vicepxx. Probablemente los mandatos siguientes resultarán apropiados, pero consulte más información en la documentación de IRIX. En ambos casos, dispositivo_puro es un nombre de dispositivo puro tal como /dev/rdsk/dks0d0s0 lo es para una partición de un solo disco, o como lo es /dev/rxlv/xlv0 para un volumen lógico. 
Para sistemas de archivos XFS, incluya las opciones indicadas para configurar la partición o el voumen lógico con inodos lo suficientemente grandes como para acomodar información específica de AFS: 

   
   # mkfs -t xfs -i size=512 -l size=4000b dispositivo_puro   

Para sistemas de archivos EFS: 

   
   # mkfs -t efs dispositivo_puro
   

Monte cada una de las particiones, emitiendo el mandato mount -a para montar todas las particiones a la vez o el mandato mount para montar cada partición por turnos. 
(Opcional) Si ha configurado particiones o volúmenes lógicos para utilizar XFS, emita el mandato siguiente con el fin de verificar que los inodos estén bien configurados (son suficientemente grandes para acomodar información específica de AFS). Si la configuración es correcta, el mandato no devuelve ninguna salida. De lo contrario, especifica el mandato que se debe ejecutar para configurar cada partición o volumen lógico adecuadamente. 
   
   # /usr/afs/bin/xfs_size_check
   

Si piensa mantener el funcionamiento de cliente en esta máquina después de completar la instalación, siga con el apartado Habilitación del inicio de sesión de AFS en sistemas IRIX. De lo contrario, siga con el apartado Inicio del Servidor BOS. 

Habilitación del inicio de sesión de AFS en sistemas IRIX
Nota: Si piensa eliminar el funcionamiento de cliente de esta máquina después de completar la instalación, sáltese esta sección y siga con el apartado Inicio del Servidor BOS.  

El programa login estándar de la línea de mandatos de IRIX y el programa de inicio de sesión gráfico xdm otorgan automáticamente una señal de AFS cuando se incorpora AFS en el kernel de la máquina. Sin embargo, algunas distribuciones de IRIX utilizan, por omisión, otro programa de utilidad de inicio de sesión que no incorpora necesariamente las modificaciones de AFS requeridas. Si se da este caso, debe inhabilitar el programa de utilidad por omisión si desea que los usuarios de AFS obtengan señales de AFS al inicio de sesión. Para obtener una explicación adicional, consulte las IBM AFS Release Notes. 

Si se configura la máquina de forma que utilice un programa de utilidad de inicio de sesión modificado por AFS, los archivos afsauthlib.so y afskauthlib.so (incluidos en la distribución de AFS) deben residir en el directorio /usr/vice/etc. Emita el mandato ls para verificarlo. 

  
   # ls /usr/vice/etc   

Si los archivos no existen, monte el CD-ROM de AFS para IRIX (si no está montado todavía), cambie de directorio de la forma indicada y cópielos. 

  
   # cd /cdrom/sgi_65/root.client/usr/vice/etc
   
   # cp  -p  *authlib*  /usr/vice/etc   

Después de emprender las acciones necesarias, siga con el apartado Inicio del Servidor BOS. 


--------------------------------------------------------------------------------

Cómo empezar en sistemas Linux
Empiece por ejecutar el script de inicialización de AFS que llamará al programa insmod, el cual carga dinámicamente las modificaciones de AFS en el kernel. A continuación, cree particiones para almacenar volúmenes AFS. No es necesario que sustituya el programa fsck de Linux. Si la máquina va a permanecer como máquina cliente AFS, incorpore AFS al Módulo de autentificación conectable (PAM) de la máquina. 


Carga de AFS en el kernel de Linux
El programa insmod es el cargador dinámico del kernel para Linux. Linux no soporta la incorporación de modificaciones de AFS durante la creación de un kernel. 

Para que AFS funcione correctamente se debe ejecutar el programa insmod cada vez que se rearranque la máquina, de forma que el script de inicialización de AFS (que se incluye en el CD-ROM de AFS) lo invoque automáticamente. El script también incluye mandatos que seleccionan automáticamente el archivo de bibliotecas de AFS apropiado. En este apartado se ejecuta el script. 

En apartados posteriores se verificará que el script inicialice correctamente todos los componentes de AFS y luego se activará una variable de configuración, que tiene como resultado la incorporación del script a la secuencia de arranque y cierre de Linux. 

Monte el CD-ROM de AFS para Linux en el directorio local /cdrom. Para obtener instrucciones sobre cómo montar los CD-ROM (ya sea local o remotamente por medio de NFS), consulte la documentación de Linux. A continuación, cambie de directorio tal como se indica. 
   
   # cd  /cdrom/i386_linux22/root.client/usr/vice/etc
   

Copie los archivos de bibliotecas del kernel AFS en el directorio local /usr/vice/etc/modload. Los nombres de archivo para las bibliotecas tienen el formato libafs-versión.o, donde versión indica el nivel de creación del kernel. La serie .mp de la versión indica que el archivo es apropiado para máquinas que ejecuten un kernel de varios procesadores. 
   
   # cp -rp  modload  /usr/vice/etc
   

Copie el script de inicialización de AFS en el directorio local para archivos de inicialización (por convenio, /etc/rc.d/init.d en las máquinas Linux). Observe la eliminación de la extensión .rc cuando se copia el script. 
   
   # cp -p   afs.rc  /etc/rc.d/init.d/afs 
    

Ejecute el script de inicialización de AFS para cargar extensiones de AFS en el kernel. Puede hacer caso omiso de cualquier mensaje de error sobre la imposibilidad de iniciar el Servidor BOS, el Gestor de antememoria o el cliente AFS. 
   
   # /etc/rc.d/init.d/afs  start
   


Configuración de particiones de servidor en sistemas Linux
Cada máquina servidor de archivos AFS debe tener como mínimo una partición o un volumen lógico dedicados al almacenamiento de volúmenes AFS. Cada partición de servidor se monta en un directorio denominado /vicepxx, siendo xx una o dos letras minúsculas. Los directorios /vicepxx deben residir en el directorio raíz de la máquina servidor de archivos, y no en uno de los subdirectorios del mismo (por ejemplo, /usr/vicepa no es una ubicación de directorio aceptable). Para obtener información adicional, consulte el apartado Realización de procedimientos específicos de la plataforma. 

Cree un directorio llamado /vicepxx para cada partición de servidor AFS que esté configurando (tiene que haber por lo menos una). Repita el mandato para cada una de las particiones. 
   
   # mkdir /vicepxx
   

Añada una línea en el archivo de registro de sistemas de archivos /etc/fstab con el formato siguiente, para cada uno de los directorios que acabe de crear. La entrada correlaciona el nombre de directorio con la partición de disco que se deberá montar en él. 
   
   /dev/disco  /vicepxx  ext2  defaults  0  2   

A continuación se muestra un ejemplo de la primera partición que se configura. 

   
   /dev/sda8 /vicepa ext2 defaults 0 2
   

Cree un sistema de archivos en cada partición que se vaya a montar en un directorio /vicepxx. Probablemente el mandato siguiente resultará apropiado, pero consulte más información en la documentación de Linux. 
   
   # mkfs -v /dev/disco
   

Monte cada una de las particiones emitiendo el mandato mount -a para montar todas las particiones a la vez o el mandato mount para montar cada partición por turnos. 
Si piensa mantener el funcionamiento de cliente en esta máquina después de completar la instalación, siga con el apartado Habilitación del inicio de sesión de AFS en sistemas Linux. De lo contrario, siga con el apartado Inicio del Servidor BOS. 

Habilitación del inicio de sesión de AFS en sistemas Linux
Nota: Si piensa eliminar el funcionamiento de cliente de esta máquina después de completar la instalación, sáltese esta sección y siga con el apartado Inicio del Servidor BOS.  

En este punto se incorpora AFS al esquema del Módulo de autentificación conectable (PAM) del sistema operativo. PAM integra todos los mecanismos de autentificación en la máquina, incluyendo el inicio de sesión, con el fin de proporcionar la infraestructura de seguridad necesaria para un acceso autentificado a la máquina y desde ella. 

La explicación de PAM queda fuera del ámbito de este documento. Se supone que el usuario ya comprende la sintaxis y los significados de los valores del archivo de configuración de PAM (por ejemplo, cómo funciona la entrada other, el efecto de hacer que una entrada sea required, optional o sufficient, etc.). 

Las instrucciones siguientes explican cómo alterar las entradas del archivo de configuración de PAM para cada servicio en el que se desee utilizar la autentificación de AFS. Posiblemente otras configuraciones también funcionarían, pero las instrucciones especifican la configuración recomendada y comprobada. 

Las entradas relacionadas con AFS recomendadas en el archivo de configuración de PAM pueden hacer uso de uno o más de los tres atributos siguientes. 


try_first_pass 
Se trata de un atributo estándar de PAM que se puede incluir en las entradas de un servicio posteriores a la primera; éste dirige el módulo que debe utilizar la contraseña proporcionada al primer módulo. Para el módulo AFS, significa que la autentificación de AFS es satisfactoria si la contraseña proporcionada al módulo listado en primer lugar es la contraseña de AFS correcta del usuario. Para obtener una explicación adicional de este atributo y de las alternativas del mismo, consulte la documentación sobre PAM del sistema operativo. 

ignore_root 
Este atributo, específico del módulo PAM de AFS, le hace ignorar no sólo al superusuario root local, sino también a cualquier usuario cuyo UID sea 0 (cero). 

setenv_password_expires 
Este atributo, específico del módulo PAM de AFS, establece la variable de entorno PASSWORD_EXPIRES según la fecha de caducidad de la contraseña de AFS del usuario, que está registrada en la Base de datos de autentificación. 
Lleve a cabo los pasos siguientes para habilitar el inicio de sesión de AFS. 

Monte el CD-ROM de AFS para Linux en el directorio /cdrom, si no está montado todavía. A continuación, cambie al directorio para módulos PAM, que depende de la distribución de Linux que esté utilizando. 
Si está utilizando una distribución de Linux procedente de Red Hat Software: 

   
   # cd /lib/security   

Si está utilizando otra distribución de Linux: 

   
   # cd /usr/lib/security
   

Copie el archivo de bibliotecas de autentificación de AFS apropiado en el directorio al que ha cambiado en el paso anterior. Cree un enlace simbólico en cuyo nombre no se mencione la versión. El hecho de omitir la versión elimina la necesidad de editar el archivo de configuración de PAM si, más adelante, actualiza el archivo de bibliotecas. 
Si utiliza el Servidor de autentificación de AFS (proceso kaserver): 

   
   # cp /cdrom/i386_linux22/lib/pam_afs.so.1  .
   
   # ln -s pam_afs.so.1 pam_afs.so   

Si utiliza una implantación Kerberos de la autentificación de AFS: 

   
   # cp /cdrom/i386_linux22/lib/pam_afs.krb.so.1   .
   
   # ln -s pam_afs.krb.so.1 pam_afs.so
   

Para cada servicio en el que desee utilizar la autentificación de AFS, inserte una entrada para el módulo PAM de AFS en la sección auth del archivo de configuración de PAM del servicio. (Linux utiliza un archivo de configuración independiente para cada servicio, a diferencia de otros sistemas operativos que listan todos los servicios en un único archivo.) Marque la entrada como sufficient en el segundo campo. 
Coloque la entrada de AFS debajo de las entradas que impongan condiciones bajo las que desea que falle el servicio para un usuario que no cumpla con los requisitos de la entrada. Marque estas entradas como required. Coloque la entrada de AFS encima de las entradas que sólo se tengan que ejecutar si falla la autentificación de AFS. 

Si utiliza la distribución de Red Hat, inserte la entrada de AFS siguiente: 

   
   auth      sufficient /lib/security/pam_afs.so try_first_pass ignore_root   

Si utiliza otra distribución, inserte la entrada de AFS siguiente: 

   
   auth  sufficient  /usr/lib/security/pam_afs.so  try_first_pass  ignore_root   

El ejemplo siguiente ilustra la configuración recomendada para el archivo de configuración del servicio login (/etc/pam.d/login) en una máquina que utiliza la distribución de Red Hat. 

   
   #%PAM-1.0
   auth      required   /lib/security/pam_securetty.so
   auth      required   /lib/security/pam_nologin.so
   auth      sufficient /lib/security/pam_afs.so try_first_pass ignore_root
   auth      required   /lib/security/pam_pwdb.so shadow nullok
   account   required   /lib/security/pam_pwdb.so
   password  required   /lib/security/pam_cracklib.so
   password  required   /lib/security/pam_pwdb.so shadow nullok use_authtok
   session   required   /lib/security/pam_pwdb.so
   

Siga con el apartado Inicio del Servidor BOS (o, si está consultando estas instrucciones mientras instala una máquina servidor de archivos adicional, regrese al apartado Inicio de los programas de servidor). 

--------------------------------------------------------------------------------

Cómo empezar en sistemas Solaris
Empiece por ejecutar el script de inicialización de AFS que llamará al programa modload distribuido por Sun Microsystems, el cual carga dinámicamente las modificaciones de AFS en el kernel. A continuación, cree particiones para almacenar volúmenes AFS e instale y configure el programa fsck modificado por AFS para que se ejecute en las particiones de servidor AFS. Si la máquina va a permanecer como máquina cliente AFS, incorpore AFS al Módulo de autentificación conectable (PAM) de la máquina. 


Carga de AFS en el kernel de Solaris
El programa modload es el cargador dinámico del kernel proporcionado por Sun Microsystems para sistemas Solaris. Solaris no soporta la incorporación de modificaciones de AFS durante la creación de un kernel. 

Para que AFS funcione correctamente se debe ejecutar el programa modload cada vez que se rearranque la máquina, de forma que el script de inicialización de AFS (que se incluye en el CD-ROM de AFS) lo invoque automáticamente. En este apartado se copia el archivo de bibliotecas de AFS apropiado en la ubicación en la que el programa modload accede a él y, a continuación, se ejecuta el script. 

En apartados posteriores se verificará que el script inicialice correctamente todos los componentes de AFS y luego se crearán los enlaces que incorporan AFS en la secuencia de arranque y cierre de Solaris. 

Monte el CD-ROM de AFS para Solaris en el directorio /cdrom. Para obtener instrucciones sobre cómo montar los CD-ROM (ya sea local o remotamente por medio de NFS), consulte la documentación de Solaris. A continuación, cambie de directorio tal como se indica. 
   
   # cd  /cdrom/sun4x_56/root.client/usr/vice/etc
   

Copie el script de inicialización de AFS en el directorio local para archivos de inicialización (por convenio, /etc/init.d en las máquinas Solaris). Observe la eliminación de la extensión .rc cuando se copia el script. 
   
   # cp -p  afs.rc  /etc/init.d/afs
   

Copie el archivo de bibliotecas del kernel AFS apropiado en el archivo /kernel/fs/afs local. 
Si en la máquina se está ejecutando Solaris 2.6 o la versión de 32 bits de Solaris 7, el kernel soporta el funcionamiento de servidor NFS y se está ejecutando el proceso nfsd: 

   
   # cp -p modload/libafs.o /kernel/fs/afs   

Si en la máquina se está ejecutando Solaris 2.6 o la versión de 32 bits de Solaris 7 y el kernel no soporta el funcionamiento de servidor NFS o no se está ejecutando el proceso nfsd: 

   
   # cp -p modload/libafs.nonfs.o /kernel/fs/afs   

Si en la máquina se está ejecutando la versión de 64 bits de Solaris 7, el kernel soporta el funcionamiento de servidor NFS y se está ejecutando el proceso nfsd: 

   
   # cp -p modload/libafs64.o /kernel/fs/sparcv9/afs   

Si en la máquina se está ejecutando la versión de 64 bits de Solaris 7 y el kernel no soporta el funcionamiento de servidor NFS o no se está ejecutando el proceso nfsd: 

   
   # cp -p modload/libafs64.nonfs.o /kernel/fs/sparcv9/afs
   

Ejecute el script de inicialización de AFS para cargar modificaciones de AFS en el kernel. Puede hacer caso omiso de cualquier mensaje de error sobre la imposibilidad de iniciar el Servidor BOS, el Gestor de antememoria o el cliente AFS. 
   
   # /etc/init.d/afs start   

Si no existe una entrada llamada afs en el archivo local /etc/nombre_a_númsist, el script la crea automáticamente y rearranca la máquina para empezar a utilizar la nueva versión del archivo. De suceder así, inicie de nuevo una sesión como supersusuario root después del rearranque y vuelva a ejecutar el script de inicialización. Esta vez ya existirá la entrada necesaria en el archivo /etc/nombre_a_númsist y se ejecutará el programa modload. 

   
   login: root
   Contraseña: contraseña_root
   
   # /etc/init.d/afs start
   


Configuración del programa fsck modificado por AFS en sistemas Solaris
En este apartado se efectúan modificaciones para garantizar que se ejecute el programa fsck apropiado en las particiones de servidor AFS. El programa fsck proporcionado con el sistema operativo nunca se debe ejecutar en particiones de servidor AFS. Dado que no reconoce las estructuras que utiliza el Servidor de archivos para organizar datos de volúmenes, elimina todos los datos. Una vez más: 

Nunca se debe ejecutar el programa fsck estándar en particiones de servidor AFS, porque descarta los volúmenes AFS. 

Cree el directorio /usr/lib/fs/afs para alojar el programa fsck modificado por AFS y los archivos relacionados. 
  
   # mkdir /usr/lib/fs/afs
   
   # cd /usr/lib/fs/afs	
  

Copie el binario vfsck en el directorio recién creado, cambiándole el nombre al llevar a cabo la copia. 
   
   # cp  /cdrom/sun4x_56/root.server/etc/vfsck  fsck
  

Trabajando en el directorio /usr/lib/fs/afs, cree los enlaces siguientes con las bibliotecas de Solaris: 
  
   # ln -s /usr/lib/fs/ufs/clri	
   # ln -s /usr/lib/fs/ufs/df
   # ln -s /usr/lib/fs/ufs/edquota
   # ln -s /usr/lib/fs/ufs/ff
   # ln -s /usr/lib/fs/ufs/fsdb	
   # ln -s /usr/lib/fs/ufs/fsirand
   # ln -s /usr/lib/fs/ufs/fstyp
   # ln -s /usr/lib/fs/ufs/labelit
   # ln -s /usr/lib/fs/ufs/lockfs
   # ln -s /usr/lib/fs/ufs/mkfs	
   # ln -s /usr/lib/fs/ufs/mount
   # ln -s /usr/lib/fs/ufs/ncheck
   # ln -s /usr/lib/fs/ufs/newfs
   # ln -s /usr/lib/fs/ufs/quot
   # ln -s /usr/lib/fs/ufs/quota
   # ln -s /usr/lib/fs/ufs/quotaoff
   # ln -s /usr/lib/fs/ufs/quotaon
   # ln -s /usr/lib/fs/ufs/repquota
   # ln -s /usr/lib/fs/ufs/tunefs
   # ln -s /usr/lib/fs/ufs/ufsdump
   # ln -s /usr/lib/fs/ufs/ufsrestore
   # ln -s /usr/lib/fs/ufs/volcopy
   

Añada la línea siguiente al final del archivo /etc/dfs/fstypes. 
  
   afs AFS Utilities
  

Edite el archivo /sbin/mountall, efectuando dos cambios. 
Añada una entrada para AFS en la sentencia case para la opción 2, de forma que se lea lo siguiente: 
  
   case "$2" in
   ufs)    foptions="-o p"
           ;;
   afs)    foptions="-o p"
           ;;
   s5)     foptions="-y -t /var/tmp/tmp$$ -D"
           ;;
   *)      foptions="-y"
           ;;
  

Edite el archivo para que se comprueben todas las particiones de AFS y UFS en paralelo. Sustituya la sección de código siguiente: 
  
   # For  fsck purposes, we make a distinction between ufs and
   # other file systems
   #
   if [ "$fstype" = "ufs" ]; then
        ufs_fscklist="$ufs_fscklist $fsckdev"
        saveentry $fstype "$OPTIONS" $special $mountp
        continue
   fi  

por esta sección de código: 

  
   # For fsck purposes, we make a distinction between ufs/afs
   # and other file systems.
   #
   if [ "$fstype" = "ufs" -o "$fstype" = "afs" ]; then
        ufs_fscklist="$ufs_fscklist $fsckdev"
        saveentry $fstype "$OPTIONS" $special $mountp
        continue
   fi
  


Configuración de particiones de servidor en sistemas Solaris
Cada máquina servidor de archivos AFS debe tener como mínimo una partición o un volumen lógico dedicados al almacenamiento de volúmenes AFS. Cada partición de servidor se monta en un directorio denominado /vicepxx, siendo xx una o dos letras minúsculas. Los directorios /vicepxx deben residir en el directorio raíz de la máquina servidor de archivos, y no en uno de los subdirectorios del mismo (por ejemplo, /usr/vicepa no es una ubicación de directorio aceptable). Para obtener información adicional, consulte el apartado Realización de procedimientos específicos de la plataforma. 

Cree un directorio llamado /vicepxx para cada partición de servidor AFS que esté configurando (tiene que haber por lo menos una). Repita el mandato para cada una de las particiones. 
   
   # mkdir /vicepxx
   

Añada una línea en el archivo de registro de sistemas de archivos /etc/vfstab con el formato siguiente, para cada una de las particiones creadas en el paso anterior. Observe el valor afs en el cuarto campo, el cual indica a Solaris que se debe utilizar el programa fsck modificado por AFS en esta partición. 
   
   /dev/dsk/disco   /dev/rdsk/disco   /vicepxx   afs  orden_arranque  yes  

A continuación se muestra un ejemplo de la primera partición que se configura. 

  
   /dev/dsk/c0t6d0s1 /dev/rdsk/c0t6d0s1 /vicepa afs 3 yes
  

Cree un sistema de archivos en cada partición que se vaya a montar en un directorio /vicepxx. Probablemente el mandato siguiente resultará apropiado, pero consulte más información en la documentación de Solaris. 
  
   # newfs -v /dev/rdsk/disco
  

Emita el mandato mountall para montar todas las particiones a la vez 
Si piensa mantener el funcionamiento de cliente en esta máquina después de completar la instalación, siga con el apartado Habilitación del inicio de sesión de AFS y edición del script de borrado de sistemas de archivos en sistemas Solaris. De lo contrario, siga con el apartado Inicio del Servidor BOS. 

Habilitación del inicio de sesión de AFS y edición del script de borrado de sistemas de archivos en sistemas Solaris
Nota: Si piensa eliminar el funcionamiento de cliente de esta máquina después de completar la instalación, sáltese esta sección y siga con el apartado Inicio del Servidor BOS.  

En este punto se incorpora AFS al esquema del Módulo de autentificación conectable (PAM) del sistema operativo. PAM integra todos los mecanismos de autentificación en la máquina, incluyendo el inicio de sesión, con el fin de proporcionar la infraestructura de seguridad necesaria para un acceso autentificado a la máquina y desde ella. 

La explicación de PAM queda fuera del ámbito de este documento. Se supone que el usuario ya comprende la sintaxis y los significados de los valores del archivo de configuración de PAM (por ejemplo, cómo funciona la entrada other, el efecto de hacer que una entrada sea required, optional o sufficient, etc.). 

Las instrucciones siguientes explican cómo alterar las entradas del archivo de configuración de PAM para cada servicio en el que se desee utilizar la autentificación de AFS. Posiblemente otras configuraciones también funcionarían, pero las instrucciones especifican la configuración recomendada y comprobada. Nota: Las instrucciones especifican que se debe marcar cada entrada como optional. Sin embargo, el hecho de marcar algunos módulos como opcionales puede significar que éstos otorguen acceso al servicio correspondiente aunque el usuario no cumpla con todos los requisitos del módulo. Por ejemplo, en algunas revisiones del sistema operativo, si se marca como opcional el módulo que controla los inicios de sesión mediante una conexión de marcación, se permite a los usuarios iniciar sesiones sin proporcionar contraseña alguna. Para obtener una explicación de las limitaciones que se aplican a este sistema operativo, consulte las IBM AFS Release Notes. 
Asimismo, con algunas versiones del sistema operativo se deben instalar parches para que PAM interactúe correctamente con determinados programas de autentificación. Para conocer los detalles, consulte las IBM AFS Release Notes. 
 


Las entradas relacionadas con AFS recomendadas en el archivo de configuración de PAM pueden hacer uso de uno o más de los tres atributos siguientes. 


try_first_pass 
Se trata de un atributo estándar de PAM que se puede incluir en las entradas de un servicio posteriores a la primera; éste dirige el módulo que debe utilizar la contraseña proporcionada al primer módulo. Para el módulo AFS, significa que la autentificación de AFS es satisfactoria si la contraseña proporcionada al módulo listado en primer lugar es la contraseña de AFS correcta del usuario. Para obtener una explicación adicional de este atributo y de las alternativas del mismo, consulte la documentación sobre PAM del sistema operativo. 

ignore_root 
Este atributo, específico del módulo PAM de AFS, le hace ignorar no sólo al superusuario root local, sino también a cualquier usuario cuyo UID sea 0 (cero). 

setenv_password_expires 
Este atributo, específico del módulo PAM de AFS, establece la variable de entorno PASSWORD_EXPIRES según la fecha de caducidad de la contraseña de AFS del usuario, que está registrada en la Base de datos de autentificación. 
Lleve a cabo los pasos siguientes para habilitar el inicio de sesión de AFS. 

Monte el CD-ROM de AFS para Solaris en el directorio /cdrom, si no está montado todavía. A continuación, cambie de directorio tal como se indica. 
  
   # cd /usr/lib/security
   

Copie el archivo de bibliotecas de autentificación de AFS en el directorio /usr/lib/security. Luego, cree un enlace simbólico en cuyo nombre no se mencione la versión. El hecho de omitir la versión elimina la necesidad de editar el archivo de configuración de PAM si, más adelante, se actualiza el archivo de bibliotecas. 
Si utiliza el Servidor de autentificación de AFS (proceso kaserver): 

  
   # cp /cdrom/sun4x_56/lib/pam_afs.so.1 .
  
   # ln -s pam_afs.so.1 pam_afs.so   

Si utiliza una implantación Kerberos de la autentificación de AFS: 

     
   # cp /cdrom/sun4x_56/lib/pam_afs.krb.so.1 .
  
   # ln -s pam_afs.krb.so.1 pam_afs.so
   

Edite la sección Authentication management del archivo de configuración de PAM de Solaris, por convenio /etc/pam.conf. Las entradas de esta sección tienen el valor auth en el segundo campo. 
En primer lugar, edite las entradas estándar, que hacen referencia al módulo PAM de Solaris (habitualmente, el archivo /usr/lib/security/pam_unix.so.1) en el cuarto campo. Para cada servicio en el que desee que se utilice la autentificación de AFS, edite el tercer campo de la entrada correspondiente de forma que contenga el valor optional. El archivo pam.conf de la distribución de Solaris suele incluir entradas estándar, por ejemplo, para los servicios rlogin y rsh. 

Si hay servicios en los que desea que se utilice la autentificación de AFS pero para los cuales el archivo pam.conf no incluye todavía una entrada estándar, debe crear dicha entrada y colocar el valor optional en el tercer campo de la misma. Por ejemplo, el archivo pam.conf de Solaris no suele incluir entradas estándar para los servicios ftp ni telnet. 

Seguidamente, cree una entrada relativa a AFS para cada servicio, colocándola inmediatamente debajo de la entrada estándar. El ejemplo siguiente muestra el aspecto de la sección Authentication Management después de haber editado o creado entradas para los servicios mencionados anteriormente. Observe que las entradas de AFS del ejemplo aparecen en dos líneas únicamente para que se puedan leer sin dificultad. 

  
   login   auth  optional  /usr/lib/security/pam_unix.so.1
   login   auth  optional  /usr/lib/security/pam_afs.so       \
         try_first_pass  ignore_root  setenv_password_expires
   rlogin  auth  optional  /usr/lib/security/pam_unix.so.1
   rlogin  auth  optional  /usr/lib/security/pam_afs.so       \
         try_first_pass  ignore_root  setenv_password_expires
   rsh     auth  optional  /usr/lib/security/pam_unix.so.1
   rsh     auth  optional  /usr/lib/security/pam_afs.so       \
         try_first_pass  ignore_root		
   ftp     auth  optional  /usr/lib/security/pam_unix.so.1
   ftp     auth  optional  /usr/lib/security/pam_afs.so       \
         try_first_pass  ignore_root
   telnet  auth  optional  /usr/lib/security/pam_unix.so.1
   telnet  auth  optional  /usr/lib/security/pam_afs.so       \
         try_first_pass  ignore_root  setenv_password_expires
   

Si utiliza Common Desktop Environment (CDE) en la máquina y desea que los usuarios obtengan una señal de AFS al inicio de sesión, añada o edite también las cuatro entradas siguientes de la sección Authentication management. Observe que las entradas relativas a AFS del ejemplo aparecen en dos líneas únicamente para que se puedan leer sin dificultad. 
   
   dtlogin   auth  optional  /usr/lib/security/pam_unix.so.1
   dtlogin   auth  optional  /usr/lib/security/pam_afs.so     \
         try_first_pass  ignore_root
   dtsession  auth  optional /usr/lib/security/pam_unix.so.1
   dtsession  auth  optional /usr/lib/security/pam_afs.so     \
         try_first_pass  ignore_root
   

Algunas distribuciones de Solaris incluyen un script que localiza y elimina los archivos innecesarios de diversos sistemas de archivos. Su ubicación convencional es /usr/lib/fs/nfs/nfsfind. Generalmente, el script utiliza un argumento del mandato find para definir en qué sistemas de archivos se debe buscar. En este paso se modifica dicho mandato para excluir el directorio /afs. De no hacerlo, el mandato recorre el espacio de archivos AFS de cada una de las células a las que se puede acceder desde la máquina, operación que puede tardar muchas horas. Las alteraciones siguientes constituyen posibilidades, pero debe verificar que son apropiadas para su célula. 
La primera alteración posible consiste en añadir el distintivo -local al mandato existente, de forma que tenga el aspecto siguiente: 

  
   find $dir -local -name .nfs\* -mtime +7 -mount -exec rm -f {} \;   

Otra alternativa consiste en excluir los directorios cuyos nombres empiecen por la letra a minúscula o un carácter no alfabético. 

  
   find /[A-Zb-z]*  resto del mandato existente

No utilice el mandato siguiente, que continúa buscando en el directorio /afs un subdirectorio de tipo 4.2. 

  
   find / -fstype 4.2     /* no utilizar */
   

Siga con el apartado Inicio del Servidor BOS (o, si está consultando estas instrucciones mientras instala una máquina servidor de archivos adicional, regrese al apartado Inicio de los programas de servidor). 

--------------------------------------------------------------------------------

Inicio del Servidor BOS
Ahora ya está preparado para iniciar los procesos de servidor AFS en esta máquina. Empiece por copiar los binarios de servidor AFS del CD-ROM en la ubicación de disco local convencional, el directorio /usr/afs/bin. Las instrucciones siguientes también crean archivos en otros subdirectorios del directorio /usr/afs. 

A continuación, emita el mandato bosserver para inicializar el Servidor Basic OverSeer (BOS), que supervisa y controla otros procesos de servidor AFS en su máquina servidor. Incluya el distintivo -noauth para inhabilitar la comprobación de la autorización. Dado que todavía no ha configurado los mecanismos de autentificación y autorización de AFS en la célula, el Servidor BOS no puede realizar una comprobación de la autorización tal como lo hace durante un funcionamiento normal. En modalidad sin autorización, no verifica la identidad ni el privilegio del emisor de un mandato bos, por lo que realiza cualquier operación para cualquier emisor. 

Una inhabilitación de la comprobación de la autorización compromete seriamente la seguridad de la célula. Debe completar todos los pasos posteriores en una pasada ininterrumpida y no debe dejar la máquina desatendida hasta que reinicie el Servidor BOS habilitando la comprobación de la seguridad, tal como se indica en el apartado Verificación del script de inicialización de AFS. 

Cuando realiza una inicialización por primera vez, el Servidor BOS crea los directorios y archivos siguientes, estableciendo como propietario el superusuario local root, así como bits de modalidad para limitar las posibilidades de grabación (y, en determinados casos, de lectura) de los mismos. Para obtener una descripción del contenido y de las funciones de estos directorios y archivos, consulte el capítulo de la publicación IBM AFS Administration Guide que trata sobre la administración de máquinas servidor. Para obtener una explicación adicional de los valores de los bits de modalidad, consulte el apartado Protección de directorios delicados de AFS. 

/usr/afs/db 
/usr/afs/etc/CellServDB 
/usr/afs/etc/ThisCell 
/usr/afs/local 
/usr/afs/logs 
El Servidor BOS también crea enlaces simbólicos denominados /usr/vice/etc/ThisCell y /usr/vice/etc/CellServDB con los archivos correspondientes del directorio /usr/afs/etc. Los intérpretes de mandatos de AFS consultan los archivos CellServDB y ThisCell del directorio /usr/vice/etc porque generalmente se ejecutan en máquinas cliente. En las máquinas que sólo son servidores AFS (tal como es esta máquina actualmente), los archivos sólo residen en el directorio /usr/afs/etc; los enlaces permiten que los intérpretes de mandatos recuperen la información que necesitan. Las instrucciones posteriores para instalar el funcionamiento de cliente sustituyen los enlaces por archivos reales. 

En el directorio local /cdrom, monte el CD-ROM de AFS para el tipo de sistema de esta máquina, si no está montado todavía. Para obtener instrucciones sobre cómo montar los CD-ROM (ya sea local o remotamente por medio de NFS), consulte la documentación del sistema operativo. 
Copie archivos del CD-ROM en el directorio local /usr/afs. 
   
   # cd /cdrom/nombre_sist/root.server/usr/afs
   
   # cp -rp  *  /usr/afs
   

Emita el mandato bosserver. Incluya el distintivo -noauth para inhabilitar la comprobación de la autorización. 

   
   # /usr/afs/bin/bosserver -noauth &
   

Verifique que el Servidor BOS haya creado /usr/vice/etc/ThisCell y /usr/vice/etc/CellServDB como enlaces simbólicos con los archivos correspondientes del directorio /usr/afs/etc. 
   
   # ls -l  /usr/vice/etc

Si /usr/vice/etc/ThisCell o /usr/vice/etc/CellServDB no existen, o si no son enlaces, emita los mandatos siguientes. 

   
   # cd /usr/vice/etc
   
   # ln -s /usr/afs/etc/ThisCell
   
   # ln -s /usr/afs/etc/CellServDB 
    


--------------------------------------------------------------------------------

Definición del nombre de célula y de la calidad de miembro para procesos de servidor
Asigne ahora el nombre de la célula. El capítulo de la publicación IBM AFS Administration Guide que trata sobre la configuración y administración de células explica las consideraciones importantes, expone porqué resulta difícil cambiar el nombre y perfila las restricciones sobre el formato de los nombres. Dos de las restricciones más importantes son que el nombre no puede incluir letras mayúsculas ni más de 64 caracteres. 

Utilice el mandato bos setcellname para asignar el nombre de célula. Este mandato crea dos archivos: 

/usr/afs/etc/ThisCell, que define la calidad de miembro de la célula de esta máquina 
/usr/afs/etc/CellServDB, que lista las máquinas servidor de base de datos de la célula; la máquina mencionada en la línea de mandatos se coloca automáticamente en la lista 
Nota: En las instrucciones siguientes, y en todas las contenidas en esta guía, sustituya el argumento nombre máquina por el nombre de sistema principal completamente cualificado de la máquina que está instalando (por ejemplo, fs1.abc.com). Sustituya el argumento nombre célula por el nombre completo de la célula (por ejemplo, abc.com).  

Emita el mandato bos setcellname para establecer el nombre de célula. 
   
   # cd /usr/afs/bin
      
   # ./bos setcellname <nombre máquina> <nombre célula> -noauth

Dado que no se ha autentificado y que está inhabilitada la comprobación de la autorización, el intérprete de mandatos bos posiblemente generará mensajes de error sobre la imposibilidad de obtener certificados y de funcionar si no se ha autentificado. Puede hacer caso omiso de los mensajes. 

Emita el mandato bos listhosts para verificar que la máquina que está instalando está ahora registrada como primera máquina servidor de base de datos de la célula. 
   
   # ./bos listhosts <nombre máquina> -noauth
   Cell name is nombre_célula
       Host 1 is nombre_máquina
   


--------------------------------------------------------------------------------

Inicio de los procesos de servidor de base de datos
A continuación, utilice el mandato bos create para crear entradas para los cuatro procesos de servidor de base de datos en el archivo /usr/afs/local/BosConfig y empiece a ejecutarlos. Los cuatro procesos sólo se ejecutan en máquinas servidor de base de datos: 

El Servidor de autentificación (proceso kaserver) mantiene la Base de datos de autentificación 
El Servidor de copia de seguridad (proceso buserver) mantiene la Base de datos de copia de seguridad 
El Servidor de protección (proceso ptserver) mantiene la Base de datos de protección 
El Servidor de ubicación de volúmenes (VL) (proceso vlserver) mantiene la Base de datos de ubicación de volúmenes (VLDB) 
Nota: El software de autentificación y autorización de AFS se basa en algoritmos y otros procedimientos conocidos como Kerberos, desarrollados originalmente por Project Athena en el Massachusetts Institute of Technology. En algunas células se elige sustituir el Servidor de autentificación de AFS y otros protocolos relativos a la seguridad por Kerberos, tal como se obtiene directamente de Project Athena o de otras fuentes. Si así lo desea, póngase ahora en contacto con el grupo de soporte del producto AFS para averiguar las modificaciones que es necesario efectuar en la instalación.  

Las instrucciones restantes de este capítulo incluyen el argumento -cell en todos los mandatos pertinentes. Proporcione el nombre de célula que ha asignado en el apartado Definición del nombre de célula y de la calidad de miembro para procesos de servidor. Si un mandato aparece en varias líneas, sólo es así para que se pueda leer sin dificultad. 

Emita el mandato bos create para iniciar el Servidor de autentificación. El directorio de trabajo actual sigue siendo /usr/afs/bin. 
   
   # ./bos create <nombre máquina> kaserver simple /usr/afs/bin/kaserver  \
                   -cell <nombre célula>  -noauth   

Puede hacer caso omiso de los mensajes que le indiquen que añada Kerberos al archivo /etc/services; AFS utiliza un valor por omisión que hace que dicha adición sea innecesaria. También puede hacer caso omiso de los mensajes relativos a una anomalía en la autentificación. 

Emita el mandato bos create para iniciar el Servidor de copia de seguridad. 
   
   # ./bos create <nombre máquina> buserver simple /usr/afs/bin/buserver  \
                   -cell <nombre célula>  -noauth
   

Emita el mandato bos create para iniciar el Servidor de protección. 
   
   # ./bos create <nombre máquina> ptserver simple /usr/afs/bin/ptserver  \
                   -cell <nombre célula>  -noauth
   

Emita el mandato bos create para iniciar el Servidor de VL. 
   
   # ./bos create <nombre máquina> vlserver simple /usr/afs/bin/vlserver  \
                   -cell <nombre célula>  -noauth
   


--------------------------------------------------------------------------------

Inicialización de la seguridad de la célula
Inicialice ahora los mecanismos de seguridad de la célula. Empiece por crear las dos entradas iniciales siguientes en la Base de autentificación: 

Un perfil de administración genérico, llamado por convenio admin. Si decide asignarle otro nombre, sustitúyalo en el resto de este documento. 
Después de completar la instalación de la primera máquina, puede continuar haciendo que todos los administradores utilicen el perfil admin, o puede crear un perfil de administración independiente para cada uno de ellos. El último esquema implica algo más de actividad general, pero proporciona un seguimiento de comprobación más informativo para las operaciones administrativas. 

La entrada para los procesos de servidor AFS, llamada afs. Ningún usuario inicia sesiones bajo esta identidad, pero el módulo Servicio de otorgamiento de certificados (TGS) del Servidor de autentificación utiliza la clave asociada para cifrar los certificados de servidor que otorga a los clientes AFS para su presentación a procesos de servidor durante una autentificación mutua. (El capítulo de la publicación IBM AFS Administration Guide que trata sobre la configuración y administración de células describe la función de las claves de cifrado de servidor en la autentificación mutua.) 
En el paso 7, coloque también la clave de cifrado inicial del servidor AFS en el archivo /usr/afs/etc/KeyFile. Los procesos de servidor AFS consultan este archivo para averiguar la clave de cifrado del servidor cuando necesitan descifrar certificados de servidor. 

También se emiten varios mandatos que permiten que el nuevo usuario admin emita mandatos privilegiados de todos los juegos de AFS. 

Las instrucciones siguientes no configuran todos los mecanismos de seguridad relacionadas con el Sistema de copia de seguridad de AFS. Consulte el capítulo de la publicación IBM AFS Administration Guide que trata sobre la configuración del Sistema de copia de seguridad. 

Entre en la modalidad interactiva kas. Dado que la máquina está en una modalidad en que no se comprueba la autorización, incluya el distintivo -noauth para suprimir el mensaje de solicitud habitual de contraseña del Servidor de autentificación. 
   
   # kas  -cell <nombre célula>  -noauth
   ka>
  

Emita el mandato kas create para crear, en la Base de datos de autentificación, las entradas denominadas admin y afs. 
No proporcione ninguna contraseña en la línea de mandatos. En lugar de esto, proporciónelas como contraseña_afs y contraseña_admin en respuesta a los mensajes de solicitud del intérprete de mandatos kas tal como se muestra, de forma que no aparezcan en la corriente de salida estándar. 

Sólo es necesario entrar la serie contraseña_afs en este paso y en el paso 7, por lo que debe proporcionar un valor que sea tan largo y complejo como sea posible, que preferentemente incluya números, signos de puntuación y letras mayúsculas y minúsculas. Elabore también una contraseña_admin tan larga y compleja como sea posible, pero recuerde que los administradores la tendrán que entrar con frecuencia. Ambas contraseñas deben tener una longitud mínima de seis caracteres. 

   
   ka> create afs 
   initial_password:  contraseña_afs
   Verifying, please re-enter initial_password: contraseña_afs
    
   ka> create admin
   initial_password: contraseña_admin
   Verifying, please re-enter initial_password: contraseña_admin
   

Emita el mandato kas examine para visualizar la entrada afs. La salida incluye una suma de comprobación generada por el cifrado de una constante con la clave de cifrado del servidor deducida de la serie contraseña_afs. En el paso 8 se emite el mandato bos listkeys para verificar que la suma de comprobación incluida en la salida coincide con la suma de comprobación de esta salida. 
   
   ka> examine afs
   User data for afs
    key (0) cksum is suma_comprobación . . .
   

Emita el mandato kas setfields para activar el distintivo ADMIN en la entrada admin. Esto permite que el usuario admin emita mandatos privilegiados kas. A continuación, emita el mandato kas examine para verificar que el distintivo ADMIN aparece entre paréntesis en la primera línea de salida, tal como se muestra en el ejemplo. 
   
   ka> setfields admin -flags admin
   
   ka> examine admin 
   User data for admin (ADMIN) . . .
     

Emita el mandato kas quit para salir de la modalidad interactiva de kas. 
   
   ka> quit
   

Emita el mandato bos adduser para añadir el usuario admin al archivo /usr/afs/etc/UserList. Esto permite que el usuario admin emita mandatos privilegiados bos y vos. 
   
   # ./bos adduser <nombre máquina> admin -cell <nombre célula> -noauth
   

Emita el mandato bos addkey para definir la clave de cifrado de servidor AFS en el archivo /usr/afs/etc/KeyFile. 
No proporcione la contraseña en la línea de mandatos. En lugar de ello, proporciónela como contraseña_afs en respuesta a los mensajes de solicitud del intérprete de mandatos bos, tal como se muestra. Proporcione la misma serie que en el paso 2. 

   
   # ./bos addkey <nombre máquina> -kvno 0 -cell <nombre célula>  -noauth
   Input key: contraseña_afs
   Retype input key: contraseña_afs
   

Emita el mandato bos listkeys para verificar que la suma de comprobación de la nueva clave en el archivo KeyFile es igual que la suma de comprobación de la clave en la entrada afs de la Base de datos de autentificación, que ha visualizado en el paso 3. 
   
   # ./bos listkeys <nombre máquina> -cell <nombre célula> -noauth 
   key 0 has cksum suma_comprobación    

Puede hacer caso omiso de los mensajes de error que indiquen que bos no ha podido obtener certificados o que la autentificación ha fallado. 

Si las claves son diferentes, emita los mandatos siguientes asegurándose de que la serie contraseña_afs sea igual en todos los casos. Las series suma_comprobación informadas por los mandatos kas examine y bos listkeys deben coincidir; de no ser así, repita estas instrucciones hasta que lo consiga, utilizando el argumento -kvno para incrementar cada vez el número de versión de la clave. 

   
   # ./kas  -cell <nombre célula>  -noauth
       
   ka> setpassword afs -kvno 1 
   new_password:  contraseña_afs
   Verifying, please re-enter initial_password: contraseña_afs
   
   ka> examine afs
   User data for afs
    key (1) cksum is suma_comprobación . . .
  
   ka> quit
  
   # ./bos addkey <nombre máquina> -kvno 1 -cell <nombre célula> -noauth
   Input key: contraseña_afs
   Retype input key: contraseña_afs
   
   # ./bos listkeys <nombre máquina> -cell <nombre célula> -noauth 
   key 1 has cksum suma_comprobación
   

Emita el mandato pts createuser para crear, en la Base de datos de protección, una entrada para el usuario admin. 
Por omisión, el Servidor de protección asigna el UID 1 (uno) de AFS al usuario admin, puesto que es la primera entrada de usuario que se crea. Si el archivo de contraseñas local (/etc/passwd o equivalente) ya contiene una entrada para admin que le asigna un UID de UNIX distinto de 1, es mejor utilizar el argumento -id con el mandato pts createuser para hacer que el nuevo UID de AFS coincida con el UID de UNIX existente. De no hacerlo así, es mejor aceptar el valor por omisión. 

   
   # ./pts createuser -name admin -cell <nombre célula> [-id <AFS UID>]  -noauth
   User admin has id AFS UID
   

Emita el mandato pts adduser, para hacer que el usuario admin sea miembro del grupo system:administrators, y el mandato pts membership, para verificar la calidad de nuevo miembro. La calidad de miembro del grupo permite que el usuario admin emita mandatos privilegiados pts y algunos mandatos privilegiados fs. 
   
   # ./pts adduser admin system:administrators -cell <nombre célula> -noauth
   
   # ./pts membership admin -cell  <nombre célula>  -noauth
   Groups admin (id: 1) is a member of:
     system:administrators
   

Emita el mandato bos restart con el distintivo -all para reiniciar los procesos de servidor de base de datos, de forma que empiecen a utilizar la nueva clave de cifrado de servidor. 
   
   # ./bos restart <nombre máquina> -all -cell <nombre célula> -noauth
   


--------------------------------------------------------------------------------

Inicio del Servidor de archivos, del Servidor de volúmenes y del Recuperador
Inicie el proceso fs, que consta del Servidor de archivos, el Servidor de volúmenes y el Recuperador (procesos fileserver, volserver y salvager). 

Emita el mandato bos create para iniciar el proceso fs. El mandato aparece aquí en varias líneas únicamente para que se pueda leer sin dificultad. 
   
   # ./bos create  <nombre máquina> fs fs /usr/afs/bin/fileserver   \
                   /usr/afs/bin/volserver /usr/afs/bin/salvager  \
                   -cell <nombre célula>  -noauth   

Algunas veces aparece un mensaje de inicialización de la Base de datos de ubicación de volúmenes (VLDB), junto con una o más instancias de un mensaje de error parecido al siguiente: 

   
   FSYNC_clientInit temporary failure (will retry)   

Este mensaje aparece este cuando el proceso volserver intenta comenzar antes de que el proceso fileserver haya finalizado su inicialización. Antes de continuar, espere unos minutos después del último de dichos mensajes a fin de garantizar que ambos procesos se hayan iniciado satisfactoriamente. 

Puede verificar que el proceso fs se ha iniciado satisfactoriamente emitiendo el mandato bos status. La salida del mismo menciona dos proc starts. 

  
   # ./bos status <nombre máquina> fs -long -noauth
   

La acción que se debe emprender seguidamente dependerá de si alguna vez ha ejecutado máquinas servidor de archivos AFS en la célula: 
Si está instalando la primera máquina servidor AFS que ha existido en la célula (es decir, si no está actualizando el software de AFS a partir de una versión anterior), cree el primer volumen AFS, root.afs. 
Sustituya el argumento nombre partición por el nombre de una de las particiones de servidor AFS de la máquina (por ejemplo, /vicepa). 

  
   # ./vos create  <nombre máquina> <nombre partición> root.afs   \
                   -cell <nombre célula>  -noauth   

El Servidor de volúmenes produce un mensaje que confirma que ha creado el volumen en la partición especificada. Puede hacer caso omiso de los mensajes de error que indiquen que faltan señales o que la autentificación ha fallado. 

Si en la célula existen volúmenes y máquinas servidor de archivos AFS, emita los mandatos vos syncvldb y vos syncserv para sincronizar la VLDB con el estado real de los volúmenes de la máquina local. Para seguir el proceso de la operación de sincronización, que puede tardar varios minutos, utilice el distintivo -verbose. 
  
   # ./vos syncvldb <nombre máquina> -cell <nombre célula> -verbose  -noauth 
  
   # ./vos syncserv <nombre máquina> -cell <nombre célula> -verbose  -noauth   

Puede hacer caso omiso de los mensajes de error que indiquen que faltan señales o que la autentificación ha fallado. 


--------------------------------------------------------------------------------

Inicio de la porción de servidor del Servidor de actualización
Inicie la porción de servidor del Servidor de actualización (proceso upserver) para distribuir el contenido de los directorios de esta máquina a otras máquinas servidor de la célula. Se activa cuando se configura la porción de cliente del Servidor de actualización en máquinas servidor adicionales. 

La distribución del contenido del directorio /usr/afs/etc hace de esta máquina la máquina de control del sistema de la célula. Las otras máquinas servidor de la célula ejecutan el proceso upclientetc (una instancia de la porción de cliente del Servidor de actualización) para recuperar los archivos de configuración. Utilice el argumento -crypt del mandato de inicialización upserver para especificar que el Servidor de actualización sólo distribuya el contenido del directorio /usr/afs/etc en formato cifrado, tal como se muestra en la instrucción siguiente. Varios de los archivos del directorio, especialmente el archivo KeyFile, resultan cruciales para la seguridad de la célula y, por consiguiente, nunca deben cruzar la red sin estar cifrados. 

(Puede elegir no configurar una máquina de control del sistema, en cuyo caso debe actualizar los archivos de configuración del directorio /usr/afs/etc de cada máquina servidor individualmente. Los mandatos bos utilizados para este propósito cifran los datos antes de enviarlos por la red.) 

La distribución del contenido del directorio /usr/afs/bin a otras máquinas servidor del mismo tipo de sistema hace de esta máquina una máquina de distribución de binarios. Las otras máquinas servidor del mismo tipo de sistema ejecutan el proceso upclientbin (una instancia de la porción de cliente del Servidor de actualización) para recuperar los binarios. 

Los binarios del directorio /usr/afs/bin no son delicados, por lo que no es necesario cifrarlos antes de transferirlos por la red. Incluya el argumento -clear en el mandato de inicialización upserver para especificar que el Servidor de actualización distribuye el contenido del directorio /usr/afs/bin en formato descifrado a no ser que un proceso upclientbin solicite una transferencia cifrada. 

Observe que las porciones de servidor y cliente del Servidor de actualización siempre se autentifican mutuamente, aunque utilice los argumentos -clear o -crypt. Esto protege en cierta medida sus comunicaciones frente a escuchas escondidas. 

Para obtener más información sobre los procesos upclient y upserver, remítase a las páginas de consulta correspondientes a los mismos en la publicación IBM AFS Administration Reference. Los mandatos aparecen aquí en varias líneas únicamente para que se puedan leer sin dificultad. 

Emita el mandato bos create para iniciar el proceso upserver. 
   
   # ./bos create  <nombre máquina upserver simple  \
             "/usr/afs/bin/upserver  -crypt /usr/afs/etc    \
             -clear /usr/afs/bin" -cell <nombre célula>  -noauth 
   


--------------------------------------------------------------------------------

Inicio del controlador para NTPD
El hecho de mantener sincronizados los relojes de todas las máquinas servidor y cliente de la célula resulta crucial para varias funciones, y en especial para un funcionamiento correcto de la tecnología de bases de datos distribuidas de AFS, Ubik. El capítulo de la publicación IBM AFS Administration Guide que trata sobre la administración de máquinas servidor explica cómo un desvío en el tiempo puede alterar el rendimiento de Ubik y ocasionar interrupciones del servicio en la célula. 

La distribución de AFS incluye una versión del Network Time Protocol Daemon (NTPD) para sincronizar los relojes en máquinas servidor. Si en la máquina todavía no hay un programa de sincronización de horas en ejecución, en este apartado se inicia el proceso runntp para configurar NTPD para utilizarlo con AFS. Nota: No ejecute el proceso runntp si en la máquina ya se está ejecutando NTPD u otro protocolo de sincronización de horas. Algunas versiones de sistemas operativos ejecutan, por omisión, un programa de sincronización de horas, tal como se detalla en las IBM AFS Release Notes. 
Un intento de ejecutar varias instancias de NTPD genera un error. El hecho de ejecutar NTPD junto con otro protocolo de sincronización de horas resulta innecesario y puede ocasionar inestabilidad en el establecimiento del reloj. 
 


Si ejecuta el proceso runntp y la célula tiene una conectividad de red fiable con máquinas que se encuentran fuera de la célula, lo convencional es configurar la primera máquina AFS de forma que consulte una fuente horaria externa a la célula. Más adelante, cuando se instala el programa runntp en otras máquinas servidor de la célula, éste configura NTPD para elegir una fuente horaria al azar entre las máquinas servidor de base de datos listadas en el archivo /usr/afs/etc/CellServDB. Por esta razón, la sincronización de horas funciona de manera encadenada: esta máquina servidor de base de datos consulta una fuente horaria externa a la célula, las máquinas servidor de base de datos consultan a la máquina, de entre todas, que tiene acceso a la hora más exacta (el propio NTPD incluye código para determinar este aspecto) y cada máquina servidor que no lo es de base de datos consulta una máquina servidor de base de datos local aleatoria del archivo /usr/afs/etc/CellServDB. Si en algún momento decide eliminar de esta máquina el funcionamiento de servidor de base de datos, es mejor transferir la responsabilidad de consultar una fuente horaria externa a una máquina servidor de base de datos que siga funcionando. 

Si la célula no tiene conectividad de red con máquinas externas, o si la conectividad no es fiable, incluya el distintivo -localclock en el mandato runntp, tal como se indica en las instrucciones siguientes. Este distintivo indica a NTPD que confíe en el reloj interno de la máquina cuando todas las fuentes horarias externas sean inaccesibles. El mandato runntp tiene otros argumentos que posiblemente resultarán útiles dada la configuración de la célula; consulte la publicación IBM AFS Administration Reference. 

La elección de una fuente horaria externa apropiada es importante, pero implica más consideraciones que las que se pueden tratar aquí. Si necesita ayuda para seleccionar una fuente, póngase en contacto con el grupo de soporte del producto AFS. 

Puesto que el proceso runntp inicializa NTPD, algunas veces aparecen mensajes de rastreo en la corriente de salida estándar. Puede hacer caso omiso de ellos, pero pueden resultar informativos si se conoce el funcionamiento de NTPD. 

Emita el mandato bos create para iniciar el proceso runntp. Sustituya el argumento sist_princ por el nombre de sistema principal completamente cualificado, o la dirección IP, de una o más máquinas que se encuentren fuera de la célula y vayan a servir de fuentes horarias. Separe los nombres mediante un espacio. 
Si la célula suele tener una conectividad de red fiable con una fuente horaria externa, utilice el mandato siguiente: 
   
   # ./bos create  <nombre máquina>  runntp simple   \
        "/usr/afs/bin/runntp <sist_princ>+"  -cell <nombre célula>  -noauth
   

Si la célula no tiene una conectividad de red fiable con una fuente horaria externa, utilice el mandato siguiente: 
   
   # ./bos create   <nombre máquina>   runntp simple   \
        "/usr/afs/bin/runntp -localclock"  -cell <nombre célula>  -noauth
   

Si la célula tiene conectividad de red con una fuente horaria externa pero la conexión de la red se interrumpe con frecuencia, utilice el mandato siguiente: 
   
   # ./bos create   <nombre máquina>   runntp simple   \
         "/usr/afs/bin/runntp -localclock <sist_princ>+"  \
                   -cell <nombre célula>  -noauth
   


--------------------------------------------------------------------------------

Visión general: Instalación del funcionamiento de cliente
La máquina que está instalando es ahora una máquina servidor de archivos AFS, una máquina servidor de base de datos y una máquina de distribución de binarios. Haga de ella una máquina cliente realizando las tareas siguientes: 

Defina la calidad de miembro de la célula por parte de la máquina para procesos cliente 
Cree la versión de cliente del archivo CellServDB 
Defina la ubicación y el tamaño de la antememoria 
Cree el directorio /afs e inicie el Gestor de antememoria 

--------------------------------------------------------------------------------

Copia de archivos cliente en el disco local
Antes de instalar y configurar el cliente AFS, copie los archivos necesarios desde el CD-ROM de AFS en el directorio local /usr/vice/etc. 

En el directorio local /cdrom, monte el CD-ROM de AFS para el tipo de sistema de esta máquina, si no está montado todavía. Para obtener instrucciones sobre cómo montar los CD-ROM (ya sea local o remotamente por medio de NFS), consulte la documentación del sistema operativo. 
Copie archivos en el directorio local /usr/vice/etc. 
Este paso coloca una copia del script de inicialización de AFS (y de los archivos relacionados, si es pertinente) en el directorio /usr/vice/etc. En las instrucciones precedentes para incorporar AFS en el kernel, se ha copiado el script directamente en la ubicación convencional del sistema operativo para archivos de inicialización. Cuando incorpore AFS en la secuencia de arranque de la máquina, en un paso posterior, podrá enlazar los dos archivos. 

En algunos tipos de sistema que utilizan un programa cargador dinámico de kernel, previamente habrá copiado los archivos de bibliotecas de AFS en un subdirectorio del directorio /usr/vice/etc. En otros tipos de sistema, habrá copiado el archivo de bibliotecas de AFS apropiado directamente en el directorio al cual accede el sistema operativo. Los mandatos siguientes no copian ni vuelven a copiar los archivos de bibliotecas de AFS en el directorio /usr/vice/etc, puesto que en algunos tipos de sistema los archivos de bibliotecas consumen una gran cantidad de espacio. Si desea copiarlos, añada el distintivo -r al primer mandato cp y sáltese el segundo mandato cp. 

   
   # cd /cdrom/nombre_sist/root.client/usr/vice/etc
   
   # cp -p  *  /usr/vice/etc
  
   # cp -rp  C  /usr/vice/etc
   


--------------------------------------------------------------------------------

Definición de la calidad de miembro de la célula para procesos de cliente
Cada máquina cliente AFS tiene una copia del archivo /usr/vice/etc/ThisCell en su disco local para definir la calidad de miembro de la célula por parte de la máquina para los programas de cliente AFS que se ejecuten en ella. El archivo ThisCell que ha creado en el directorio /usr/afs/etc (en el apartado Definición del nombre de célula y de la calidad de miembro para procesos de servidor) sólo lo utilizan los procesos de servidor. 

Entre otras funciones, el archivo ThisCell de una máquina cliente determina lo siguiente: 

La célula en la que se autentifican los usuarios cuando inician una sesión en la máquina, suponiendo que ésta utilice un programa de utilidad de inicio de sesión modificado por AFS 
La célula en la que se autentifican por omisión los usuarios cuando emiten el mandato klog 
La calidad de miembro de la célula por parte de los procesos de servidor AFS con los que los intérpretes de mandatos de AFS de esta máquina establecen contacto por omisión 
Cambie al directorio /usr/vice/etc y elimine el enlace simbólico creado en el apartado Inicio del Servidor BOS. 
      
   # cd /usr/vice/etc
   
   # rm ThisCell
   

Cree el archivo ThisCell como copia del archivo /usr/afs/etc/ThisCell. El hecho de definir la misma célula local para ambos procesos, de servidor y de cliente, conduce al rendimiento más coherente posible de AFS. 
   
   # cp  /usr/afs/etc/ThisCell  ThisCell
   


--------------------------------------------------------------------------------

Creación del archivo CellServDB de cliente
El archivo /usr/vice/etc/CellServDB del disco local de una máquina cliente lista las máquinas servidor de base de datos para cada una de las células con las que el Gestor de antememoria puede contactar. Si en el archivo no existe ninguna entrada para una célula, o si la lista de máquinas servidor de base de datos es incorrecta, los usuarios que trabajen en esta máquina no podrán acceder a la célula. El capítulo de la publicación IBM AFS Administration Guide que trata sobre la administración de máquinas cliente explica cómo mantener el archivo después de crearlo. 

Puesto que el programa afsd inicializa el Gestor de antememoria, copia el contenido del archivo CellServDB en la memoria del kernel. El Gestor de antememoria siempre consulta la lista de la memoria del kernel, en lugar de consultar el propio archivo CellServDB. Entre rearranques de la máquina, puede utilizar el mandato fs newcell para actualizar directamente la lista de la memoria del kernel; consulte el capítulo de la publicación IBM AFS Administration Guide que trata sobre la administración de máquinas cliente. 

La distribución de AFS incluye el archivo CellServDB.sample y ya lo ha copiado en el directorio /usr/vice/etc. Este archivo incluye una entrada para todas las células AFS que han accedido a compartir la información de su máquina servidor de base de datos en el momento de crear el CD-ROM de AFS. El grupo de soporte del producto AFS también mantiene una copia del archivo, actualizándolo en caso necesario. Si está interesado en participar en el espacio de nombres global de AFS, una buena política consiste en consultar el archivo ocasionalmente para ver si ha sufrido actualizaciones. Solicite un puntero para la ubicación del mismo al grupo de soporte del producto AFS. 

El archivo CellServDB.sample puede ser una buena base para el archivo CellServDB de cliente, puesto que todas las entradas del mismo utilizan el formato correcto. Puede añadir o eliminar entradas de célula tal como encajen. Más adelante (en el apartado Habilitación del acceso a células externas) realizará pasos adicionales que permitirán al Gestor de antememoria llegar realmente a las células. 

En este apartado se añade una entrada para la célula local al archivo CellServDB local. El directorio de trabajo actual sigue siendo /usr/vice/etc. 

Elimine el enlace simbólico creado en el apartado Inicio del Servidor BOS y cambie el nombre del archivo CellServDB.sample por CellServDB. 
   
   # rm CellServDB
  
   # mv CellServDB.sample CellServDB
      

Añada una entrada para la célula local en el archivo CellServDB. Un método fácil consiste en utilizar el mandato cat para añadir el contenido del archivo /usr/afs/etc/CellServDB de servidor a la versión de cliente. 
   
    # cat  /usr/afs/etc/CellServDB >>  CellServDB   

A continuación, abra el editor de texto para verificar que no existen líneas en blanco y que todas las entradas tienen el formato requerido, que se describe a continuación. La ordenación de la células no es significativa, pero puede ser conveniente tener la célula inicial de la máquina cliente al principio; si lo desea, trasládela ahora a ese lugar. 

La primera línea de la entrada de una célula tiene el formato siguiente: 
   
   >nombre_célula      #organización   

donde nombre_célula es el nombre de dominio de Internet completo de la célula (por ejemplo, abc.com) y organización es un campo opcional que sigue a cualquier número de espacios y al signo numérico (#). Por convenio, denomina la organización a la que corresponde la célula (por ejemplo, ABC Corporation). 

Después de la primera línea viene una línea independiente para cada máquina servidor de base de datos. Cada una de las líneas tiene el formato siguiente: 
   
   dirección_IP   #nombre_máquina   

donde dirección_IP es la dirección IP de la máquina en formato decimal con puntos (por ejemplo, 192.12.105.3). A continuación de cualquier número de espacios y del signo numérico (#) está nombre_máquina, el nombre de sistema principal completamente cualificado de la máquina (por ejemplo, db1.abc.com). En este caso, el signo numérico no indica un comentario; nombre_máquina es un campo obligatorio. 

Si el archivo incluye células a las que no desea que accedan los usuarios de esta máquina, elimine las entradas de las mismas. 
En el ejemplo siguiente se muestran entradas para dos células, cada una de las cuales tiene tres máquinas servidor de base de datos: 


   
   >abc.com       #ABC Corporation (célula inicial)
   192.12.105.3      #db1.abc.com
   192.12.105.4      #db2.abc.com
   192.12.105.55     #db3.abc.com
   >stateu.edu    #State University cell
   138.255.68.93     #serverA.stateu.edu
   138.255.68.72     #serverB.stateu.edu
   138.255.33.154    #serverC.stateu.edu
   


--------------------------------------------------------------------------------

Configuración de la antememoria
El Gestor de antememoria utiliza una antememoria en el disco local o en la memoria de la máquina para almacenar copias locales de los archivos captados de las máquinas servidor de archivos. Puesto que el programa afsd inicializa el Gestor de antememoria, establece los parámetros básicos de configuración de la antememoria de acuerdo con las definiciones contenidas en el archivo /usr/vice/etc/cacheinfo local. Este archivo tiene tres campos: 

El primer campo menciona el directorio local en el que se montará el espacio de archivos AFS. La ubicación convencional es el directorio /afs. 
El segundo campo define el directorio del disco local que se utilizará para la antememoria de disco. La ubicación convencional es el directorio /usr/vice/cache, pero se puede especificar un directorio alternativo si hay más espacio disponible en otra partición. En este campo siempre tiene que haber un valor, pero el Gestor de antememoria lo ignora si la máquina utiliza una antememoria de memoria. 
El tercer campo especifica el número de bloques de kilobytes (1024 bytes) que se deben asignar a la antememoria. 
Los valores que defina deben cumplir con los requisitos siguientes. 

En una máquina que utiliza una antememoria de disco, el Gestor de antememoria siempre espera que podrá utilizar la cantidad de espacio especificada en el tercer campo. Si no se cumple con este requisito se pueden ocasionar graves problemas, algunos de los cuales sólo se pueden reparar mediante un rearranque. Debe evitar que los procesos que no sean de AFS llenen la partición de antememoria. La manera más sencilla consiste en dedicar una partición, exclusivamente, a la antememoria. 
La cantidad de espacio disponible en la memoria, o en la partición que aloja el directorio de antememoria del disco, impone un límite absoluto en el tamaño de la antememoria. 
El tamaño máximo soportado para la antememoria puede variar en cada release de AFS; consulte las IBM AFS Release Notes correspondientes a la versión actual. 
Para una antememoria de disco, no se puede especificar en el tercer campo un valor que supere el 95% del espacio disponible en la partición montada en el directorio mencionado en el segundo campo. Si se infringe esta restricción, el programa afsd sale sin iniciar el Gestor de antememoria y se imprimirá un mensaje apropiado en la corriente de salida estándar. El valor más apropiado en la mayoría de máquinas es el 90%. Algunos sistemas operativos (como, por ejemplo, AIX) no reservan automáticamente espacio para evitar que la partición se llene por completo; para estos sistemas, resulta más apropiado un valor más pequeño (digamos del 80% al 85% del espacio disponible). 
Para una antememoria de memoria, debe dejar suficiente memoria para que se ejecuten otros procesos y aplicaciones. Si se intenta asignar más memoria de la que está realmente disponible, se finalizará el programa afsd sin inicializar el Gestor de antememoria y se generará el mensaje siguiente en la corriente de salida estándar. 
   
   afsd: memCache allocation failure at número KB

El valor de número indica cuántos kilobytes se habían asignado justo antes de la anomalía y, por lo tanto, indica la cantidad aproximada de memoria disponible. 

Dentro de estos límites rígidos, los factores que determinan un tamaño de antememoria apropiado incluyen el número de usuarios que trabajan en la máquina, el tamaño de los archivos con los que trabajan y (para una antememoria de memoria) el número de procesos que se ejecutan en la máquina. Cuanto mayor es la demanda de estos factores, mayor tiene que ser la antememoria para mantener un buen rendimiento. 

Las antememorias de disco menores de 10 MB no suelen funcionar bien. Las máquinas que sirven a muchos usuarios suelen funcionar mejor con una antememoria mínima de entre 60 y 70 MB. El punto en el que un aumento de la antememoria no mejorará realmente el rendimiento depende de los factores mencionados anteriormente y resulta difícil de predecir. 

Las antememorias de memoria menores de 1 MB no son funcionales, y el rendimiento de las antememorias menores de 5 MB no suele ser satisfactorio. Los límites superiores adecuados son parecidos a los de las antememorias de disco, pero probablemente se determinan más por las demandas de memoria por parte de otras fuentes de la máquina (número de usuarios y procesos). Las máquinas que sólo ejecuten unos cuantos procesos podrán, posiblemente, utilizar una antememoria de memoria más pequeña. 


Configuración de una antememoria de disco
Nota: No todos los tipos de sistema de archivos que un sistema operativo soporta se pueden necesariamente utilizar como partición de antememoria. Para conocer las posibles restricciones, consulte las IBM AFS Release Notes.  

Para configurar la antememoria de disco, lleve a cabo los procedimientos siguientes: 

Cree el directorio local que se utilizará para gestionar la antememoria. La instrucción siguiente muestra la ubicación convencional, /usr/vice/cache. Si dedica una partición exclusivamente a la gestión de la antememoria, tal como recomendamos, también la debe configurar, crear un sistema de archivos en ella y montarlo en el directorio que se crea en este paso. 
   
   # mkdir /usr/vice/cache
   

Cree el archivo cacheinfo para definir los parámetros de configuración que hemos tratado anteriormente. La instrucción siguiente muestra la ubicación estándar de montaje, /afs, y la ubicación estándar de la antememoria, /usr/vice/cache. 
   
   # echo "/afs:/usr/vice/cache:#bloques" > /usr/vice/etc/cacheinfo

En el ejemplo siguiente se define el tamaño de la antememoria de disco como de 50.000 KB: 

   
   # echo "/afs:/usr/vice/cache:50000" > /usr/vice/etc/cacheinfo


Configuración de una antememoria de memoria
Para configurar una antememoria de memoria, cree el archivo cacheinfo para definir los parámetros de configuración que hemos tratado anteriormente. La instrucción siguiente muestra la ubicación estándar de montaje, /afs, y la ubicación estándar de la antememoria, /usr/vice/cache (aunque el valor exacto de la última es irrelevante para una antememoria de memoria) 

   
   # echo "/afs:/usr/vice/cache:#bloques" > /usr/vice/etc/cacheinfo

En el ejemplo siguiente se asignan 25.000 KB de memoria para la antememoria. 

   
   # echo "/afs:/usr/vice/cache:25000" > /usr/vice/etc/cacheinfo


--------------------------------------------------------------------------------

Configuración del Gestor de antememoria
Por convenio, el Gestor de antememoria monta el espacio de archivos AFS en el directorio local /afs. En este apartado se crea dicho directorio. 

El programa afsd establece varios parámetros de configuración de la antememoria cuando inicializa el Gestor de antememoria, e inicia daemons que mejoran el rendimiento. Puede utilizar los argumentos del mandato afsd para alterar temporalmente los valores por omisión de los parámetros y para cambiar el número de algunos de los daemons. En función del tamaño de la antememoria de la máquina, de la cantidad de RAM y de la manera en que el personal trabaja con ella, algunas veces se puede mejorar el rendimiento del Gestor de antememoria alterando temporalmente los valores por omisión. Para obtener una explicación de todos los argumentos del mandato afsd, vea la página de consulta de este mandato en la publicación IBM AFS Administration Reference. 

La línea del mandato afsd en el script de inicialización de AFS de cada tipo de sistema incluye una variable OPTIONS. La puede utilizar para establecer valores que no sean valores por omisión para los argumentos del mandato, de una de las maneras siguientes: 

Puede crear un archivo de opciones de afsd que establezca valores para los argumentos del mandato afsd. Si el archivo ya existe, su contenido se sustituye automáticamente por la variable OPTIONS del script de inicialización de AFS. La distribución de AFS para algunos tipos de sistema incluye un archivo de opciones; en otros tipos de sistema, hay que crearlo. 
En el script de inicialización de AFS se utilizan dos variables para especificar la vía al archivo de opciones: CONFIG y AFSDOPT. En los tipos de sistema que definen un directorio convencional para archivos de configuración, la variable CONFIG lo indica por omisión; en caso contrario, la variable indica una ubicación apropiada. 

Liste las opciones de afsd que desee en una única línea del archivo de opciones, separándolas mediante uno o más espacios. El ejemplo siguiente establece el argumento -stat en 2500, el argumento -daemons en 4 y el argumento -volumes en 100. 

   
   -stat 2500 -daemons 4 -volumes 100   
   

En una máquina que utilice una antememoria de disco, puede establecer la variable OPTIONS del script de inicialización de AFS en uno de los valores $SMALL, $MEDIUM o $LARGE. El script de inicialización de AFS utiliza uno de estos valores si no existe el archivo de opciones de afsd mencionado por la variable AFSDOPT. En el script, tal como se distribuye, la variable OPTIONS está establecida con el valor $MEDIUM. Nota: No establezca la variable OPTIONS con los valores $SMALL, $MEDIUM o $LARGE en una máquina que utilice una antememoria de memoria. Los argumentos que establece sólo son apropiados en una máquina que utilice una antememoria de disco.  

El script (o, en algunos tipos de sistema, el archivo de opciones de afsd mencionado por la variable AFSDOPT) define un valor para cada uno de los valores SMALL, MEDIUM y LARGE que establecen los argumentos del mandato afsd de forma apropiada para máquinas cliente de distintos tamaños: 

SMALL es adecuado para una máquina pequeña que sirve a uno o dos usuarios y tiene, aproximadamente, 8 MB de RAM y una antememoria de 20 MB 
MEDIUM es adecuado para una máquina de tamaño medio que sirve a entre dos y seis usuarios y tiene 16 MB de RAM y una antememoria de 40 MB 
LARGE es adecuado para una máquina de tamaño grande que sirve a entre cinco y diez usuarios y tiene 32 MB de RAM y una antememoria de 100 MB 
Puede elegir que no se cree un archivo de opciones de afsd y establecer la variable OPTIONS en el script de inicialización con un valor nulo en lugar del valor por omisión, que es $MEDIUM. Luego puede establecer los argumentos directamente en la línea del mandato afsd del script, o no establecer ningún argumento (aceptando, por lo tanto, los valores por omisión para todos los parámetros del Gestor de antememoria). 
Cree el directorio local en el que se montará el espacio de archivos AFS, que es por convenio /afs. Si el directorio ya existe, compruebe que esté vacío. 
   
   # mkdir /afs
   

En sistemas AIX, añada la línea siguiente en el archivo /etc/vfs. Esto permite que AIX desmonte AFS correctamente durante el cierre. 
   
   afs     4     none     none
   

En sistemas Linux, copie el archivo de opciones afsd del directorio /usr/vice/etc en el directorio /etc/sysconfig, eliminando al hacerlo la extensión .conf. 
   
   # cp /usr/vice/etc/afs.conf /etc/sysconfig/afs
   

Edite el script de inicialización de AFS o el archivo de opciones de afsd de la máquina para establecer valores adecuados para los parámetros del mandato afsd. El script reside en la ubicación indicada de cada tipo de sistema: 
En sistemas AIX, /etc/rc.afs 
En sistemas Digital UNIX, /sbin/init.d/afs 
En sistemas HP-UX, /sbin/init.d/afs 
En sistemas IRIX, /etc/init.d/afs 
En sistemas Linux, /etc/sysconfig/afs (archivo de opciones afsd) 
En sistemas Solaris, /etc/init.d/afs 
Utilice uno de los métodos descritos en la introducción de este apartado para añadir los distintivos siguientes a la línea del mandato afsd. Si pretende que la máquina permanezca como cliente AFS, establezca también los argumentos relativos al rendimiento que desee. 

Añada el distintivo -nosettime, puesto que ésta es una máquina servidor de archivos que también es cliente. Este distintivo impide que la máquina discrimine una máquina servidor de archivos de la célula como fuente horaria correcta, cosa que normalmente hacen las máquinas cliente. En lugar de ello, las máquinas servidor utilizan NTPD (controlado por el proceso runntp) u otro protocolo para sincronizar sus relojes. 
Añada el distintivo -memcache si la máquina va a utilizar una antememoria de memoria. 
Añada el distintivo -verbose para visualizar un seguimiento de la inicialización del Gestor de antememoria en la corriente de salida estándar. 

--------------------------------------------------------------------------------

Visión general: Realización de la instalación de la primera máquina AFS
Ahora, la máquina está configurada como máquina cliente y máquina servidor de archivos AFS. En esta fase final de la instalación, se inicializa el Gestor de antememoria y luego se crean los niveles superiores del espacio de archivos AFS, entre otros procedimientos. Los procedimientos son: 

Verificación de que el script de inicialización funciona correctamente e incorporación del mismo a la secuencia de arranque y cierre del sistema operativo 
Creación y montaje de volúmenes de nivel superior 
Creación y montaje de volúmenes para almacenar binarios del sistema en AFS 
Habilitación del acceso a células externas 
Institución de medidas de seguridad adicionales 
Eliminación, si se desea, del funcionamiento de cliente 

--------------------------------------------------------------------------------

Verificación del script de inicialización de AFS
En este punto se ejecuta el script de inicialización de AFS para verificar que invoca correctamente a todos los programas y procesos de AFS necesarios, así como que éstos se inician correctamente. Los mandatos oportunos son los siguientes: 

El mandato que carga dinámicamente las modificaciones de AFS en el kernel, en algunos tipos de sistema (no es aplicable si el kernel tiene incorporadas las modificaciones de AFS) 
El mandato bosserver, que inicia el Servidor BOS; el cual, a su vez, inicia los procesos de servidor para los que se han creado entradas en el archivo /usr/afs/local/BosConfig 
El mandato afsd, que inicializa el Gestor de antememoria 
En los tipos de sistema que utilizan un programa cargador dinámico, debe rearrancar la máquina antes de ejecutar el script de inicialización, de forma que éste pueda cargar de nuevo las modificaciones de AFS en el kernel. 

Si surgen problemas durante la inicialización, intente resolverlos. De ser necesario, el grupo de soporte del producto AFS puede ofrecerle ayuda. 

Emita el mandato bos shutdown para cerrar los procesos de servidor AFS que no sean el Servidor BOS. Incluya el distintivo -wait para retardar el retorno del mensaje de solicitud del shell de mandatos hasta que se hayan cerrado completamente todos los procesos. 
      
   # /usr/afs/bin/bos shutdown <nombre máquina> -wait
   

Emita el mandato ps para averiguar el número de ID de proceso (PID) del proceso bosserver y, a continuación, el mandato kill para detenerlo. 
   
   # ps opciones_ps_apropiadas  | grep bosserver
   
   # kill PID_servidor_bos
   

Emita los mandatos adecuados para ejecutar el script de inicialización de AFS para este tipo de sistema. 
En sistemas AIX: 

Rearranque la máquina e inicie de nuevo una sesión como superusuario root local. 
   
   # cd /
   
   # shutdown -r now
   
   login: root
   Contraseña: contraseña_root
   

Ejecute el script de inicialización de AFS. 
   
   # /etc/rc.afs
   

En sistemas Digital UNIX: 

Ejecute el script de inicialización de AFS. 
   
   # /sbin/init.d/afs  start
   

En sistemas HP-UX: 

Ejecute el script de inicialización de AFS. 
   
   # /sbin/init.d/afs  start
   

En sistemas IRIX: 

Si ha configurado la máquina para utilizar el programa cargador dinámico ml, rearranque la máquina y vuelva a iniciar una sesión como superusuario root local. 
   
   # cd /
   
   # shutdown -i6 -g0 -y
   
   login: root
   Contraseña: contraseña_root
   

Emita el mandato chkconfig para activar las variables de configuración afsserver y afsclient. 
   
   # /etc/chkconfig -f afsserver on
   
   # /etc/chkconfig -f afsclient on 
   

Ejecute el script de inicialización de AFS. 
   
   # /etc/init.d/afs  start
   

En sistemas Linux: 

Rearranque la máquina e inicie de nuevo una sesión como superusuario root local. 
  
   # cd /
         
   # shutdown -r now
   
   login: root
   Contraseña: contraseña_root
   

Ejecute el script de inicialización de AFS. 
   
   # /etc/rc.d/init.d/afs  start
   

En sistemas Solaris: 

Rearranque la máquina e inicie de nuevo una sesión como superusuario root local. 
   
   # cd /
      
   # shutdown -i6 -g0 -y
   
   login: root
   Contraseña: contraseña_root
   

Ejecute el script de inicialización de AFS. 
   
   # /etc/init.d/afs start
   

Espere al mensaje que confirma que la inicialización del Gestor de antememoria se ha completado. 
En las máquinas que utilizan una antememoria de disco, la inicialización del Gestor de antememoria por primera vez puede tardar un poco, puesto que el programa afsd tiene que crear todos los archivos Vn en el directorio de la antememoria. Las posteriores inicializaciones del Gestor de antememoria no tardarán tanto, puesto que los archivos Vn ya existirán. 

Como prueba básica de un funcionamiento correcto de AFS, emita el mandato klog para autentificarse como usuario admin. Proporcione la contraseña (contraseña_admin) que ha definido en el apartado Inicialización de la seguridad de la célula. 

   
   # /usr/afs/bin/klog admin
   Contraseña:  contraseña_admin
   

Emita el mandato tokens para verificar que el mandato klog ha funcionado correctamente. Si es así, la salida es parecida al ejemplo siguiente para la célula abc.com, donde el UID de admin para AFS es 1. Si la salida no parece correcta, resuelva el problema. Posiblemente tenga que efectuar cambios en el script de inicialización de AFS. De ser necesario, el grupo de soporte del producto AFS puede ofrecerle ayuda. 
   
   # /usr/afs/bin/tokens
   Tokens held by the Cache Manager:
  
   User's (AFS ID 1) tokens for afs@abc.com [Expires May 22 11:52]
       --End of list--
   

Emita el mandato bos status para verificar que la salida de cada proceso indica Currently running normally. 
   
   # /usr/afs/bin/bos status <nombre máquina>
   

Cambie al directorio del sistema de archivos raíz local (/) y emita el mandato fs checkvolumes. 
   
   # cd /
   
   # /usr/afs/bin/fs checkvolumes
   


--------------------------------------------------------------------------------

Activación del script de inicialización de AFS
Ahora que ya ha confirmado que el script de inicialización de AFS funciona correctamente, emprenda la acción necesaria para que se ejecute automáticamente en cada rearranque. Siga con las instrucciones correspondientes a su tipo de sistema: 

Activación del script en sistemas AIX 
Activación del script en sistemas Digital UNIX 
Activación del script en sistemas HP-UX 
Activación del script en sistemas IRIX 
Activación del script en sistemas Linux 
Activación del script en sistemas Solaris 

Activación del script en sistemas AIX
Edite el archivo de inicialización de AIX, /etc/inittab, añadiendo la línea siguiente para invocar al script de inicialización de AFS. Coloque esta línea justo detrás de la línea que inicia los daemons de NFS. 
   
   rcafs:2:wait:/etc/rc.afs > /dev/console 2>&1 # Start AFS services
   

(Opcional) Ahora existen copias del archivo de inicialización de AFS en los directorios /usr/vice/etc y /etc. Si desea evitar posibles confusiones, garantizando que siempre sean iguales, cree un enlace entre ellos. Si es necesario, siempre podrá recuperar el script original del CD-ROM de AFS. 
   
   # cd  /usr/vice/etc
   
   # rm  rc.afs
  
   # ln -s  /etc/rc.afs
   

Siga con el apartado Configuración de los niveles superiores del espacio de archivos AFS. 

Activación del script en sistemas Digital UNIX
Cambie al directorio /sbin/init.d y emita el mandato ln -s para crear enlaces simbólicos que incorporen el script de inicialización de AFS a la secuencia de arranque y cierre de Digital UNIX. 
   
   # cd  /sbin/init.d
   
   # ln -s  ../init.d/afs  /sbin/rc3.d/S67afs
   
   # ln -s  ../init.d/afs  /sbin/rc0.d/K66afs
   

(Opcional) Ahora existen copias del archivo de inicialización de AFS en los directorios /usr/vice/etc y /sbin/init.d. Si desea evitar posibles confusiones, garantizando que siempre sean iguales, cree un enlace entre ellos. Si es necesario, siempre podrá recuperar el script original del CD-ROM de AFS. 
   
   # cd  /usr/vice/etc
   
   # rm afs.rc
  
   # ln -s  /sbin/init.d/afs  afs.rc
   

Siga con el apartado Configuración de los niveles superiores del espacio de archivos AFS. 

Activación del script en sistemas HP-UX
Cambie al directorio /sbin/init.d y emita el mandato ln -s para crear enlaces simbólicos que incorporen el script de inicialización de AFS a la secuencia de arranque y cierre de HP-UX. 
   
   # cd /sbin/init.d
   
   # ln -s ../init.d/afs /sbin/rc2.d/S460afs
  
   # ln -s ../init.d/afs /sbin/rc2.d/K800afs
   

(Opcional) Ahora existen copias del archivo de inicialización de AFS en los directorios /usr/vice/etc y /sbin/init.d. Si desea evitar posibles confusiones, garantizando que siempre sean iguales, cree un enlace entre ellos. Si es necesario, siempre podrá recuperar el script original del CD-ROM de AFS. 
   
   # cd /usr/vice/etc
   
   # rm afs.rc
  
   # ln -s  /sbin/init.d/afs  afs.rc
   

Siga con el apartado Configuración de los niveles superiores del espacio de archivos AFS. 

Activación del script en sistemas IRIX
Cambie al directorio /etc/init.d y emita el mandato ln -s para crear enlaces simbólicos que incorporen el script de inicialización de AFS a la secuencia de arranque y cierre de IRIX. 
   
   # cd /etc/init.d
   
   # ln -s ../init.d/afs /etc/rc2.d/S35afs
  
   # ln -s ../init.d/afs /etc/rc0.d/K35afs
   

(Opcional) Ahora existen copias del archivo de inicialización de AFS en los directorios /usr/vice/etc y /etc/init.d. Si desea evitar posibles confusiones, garantizando que siempre sean iguales, cree un enlace entre ellos. Si es necesario, siempre podrá recuperar el script original del CD-ROM de AFS. 
   
   # cd /usr/vice/etc
   
   # rm afs.rc
  
   # ln -s  /etc/init.d/afs  afs.rc
   

Siga con el apartado Configuración de los niveles superiores del espacio de archivos AFS. 

Activación del script en sistemas Linux
Emita el mandato chkconfig para activar la variable de configuración afs. En base a la instrucción del archivo de inicialización de AFS que empieza por la serie #chkconfig, el mandato crea automáticamente los enlaces simbólicos que incorporan el script a la secuencia de arranque y cierre de Linux. 
   
   # /sbin/chkconfig  --add afs
   

(Opcional) Ahora existen copias del archivo de inicialización de AFS en los directorios /usr/vice/etc y etc/rc.d/init.d, así como copias del archivo de opciones afsd en los directorios /usr/vice/etc y /etc/sysconfig. Si desea evitar posibles confusiones, garantizando que las dos copias de cada archivo siempre sean iguales, cree un enlace entre ellas. Si es necesario, siempre podrá recuperar el script o el archivo de opciones original del CD-ROM de AFS. 
   
   # cd /usr/vice/etc
   
   # rm afs.rc afs.conf
    
   # ln -s  /etc/rc.d/init.d/afs  afs.rc
   
   # ln -s  /etc/sysconfig/afs  afs.conf
   

Siga con el apartado Configuración de los niveles superiores del espacio de archivos AFS. 

Activación del script en sistemas Solaris
Cambie al directorio /etc/init.d y emita el mandato ln -s para crear enlaces simbólicos que incorporen el script de inicialización de AFS a la secuencia de arranque y cierre de Solaris. 
   
   # cd /etc/init.d
  
   # ln -s ../init.d/afs /etc/rc3.d/S99afs
  
   # ln -s ../init.d/afs /etc/rc0.d/K66afs
   

(Opcional) Ahora existen copias del archivo de inicialización de AFS en los directorios /usr/vice/etc y /etc/init.d. Si desea evitar posibles confusiones, garantizando que siempre sean iguales, cree un enlace entre ellos. Si es necesario, siempre podrá recuperar el script original del CD-ROM de AFS. 
   
   # cd /usr/vice/etc
   
   # rm afs.rc
  
   # ln -s  /etc/init.d/afs  afs.rc
   


--------------------------------------------------------------------------------

Configuración de los niveles superiores del espacio de archivos AFS
Si previamente no ha ejecutado AFS en la célula, configure ahora los niveles superiores del espacio de archivos AFS de la misma. Si ha ejecutado una versión anterior de AFS, el espacio de archivos ya estará configurado. Siga con el apartado Almacenamiento de binarios de AFS en AFS. 

Ha creado el volumen root.afs en el apartado Inicio del Servidor de archivos, del Servidor de volúmenes y del Recuperador, y el Gestor de antememoria lo ha montado automáticamente en el directorio local /afs al ejecutar el script de inicialización de AFS en el apartado Verificación del script de inicialización de AFS. Establezca ahora la lista de control de acceso (ACL) en el directorio /afs; creación, montaje y establecimiento de la ACL son los tres pasos necesarios al crear cualquier volumen. 

Después de establecer la ACL en el volumen root.afs, cree el volumen root.cell de la célula, móntelo como subdirectorio del directorio /afs y establezca la ACL. Cree un punto de montaje de lectura/grabación y uno normal para el volumen root.cell. El punto de montaje de lectura/grabación le permite acceder a la versión de lectura/grabación de los volúmenes duplicados cuando sea necesario. Esencialmente, la creación de ambos puntos de montaje crea copias independientes de sólo lectura y de lectura/grabación del espacio de archivos, y permite que el Gestor de antememoria recorra el espacio de archivos por una vía de sólo lectura o de lectura/grabación, según sea oportuno. Para obtener una explicación adicional de estos conceptos, consulte el capítulo de la publicación IBM AFS Administration Guide que trata sobre la administración de volúmenes. 

A continuación, duplique los volúmenes root.afs y root.cell. Esto es necesario si desea duplicar cualquier otro volumen de la célula, puesto que todos los volúmenes montados por encima de un volumen duplicado también se deben duplicar para que el Gestor de antememoria acceda a la duplicación. 

Cuando el volumen root.afs está duplicado, el Gestor de antememoria está programado para acceder a la versión de sólo lectura del mismo (root.afs.readonly) siempre que sea posible. Para efectuar cambios en el contenido del volumen root.afs (por ejemplo, cuando se monta el volumen root.cell de otra célula en el segundo nivel del espacio de archivos), debe montar el volumen root.afs temporalmente, efectuar los cambios, liberar el volumen y eliminar el punto de montaje temporal. Si desea obtener instrucciones, consulte el apartado Habilitación del acceso a células externas. 

Emita el mandato fs setacl para editar la ACL del directorio /afs. Añada una entrada que otorgue los permisos l (lookup) y r (read) al grupo system:anyuser, a fin de permitir que todos los usuarios de AFS que puedan llegar a la célula atraviesen el directorio. Si prefiere habilitar el acceso únicamente de los usuarios autentificados localmente, sustituya el grupo system:authuser. 
Observe que ya existe una entrada de ACL que otorga los siete derechos de acceso al grupo system:administrators. Se trata de una entrada por omisión que AFS coloca en el directorio raíz de cada nuevo volumen. 

   
   # /usr/afs/bin/fs setacl /afs system:anyuser rl
   

Emita el mandato vos create para crear el volumen root.cell. A continuación, emita el mandato fs mkmount para montarlo como subdirectorio del directorio /afs, en el que sirve de raíz del espacio de archivos AFS local de la célula. Finalmente, emita el mandato fs setacl para crear una entrada de ACL para el grupo system:anyuser (o para el grupo system:authuser). 
Sustituya el argumento nombre partición por el nombre de una de las particiones de servidor AFS de la máquina (como, por ejemplo, /vicepa). Sustituya el argumento nombre_célula por el nombre de dominio de Internet completamente cualificado de la célula (como, por ejemplo, abc.com). 

   
   # /usr/afs/bin/vos create  <nombre máquina> <nombre partición> root.cell
   
   # /usr/afs/bin/fs mkmount /afs/nombre_célula  root.cell
   
   # /usr/afs/bin/fs setacl /afs/nombre_célula  system:anyuser rl
   

(Opcional) Cree un enlace simbólico con un nombre de célula acortado, a fin de reducir la longitud de los nombres de vía para los usuarios de la célula local. Por ejemplo, en la célula abc.com, /afs/abc es un enlace con /afs/abc.com. 
     
   # cd /afs
   
   # ln -s  nombre_célula_completo nombre_célula_corto
   

Emita el mandato fs mkmount para crear un punto de montaje de lectura/grabación para el volumen root.cell (ha creado un punto de montaje normal en el paso 2). 
Por convenio, el nombre de un punto de montaje de lectura/grabación empieza por un punto, tanto para distinguirlo de un punto de montaje normal como para hacer que sólo sea visible cuando se utilice el distintivo -a en el mandato ls. 

Cambie al directorio /usr/afs/bin para facilitar el acceso a los binarios de mandatos. 

   
   # cd /usr/afs/bin
   
   # ./fs mkmount   /afs/.nombre_célula  root.cell -rw
   

Emita el mandato vos addsite para definir un sitio de duplicación para los volúmenes root.afs y root.cell. En cada caso, sustituya el argumento nombre partición por la partición en que reside la versión de lectura/grabación del volumen. Cuando se instalan máquinas servidor de archivos adicionales, es buena idea crear también sitios de duplicación en ellas. 
   
   # ./vos addsite <nombre máquina> <nombre partición> root.afs
   
   # ./vos addsite <nombre máquina> <nombre partición> root.cell
   

Emita el mandato fs examine para verificar que el Gestor de antememoria puede acceder a los dos volúmenes root.afs y root.cell, antes de intentar duplicarlos. La salida lista el nombre, el número de ID de volumen, el cupo y el tamaño de cada volumen, así como el tamaño de la partición que los aloja. Si en lugar de esta salida obtiene un mensaje de error, no prosiga sin emprender antes una acción correctora. 
 
   # ./fs examine /afs
   
   # ./fs examine /afs/nombre_célula
   

Emita el mandato vos release para liberar una duplicación de los volúmenes root.afs y root.cell en los sitios que ha definido en el paso 5. 
   
   # ./vos release root.afs
   
   # ./vos release root.cell
   

Emita el mandato fs checkvolumes para imponer que el Gestor de antememoria observe que ha liberado las versiones de sólo lectura de los volúmenes; a continuación, emita de nuevo el mandato fs examine. Esta vez, la salida menciona la versión de sólo lectura de los volúmenes (root.afs.readonly y root.cell.readonly) en lugar de las versiones de lectura/grabación, debido al error sistemático del Gestor de antememoria al acceder a la versión de sólo lectura del volumen root.afs, en caso de que exista. 
   
   # ./fs checkvolumes
   
   # ./fs examine /afs
   
   # ./fs examine /afs/nombre_célula
   


--------------------------------------------------------------------------------

Almacenamiento de binarios de AFS en AFS
En una configuración convencional, los binarios de cliente AFS y los archivos de configuración se ponen disponibles en los subdirectorios del directorio /usr/afsws de las máquinas cliente (afsws es un acrónimo de AFS workstation). Puede conservar espacio en el disco local creando /usr/afsws como enlace con un volumen AFS que aloje los binarios de cliente AFS y los archivos de configuración para este tipo de sistema. 

En este apartado se crean los volúmenes necesarios. La ubicación convencional con la que enlazar /usr/afsws es /afs/nombre_célula/nombre_sist/usr/afsws, donde nombre_sist es el nombre de tipo de sistema apropiado especificado en las IBM AFS Release Notes. En las instrucciones contenidas en el Instalación de máquinas cliente adicionales se supone que se han seguido las instrucciones indicadas en este apartado. 

Si previamente ha ejecutado AFS en la célula, posiblemente los volúmenes ya existirán. De ser así, sólo tendrá que llevar a cabo el paso 8. 

El directorio de trabajo actual sigue siendo /usr/afs/bin, que aloja los binarios de los juegos de mandatos fs y vos. En los mandatos siguientes, es posible que siga teniendo que especificar el nombre de vía a los mandatos, en función de cómo se haya establecido la variable de entorno PATH. 

Emita el mandato vos create para crear volúmenes en los que almacenar los binarios de clientes AFS para este tipo de sistema. La instrucción del ejemplo siguiente crea los volúmenes llamados nombre_sist, nombre_sist.usr y nombre_sist.usr.afsws. Consulte las IBM AFS Release Notes para averiguar el valor de nombre_sist adecuado para este tipo de sistema. 
    
   # vos create <nombre máquina> <nombre partición> nombre_sist
     
   # vos create <nombre máquina> <nombre partición> nombre_sist.usr
     
   # vos create <nombre máquina> <nombre partición> nombre_sist.usr.afsws
    

Emita el mandato fs mkmount para montar los volúmenes recién creados. Puesto que el volumen root.cell está duplicado, debe anteponer un punto a la parte nombre_célula del nombre de vía para especificar el punto de montaje de lectura/grabación, tal como se muestra. A continuación, emita el mandato vos release, para liberar una nueva duplicación del volumen root.cell, y el mandato fs checkvolumes, para imponer que el Gestor de antememoria local acceda a ellos. 
   
   # fs mkmount -dir /afs/.nombre_célula/nombre_sist -vol nombre_sist
   
   # fs mkmount -dir /afs/.nombre_célula/nombre_sist/usr -vol nombre_sist.usr
   
   # fs mkmount -dir /afs/.nombre_célula/nombre_sist/usr/afsws -vol\
             nombre_sist.usr.afsws
   
   # vos release root.cell
   
   # fs checkvolumes
   

Emita el mandato fs setacl para otorgar los permisos l (lookup) y r (read) al grupo system:anyuser en la ACL de cada nuevo directorio. 
   
   # cd /afs/.nombre_célula/nombre_sist
   
   # fs setacl  -dir  .  usr  usr/afsws  -acl  system:anyuser rl 
   

Emita el mandato fs setquota para establecer un cupo ilimitado en el volumen montado en el directorio /afs/nombre_célula/nombre_sist/usr/afsws. Esto le permitirá copiar todos los archivos apropiados del CD-ROM en el volumen sin sobrepasar el cupo del volumen. 
Si lo desea, puede establecer el cupo del volumen en un valor finito después de completar la operación de copia. En este punto, utilice el mandato vos examine para determinar cuánto espacio está ocupando el volumen. A continuación, emita el mandato fs setquota para establecer un cupo que sea ligeramente mayor. 

   
   # fs setquota /afs/.nombre_célula/nombre_sist/usr/afsws  0
   

Monte el CD-ROM de AFS para el tipo de sistema de esta máquina en el directorio local /cdrom, si no se ha montado todavía. Para obtener instrucciones sobre cómo montar los CD-ROM (ya sea local o remotamente por medio de NFS), consulte la documentación del sistema operativo. 
Copie el contenido de los directorios indicados desde el CD-ROM en el directorio /afs/nombre_célula/nombre_sist/usr/afsws. 
   
   # cd /afs/.nombre_célula/nombre_sist/usr/afsws
   
   # cp -rp /cdrom/nombre_sist/bin  .
   
   # cp -rp /cdrom/nombre_sist/etc  .
   
   # cp -rp /cdrom/nombre_sist/include  .
   
   # cp -rp /cdrom/nombre_sist/lib  .
   

Emita el mandato fs setacl para establecer la ACL en cada directorio de la forma apropiada. Para cumplir con los términos del contrato de Licencia de AFS, debe impedir que los usuarios no autorizados accedan al software de AFS. Para permitir únicamente el acceso de los usuarios autentificados localmente, establezca la ACL en los subdirectorios etc, include y lib a fin de otorgar los permisos l y r al grupo system:authuser, en lugar de otorgarlos al grupo system:anyuser. El grupo system:anyuser debe conservar los permisos l y r en el subdirectorio bin para permitir que los usuarios no autentificados accedan al binario de klog. Para asegurarse de que los usuarios no autorizados no acceden al software de AFS, compruebe periódicamente que las ACL contenidas en estos directorios están bien establecidas. 
     
   # cd  /afs/.nombre_célula/nombre_sist/usr/afsws
   
   # fs setacl  -dir etc include lib  -acl  system:authuser rl  \
              system:anyuser none
   

Cree /usr/afsws en el disco local como enlace simbólico con el directorio /afs/nombre_célula/@sys/usr/afsws. Si lo desea, puede especificar el nombre real del sistema en lugar de @sys, pero la ventaja de utilizar @sys es que sigue siendo válido si se actualiza esta máquina para un tipo de sistema distinto. 
   
   # ln -s /afs/nombre_célula/@sys/usr/afsws  /usr/afsws
   

(Opcional) Para permitir que los usuarios emitan mandatos de los juegos de AFS (como, por ejemplo, fs) sin tener que especificar un nombre de vía a los binarios correspondientes, incluya los directorios /usr/afsws/bin y /usr/afsws/etc en la variable de entorno PATH que defina en el archivo de inicialización del shell de cada usuario (como por ejemplo .cshrc). 

--------------------------------------------------------------------------------

Almacenamiento de documentos de AFS en AFS
La distribución de AFS incluye los documentos siguientes: 

IBM AFS Release Notes 
IBM AFS Guía de iniciación rápida 
IBM AFS User Guide 
IBM AFS Administration Reference 
IBM AFS Administration Guide 
El CD-ROM de AFS para cada tipo de sistema tiene un directorio Documentation en el nivel superior, con un subdirectorio para cada formato de documento proporcionado. Los distintos formatos son adecuados para su visualización y/o impresión. 

En este apartado se explica cómo crear y montar un volumen para alojar los documentos, poniéndolos a disposición de los usuarios. El punto de montaje recomendado para el volumen es /afs/nombre_célula/afsdoc. Si lo desea, puede crear un enlace con el punto de montaje del disco local de cada máquina cliente, llamado /usr/afsdoc. Como alternativa, puede crear un enlace con el punto de montaje del directorio inicial de cada usuario. También puede elegir que sólo se permita a los usuarios acceder a determinados documentos (muy probablemente, a la publicación IBM AFS User Guide) creando distintos puntos de montaje o estableciendo ACL diferentes en distintos directorios de documentos. 

El directorio de trabajo actual sigue siendo /usr/afs/bin, que aloja los binarios de los juegos de mandatos fs y vos que se utilizan para crear y montar volúmenes. En los mandatos siguientes, es posible que siga teniendo que especificar el nombre de vía a los mandatos, en función de cómo se haya establecido la variable de entorno PATH. 

Emita el mandato vos create para crear un volumen en el que almacenar la documentación de AFS. Incluya el argumento -maxquota para establecer un cupo ilimitado en el volumen. Esto le permitirá copiar todos los archivos apropiados desde el CD-ROM en el volumen sin sobrepasar el cupo del volumen. 
Si lo desea, puede establecer el cupo del volumen en un valor finito después de completar las operaciones de copia. En este punto, utilice el mandato vos examine para determinar cuánto espacio está ocupando el volumen. A continuación, emita el mandato fs setquota para establecer un cupo que sea ligeramente mayor. 

   
   # vos create  <nombre máquina> <nombre partición>  afsdoc  -maxquota  0
     

Emita el mandato fs mkmount para montar el nuevo volumen. Puesto que el volumen root.cell está duplicado, debe anteponer un punto al nombre_célula para especificar el punto de montaje de lectura/grabación, tal como se muestra. A continuación, emita el mandato vos release, para liberar una nueva duplicación del volumen root.cell, y el mandato fs checkvolumes, para imponer que el Gestor de antememoria local acceda a ellos. 
     
   # fs mkmount -dir /afs/.nombre_célula/afsdoc -vol afsdoc
   
   # vos release root.cell
   
   # fs checkvolumes
    

Emita el mandato fs setacl para otorgar los permisos rl al grupo system:anyuser en la ACL del nuevo directorio. 
       
   # cd /afs/.nombre_célula/afsdoc 
    
   # fs setacl  .  system:anyuser rl 
   

Monte el CD-ROM de AFS para el tipo de sistema deseado en el directorio local /cdrom, si no se ha montado todavía. Para obtener instrucciones sobre cómo montar los CD-ROM (ya sea local o remotamente por medio de NFS), consulte la documentación del sistema operativo. 
Copie los documentos de AFS en uno o más formatos desde el CD-ROM a subdirectorios del directorio /afs/nombre_célula/afsdoc. Repita los mandatos para cada uno de los formatos. 
    
   # mkdir nombre_formato
  
   # cd nombre_formato
  
   # cp -rp /cdrom/Documentation/formato  .

Si decide almacenar la versión HTML de los documentos en AFS, observe que, además de un subdirectorio para cada documento, hay varios archivos que tienen la extensión .gif y que permiten que los lectores se muevan con facilidad entre las secciones de un documento. El archivo llamado index.htm es una página de introducción de HTML que contiene un hiperenlace con cada uno de los documentos. Para que la visualización en línea funcione correctamente, estos archivos deben permanecer en el directorio HTML de nivel superior (llamado /afs/nombre_célula/afsdoc/html). 

(Opcional) Si piensa que a sus usuarios les será de utilidad acceder a los documentos de AFS en un formato determinado a través de un directorio del disco local, cree /usr/afsdoc en el disco local como enlace simbólico con el directorio de documentación de AFS (/afs/nombre_célula/afsdoc/nombre_formato). 

   
   # ln -s /afs/nombre_célula/afsdoc/nombre_formato /usr/afsdoc

Una alternativa consiste en crear, en el directorio inicial de cada usuario, un enlace con el directorio /afs/nombre_célula/afsdoc/nombre_formato. 


--------------------------------------------------------------------------------

Almacenamiento de binarios del sistema en AFS
También puede elegir almacenar otros binarios del sistema en volúmenes AFS, como por ejemplo los programas estándar de UNIX, convencionalmente ubicados en directorios del disco local tales como /etc, /bin y /lib. El almacenamiento de estos binarios en un volumen AFS no sólo libera espacio en el disco local, sino que también facilita la actualización de binarios en todas las máquinas cliente. 

A continuación se muestra un esquema sugerido para almacenar binarios del sistema en AFS. Dicho esquema no incluye instrucciones, pero puede utilizar como patrón las que se indican en el apartado Almacenamiento de binarios de AFS en AFS (que son para binarios específicos de AFS). 

Algunos archivos deben permanecer en el disco local para utilizarlos cuando AFS no esté accesible (durante arranques e interrupciones del servidor de archivos o de la red). Los binarios requeridos incluyen los siguientes: 

Un editor de texto, mandatos de red, etcétera 
Archivos utilizados durante la secuencia de arranque y antes de que se ejecute el programa afsd, como por ejemplo archivos de inicialización y configuración, y binarios para mandatos que montan sistemas de archivos 
Archivos utilizados por los programas cargadores dinámicos del kernel 
En la mayoría de casos, resulta más seguro permitir que sólo los usuarios con autentificación local accedan a los binarios del sistema, otorgando los permisos l (lookup) y r (read) al grupo system:authuser en las ACL de los directorios que contienen los binarios. Sin embargo, si hay usuarios que necesitan acceder a un binario sin disponer de autentificación, la ACL del directorio correspondiente debe otorgar dichos permisos al grupo system:anyuser. 

El diagrama siguiente resume el nombre de volumen y el punto de montaje sugeridos para almacenar binarios del sistema. Se utiliza un volumen independiente para cada directorio. Ya ha creado un volumen llamado nombre_sist para el tipo de sistema de esta máquina al seguir las instrucciones indicadas en el apartado Almacenamiento de binarios de AFS en AFS. 

Puede denominar los volúmenes de la forma que quiera y montarlos en ubicaciones distintas de las sugeridas aquí. Sin embargo, este esquema tiene varias ventajas: 

Los nombres de volumen identifican con claridad el contenido del volumen 
La utilización del prefijo nombre_sist en cada volumen facilita la obtención de una copia de seguridad de todos los volúmenes juntos, puesto que el Sistema de copia de seguridad de AFS le permite definir series de volúmenes basados en una serie incluida en todos sus nombres 
Facilita un seguimiento de los volúmenes relacionados, manteniéndolos juntos en la misma máquina servidor de archivos si así se desea 
Hay una relación clara entre el nombre del volumen y el nombre del punto de montaje 

Nombre de volumen  Punto de montaje  
nombre_sist  /afs/nombre_célula/nombre_sist  
nombre_sist.bin  /afs/nombre_célula/nombre_sist/bin  
nombre_sist.etc  /afs/nombre_célula/nombre_sist/etc  
nombre_sist.usr  /afs/nombre_célula/nombre_sist/usr  
nombre_sist.usr.afsws  /afs/nombre_célula/nombre_sist/usr/afsws  
nombre_sist.usr.bin  /afs/nombre_célula/nombre_sist/usr/bin  
nombre_sist.usr.etc  /afs/nombre_célula/nombre_sist/usr/etc  
nombre_sist.usr.inc  /afs/nombre_célula/nombre_sist/usr/include  
nombre_sist.usr.lib  /afs/nombre_célula/nombre_sist/usr/lib  
nombre_sist.usr.loc  /afs/nombre_célula/nombre_sist/usr/local  
nombre_sist.usr.man  /afs/nombre_célula/nombre_sist/usr/man  
nombre_sist.usr.sys  /afs/nombre_célula/nombre_sist/usr/sys  



--------------------------------------------------------------------------------

Habilitación del acceso a células externas
En este apartado se crea un punto de montaje en el espacio de archivos AFS para el volumen root.cell de cada célula externa a la que se desea permitir el acceso por parte de los usuarios. Para que los usuarios que trabajan en una máquina cliente accedan a la célula, también deben tener una entrada para la misma en el archivo local /usr/vice/etc/CellServDB de la máquina cliente. (Las instrucciones que contiene el apartado Creación del archivo CellServDB de cliente sugieren que se utilice el archivo CellServDB.sample, incluido en la distribución de AFS, como base para el archivo CellServDB cliente de la célula. El archivo de ejemplo lista todas las células que han accedido a participar en el espacio de nombres global de AFS en el momento de crear el CD-ROM de AFS. Tal como se ha mencionado en dicho apartado, el grupo de soporte del producto AFS también conserva una copia del archivo, actualizándolo en caso necesario.) 

El capítulo de la publicación IBM AFS Administration Guide que trata sobre temas de administración y configuración explica las implicaciones de participar en el espacio de nombres global de AFS. El capítulo que trata sobre la administración de máquinas cliente explica cómo mantener el conocimiento de células externas en las máquinas cliente e incluye sugerencias para mantener una versión central del archivo en AFS. 

Emita el mandato fs mkmount para montar el volumen root.cell de cada célula externa en un directorio denominado /afs/célula_externa. Puesto que el volumen root.afs está duplicado, debe crear un punto de montaje temporal para la versión de lectura/grabación del mismo en un directorio para el que tenga acceso de grabación (como, por ejemplo, el directorio /afs/.nombre_célula de la célula). Cree los puntos de montaje, emita el mandato vos release para liberar nuevas duplicaciones en los sitios de sólo lectura para el volumen root.afs y emita el mandato fs checkvolumes para hacer que el Gestor de antememoria local acceda a la nueva duplicación. 
Nota: Sólo tendrá que emitir el mandato fs mkmount una vez para el volumen root.cell de cada célula externa. No es necesario que repita este mandato en cada máquina cliente.  


Sustituya nombre_célula por el nombre de la célula. 

   
   # cd /afs/.nombre_célula
   
   # /usr/afs/bin/fs  mkmount  temp  root.afs   

Repita el mandato fs mkmount para cada célula externa que desee montar en este momento. 

   
   # /usr/afs/bin/fs mkmount temp/célula_externa root.cell -c célula_externa   

Emita los mandatos siguientes una sola vez. 

     
   # /usr/afs/bin/fs rmmount temp
   
   # /usr/afs/bin/vos release root.afs
   
   # /usr/afs/bin/fs checkvolumes
   

Si esta máquina va a permanecer como cliente AFS después de completar la instalación, verifique que el archivo local /usr/vice/etc/CellServDB incluya una entrada para cada célula externa. 
Para cada célula que todavía no tenga una entrada, lleve a cabo las instrucciones siguientes: 

Cree una entrada en el archivo CellServDB. Asegúrese de cumplir las instrucciones de formateo que se indican en el apartado Creación del archivo CellServDB de cliente. 
Emita el mandato fs newcell para añadir una entrada para la célula directamente en la lista que el Gestor de antememoria mantiene en la memoria del kernel. Proporcione el nombre de sistema principal completamente cualificada de cada una de las máquinas servidor de base de datos. 
   
   # /usr/afs/bin/fs newcell <célula_externa> < servidor_base_datos1>    \
            [<servidor_base_datos2>] [<servidor_base_datos3>]
   

Si piensa conservar una versión central del archivo CellServDB (la ubicación convencional es /afs/nombre_célula/common/etc/CellServDB), créela ahora como copia del archivo local /usr/vice/etc/CellServDB. Verifique que incluye una entrada para cada una de las células externas a las que desea que los usuarios puedan acceder. 
   
   # mkdir common
   
   # mkdir common/etc
   
   # cp  /usr/vice/etc/CellServDB  common/etc
   
   # /usr/afs/bin/vos release root.cell
   

Emita el mandato ls para verificar que el punto de montaje de la nueva célula es visible en el espacio de archivos. La salida lista los directorios de nivel superior del espacio de archivos AFS de la nueva célula. 
   
   # ls /afs/célula_externa
   

Registre la célula en el grupo de soporte del producto AFS en este momento. Si no desea participar en el espacio de nombres global de AFS, liste su célula en un archivo CellServDB privado que no esté disponible para otras células AFS. 

--------------------------------------------------------------------------------

Mejora de la seguridad de la célula
En este apartado se explican maneras de mejorar la seguridad de los datos de AFS en la célula. Consulte también el capítulo de la publicación IBM AFS Administration Guide que trata temas de configuración y administración. 


Control de acceso del usuario root
Como en cualquier máquina, es importante impedir que los usuarios no autorizados inicien sesiones con una máquina cliente o servidor AFS como superusuario local root. Tenga el cuidado de mantener en secreto la contraseña del usuario root. 

El superusuario local root no tiene un acceso especial a los datos de AFS a través del Gestor de antememoria (como lo tienen los miembros del grupo system:administrators), pero tiene los privilegios siguientes: 

En las máquinas cliente, la posibilidad de emitir mandatos del juego de mandatos fs que afectan al rendimiento de AFS 
En las máquinas servidor, la posibilidad de inhabilitar la comprobación de la autorización o de instalar binarios de procesos pillos 

Control de acceso del administrador del sistema
A continuación se muestran sugerencias para gestionar el privilegio administrativo de AFS: 

Cree, para cada administrador, un perfil de administración denominado algo así como nombreusuario.admin. Los administradores sólo se autentifican bajo estas identidades cuando realizan tareas administrativas, y destruyen las señales administrativas inmediatamente después de terminar la tarea (ya sea emitiendo el mandato unlog o emitiendo el mandato klog para adoptar su identidad normal). 
Establezca un tiempo de vida del certificado que sea breve para los perfiles de administrador (por ejemplo, 20 minutos) utilizando el argumento -lifetime en el mandato kas setfields, que se describe en la publicación IBM AFS Administration Reference. Sin embargo, no debe utilizar un tiempo de vida breve para los usuarios que emiten mandatos backup de larga ejecución. 
Limite el número de administradores del sistema en la célula, especialmente el de aquéllos que pertenecen al grupo system:administrators. Por omisión, tienen todos los derechos de ACL sobre todos los directorios del espacio de archivos locales AFS y, por consiguiente, se debe confiar en que no examinarán archivos privados. 
Limite el uso de perfiles de administrador del sistema en máquinas que se encuentren en áreas públicas. Es especialmente importante no dejar tales máquinas desatendidas sin antes destruir las señales administrativas. 
Limite el uso, por parte de los administradores, de mandatos estándar de UNIX que efectúen conexiones con máquinas remotas (como, por ejemplo, el programa de utilidad telnet). Muchos de estos programas envían contraseñas por la red sin cifrarlas. 

Protección de directorios delicados de AFS
Algunos subdirectorios del directorio /usr/afs contienen archivos que son cruciales para la seguridad de la célula. Los usuarios no autorizados no deben leer ni grabar dichos archivos debido a la posibilidad de un mal uso de la información que contienen. 

Puesto que el Servidor BOS se inicializa por primera vez en una máquina servidor, crea varios archivos y directorios (tal como se ha mencionado en el apartado Inicio del Servidor BOS). También establece el propietario de los mismos como el superusuario local root y establece los bits de modalidad de forma que se permita la grabación únicamente por parte del propietario; en algunos casos, también restringe la lectura. 

En cada rearranque posterior, el Servidor BOS comprueba que el propietario y los bits de modalidad de estos archivos siguen estando establecidos de manera apropiada. Si no es así, graba el mensaje siguiente en el archivo /usr/afs/logs/BosLog: 

   
   Bosserver reports inappropriate access on server directories   

El Servidor BOS no restablece los bits de modalidad, lo cual permite al usuario establecer valores alternativos en caso de que lo desee. 

El diagrama siguiente lista los valores esperados en los bits de modalidad. Un interrogante indica que el Servidor BOS no comprueba ese bit de modalidad. 
/usr/afs  drwxr?xr-x  
/usr/afs/backup  drwx???---  
/usr/afs/bin  drwxr?xr-x  
/usr/afs/db  drwx???---  
/usr/afs/etc  drwxr?xr-x  
/usr/afs/etc/KeyFile  -rw????---  
/usr/afs/etc/UserList  -rw?????--  
/usr/afs/local  drwx???---  
/usr/afs/logs  drwxr?xr-x  




--------------------------------------------------------------------------------

Eliminación del funcionamiento de cliente
Únicamente debe seguir las instrucciones de este apartado si no desea que esta máquina permanezca como cliente AFS. Una eliminación del funcionamiento de cliente significa que no se puede utilizar esta máquina para acceder a archivos AFS. 

Elimine los archivos del directorio /usr/vice/etc. El mandato no elimina del directorio los archivos utilizados por el programa cargador dinámico del kernel, en caso de que existan en este tipo de sistema. Dichos archivos siguen siendo necesarios en una máquina que sólo funcione como servidor. 
    
   # cd /usr/vice/etc
   
   # rm  * 
   
   # rm -rf  C
   

Cree enlaces simbólicos con los archivos ThisCell y CellServDB del directorio /usr/afs/etc. Esto posibilita la emisión de mandatos de los juegos de mandatos de AFS (tales como bos y fs) en esta máquina. 
     
   # ln -s /usr/afs/etc/ThisCell ThisCell
   
   # ln -s /usr/afs/etc/CellServDB CellServDB
   

En sistemas IRIX, emita el mandato chkconfig para desactivar la variable de configuración afsclient. 
   
   # /etc/chkconfig -f afsclient off
   

Rearranque la máquina. La mayoría de tipos de sistema utilizan el mandato shutdown, pero las opciones apropiadas varían. 
   
   # cd /
   
   # shutdown opciones_apropiadas
   


Compilacion De Datos cx|c0x^

Fuentes: IBM , All Teams , Aix Ibm system 

Para Mz ezines edition nº3
http://www.merzenarioz.org 

Cx|c0x^
