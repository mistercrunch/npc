
                       :..::..File 8 Of 14.::..:
                       :..Editing The Registry.:
                       :..::.:.By Cyborg.:.::..:

<*> Introduction

The Registry is a central database that is created by Windows 95
during installation. The entries in that database consist of the
hardware, software, users, and preferences data for a single computer,
or any computer on a network. Whenever the user makes changes to the
Control Panel settings, File Associations, System Policies, or
installed software, the changes are reflected in the Registry.

Ok, if you have ever read any files dealing with the Registry before
you'll notice the first thing the author says is back up your Registry.
I personally, couldn't give a shit, if you have to reinstall Windows it
is of no consequence to me.

  <*>----------<*>----------<*>----------<*>----------<*>----------<*>


                           ^ My Computer ^

                               \     /
                                -----
                                  |
                                  |
                                  |
                                  |
                                  |
                          /-------|-------\
                         /        |        \
                        /         |         \
                       /          |          \
                      /           |           \
                   -----        -----        -----
                  /    /       /     \       \    \

   ^ Hkey_Classes_Root ^ Hkey_Current_User   ^ Hkey_Local_Machine ^
   ^ Hkey_Users        ^ Hkey_Current_Config ^ Hkey_Dyn_Data      ^


  <*>----------<*>----------<*>----------<*>----------<*>----------<*>

<*> Registry Editor

You can find the Registry Editor in c:\windows\regedit.exe or whatever
non standard name you chose as your Windows directory. Copy that onto
a backup disk if it pleases you to do so. For future reference you need
only choose Run|Regedit if you only want to run the program. Once
Regedit is open you should see My Computer and six HKEY folders.

As your tool of control over the Windows environment you will have to
know Regedit intimately. There is no point being in the driving seat if
you can't use a steering wheel, and there is no point getting into a
car if you don't know how to turn the keys. Enough with the confusing
metaphors. Below is an extract from a Windows help topic:

"Overview Of Registry Editor.

Registry Editor is an advanced tool that enables you to change
settings in your system Registry, which contains information about how
your computer runs. Generally, it is best to use Windows controls to
change your system settings.

You should not edit your Registry unless it is absolutely necessary. If
there is an error in your Registry, your computer may become non
functional. If this happens, you can restore the Registry to its state
when you last successfully started your computer. For instructions, see
Related Topics below."

As you can see it is the usual bullshit from the bureaucrats at
Microsoft. I think what they are really trying to say is that if you
start fucking with the Registry you have passed the point of no return.
Bill Gates asks you not to go down that road. Warning users off from
things that might get icky is a sort of Microsoft trademark. They are
safe in the knowledge that their half-assed assessment of Regedit will
frighten most new users away. The most key utility to controlling your
Win32 box is hidden away in c:\windows with no shortcuts and a whole
nine lines devoted to describing it, most of which fits into the
Microsoft play-it-safe agenda.

<*> Hkey Definitions

{1} Hkey_Classes_Root

This key points to a branch of Hkey_Local_Machine that describes
certain software settings. This key contains essential information
about OLE and drag and drop operations, shortcuts, and core aspects of
the Windows 95 GUI which we all think are so pretty =).

{2} Hkey_Current_User

This key points to a branch of Hkey_Users for the user who is currently
logged onto the system. Sort of like the equivalent of the Unix who
command but not really.

{3} Hkey_Local_Machine

Contains computer specific information about the type of hardware,
software, and other preferences on a given PC. This information is used
for all users who log onto this computer. The data is stored in machine
code. The software side often includes the serial keys for products you
have registered and sometimes encrypted passwords.

{4} Hkey_Users 

This key contains information about the users that log onto the
computer. Both generic and user-specific information is used, and each
user who uses the system has their own Subkey to accompany the .pwl
file in c:\windows. The .pwl file contains the password data whilst the
specified Subkey contains all other information.

{5} Hkey_Current_Config 

This key points to a branch of the Key Hkey_Local_Machine \Config that
contains information about the current hardware configuration. It is
updated when you use the Add New Hardware program.

{6} Hkey_Dyn_Data 

This key points to a branch of Hkey_Local_Machine that contains various
bits of information regarding the System's Plug and Play configuration.
This information is DYNAMIC, meaning that it may change as devices are
added to or removed from the computer. 

<*> Disabling Content Advisor Ratings

The thing about the Registry is that although Microsoft lean on it to
keep Windows tip-top they are more dependant on it than you might
realise. I mean that they utilise it the running of other Microsoft
products. Internet Explorer for instance, although it has been said
that it is an integral part of Windows (Microsoft are still in court
over that one). The insides of IE are stored in the Registry, including
their Internet Options. I have read Usenet posts about reg keys that
lower the security zone in IE or enable Java and other malicious
things. Take for example the password encoded censor Content Advisor
Ratings. If you want to disable their page blocking open up you Regedit
and find the key below:

HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Ratings\Key

Now just rename Key to something else e.g. KeyFucked. The next time the
Content Advisor Ratings are running the system will not be able to find
the key it is searching for. They key actually contains the encrypted
password information. I'm sure you can already think of ways that this
might be useful. If you are interested in this topic I suggest you do
a net search on algorithms.

<*> Hidden Shares

You must have seen the hype concerning all those Windows trojans. Any
guy off the street could own a Windows box, am I right? Well anyone who
has ever had to remove a nasty proggie will know where the server
implants itself, the Registry. For the trojan to function 24/7 it needs
to initialise every time Windows starts up. Now I don't think Back
Orifice would have been quite as popular if it required you to place
a shortcut in the Startup folder or a line in win.ini.

You can create the lame trojan effect with a Registry key that uses the
DOS prompt as the client for controlling the target computer. This
works by connecting to shares. Shares are what Windows uses to share
resources from computer to computer. The NetNinja Setup trojan creates
the C$ admin share in:

HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Network\LanMan\C$

This will assign the remote shared drive to the next available letter on the
user's machine and grants full read/write access. When run, the Setup
trojan creates a hidden share of drive C: and it places four entries in
that key as follows:

"Flags"=dword:00000302
"Path"="C:\\"
"Remark"=""
"Type"=dword:00000000

Two things cause the share to be invisible. The "$" at the end of the
name hides any share from the NET VIEW command and to Net Watcher's
shared folder listing. The Setup Trojan can be downloaded from:

http://www.netninja.com/files/SetupTrojan.zip

<*> Registry Programming

Now, before I start I must say that there really is no such thing as
Registry programming as such. Registry information is not like a
programming language, you're not really supposed to make reg keys.
Although it is viable to reprogram your registry with programs through
various programming languages that is entirely different. What I'm
talking about is generally called Registry editing. Similar to
patching hex or binary because if you move one space or character out
of place then the executable will dysfunction, no questions asked. It
is important to understand this.

However editing your Registry is easier because it's values are often
represented by real words and the more you look at and change keys, the
more you will recognise things that repeat. Of course, the reason that
reg keys don't equate to a programming language is because there is
only similarities, never defined code. They use all sorts of values
as well such as binary, hex, hexadecimal etc. Open up all reg keys in
Wordpad and save new ones in Wordpad. It is important you use Wordpad
and not any other text editor. 

Below is a reg key which opens up all files with an unrecognised file
extension with DOS Edit. Instead of opening the Open With dialog box
you will be brought straight into DOS Edit to view the files. This is
handy for viewing files made in Unix with no extensions. Note the
Registry definition "ASCII Viewable Document" which means a text file
"Content Type"="text/plain". Of course if you have ever fooled around
with DOS Edit before you will notice it doesn't support executables.
This means if you use it to open a .exe file it will represent it in
text as best as is possible. This key also ties defines .nfo and .diz
as plain text file types. This is handy because although they are
famous file extensions they were not created with any text editor in
mind so this reg key tells the system they are text files without
having to reformat them with a fixed text editor.

----- begin dosedit.reg -----

REGEDIT4

[HKEY_CLASSES_ROOT\asciifile]
@="ASCII Viewable Document"
"EditFlags"=hex:00,00,01,00

[HKEY_CLASSES_ROOT\asciifile\Shell]
@=""

[HKEY_CLASSES_ROOT\asciifile\Shell\open]

[HKEY_CLASSES_ROOT\asciifile\Shell\open\command]
@="edit.com %1"

[HKEY_CLASSES_ROOT\asciifile\DefaultIcon]
@="C:\\WINDOWS\\SYSTEM\\shell32.dll,64"

[HKEY_CLASSES_ROOT\.diz]
@="asciifile"
"Content Type"="text/plain"

[HKEY_CLASSES_ROOT\.nfo]
@="asciifile"
"Content Type"="text/plain"

----- end dosedit.reg -----

<*> Extracting Registry Data

Now we will take a look at some Registry data. Here is an example of a
perl script taken from 'Learning Perl on Win32 Systems'.

-----  begin reg.pl  -----

#! c:\perl\bin\perl.exeuse 

Win32::Registry;

$p = "SOFTWARE\\Microsoft\\Windows
\\CurrentVersion";
$main::HKEY_LOCAL_MACHINE->Open($p, $CurrVer) ||
die "Open:  $!\n";
$CurrVer->GetValues(\%vals);
foreach $k (keys %vals) {  
$key = $vals{$k};
print "$$key[0] = $$key[2]\n";
}

-----  end reg.pl  -----

<*> Hkey_Local_Machine Subkey Functions

As anyone who is experienced in using the Registry will tell you, the
Hkey_Local_Machine directory is the key to controlling your Windows
box. Here is a brief rundown of its standard Subkeys.

--> /Config      [ A collection of configurations for the local      ]
                 [ computer.                                         ]

--> /Enum        [ Info on the system's installed hardware devices.  ]

--> /Hardware    [ Info on the ports and modems used with            ]
                 [ hyperterminal.                                    ]

--> /Network     [ Info created when a user logs on to a networked   ]
                 [ computer.                                         ]

--> /Security    [ Info on network security and remote               ]
                 [ administration.                                   ]

--> /Software    [ Info about software and it's configuration on     ]
                 [ the system.                                       ]

--> /System      [ The database that controls system start-up,       ]
                 [ device driver loading, Windows 95 services, and   ]
                 [ O/S behaviour.                                    ]

<*> Signing Off

                  _________  ___ ____   ____   ____   ______
                 / ____/\  \/  // __ ) / __ \ / __ ) / ____/
                / /      \    // __  |/ / / |/ __  |/ / __
               / /___     \  // /_/ // /_/ // / / // /_/ /
               \____/     /_//_____/ \____//_/ /_/ \____/

                           cyborg@disinfo.net
                        http://cyborg.ie.8m.com

            "its not stolen, it fell off the back of a truck"

 [mousey] [franco] [hitman] [simo] [r0b] [cheesy] [gpf#2] [crypt0genic]
  [demonr] [alan509] [darkflame] [crossfire] [zirqaz] [force] [zomba]
[axcess] [firestarter] [freeman] [ego] [sunburst] [bluecat] [lordphaxx]
[hellbent] [tefx] [g_h] [rekcah] [neonbunny] [n1s] [h2so4] [npn] [call]
 [tds] [swat] [darkcyde] [scorpion] [#hackers_ireland] [#hackerzlair]

                       :..::..End Of File..::..:
