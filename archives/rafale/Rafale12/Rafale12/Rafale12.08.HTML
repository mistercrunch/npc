<html>
<head><title>Wi-Fi: Default key algorithms</title></head>
<body><pre>

                     <b>Wi-Fi: Default key algorithms</b>
<i>
Auteur : Gorn
Zine: Rafale #12
</i>


<b>1) Introduction</b>

Après quelques jours d'attentes, vous venez de recevoir votre MachinTrucBOX.
Soucieux de sécurité, vous regardez le type de cryptage employé car vous
savez que le WEP est facilement "crackable", résistant à peine à quelques
minutes voir quelques secondes. Mais, heureusement, votre FAI préférée
n'utilise pas (voir plus) ce cryptage. Vous récupérez, donc, en toute
confiance la clé par défaut pour vous connecter à distance en Wi-Fi.

Seulement, voilà. Savez vous que certains FAI et constructeurs utilisent,
par négligence, des algorithmes pour la génération des clés de cryptages ?
Des algorithmes facilement exploitables par une personne malveillante,
rendant la sécurité de votre réseau totalement inutile.

Voici un petit tour d'horizon de ces FAI et constructeurs, et des fameux
algorithmes de génération de clé par défaut ...



<b>2) Club Internet, "le club le plus ouvert de la planète"</b>

En septembre 1998, Club Internet utilise dans ces publicités, le slogan :
"Club Internet, Le club le plus ouvert de la planète" (<a href="#ref1">#1</a>). Mais c'est des
années plus tard que les utilisateurs des clubinternet.box v1, v2 ou
des Comtrend CT635, comprennent la véritable signification du mot <i>ouvert</i>.

En effet, au cours de l'année 2007, Club Internet met à disposition sur son
site web un outil nommé WepTool, qui permet d'obtenir la clé wep par défaut
en fonction de l'ESSID du routeur (<a href="#ref2">#2</a>).


              <img src="Images/08/weptool.png" alt="WepTool" />
              <i>Image n°1 - WepTool de Club Internet</i>


<i>L'article n'étant pas basé sur l'utilisation de ce logiciel, je
n'expliquerais pas son fonctionnement en détail. Cet outil étant simple d'
utilisation, il existe une multitude de documentation (<a href="#ref3">#3</a>).</i>


L'existence de ce logiciel est intéressant puisque nous comprenons grâce à
lui qu'il existe un algorithme permettant d'obtenir la clé WEP.
En analysant ce logiciel et le fichier FSHash.dll (pour File String Hash et
dont le code de source est sous licence LGPL (<a href="#ref4">#4</a>)), on découvre
que la clé par défaut correspond aux 26 premiers caractères du cryptage
SHA-1 de l'ESSID.


Utilisons, en exemple, l'ESSID suivant : <b>TECOM-AH4222-527A92</b>
Avec cette information, nous savons qu'il s'agit d'une clubinternet.box v2.

   - clubinternet.box v1   =>   Hitachi (TECOM) AH-4021
   - clubinternet.box v2   =>   Hitachi (TECOM) AH-4222

Nous cryptons, donc, l'ESSID avec la fonction de hachage SHA-1
On obtient : <b><font color=black>e724947bf889dd651a1698dd3f</font><font color=#AAAAAA>61f0c452f0a203</font></b>
La clé WEP correspond au 26 premiers caractères (en noir).


Pour récupérer l'ESSID à partir de l'adresse MAC (et inversement), sur
des <b>Hitachi AH-4222</b> (ne fonctionne pas sur les AH-4021), il suffit de
soustraire <b>0x00000B</b> aux 3 derniers octets de l'adresse MAC et de
mettre le résultat à la place des xxxxxx de "TECOM-AH4222-xxxxxx".


Prenons un cas de figure, l'ESSID de notre clubinternet.box v2 est masqué et
en lançant un airodump-ng sur un poste linux distant, nous avons :

<img src="Images/08/airodump.png" alt="Airodump" />
<i>Image n°2 - Airodump-ng, outil qui collecte les « paquets » sur votre réseau Wi-Fi</i>

Comme, l'adresse MAC des Hitachi AH-4222 commence, généralement, par soit
<b>00:16:38</b>:xx:xx:xx ou soit <b>00:19:15</b>:xx:xx:xx. Avec cette information,
nous savons que l'adresse MAC correspond à ce type de routeur.

Seulement, les Hitachi AH-4222 n'ont pas été, uniquement, employés pour la
clubinternet.box v2 mais aussi pour des AliceBox. Pour savoir si notre routeur
est une clubinternet.box, il suffit de lire la taille de l'ESSID masqué.
En effet, comme l'ESSID d'une clubinternetbox (<i>TECOM-AH4222-xxxxxx</i>), la taille
de notre exemple est de 19 caractères (<b>&lt;length: 19&gt;</b>). Si le routeur
était une AliceBox, on aurait eu 12 caractères, soit <i>ALICE-xxxxxx</i>.

Nous récupérons, donc, les 3 derniers octets de cette adresse, soit : <b>527A9D</b>
On applique la soustraction : 0x527A9D - 0x00000B = <b>0x527A92</b>
Ainsi, on obtient l'ESSID suivant TECOM-AH4222-<b>527A92</b> et donc par
conséquent la clé WEP suivante <b>e724947bf889dd651a1698dd3f</b>

A noter également, que si notre adresse MAC en 00:16:38:52:7A:9D provenait
d'une AliceBox, la méthode pour passer de l'adresse MAC à l'ESSID ne
changerait pas et l'ESSID serait <b>ALICE-527A92</b>.


Voici un schéma résumant les algorithmes utilisaient :


        <img src="Images/08/resume.png" alt="Schéma récapitulatif" />
        <i>Image n°3 - Schéma récapitulatif</i>


En conclusion, en plus de pouvoir récupérer la clé WEP avec l'ESSID des
clubinternet.box, nous pouvons également obtenir la clé par défaut d'un
Hitachi AH-4222, uniquement, avec son adresse MAC.



<b>3) Alcatel/Thomson SpeedTouch et British Telecom</b>

Le 14 avril 2008, Kevin Devine révèle sur le site GNUCitizen une faiblesse
dans la sécurité WEP/WPA des Alcatel/Thomson SpeedTouch (et par la même
occasion des BTHome Hub Router basé sur le SpeedTouch 7G) (<a href="#ref6">#6</a>). En effet,
ces routeurs sont livrés avec une clé WEP/WPA et un ESSID, dépendant du
numéro de série du boîtier.

                  <img src="Images/08/bt-home-hub.jpg" alt="BTHome Hub Router" />
                  <i>Image n°4 - BTHome Hub Router
                  (basé sur l'Alcatel/Thomson SpeedTouch 7G)</i>



Utilisons, en exemple, le numéro de série suivant : <b>CP0615JT109 (53)</b>
Le numéro de ces routeurs est sous la forme <b>CP</b>AAAABBCCC (DD)
Supprimons les valeurs "BB" et "DD", on obtient : <b>CP0615109</b>
Convertissons les caractères ASCII "CCC" par leurs valeurs hexadécimales
(1=>0x31, 0=>0x30, 9=>0x39). Ce qui donne : CP0615<b>313039</b>
Nous cryptons avec SHA-1: <b>742da831d2b657fa53d347301ec610e1ebf8a3d0</b>

Pour les SpeedTouch, les trois derniers octets (<b>f8a3d0</b>) sont ajoutés à
la chaîne "SpeedTouch" pour devenir l'ESSID par défaut : <b>SpeedTouchF8A3D0</b>

Tandis que pour les BTHome Hub Routeur, l'ESSID par défaut est formé à
partir de la chaîne "BTHomeHub-" et des deux derniers octets (<b>a3d0</b>) pour
devenir : <b>BTHomeHub-A3D0</b>

Enfin, la clé de cryptage WEP/WPA par défaut correspond aux 5 premiers
octets du hash SHA-1, soit : <b>742da831d2</b>


Même si un attaquant peut avoir difficilement le numéro de série du routeur,
il peut prédire, à partir d'une liste de numéros de séries possibles,
qu'elles sont les clés de cryptages en fonction de la fin de l'ESSID.
Ces fonctionnalités sont réalisées dans "STKeys" de Kevin Devine.

En utilisant ce logiciel et notre exemple, nous pouvons savoir, en moins de
30 secondes, que deux clés seulement correspondent à l'ESSID <b>SpeedTouchF8A3D0</b>

      <img src="Images/08/stkeys.png" alt="Schéma récapitulatif" />
      <i>Image n°5 - Exemple d'utilisation de STKeys</i>

Pour les BTHome Hub Routeur, nous avons beaucoup plus de possibilités car
nous avons uniquement les deux derniers octets en critère de recherche.
Ainsi pour le <b>BTHomeHub-A3D0</b>, nous avons 79 possibilités de clés.

Mais Adrian (pagvac) Pastor apporte la solution avec ces programmes nommés,
BTHHkeygen et BTHHkeybf, qui intègrent une fonction de "brute forcing".



<b>4) Conclusion</b>

À travers les exemples de Club Internet, de Hitachi, de Alcatel/Thomson ou
British Telecom, nous ne saurions trop vous recommander de modifier les mots
de passe et l'ESSID de vos routeurs. Toutefois, il est évident que le
matériel dans ces exemples est de plus en plus rare. Mais l'avenir, nous
réserve sûrement de nouvelles découvertes d'algorithmes sur d'autres FAI ou
d'autres routeurs, qui pourront faire l'objet, sûrement, d'un prochain
article ...



<b>5) Références</b>

<a name="ref1">1. <a target="_blank" href="http://fr.wikipedia.org/wiki/Club_internet#1998-1999_-_.C2.AB_Le_Club_le_plus_ouvert_de_la_plan.C3.A8te_.C2.BB">Club Internet sur Wikipédia</a></a>
<a name="ref2">2. <a target="_blank" href="http://assistance.club-internet.fr/assistance/telechargement/ADSL/logiciels_club/pc/WEPtool.zip">WepTool sur le site d'assitance de Club Internet</a></a>
<a name="ref3">3. <a target="_blank" href="http://assistance.club-internet.fr/assistance/pop_fiche_tech.phtml?type=technique&id_content=21784">WepTool pour les utilisateurs de Windows VISTA</a></a>
<a name="ref4">4. <a target="_blank" href="http://www.autoitscript.com/forum/index.php?showtopic=21010">FSHash : MD5 Hash Plug-in SHA-1</a></a>
<a name="ref5">5. <a target="_blank" href="http://esec.fr.sogeti.com/blog/dotclear/?2007/09/05/7-souvenirs-dcole">Reverse Engineering de WepTool par l'ESEC</a></a>
<a name="ref6">6. <a target="_blank" href="http://www.gnucitizen.org/blog/default-key-algorithm-in-thomson-and-bt-home-hub-routers/">GNUCitizen : Default key algorithm in Thomson and BT Home Hub routers</a></a>












































</pre></body></html>
