Minotauro Magazine #7:

			     Hacking Adabas/Natural
			        por Mantis King

	A medida que "trabajaba" sobre el sistema y consegu¡a informaci¢n
t‚cnica iba escribiendo toda esta informaci¢n en los bordes de hojas diario,
papeles de chocolate, borradores diversos, etc. y as¡ fue como la guard‚ en mi
prolijo archivo :). Ahora que la estoy pasando en limpio muchas veces no me 
entiendo la letra, y me cuesta un poco relacionar los distintos papelitos asi 
que sorry si este texto tiene algunos errores. Y si no te gusta es muy sencillo
vieja, pasas de largo y seguis leyendo Minotauro ¨ OK ?

% Adabas %

	Toda la info. que vas a encontrar se refiere a la versi¢n 5.2.5. Si 
pensas hackear un ambiente Adabas, podes encontrar 15 niveles distintos de 
seguridad. El nivel de seguridad lo elige el administrador del sistema cuando 
instala el software. Estos niveles de seguridad (entre 0 y 14) est n asociados 
con el password de cada usuario. Cada password puede tener diferentes niveles 
para lectura y para escritura. Si conseguiste un password y queres ver los 
derechos que tiene este password tipe :

ADASCR PFILES PW = password

De la misma forma, tambi‚n los archivos o campos de un archivo pueden tener 
diferentes niveles de acceso, en un rango desde 0 (sin seguridad) hasta 14 
(la seguridad m s alta). Si quer‚s encontrar donde est n los archivos 
sensitivos, esos que realmente te gustar¡a ver que guardan informaci¢n 
confidencial, lo que tendr¡as que hacer es identificar los que tienen la
seguridad mas alta. Para ver los niveles de protecci¢n de los archivos de la 
base de datos podes usar el comando:

ADASCR PFILES

Look at this ! En Adabas podes visualizar todos los passwords, lo
£nico que tenes que hacer es usar este comando:

ADASCR PPW CODE = dbacode

Eeeh ! Te la creiste eh ???. No es tan facil, dbacode es un c¢digo que el 
software le da al administrador de la base cuando instala el Adabas. Si 
conseguis uno vas a poder hacer cosas m s que interesantes. Si quer‚s cambiar 
algo en los datos almacenados en la base de datos te comento lo siguiente.
Primero que nada, los verdaderos hackers solo curiosean la informaci¢n de los 
sistemas, no la cambian...pero, es tu desici¢n. Segundo, puede ser que el DBA 
(administrador de la base de datos) haya establecido controles restringidos a 
valores. Esto quiere decir que el sistema chequea uno o mas campos de un 
registro para establecer si ten‚s acceso para leer o escribir el registro. Si
no ten‚s el nivel de acceso necesario para ese file tu acci¢n se va a registrar
en el botonazo log. Al d¡a siguiente el DBA revisa el log y quedas pegado hasta
las manos. Entonces, si quer‚s ver el criterio de seguridad por valor de tu
password podes usar el comando:

ADASCR PPW CODE = dbacode, PW = password

Como ya te habras dado cuenta (eso espero) pod‚s combinar este comando con el
anterior para elegir un password con el nivel suficiente como para modificar 
los archivos que quieras toquetear. Si tue idea no es modificar archivos, sino 
solamente espiar un poco los archivos m s interesantes, tenes que tener claro 
que es muy probable que los mas copados est‚n encriptados. En Adabas es muy 
f cil encriptar archivos usando el par metro ADAWAN y un c¢digo de 8 caract‚res
en el utilitario Compression. Tambi‚n si andas con ganas de hacer guachadas le 
podes encriptar algunos archivos al pobre man, pero no seas tan turro che !! 
Si los archivos est n encriptados, te recomiento que te copies los archivos y 
los labures en tu casa. No es recomendable tratar de adivinar el c¢digo 
directamente sobre la m quina hackeada, acordate de los logs, cada error que 
cometas se va a registrar en el log. En cambio, con los files en tu casa podes 
probar cientos de veces sin peligro. Hay muchos textos y utilitarios que te 
pueden ayudar a adivinar el c¢digo de 8 caracteres que necesitas para 
desencriptar el archivo.

% Natural %

	Si quer‚s chequear las opciones generales presiona "D" en el Men£
Principal, as¡ vas a llegar a los "Security Administrator Services". En esta 
pantalla, y presionando "D" llegas a "Modify General Options" que te muestra 
las opciones generales de seguridad. Podes chequear la estructura de seguridad
(grupos y miembros) presionando "D" e ingresando luego la identificaci¢n de 
usuario en el "User Maintenance Menu". As¡ vas a poder ver todos los grupos a 
los que pertenece este usuario, adem s de mas informaci¢n sobre cada grupo. Si
quer‚s ver la seguridad de cada aplicaci¢n ten‚s que presionar "D" y la 
identificaci¢n de aplicaci¢n en el "Application Maintenance Menu". Si quer‚s 
ver un n£mero m s grande de definiciones de seguridad de aplicaciones podes 
usar la funci¢n "MASS FUNCTION", que te va a mostrar una lista de todas las
aplicaciones que fueron definidas en la seguridad del Natural por orden 
alfab‚tico por identificaci¢n de aplicaci¢n. Para usar esta posibilidad, lo 
£nico que ten‚s que hacer es presionar "Q" en el "Application Maintenance 
Menu". Esto es muy importante, porque en Natural la seguridad de los datos 
est  asociada con la seguridad de las aplicaciones que acceden a esos archivos.
Si usas la opci¢n "Select File" (presionando "S") en el "File Maintenance Menu"
vas a ver el estado de cada archivo. Sin dudas los archivos "PRIV" van a ser 
los m s interesantes, pero tambi‚n deber¡as pegarle un vistazo a los "PUBL", 
porque en un ambiente mal controlado pod‚s encontrar informaci¢n confidencial 
tambi‚n en este tipo de archivo. Todas las posibilidades que expliqu‚ antes las
podes usar (aunque de solo lectura) usando "Retrieval" en el Menu Principal.
Atenci¢n, si corres una aplicaci¢n que tenga la opci¢n "LOG" en "Y", la 
seguridad del Natural va a escribir un registro en archivo de log. Yo te 
recomendar¡a pegarle un vistazo a los registros de log para chequear si tus 
actividades fueron registradas. Podes verlos usando la funci¢n "Logon Records 
Processing". En el Menu Principal tenes que presionar "D" para llegar a los 
servicios del administrador de seguridad y despu‚s "L" para ver los archivos de
log. El administrador de la base puede setear un n£mero m ximo de intentos de 
logon. Y si realizas un n£mero m s grande de intentos que el establecido por el
DBA, el sistema va a generar un registro en el archivo de log. Siempre tendr¡as
que tratar de pasar inadvertido en el sistema. Entonces, por ejemplo, si ten‚s 
un password y est s dentro del sistema y conseguiste otra password con m s 
nivel, pero que no es segura, yo te recomendar¡a antes de empezar a probarla 
chequear cual es el n£mero m ximo de intentos de logon que est n permitidos. 
Si el n£mero m ximo es seis, podes probar tu password dudosa cinco veces y no 
se van a crear registros de error en el archivo de log. Si estas en el sistema 
y quer‚s ver el registro de errores de logon para ver si hay mas gente tratando
de hackear el sistema (eso puede ser peligroso porque si hay muchos hackers 
rondando por el sistema es probable que alguno se mande una cagada y todos
queden pegados), o si simplemente quer‚s ver cuan pelotuda es la gente :), 
podes hacer lo siguiente. Presiona "D" en el Menu Principal para acceder a los 
servicios del Administrador de seguridad y despu‚s presiona "E" para ver los 
registros de errores de logon. Esto es importante, si nos damos cuenta que en 
el sistema este tipo de errores es cont¡nuo y repetido, es una se¤al clara que 
el sistema esta mal controlado y el Administrador de Sistema no le da bola a 
los archivos de log. Entonces no habr  problemas en probar un n£mero m s grande
de logons incorrectos. Como en el Natural puede haber mas de un administrador, 
el Natural da la posibilidad de usar contrafirmas (countersignatures) para 
controlar la seguridad. En criollo esto quiere decir que para cambiar una 
definici¢n de seguridad pueden ser necesarias 0, 1, 2 o 3 confirmaciones
(countersignatures) de los otros administradores definidos. Entonces tenes que 
tener claro que si conseguis privilegios de administrador todav¡a no ten‚s el 
control absoluto del sistema (si es que hay otros administradores definidos y 
fue establecido un sistema de contrafirmas). Entonces, antes de intentar hacer 
cualquier cambio, deber¡as verificar si hay definidos otros administradores y 
si se han establecido contrafirmas. Te puedo asegurar que es realmente molesto
"trabajar" en una m quina que tenga establecidas contrafirmas, pero no te 
calentes mucho porque la mayor¡a de los ambientes Natural solo tienen un
administrador.
 
Espero que esta informaci¢n que fue muy £til para mi, tambien pueda ser £til 
para ustedes..

                                    Mantis King  [NO DAN] :)
