 
                    _.:[ TCP und IP Header ]:._


 Hier ein paar Infos zum TCP und IP Header, die auch 
 recht nützlich sind um TCP-IP und ihre Angriffsmöglichkeiten zu
 verstehen.


Der TCP-Header:


 Der normale TCP Header ist 20 Bytes groß und enthält Angaben über
 Quelle und Ziel. Die ersten 16 Bits nimmt der Quellport ein, aus dem 
 das TCP Paket kommt. Die nächsten 16 Bits sind nun der Zielport, an
 den das Paket gesendet wird (80 bei HTTP,  23 bei Telnet etc..)
 In den nächsten 32 Bits steht die Sequenznummer, eine Nummer, die
 die Reihenfolge der Pakete angibt. Wenn das SYN-Flag gesetzt ist steht
 hier die Initial Sequence Nummer. Die nächsten 32 Bits werden von der
 nächsten Sequenznummer ausgefüllt, die man vom Gegenüber erwartet. Dies ist 
 normalerweise die zuletzt erhaltene plus Eins. Die nächsten 4 Bits enthalten
 das Data Offset, also die Stelle, an der die im TCP Paket enthaltenen Daten
 anfangen (man kann das Feld auch einfach als Länge des TCP Headers deuten). Der
 Offset ist hier in 32 Bit Einheiten angegeben. Nun folgen Sechs Nullen. Dieser Platz ist 
 für zukünftiges reserviert und muss immer 0 sein. Nun folgen die Flags oder Controllbits, 
 die 6 Bits einnehmen.

 Diese können sein:  URG - Urgent Pointer
                     ACK - Acknowledgment
                     PSH - Push Function
                     RST - Reset
                     SYN - Synchronize
                     FIN - Keine Pakete werden folgen (ENDE)

 In der hier aufgelisteten Reihenfolge werden die Bits gesetzt, indem sie entweder 0 oder 1 
 enthalten. Nun folgen die 16 bits des Window Segments. Hier kann man dem Gegenüber 
 mitteilen, wieviel Daten man noch akzeptieren wird. Wenn man zum Beispiel dem Gegenüber
 den Hahn abdrehen will, setzt man dieses Feld auf Null. Nun folgt eine 16 Bits große
 Prüfsumme, die sich aus der Summe aller Werte des Headers zusammensetzt.
 Nun folgen 16 Bits des Urgent Pointers, die nur überprüft werden, wenn das URG Flag
 gesetzt ist. Sie beinhalten einen Offset (von der Sequence Nummer aus), das die 
 nächste Sequence Nummer nach einem Daten Oktett zeigt. Nun folgt eine Variable Anzahl an
 8 Bit Paketen, die folgende Daten enthalten: Quelladdresse, Zieladdresse, 0, PTCL, Länge
 des TCP Paketes insgesamt (auch in dieser Reihenfolge) diese Pakete nennt man das Options Feld. 
 Nun folgt das Ende mit einer Variablen Anzahl an Nullen, nach dem die Daten folgen. Die Nullen sind
 notwendig um das Paket auf eine Vielfache von 32-Bit aufzurunden.

 Ok, meine ASCII-Art ist nicht die Beste, aber hier ein kleines Diagramm ;)

   .--------------------------------------------------------.
   |               Source Port   |    Destination Port      |
   |--------------------------------------------------------|
   |                      Sequence Number                   |
   |--------------------------------------------------------|
   |                  Acknowledgement Number                |
   |--------------------------------------------------------|
   |Data Offset|Reserviert|Flags |       Window Size        |
   |--------------------------------------------------------|
   |                Checksum     |  Urgent Pointer          |
   |--------------------------------------------------------|
   |                          Options                       |
   |--------------------------------------------------------| 
   |                           Data                         |
   |________________________________________________________|

Der IP Header:
 Der IP Header setzt sich vor den TCP Header. Der Header ist mindestens 20 Bytes
 groß. Am Anfang des Headers steht immer in einem 4 Bit Feld die aktuelle Version des 
 Internet Protokolls (momentan 4 oder 6). Danach befindet sich ein 4-Bit großes Feld welches 
 die Länge des IP Headers enthält (in 32Bit Einheiten) . Dann folgt der Typ des Services in 8 Bit,  
 der vom  Gegenüber erwartet wird, wird aber meistens ignoriert, weshalb man den Wert 0 einsetzt. 
 Je nach Service wird das Paket anders behandelt, so das man hier angeben kann worauf es bei der
 Vermittlung des Paketes am ehesten ankommt. Priorität in 2 Bits, je höher desto wichtiger, dann
 noch folgende 3 Flags: Verzögerung, Durchsatz, Zuverlässigkeit. Der Rest ist unbenutzt bzw
 reserviert wie es immer so schön heißt ;) Danach wird die Größe des IP Headers plus den Daten in
 einem 16 Bit-Feld angegeben. Jetzt folgt die eine Identifikationsnummer des Senders, 
 mit der er eindeutig indentifiziert zu welchem Datensatz das Paket gehört. Diese wird in einem 
 16 Bit Feld angegeben. Auch hier werden nun Flags gesetzt.  Die Flags sind dafür da,
 um anzuzeigen, ob Router die IP Pakete zerlegen dürfen, wenn ein anderes Protokoll dies verlangt.
 Das 1te Bit ist unbenutzt. Das 2. wird gesetzt, wenn das Paket nicht zerlegt werden darf.
 Das 3. deutet an, das das Paket bereits zerlegt ist. Das 4. Bit wird bei einer Zerlegung immer 
 gesetzt und anzuzeigen, das noch Pakete zu erwarten sind. Deshalb hat das letzte Fragment 
 dieses Paketes dort eine 0, da keine Teilpakete mehr ankommen. Nun folgt in 12 Bits der
 Fragmentation Offset, der angibt, an  welchem Offset des Original Paketes wir uns nun befinden,
 wenn das Paket zerlegt wurde.  Die nun folgenden 8 Bits zeigen an, wie viele Router das Paket 
 durchlaufen darf, bevor es abgelegt wird, um eventuelle Endlosversendungen zu vermeiden. Die
 meisten Router vermindern daher diese Stelle um Eins. Nun folgt ein 8 Bit Feld in dem angegeben wird,
 unter welchem Transportprotokoll dsa Paket weitergeleitet wird. ( 0 = IP, 6 = TCP) Jetzt kommt 
 wieder einmal eine 8-Bit Prüfsumme, die jedesmal  erneuert wird, wenn irgendetwas am Paket 
 geändert wird. Jetzt kommt die Quell und  Zieladdresse des Paketes in jeweils 32 Bit. 
 Nun folgt noch ein  32 Bit Optionen Feld, das aber auch normalerweise unbenutzt bleibt.
 Alles was jetzt noch folgt sind optionale Füllzeichen um das Optionen Feld auf 32 Bit aufzustocken.
 Danach dann endlich die ersehnten Daten.. ;)

 Und noch eins.. hoffe ihr bekommt von so viel schlechtem ASCII kein Augenkrebs ;)..

   .--------------------------------------------------------.
   | Version| Lenght| Service  |              Packet Lenght |
   |--------------------------------------------------------|
   |   Sender IP               |Flags|  Fragment Offset     |
   |--------------------------------------------------------|
   | Time to Live   | Protocol |       Header Checksum      |
   |--------------------------------------------------------|
   |                      Source IP                         |
   |--------------------------------------------------------|
   |                   Destination IP                       |
   |--------------------------------------------------------|
   |                      Options                           |
   |--------------------------------------------------------|
   |                       Data                             |
   |________________________________________________________|


 written by SnakeByte

