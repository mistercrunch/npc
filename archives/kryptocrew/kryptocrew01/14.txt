/*
  Port-Watcher
  
  Wartet an einem Port für Verbindungsversuche und gibt Informationen aus, wenn ein Kiddie versucht zu connecten

  Grüße an: netnative, oracle, prometeus, sacrelege

von Anthraxx, 13.12.1999 (the next millenium is near, uh..)
*/

#include <stdio.h>
#include <unistd.h>
#include <stdlib.h>
#include <strings.h>
#include <netinet/in.h>
#include <sys/socket.h>
#include <signal.h>

int main(int argc, char **argv)
{
char *msg = "\nSorry, you are logged...\n\n";	/* Nachricht die gesendet wird */

int sin_size;
int port=5;		/* Der Port... änder ihn in was du willst ;) */
int rip;			/* Remote IP */
int s;			/* Local listening Socket */
int r;			/* Remote Socket */
int err;		   /* für Fehlermeldungen (Error codes) */

struct sockaddr_in laddr, raddr;      /* laddr=local, raddr = remote */

  if(argc==2)
    port=atoi(argv[1]);

  laddr.sin_family = AF_INET;	        /* wir füllen dies mit unserer ip und port */
  laddr.sin_port = htons(port);	     /* überprüfen von "port" */
  laddr.sin_addr.s_addr = INADDR_ANY; /* unsere IP (wird vom Kernel ausgefüllt) */
  bzero (&(laddr.sin_zero), 8);

  s = socket (AF_INET, SOCK_STREAM, 0);  /* listening socket */
  err=bind (s, (struct sockaddr *)&laddr, sizeof (struct sockaddr));
  if(err)
    printf("bind error");


  listen (s, 3);		        /* listen an Port, Maximal 3 active Verbindungen */

  while(1)
  {
    sin_size=sizeof(struct sockaddr_in);
    r=accept(s, &raddr, &sin_size);

    printf("connetion from %s, port %i \n", inet_ntoa(raddr.sin_addr), port);

    send(r, msg, strlen(msg), 0);

    close(r);
  }

  close(s);

return(1);
}
