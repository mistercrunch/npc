
         +------------------------------+
         | Autore: LupSyn               |
         | Titolo: Signal.h             |
         | Mail: lupsyn@mojodo.it       |
         | Http://www.mojodo.it         |
         +------------------------------+

+---(Segnali)----------------------------------------------------------------------+
| Un segnale è  una notificazione ad  un  processi che  si è verificato  o che  è  |
| in corso. I segnali possono essere inviati :                                     |
| da un processo ad un altro processo ;                                            |
| dal kernel ad un processo;                                                       |
|                                                                                  |
| Ogni segnale ha un nome specificato in signal.h                                  |
|----------------------------------------------------------------------------------|
|   Nome   |   Descrizione                    |   Azione normale                   |
|----------------------------------------------------------------------------------|
| SIGALRM  | Sveglia  		              | Termina                            |
| SIGBUS   | Errore di bus		      | Termina                            |
| SIGCLD   | Morte di un proc child           | Segnale scartato                   |
| SIGCONT  | Continua dopo SIGSTP             | Segnale scartato                   |
| SIGEMT   | Istruzione EMT		      | Termina		                   |
| SIGFPE   | Istruzione FPE      	      | Termina	                           |
| SIGHUP   | Riaggancio	                      | Termina                            |
| SIGILL   | Istruzione illegale	      | Termina	                           |
| SIGINT   | Carattere d'interruzzione        | Termina                            |
| SIGKILL  | Sopprime =)	              |                                    |
|          | senza nexuno perleggerla         | Termina                            |
| SIQUIT   | Carattere di terminazione "quit" | Termina	                           |
| SIGSEV   | Violazione della segmentazione   | Termina			           |
| SIGSTOP  | STOp			      | Arresta il processo                |
| SIGSYS   | Argomento non valido per la      |                                    |
|          | chiamata di sistema	      | Arresta                            |
| SIGTERM  | Segnale di terminazione software | Termina                            |
| SIGTSTP  | Seganle di stop generato dalla   |                                    |
|          | tastiera		              | Arresta                            |
| SIGUSR1  | Segale 1 definito dall'user      |                                    |
| SIGUSR2  | Segnale 2 definito dall'user     |                                    |
|----------------------------------------------------------------------------------|
|                                                                                  |
| Alcuni SIG sono stati trascurati data la loro funzione =).                       |
|                                                                                  |
| I segnali vengono inviati tramite :                                              |
|                                                                                  |
| - int kill (int pid ,int sig );                                                  |
|   Non è detto pero' che un un segnale termini il processo.                       |
|   La chiamata kill fa molte cose diverse a seconda dei valori dei suoi           |
|   argomenti.                                                                     |
|   Se pid è 0 il segnale viene inviato a tutti i processi nel gruppo              |
|   relativo al trasmettitore.                                                     |
|   Se pid è -1 e il trasmettitore non è il super user , il segnale viene          |
|   inviato a tutti  i processi il cui ID dell utente reale uguaglia l'ID          |
|   utente effettivo del processo trasmittente.                                    |
|   Se l'argomente pid è -1 ed il trasmettitore è i super user il segnale          |
|   viene inviato a tutti i processi che non siano processi di sistema             |
|   (proc. con pid 0 e 1 ).                                                        |
|   Se l'argomento pid è negativo ma diverso da -1 il segnale viene                |
|   inviato a tutti i processi il cui ID di gruppo di processi uguaglia            |
|   il valore assoluto di pid .                                                    |
|   Se l'argomento sig è zero viene svolta la verifica degli errori ma             |
|   non viene inviato alcun segnale. Si puo' usare questa condizione per           |
|   esempio per esaminare la validità del pid.                                     |
|   Roxxa un casino sta robba =). continuiamo.                                     |
|   Il comando kill cmq è usato generalmente per l'invio di segnali                |
|   prendendo i suoi argomenti dalla riga di comando ed è applicato con            |
|   le stesse restrizioni dette sopra.                                             |
|                                                                                  |
| Cmq certi caratteri dati da tastiera generaro segnali. Basti pensare a control-C |
| o delete  che termina l'esecuzione  di un processo generando un  segnale SIGINT, |
| c'è nè un altro degno di nota ctrl-\  che termina l'esecuzione di un processo  e |
| genera un'immagine  puo' quindi  essere usata  con un  debugger per  una analisi |
| "post mortem" cosi' chiamata del  processo. Cmq possiamo predisporre dei  nostri |
| caratteri  per  fungere  da caratteri  da  interruzzione  o terminazione.  Certe |
| condizioni hardware generano segnali. Non si direbbe  per esempio gli errori  di |
| aritmetica  in  virgola  mobile  generano  un  segnale  di  errore  SIGFFPE,  il |
| riferimento ad un indirizzo all'esterno dello spazio d'indirizzi di un  processo |
| genera  un segnale  di SIGSEV.  Anche delle  condizioni del  software che  sono  |
| notificate dal kernel causano la generazione di segnali ad es. SIGURG è generato |
| quando dei dati  fuori-banda arrivano su  di un socket.  Ora quindi un  processo |
| puo' gestire un segnale  per esempio chiamando una  funzione ogni qual volta  si |
| presenti  questo. Questa  funzione è  chiamata signal  handler.Un processo  puo' |
| anche  scegliere  di  ignorare  un segnale  escluso  SIGKILL.  Un  processo puo' |
| consentire  che un  segnale si  comporti nella  sua "azione  di default"  oppure |
| ignorare questa. Un processo comunica con i segnali tramite la chimata signal()  |
|                                                                                  |
| #include <signal.h>                                                              |
|                                                                                  |
| int(*signal (int sig, void(*funz) (int))) (int);                                 |
|                                                                                  |
| Cio' che dice questa dichiarazione è  che signal è una funzione che  restituisce |
| un  puntatore  ad  una  funzione che  restituisce  un  intero.  L'argomento funz |
| specifica l'indirizzo di funzione (*) che è void ( non restituisce niente ) . Ci |
| possono esser due valori speciali per  funz : SIG_DEL e SIG_IGN per  specificare |
| che il segnale deve essere ignorato. ad esempio per attivare una funzione ciau() |
| se questa non viene ignorata                                                     |
|                                                                                  |
| #include <signal.h>                                                              |
| void ciau();                                                                     |
|                                                                                  |
| [...]                                                                            |
| if (signal(SIGINT,SIG_IGN) != SIG_IGN)                                           |
| 	signal (SIGINT,ciau);                                                      |
| [...]                                                                            |
|                                                                                  |
| Quando una funzione viene attivata per gestire un segnale , il numero intero del |
| segnale  viene   passato come  primo  argomento alla  funzione  . Questo  da  la |
| possibilità a una singola funzione di gestire piu' segnali.                      |
|                                                                                  |
| SIGALARM : Il processo predispone una sveglia mediante la chiamata di 	   | 
|            sys alarm. sleep() ad esempio predispone un segnale SIGALRM           |
|            restituendo la quantita di tempo "da stare fermi".                    |
| SIGCLD   : Questo segnale viene inviato al processo genitore qualndo un          |
|            processi figlio termina.                                              |
| SIGCONT  : Riprende un processo che era stato arrestato da SIGSTP                |
| SIGBUS   : GEnerato da un difetto dell'hardware                                  |
| SIGEMT   : Simile a sigbus                                                       |
| SIGHUP   : Per spiegare meglio, facciamo conto di chiudere una                   |
|            connessione ppp0 quando viene                                         |
|            inviato il signal SIGHUP... cosa succede ? =) il modem                |
|            riaggancia... stessa cosa ...                                         |
|            dando un SIGHUP al processo di un terminale questo                    |
|            "riaggancia" tutti i processi del gruppo                              |
| SIGILL   : GEnerato da un difetto dell'hardware                                  |
| SIGINT   : Segnale di interruzzione avviene di solito quando si batte            |
|            il tasto d 'interruzzione sul terminale                               |
| SIGKILL  : Unico modo garantito per terminare un processo poichè il              |
|            processo ricevente non lo puo' ignorare                               |
| SIGPIPE  : Quando un processo esegue una scrittura su una pipe o una             |
|            FIFO e non c'è alcun processo che legga dalla                         |
| 	     pipe o dalla FIFO questo segnale viene inviato al processo            |
|            scrivente.                                                            |
| SIGQUIT  : Questo segnale viene generato di solito quando si batte il            |
|            tasto ti terminazione . E' simile al segnale                          |
|            SIGINT ma SIGQUIT genera anche un'immagine di memoria                 |
| SIGSEV   : AMATO ? o odiato ?Questo è generato da un difetto                     |
|            dell'hardware dipendente dall'applicazzione, una                      |
|            violazione della segmentazione viene generata solitamente             |
|            quando un processo fa riferimento ad un indirizzo                     |
|            di memoria a cui non è consentito l'accesso                           |
| SIGSTOP  : Questo arresta un processo.che puo' essere ripreso con SIGCONT        |
| SIGSYS   : Indica che è stata fatta una chiamata di sistema non valida           |
| SIGTERM  : Segnale di terminazione software , E' il segnale di default           |
|            inviato ad un processo                                                |
|            quando s'impiega il comando kill diverso da kill().                   |
| SIGSTP   : Questo segnale è inviato ad un processo quando viene battuto          |
|            sulla tastiera il tasto ctrl-Z                                        |
| SIGUSR1  : Definito dall'utente                                                  |
|                                                                                  |
| Ok abbiamo  definito i  principali segnali  e kme  si usano.  Tuttavia resta una |
| questione aperta e dei problemi che prima del 4.3BSD erano sorti e che  verranno |
| risolti con l'introduzione  delle mask che  vedremmo nel prox  num di mjd  zine. |
| Ciau belli Lupsyn Una  cosa sola : non  è solo xkè avete  il drago , che  dovete |
| sentirvi grandi....!                                                             |
|                                                                                  |
+----------------------------------------------------------------------------------+