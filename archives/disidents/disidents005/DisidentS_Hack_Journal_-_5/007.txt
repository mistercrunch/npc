[007]_Modificacion_de_proyectos_VB_fuera_de_VB_by_RandomLoG_-_Disidents_Journal_5
 
 
                     -+-| DisidentS Hack Journal #5 |-+-
 
 
 
 
 
 
 
 
 
   ______________________________________________________________________
  |                                                                      |
  | -+- Titulo_____: Obteniendo Informacion de proyectos VB fuera de VB  |
  | -+- Autor______: RandomLoG                                           |
  | -+- E-Mail_____: xxmorochoxx@aol.com                                 |
  | -+- AIM S/N ___: Xx Morocho xX                                       |
  | -+- Team_______: DisidentS Argentina - http://disidents-team.cjb.net |
  |______________________________________________________________________|
 
 
 
 
 
"la potencia sin control..no sirve de nada"
>>------------------------------------------------------------------------<<
 
 
 
----------------------------------------------------------------------------
----------------------------------------------------------------------------
.==========================================================================.
|===========~ INDICE ~======================================================
|===========================================================================
|=~ 1- Parseando el Proyect file                                           |
|=~ 2- Parseando los Forms files                                           |
|=~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~=.
======================================================~ INDICE ~============
============================================================================
.==========================================================================.
|===========~ 1- Parseando el Proyect file. ~|==============================
 
Bueno para parsear el proyect file, parsearemos solamente los datos necesarios
como por ejemplo el nombre de los Formularios que lo componen, los modulos, objetos y etc.
Pero antes necesitamos saber como escribe el Visual Basic los datos en un proyecto...
abrimos con el notepad o cualkier herramienta de texto y vemos algo asi...

	Type=Exe
	Form=Form1.frm
	IconForm="Form1"
	Startup="Form1"
	Command32=""
	Name="RandomLoG"
	HelpContextID="0"
	CompatibleMode="0"
	MajorVer=1
	MinorVer=0
	RevisionVer=0
	AutoIncrementVer=0
	ServerSupportFiles=0
	VersionCompanyName="Disidents Argentina"
	CompilationType=0
	OptimizationType=0
	FavorPentiumPro(tm)=0
	CodeViewDebugInfo=0
	NoAliasing=0
	BoundsCheck=0
	OverflowCheck=0
	FlPointCheck=0
	FDIVCheck=0
	UnroundedFP=0
	StartMode=0
	Unattended=0
	ThreadPerObject=0
	MaxNumberOfThreads=1

vemos que no hay encriptacion ni nada que sea muy complejo de parsear asi que vamos a lo practico.
Podemos abrir el proyecto desde visual

open "archivo del proyecto.vbp" for input as #1
 do while not eof(1) ' Inicia un ciclo para leer linea a linea el archivo
  input #1, datos ' capturamos la linea en una variable
  if instr(1, datos, "=" ) <> 0 then ' si encuentra el signo "=" entonces procede
   vector = split( datos, "=") ' creamos un vector con los datos parseados
    select case vector(0) ' segun lo que haya en vector(0) ...
     case "Form": listForms.additem vector(1) ' aka agregamos el nombre del archivo del form a una listbox llamado listforms
    end select
  end if
 loop
close #1

Bueno como veran use un select case para 1 sola comparacion, porque ?
porque en el ejemplo solo mostrare como parsear Formularios y como obtener datos
ustedes despues pueden probar con modulos, objetos, etc, usando el case...

por ejemplo para un modulo:

   vector = split( datos, "=") ' creamos un vector con los datos parseados
    select case vector(0) ' segun lo que haya en vector(0) ...
     case "Form": listForms.additem vector(1) ' aka agregamos el nombre del archivo del form a una listbox llamado listforms
     case "Module":listmodulos.additem vector(1)' aka agregamos el nombre del archivo del modulo a una listbox llamado listModulos
    end select


Bueno hasta aka todo lindo y facil , ahora se empieza a complicar la cosa....

|===========~ 2- Parseando los Forms files. ~|==============================
|===========================================================================

abramos un archivo de formularios, con el notepad:

vamos a ver algo asi....

VERSION 5.00
Begin VB.Form Form1 
   Caption         =   "Form1"
   ClientHeight    =   3450
   ClientLeft      =   1140
   ClientTop       =   1515
   ClientWidth     =   3285
   LinkTopic       =   "Form1"
   PaletteMode     =   1  'UseZOrder
   ScaleHeight     =   3450
   ScaleWidth      =   3285
   Begin VB.TextBox ItemText 
      Height          =   285
      Left            =   720
      TabIndex        =   2
      Text            =   "DEP"
      Top             =   3000
      Width           =   855
   End
   Begin VB.CommandButton Command1 
      Caption         =   "Search"
      Height          =   495
      Left            =   1800
      TabIndex        =   1
      Top             =   2880
      Width           =   1215
   End
   Begin VB.ListBox List1 
      Height          =   2595
      Left            =   120
      Sorted          =   -1  'True
      TabIndex        =   0
      Top             =   120
      Width           =   3135
   End
   Begin VB.Label Label1 
      Caption         =   "Prefix"
      Height          =   255
      Left            =   120
      TabIndex        =   3
      Top             =   3000
      Width           =   495
   End
End
Attribute VB_Name = "Form1"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Explicit

Private Declare Function SendMessage Lib "user32" Alias "SendMessageA" (ByVal hwnd As Long, ByVal wMsg As Long, ByVal wParam As Long, ByVal lParam As String) As Long
Private Const LB_FINDSTRING = &H18F

Private Sub Command1_Click()
Dim retval As Long
    
    retval = SendMessage(List1.hwnd, _
        LB_FINDSTRING, -1, ItemText.Text)
    If retval = -1 Then
        MsgBox "No encontrado"
    Else
        MsgBox "Encontrado en la posición: " & retval + 1
    End If
End Sub


Private Sub Form_Load()
    List1.AddItem "ATT" & vbTab & "ATTENDANCE"
    List1.AddItem "ACT" & vbTab & "ACTIVITY"
    List1.AddItem "DEP" & vbTab & "DEPARTMENT"
    List1.AddItem "MTG" & vbTab & "MEETING"
    List1.AddItem "BRK" & vbTab & "BREAK"
    List1.AddItem "SIC" & vbTab & "SICK"
End Sub

No voy a explicar que es cada linea que aparece en los archivos de formularios ya que es algo trivial....
vemos que tampoco no esta encriptado, pero se complica bastante...

Bien una vez que tenemos los Formularios obtenidos luego del parseo del archivo de proyecto vamos a proceder a obtener 
la información que nos importa.... como ?, otra vez abriendo archivos

open "archivo de formulario.frm" for input as #2
  Do While Not EOF(2)
   Input #2, Datos
   If InStr(1, Datos, "Begin VB.MDIForm ") <> 0 Then Vector = Split(Datos, "VB.MDIForm"):   GoTo Rnd ' Si es un MDI Form
   If InStr(1, Datos, "Begin VB.Form ") <> 0 Then Vector = Split(Datos, "VB.Form "):   GoTo Rnd  ' Si es un Form normal
  Loop
 Close #2
rnd:
 list2.additem vector(1) ' Agrega el nombre del formulario, no el nombre del archivo
 ' Aca vemos que en list2 alojaremos los nombres de lo formularios, y en el listforms alojamos el nombre de archivo de los formularios

bien con ese pedazo de codigo se puede hacer una Sub por ejemplo:

Public Sub ActualizA_Forms ( Archivo )
' obviamente archivo es el nombre del archivo del formulario...
open archivo for input as #2
  Do While Not EOF(2)
   Input #2, Datos
   If InStr(1, Datos, "Begin VB.MDIForm ") <> 0 Then Vector = Split(Datos, "VB.MDIForm"):   GoTo Rnd ' Si es un MDI Form
   If InStr(1, Datos, "Begin VB.Form ") <> 0 Then Vector = Split(Datos, "VB.Form "):   GoTo Rnd  ' Si es un Form normal
  Loop
 Close #2
rnd:
 list2.additem vector(1) ' Agrega el nombre del formulario, no el nombre del archivo
End Sub

en que nos ayuda hacer una funcion con esto ?, facil, si queremos abrir un proyecto con mas de 1 form
no vamos a escribir todo el codigo de parseo de forms cada vez que encontremos un form.
ahora bien entre el parseo del Proyecto y del Form tenemos algo importante..... veamoslo:

open "archivo del proyecto.vbp" for input as #1
 do while not eof(1) ' Inicia un ciclo para leer linea a linea el archivo
  input #1, datos ' capturamos la linea en una variable
  if instr(1, datos, "=" ) <> 0 then ' si encuentra el signo "=" entonces procede
   vector = split( datos, "=") ' creamos un vector con los datos parseados
    select case vector(0) ' segun lo que haya en vector(0) ...
     case "Form": l
      ListForms.additem vector(1) ' aka agregamos el nombre del archivo del form a una listbox llamado listforms
      actualiza_Forms path del proyecto & vector1  ' Abrimos la Sub y actualizamos el form apenas encontramos el form. :)
    end select
  end if
 loop
close #1

Public Sub ActualizA_Forms ( Archivo )
' obviamente archivo es el nombre del archivo del formulario...
open archivo for input as #2
  Do While Not EOF(2)
   Input #2, Datos
   If InStr(1, Datos, "Begin VB.MDIForm ") <> 0 Then Vector = Split(Datos, "VB.MDIForm"):   GoTo Rnd ' Si es un MDI Form
   If InStr(1, Datos, "Begin VB.Form ") <> 0 Then Vector = Split(Datos, "VB.Form "):   GoTo Rnd  ' Si es un Form normal
  Loop
 Close #2
rnd:
 list2.additem vector(1) ' Agrega el nombre del formulario, no el nombre del archivo
End Sub

Va tomando forma esto no ?

Haremos un pequeño punto y coma y explicare que es lo que hice hasta ahora...
Primero parseamos el proyect file, sacamos el nombre de los archivos que conforman al proyecto,
tambien podriamos sacar el tipo de proyecto, si es un exe, una dll un control ocx , etc..
Parseamos tambien el Form file, para actualizar los datos de los formularios, por ejemplo su caption su nombre etc


Bueno yo les di una idea de como por ejemplo hacer un proyect explorer para Visual Basic, pero se pueden hacer muchas
cosas mas, un depurador, un interprete, modificar los forms y proyectos fuera de vb, injertar codigo, quitar codigo, etc..

onda... la cuestion aqui es interpretar lo que explique, yo explique como hacer las cosas para los forms
cambiando una linea en todo el codigo, lo pueden hacer para modulos, controles, librerias, etc...


Bueno amigos, no amigos, cachorras xD, nos veremos en el proximo EZINE :)
Feliz Navidad y un muy prospero Año Nuevo para todos!!!!


-----------------------------------------------------------------------------
                   DisidentS Hacker Team 2003 (c).
 
----------------------------------------------------------------------------
                 Mail del Team: disidents@yahoo.es
----------------------------------------------------------------------------
 
                               0
                             X0 0X
                               S
