[025]_Malas_ideas_con_Internet_Explorer_by_Freebrain_DisidentS_Hack_Team_Journal_-_5




                     -+-| DisidentS Hack Journal #5 |-+-









  _________________________________________________________________________
 |                                                                         |
 | -+- Titulo_____: Malas ideas con Internet Explorer                      |
 | -+- Autor______: FREEBRAIN                                              |
 | -+- E-Mail_____:                                                        |
 | -+- Team_______: DisidentS España - http://disidents-team.cjb.net       |
 | -+- KB_________: 14.5                                                   |
 | -+- Tema_______: Seguridad                                              |
 |_________________________________________________________________________|







.==========================================================================.
|===========~ INDICE ~======================================================
|===========================================================================
|=~ 1.0  Introduccion                                                      |
|=~ 2.0  El fallo                                                          |
|=~ 3.0  Proof of concept                                                  |
|=~ 4.0  Malas ideas                                                       |
|=~ 5.0  Poniendo remedio                                                  |
|=~ 6.0  Despedida                                                         |
|=~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~=.
======================================================~ INDICE ~============
============================================================================




.==========================================================================.
|===========~ 1.0 Introduccion ~============================================
|===========================================================================

De todos es sabido que Internet Explorer pese a ser uno de los mas populares
navegadores (por tanto, de los mas utilizados) cuenta con una buena cantidad
de fallos de seguridad, a los cuales por desgracia Microsoft no pone algun
remedio. Cada dia son mas las vulnerabilidades que azotan este navegador, y
muchas de una gravedad bastante alta. Muchos (demasiados) son los usuarios 
que estan a merced de tales fallos y pocos son conocedores de ellos.

Curioseando por redes de IRC (vaya sitio mas recondito para encontrar una
vulnerabilidad en un navegador, ¿eh?) me encontre con un gusano. Este gusano
(el cual me dejo perplejo) utilizaba la vulnerabilidad aqui explicada, y
parece que pocas personas se detuvieron a estudiarlo un poco y enterarse de
como funcionaba.

Esta vez fue un simple gusano que azotaba redes de IRC, pero ... quien sabe
que podra ser la proxima?


.==========================================================================.
|===========~ 2.0 El fallo ~================================================
|===========================================================================

Hecha esta pequeña introduccion, entremos en materia.

Mas que un fallo propiamente dicho, a mi me parece que esto ha sido un 
descuido en toda regla por parte de los programadores de Microsoft 
encargados del tema del Internet Explorer. Las versiones afectadas por ahora
son:

- Microsoft Internet Explorer 5.x

Probablemente las superiores a 5.x esten afectadas, pero es algo que todavia
no he podido comprobar (y pido disculpas por ello).
Esta vulnerabilidad se centra en la interpretacion de determinadas funciones
en JavaScript que pueden resultar bastante peligrosas segun el uso que se 
les de. En concreto me estoy refiriendo a tres funciones:

- file();

- file.writeline()

- run();

Ahora voy a explicar asi un poco por encima para que sirve cada una de estas
funciones. 

La funcion file(); esta referida a la gestion de archivos en un disco rigido
(evidentemente, en el disco rigido de quien utilize el Internet Explorer).
Dentro de esta funcion, se especifica un nombre de archivo, por ejemplo:
"proof.txt" (la sintaxis para esto se vera reflejada en el proof of concept, 
usease, en la seccion siguiente ;) y desde ahi, permite centrarnos en este
archivo, en concreto, escribir en el un determinado contenido que nosotros
especifiquemos.

¿Como se hace esto? Pues bien, dentro del bloque de file(); (dicho asi de un
modo un tanto chapucero) se incluye la otra funcion de la que se hablo, 
file.writeline(). Dentro de los parentesis, especificamos el texto que se
quiera escribir, por ejemplo, "Hola a todos", resultando:

file.writeline("Hola a todos")

Con esto se habra escrito un archivo en el hd de la persona que ha usado el
Internet Explorer para interpretar ese codigo, un archivo que contiene el
texto "Hola a todos". ¿Parece una chorrada verdad?

Pero, no acaba aqui la cosa, tenemos ahora la funcion run(); la cual (como
ya habreis supuesto) colocariamos tambien dentro del bloque file(); para
ejecutar el archivo especificado con el contenido especificado. Con el 
anterior ejemplo ... parece una gran tonteria, pero ... nadie nos quita de
que en vez de "proof.txt" fuese "proof.vbs", y de que el contenido en vez
de "Hola a todos" fuese un codigo VBS (visual basic script) escrito por 
nosotros. Ahora tendriamos todas las posibilidades que nos brinda el VBS al
alcance de nuestra mano, y por supuesto, ejecutando el hipotetico archivo
.vbs, lo que hace de esto algo bastante peligroso como podras imaginarte.

Lo peor de todo esto, es que cuando el Internet Explorer interpreta este
codigo "javascript/activeX" que a ojos de cualquiera que entienda un minimo 
puede usarse con fines maliciosos, Internet Explorer no pide confirmacion 
del usuario para que se interprete este codigo, tan siquiera da un misero 
aviso de que tal codigo esta ejecutandose y de que puede resultar peligroso.
Por tanto, el usuario no se entera de nada.

Esto todo seria un codigo JS/AX, usease, que iria escrito dentro de los
tags de script en HTML.

Si analizas un poco esto, te daras cuenta (al menos a mi me lo ha parecido)
que esto es un descuido en toda regla, pero como veremos mas adelante, ha
sido un descuido que puede costar muy caro.

Este fallo ha sido reportado con anterioridad como un asunto de activeX,
pero como se vera, aqui se le va a dar otro uso no relacionado con activeX.
Por otra parte, en los reportes que he observado este fallo se adjudica a
la version 5.5 de Internet Explorer, pero he comprobado que la version 5.0
tambien es vulnerable, por lo que supongo que otras versiones posiblemente
se vean tambien afectadas.


.==========================================================================.
|===========~ 3.0 Proof of concept ~========================================
|===========================================================================

Ahora veamos el "exploit" para esto. El codigo que se aporta a continuacion
es TOTALMENTE inofensivo (como podras comprobar si sabes un poquito de JS y
si me has prestado atencion cuando he "explicado" el fallo :-P).

Proof of concept: 

InterfaceObject=document.applets[0];
setTimeout("Write()",1000);
function Write() {
fsoClassID="{0D43FE01-F093-11CF-8940-00A0C9054228}";
InterfaceObject.setCLSID(fsoClassID);
fso = InterfaceObject.createInstance();
// windir = fso.getspecialfolder ;        
filename = "\\proof.txt";
file = fso.opentextfile(filename, "2", "TRUE");
file.writeline("Hola mundo")
file.close();
}

Bien, para todo el que no este muy ducho en JS/AX, explico un poco por
encima este pequeño codigo. Basicamente, vamos a las partes importantes:

filename = "\\proof.txt"; --> Aqui se especifica el nombre del archivo.

file.writeline("Hola mundo") --> Escribimos la linea dentro del archivo.

file.close(); --> Cerramos file();

El archivo concretamente se escribira en el directorio raiz de la unidad 
logica principal, por ejemplo, si nuestra unidad (ojo, hablo de disco 
rigido) es c:, el archivo se escribira en c:\, resultando la ruta como 
c:\archivo (c:\proof.txt en este caso).

Como dije antes, ese codigo tiene que ir entre los tag's de script, es
inofensivo (solo es una pequeña muestra de como funcionaria el fallo ;) y
en el he prescindido de la funcion run();, aunque se podria añadir despues
de la linea "file.writeline("Hola mundo")". 

Ahora imaginate que en vez de "Hola mundo" puse un codigo en VBS (e imagina
todas las posibilidades que puede darme el VBS) y que añadi "Run();". 
No hace falta imaginar demasiado, se ejecutaria el codigo del archivo, fuese
cual fuese, hiciese lo que hiciese.


.==========================================================================.
|===========~ 4.0 Malas ideas ~=============================================
|===========================================================================

Ahora bien, pese a que en principio pueda parecer un fallo sin demasiada
relevancia, o de dificil explotacion, no es asi.

Hay varias maneras de explotarlo, aqui se proponen algunas con el fin de 
resaltar la importancia de este fallo y de otros similares que puedan ser
descubiertos en el futuro (tanto en este como en otros navegadores):

1- Infeccion por mail: actualmente hay una buena cantidad de usuarios que
utilizan sistemas web-based (webmail) para leer sus correos, en vez de usar
los tipicos clientes (Eudora, MS Outlook, etc). Muchos de estos usuarios que
utilizan webmail utilizan a su vez Internet Explorer para consultar acceder
al webmail en cuestion. Por otra parte, me atreveria a decir que casi el 99%
de los webmails permiten codigos html dentro de los emails, por lo que la
posibilidad de enviar un correo a un usuario, que use webmail e Internet
Explorer, con un codigo que emplee tal vulnerabilidad para escribirle un
fichero "maligno" en su HD y que funcione, es bastante grande. Ademas esto
se podria llegar a hacer en masa (¿quien no conoce los metodos de los 
spammers que hacen llegar sus correos a miles de cuentas?) resultando una
verdadera plaga muy peligrosa.

2- Infeccion por post: en la red actualmente hay miles (por no decir 
millones) de foros, libros de visitas (guestbooks), etc etc. Estos tambien
admiten en su mayoria la añadicion de codigos html en los post. Incluyendo
el "codigo maligno" en un post, haria que toda la gente con un IE vulnerable
tan solo con leer ese post se "infectase". Ahora toca multiplicar el numero
de foros existentes en la red, por el numero de personas que visitan un post
al dia. ¿Escalofriante eh?

3- Infeccion por inyeccion de codigo HTML: y para terminar, en aplicaciones
o webs afectadas por fallos de inyeccion HTML, se podria inyectar (añadir)
el codigo maligno, por consiguiente, quien visitara la web donde ha sido
inyectado tal codigo, quedaria infectado.

Hay que decir que estos tres metodos presentados anteriormente se podrian
agilizar por medio de un software (un virus) que los llevase a cabo de 
manera repetida y continuada. Como bien comente anteriormente, un worm de
mIRC utilizaba esta vulnerabilidad para reproducirse, pero bien podria ser
utilizada para "destruir".

Supongo que existiran otras mil maneras mas de darle uso a esta potente 
vulnerabilidad, aunque realmente solo he valorado esas tres ideas (bueno, y
sinceramente son las tres que se me han ocurrido a mi). Como ya sabreis, en
estos temas lo unico que cuenta es la originalidad e imaginacion de uno,
nada mas.

Ante esto, conviene darle importancia a ese tipo de errores en software tan
utilizado como puede ser el Internet Explorer, y tratarle de poner remedio
cuanto antes, como veremos ahora mismo :-)


.==========================================================================.
|===========~ 5.0 Poniendo remedio ~========================================
|===========================================================================

Bien, en cuanto a los usuarios de Internet Explorer, recomiendo dos cosas:

1- Si se esta muy apegado al Internet Explorer por los motivos que sean,
actualizar inmediatamente a la ultima version, y parchear el IE con mucha
regularidad. Para esto puede ser interesante visitar periodicamente la web
de micro$oft, asi como otras webs de seguridad donde se publiquen fallos
relativamente recientes.

2- Si no se esta muy apegado a este navegador, recomiendo el uso de otro
navegador. Actualmente existen muchos navegadores muy competentes y con 
menos problemas de seguridad que el Internet Explorer. Algunos de estos son 
Mozilla, Opera, etc.

En cuanto a moderadores y/o administradores de foros, recomiendo que o bien
se prohiban los mensajes con codigos HTML, o bien se prohiban las "funciones
malignas" (algo asi como una proteccion de badword's). Con el tema de los
libros de visitas y similares, igual.

En cuanto al correo, de cara a los usuarios, un par de cosillas:

1- Preferentemente utilizar clientes de correo seguros antes que webmail 
(en el caso de que tu ISP te lo permita, claro).

2- Desconfiar de los emails de personas que no conocemos, nunca se sabe
cuando podran traernos un disgusto, vale mas ser precavidos :-P

Para los webmasters que utilizen generadores de portales PHP-Nuke, PostNuke,
phpBB, o similares (que frecuentemente suelen sufrir vulnerabilidades de
inyeccion) decir que se preocupen de parchear sus portales/foros con 
regularidad. Y bueno, tambien para los administradores a cargo de servidores
web, puesto que ya he visto algunas vulnerabilidades de tipo inyeccion html
que afectan a httpd's.

Y bueno, en cuanto al remedio de este problema, eso es todo :-)


.==========================================================================.
|===========~ 6.0 Despedida ~===============================================
|===========================================================================

Ha llegado la hora de despedirse. Espero que el contenido aqui expuesto te
haya servido de alguna utilidad (puesto que para eso ha sido redactado) y
tambien decir que esto es mas la reafirmacion de una vulnerabilidad, un
nuevo enfoque y una pequeña añadicion a lo que seria el "reporte original"
mas que un reporte de un nuevo fallo.

Como no, quiero dar las gracias y dedicar mi trabajo a: Nusky, Tresde, ipy,
w3ndig0, S-P-A-R-K, [[AKira]], RandomLoG, {V|s|oN}, Impos, TcpstacK, uRz4, 
MaSTeRiX, JeNdArK, Pola_De_A, |_Tr0mP4s, ^DeLtA^, ~j~, Lorddev, VaMp|r3 y
a muchos otros que ahora me dejo en el tintero. Gracias a todos.

- E0f -


----------------------------------------------------------------------------
contacto: disidents@yahoo.com 
contacto: freebrain@unionnewbies.net
----------------------------------------------------------------------------





