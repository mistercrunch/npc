---
title: "AIX"
ezine: "merzenarioz"
---

# AIX

**Ezine:** merzenarioz

<div className="ascii-content">

```


SISTEMA OPERATIVO    :///Aix\\\ " El Unix de Ibm"


Etapas:

Etapa I :Nivel Basico
Etapa II: Nivel Superior 


Nivel : Basico

Niveles de aprendisaje:

a)- Introducci≤n al Aix

b)- Archivos y Directorios

c)- El Shell 

d)- Los comandos mas usados 


iNTRODUCCION :

El sistema operativo AIX es la versi≤n de UNIX  de IBM ,es un sistema multiusuario y multitarea, lo cual quiere decir que los recursos del sistema (procesador, disco, memoria, etc) pueden ser compartidos simultßneamente por varios usuarios, cada uno de los cuales puede tener en ejecuci≤n mßs de un proceso en un momento dado. Los usuarios pueden acceder al sistema desde la consola del mismo o bien desde terminales locales o remotas (acceso vφa red).  
Cuando un usuario inicia una sesi≤n de trabajo, AIX le obliga a identificarse con su c≤digo de cuenta y contrase±a, de esta forma el sistema es capaz de identificar quiΘn es el autor de cualquier operaci≤n (ej. creaci≤n de archivo, ejecuci≤n de programa, etc) y puede tambiΘn restringir las posibles acciones del usuario. La seguridad es por lo tanto uno mßs de los aspectos que AIX tiene en consideraci≤n. 


ARCHIVOS Y DIRECTORIOS 
CONCEPTOS B┴SICOS 

Al igual que en otros sistemas operativos, en AIX un archivo es un conjunto de datos que pueden ser escritos y leφdos por los usuarios mientras que un directorio no es mßs que una entidad que permite agrupar archivos. Los directorios se emplean, por lo tanto, para organizar los archivos del sistema.  

En AIX los archivos pueden ser de tres tipos:  

Regulares: almacenan informaci≤n (ej. texto, programas, datos, ...) 
Directorios: son realmente archivos que almacenan informaci≤n para acceder a otros archivos 
Especiales: cualquier dispositivo (ej. disco, terminal, tarjeta de sonido, ...) tiene un archivo asociado. TambiΘn se encuentran en esta categorφa los archivos FIFO (first-in, first-out) 
Los archivos tienen un nombre ·nico dentro del directorio que los contiene y que ha de cumplir las siguientes reglas:  
Puede tener hasta 255 caracteres de longitud y puede contener letras, n·meros y subrayados. 
AIX distingue entre may·sculas y min·sculas (ej. Catalogo y catalogo son nombres distintos de archivo). 
Debe evitarse en nombres de archivos el uso de aquellos caracteres con un significado especial para el sistema operativo (ej. / \ " ' * ; - ? [ ] ( ) ~ ! $ { } < > # @ & |). 
Los archivos cuyo nombre comienza por . (punto) no aparecen en los listados de directorio a menos que se especifique la opci≤n apropiada. 
El nombre / estß reservado para denotar el directorio raiz. 
El nombre . (punto) estß reservado para denotar el directorio en curso. 
El nombre .. (dos puntos) estß reservado para denotar el directorio anterior al directorio en curso. 
Una ruta (o pathname) de un archivo no es mßs que su nombre precedido por los nombres de cada uno de los directorios que lo contienen. Una ruta es absoluta cuando se especifica partiendo del directorio raiz (/) y relativa cuando se especifica partiendo del directorio en curso. Cada nombre en una ruta de archivo se separa del siguiente por un / .  
Ejemplos:  
  

/unix archivo unix contenido en el directorio raiz 
/usr/bin/ls archivo ls contenido en el directorio /usr/bin 
usr/bin/ls archivo ls del directorio usr/bin contenido en el directorio en curso (si el directorio en curso es / equivale al ejemplo anterior) 
catalogo.txt archivo catalogo.txt contenido en el directorio en curso 
./catalogo.txt archivo catalogo.txt contenido en el directorio en curso 
../mensaje.txt archivo mensaje.txt contenido en el directorio anterior al directorio en curso 

PERMISOS DE ACCESO
Entre los atributos asociados a un archivo o directorio hay tres muy importantes desde el punto de vista de la seguridad:  
el propietario: usuario que creo el archivo 
el grupo: grupo de usuarios (en AIX un usuario pertenece a uno o varios grupos de usuarios) 
los permisos: flags que determinan quΘ usuarios pueden acceder al archivo y quΘ operaciones pueden realizar sobre Θl. 


Jerarquφa de directorios de AIX
Cada directorio de la jerarquφa almacena distintas clases de archivos, asφ por ejemplo:  
  

/home Contiene el directorio inicial de trabajo de cada usuario 
/usr/lib Contiene librerφas 
/usr/bin Contiene comandos de usuario 
/usr/include Contiene ficheros de cabecera (*.h) 
/etc Contiene ficheros para el arranque y gesti≤n del sistema 
/dev Contiene ficheros especiales para E/S de dispositivos 
/tmp Contiene ficheros temporales  

Si el usuario observa tras ejecutar el comando ls -l cußles son los permisos de los directorios del sistema, verß que no tiene permiso para escribir en la mayorφa de ellos, s≤lo el administrador del sistema (el usuario cuyo c≤digo de cuenta es root) puede hacerlo, con ello se evita el deterioro del sistema ocasionado por las acciones de los distintos usuarios.  
Cada usuario del sistema tiene en el directorio /home un subdirectorio del cual es propietario, ello le permite crear, borrar y renombrar los archivos y otros subdirectorios contenidos en Θl, asφ como otorgar permisos a otros usuarios para que puedan acceder a sus archivos. Por ejemplo, si el usuario JosΘ Martφn tiene como c≤digo de cuenta jmartin, su directorio HOME serß /home/jmartin. El directorio HOME de un usuario es, junto con el  /tmp, uno de los pocos lugares de la jerarquφa de directorios de AIX en los cuales los usuarios no administradores pueden escribir.  

En los sistemas con un gran n·mero de usuarios la cantidad de informaci≤n que cada uno de ellos puede grabar en su directorio HOME suele estar limitada, esto se consigue estableciendo cuotas de disco. Las cuotas permiten distribuir el espacio de almacenamiento disponible entre los distintos usuarios del sistema, evitando asφ que uno de ellos haga un uso excesivo dejando sin espacio a los demßs. Al rebasar  la cuota de disco asignada, el usuario obtendrß un mensaje de aviso (ej. "disk quota exceeded ..."), deberß entonces reducir el espacio consumido eliminando aquellos archivos que no sean de utilidad. El usuario podrß solicitar al administrador del sistema el incremento de la cuota de disco asignada en casos justificados.  



EL SHELL 
INTRODUCCI╙N 

El shell es un programa de AIX que tiene como misi≤n recoger los comandos que el usuario introduce, ejecutar los programas asociados y mostrar finalmente los resultados. Cada una de las cuentas de los usuarios tiene asignado uno de los siguientes shells disponibles en el sistema:  

Bourne shell: comando bsh 
C shell:  comando csh 
Korn shell: comando ksh 
El Korn shell es el empleado en la mayorφa de los casos al incluir las facilidades proporcionadas por los restantes, es por ello por lo que nos referiremos al Korn shell en el resto de este documento.  
El Korn shell ofrece un completo lenguaje de programaci≤n al usuario:  

ofrece sentencias de control de flujo tales como bucles y condicionales 
permite definir funciones 
permite definir variables alfanumΘricas y numΘricas y tambiΘn arrays 
dispone de operaciones aritmΘticas y bases de numeraci≤n 
Esta secci≤n no pretende transformar al lector en un experto programador del shell, sino mostrarle los conceptos mφnimos que debe conocer sobre Θl como usuario del sistema. Para profundizar mßs en el conocimiento del Korn shell el usuario puede consultar la documentaci≤n en lφnea disponible en el sistema.  
  
EJECUCI╙N DE COMANDOS 

Cuando se ejecuta el shell de forma interactiva, el usuario introduce los comandos por el teclado y el shell muestra la salida de la ejecuci≤n y los errores que se produzcan por la pantalla de la terminal. Cada vez que espera un comando, el shell muestra un apuntador (prompt) que en AIX  es por defecto el sφmbolo $ (dollar), el usuario puede entonces escribir el comando a ejecutar.  

Algunos ejemplos de comandos que se pueden construir siguiendo la sintaxis del shell son:  

comando simple: formado por el pathname (ruta) de un archivo ejecutable y sus argumentos. Ejemplo: 
  
ls /usr/bin
El ejemplo anterior lista el contenido del directorio /usr/bin. 
pipeline: formado por una lista de comandos separados por el carßcter |. En un pipeline, un comando toma como entrada la salida del comando anterior. Ejemplo: 
ls /usr/bin | more
En el pipeline anterior el comando more muestra  paginada la salida del listado. 
 
ejecuci≤n en segundo plano (background):  se ejecuta un comando concurrentemente con el shell sin necesidad de que Θste espere a su terminaci≤n (el shell muestra de inmediato el prompt para que el usuario introduzca nuevos comandos). 
sleep 5 & 
En el ejemplo anterior el comando sleep espera 5 segundos antes de terminar su ejecuci≤n.  Al ejecutarlo en segundo plano el shell no espera a que termine.
Cuando se escribe el nombre de un archivo ejecutable sin especificar el directorio que lo contiene, el shell utiliza la variable PATH para buscar el archivo en los directorios que dicha variable especifique, es mßs, no buscarß el archivo en el directorio en curso a menos que asφ se indique en dicha variable. Ejemplo:  
PATH=/usr/bin:/usr/local/bin/:.
Teniendo en cuenta la asignaci≤n anterior, si se ejecuta el archivo programa se intentarß buscar primero en /usr/bin, si no se encuentra en /usr/local/bin y por ·ltimo en el directorio en curso. Podremos conocer cußl es el valor de la variable PATH ejecutando el siguiente comando:  
echo $PATH
Si desde un programa ejecutado por el shell se quiere acceder a una variable definida por Θste, la variable debe exportarse mediante el comando de shell export. Por ejemplo, una variable que se exporta para que siempre estΘ accesible desde cualquier programa es la variable PATH vista anteriormente:  
export PATH
La ejecuci≤n de un comando puede requerir al usuario la entrada de informaci≤n (ej. introducir una cantidad). La vφa de entrada estßndar es el teclado, pero Θsta se puede redirigir a cualquier otro archivo mediante el carßcter < (menor que). Ejemplo:  
tr "[A-Z]" "[a-z]" < texto 
El comando anterior muestra por pantalla el contenido del archivo "texto" convertido a min·sculas. 
De la misma forma que se puede redirigir la fuente de entrada al ejecutar un comando, tambiΘn se puede redirigir el destino de las lφneas de salida producidas asφ como el de las lφneas de errores producidos. Ejemplos:  

Redirecci≤n de la salida de un comando 
  ls /usr/bin > listado.txt  
  
Redirecci≤n de la salida de errores 
  ls /inexistente 2> errores.txt  
  
Redirecci≤n de la entrada y salida 
  tr "[A-Z]" "[a-z]" < texto > texto.min 

PERFILES DE USUARIOS Y SHELL SCRIPTS 

Archivo de perfil de un usuario
Puesto que cada usuario puede tener unas necesidades concretas, AIX ofrece a cada uno de ellos la posibilidad de crear un archivo de perfil que serß ejecutado automßticamente por el shell de inicio del usuario al conectarse al sistema. El archivo de perfil contendrß una serie de comandos que permitirßn adecuar el entorno de trabajo a las necesidades del usuario.  
Si el shell utilizado por el usuario es el Bourne (bsh) o Korn (ksh), el archivo de perfil estß ubicado en su directorio HOME con el nombre .profile . Un uso habitual de este fichero es la modificaci≤n del valor por defecto de la variable PATH, para ello el usuario podrφa a±adir las siguientes lφneas:  

PATH=$PATH:/usr/local/bin  
export PATH
Para ver si existe este fichero y, en tal caso cußl es su contenido, se puede ejecutar el comando:  
cat $HOME/.profile  
NOTA: $HOME es una variable de shell que contiene el directorio  HOME del usuario 

Shell scripts
Cuando el usuario tiene que ejecutar una determinada serie de comandos con frecuencia puede ahorrar esfuerzo creando un shell script. Un shell script no es mßs que un archivo de texto que contiene una lista de comandos. Al ejecutar el shell script (escribiendo su nombre) se ejecutarßn los comandos que contiene.  
Por ejemplo, el usuario podrφa crear un archivo de texto llamado traspaso con los siguientes comandos:  

DIR=catalogos  
OLD=viejo  
mkdir $DIR  
rm $OLD/*.o  
cp $OLD/*.txt $DIR
para poder ejecutar el shell script anterior el archivo traspaso debe tener permiso de ejecuci≤n (x). Este permiso se puede otorgar mediante el comando chmod. Ej.: 
chmod +x traspaso 
Para ejecutar el shell script se escribirß su nombre:  
"traspaso"

LOS COMANDOS M┴S EMPLEADOS 
GESTI╙N DE DIRECTORIOS Y ARCHIVOS 

ls: listar directorios y archivos  

Listar  todos los archivos contenidos en el directorio actual 
  ls 
  
Listar los archivos contenidos en los directorios /etc y /bin 
  ls /etc /bin 
  
Listar todos los archivos y subdirectorios que empiezan por "a" contenidos en el directorio actual 
  ls a* 
  
Listar los archivos del directorio anterior  y sus atributos (permisos,  propietario, etc) 
  ls -l .. 
  
Listar archivos ocultos (los que empiezan por . (punto)) 
  ls -a
mkdir:  crear directorios  
Crear el directorio catalogos  
  mkdir catalogos 
  
Crear los directorios c1 y c2  
  mkdir c1 c2 
  
Crear el directorio /u/alopez/c1 
  mkdir /u/alopez/c1
rmdir:  eliminar directorios (deben estar vacφos)  
Eliminar el directorio catalogos 
  rmdir catalogos 
  
Eliminar los directorios c1 y c2 
  rmdir c1 c2 
pwd: mostrar el directorio en curso  
cd: cambiar el directorio en curso  

El directorio actual pasa a ser el directorio catalogos   
  cd catalogos  
El directorio actual pasa a ser /bin   
  cd /bin  
El directorio actual pasa a ser el directorio HOME del usuario 
  cd
cp: copiar archivos y directorios  
Copiar el archivo catalogo1.txt como catalogo2.txt   
  cp catalogo1.txt catalogo2.txt  
  
Copiar al directorio /u/alopez/catalogos  los archivos que empiezan por catalogo y  acaban en ".txt" 
  cp catalogo*.txt /u/alopez/catalogos  
  
Copiar recursivamente toda la estructura de archivos y  subdirectorios  contenida en el directorio catalogos  bajo el directorio catalogos.old  
  cp -r catalogos catalogos.old 
mv: renombrar o mover archivos y directorios  
Renombrar el archivo catalogo1.txt como catalogo2.txt   
  mv catalogo1.txt catalogo2.txt  
  
Mover los archivos que empiezan por catalogo y  acaban en ".txt" al directorio /u/alopez/catalogos   
  mv catalogo*.txt /u/alopez/catalogos  
  
Renombrar el directorio catalogos por catalogos.old o  moverlo si catalogos.old es un directorio ya existente.  
  mv catalogos catalogos.old 
rm:  eliminar archivos  
Eliminar el archivo catalogo.txt   
  rm catalogo.txt  
  
Eliminar los archivos que empiezan por catalogo  y acaban  en  ".txt" 
  rm catalogo*.txt 
chmod:  cambiar los permisos de archivos y directorios  
No se asigna ning·n permiso a grupo y otros   
  chmod go= a.txt 
  
Se asigna al grupo s≤lo permiso de lectura y ejecuci≤n   
  chmod g=rx a.txt 
  
Sobre los permisos existentes se a±ade para todos el de lectura   
  chmod a+r a.txt 
  
Sobre los permisos existentes se a±ade al grupo el de escritura  
  chmod g+w a.txt 
  
Se asigna al usuario s≤lo permiso de lectura y escritura  
  chmod u=rw a.txt 
  
Se asigna al usuario s≤lo permiso de lectura. Grupo y otros no tienen   
  chmod u=r,go= a.txt 
cat:  concatenar archivos o mostrar el contenido de archivos  
Mostrar el contenido del archivo a.txt   
  cat a.txt 
  
Concatenar los archivos que empiezan por "a"  y acaban  en ".txt" y depositar el resultado en el archivo b.txt  
  cat a*.txt > b.txt
COMANDOS MISCEL┴NEOS
more:  paginar por la pantalla de la terminal el contenido de archivos  
 Mostrar el contenido del archivo  
  more a.txt 
  
Mostrar los archivos especificados  
  more a*.txt 
  
Concatenar los archivos y paginarlos 
  cat a*.txt | more
head:  mostrar las N (por defecto 10) primeras lφneas de un archivo de texto  
Mostrar las diez primeras lφneas del archivo  
  head a.txt 
  
Mostrar las 20 primeras lφneas del archivo  
  head -20 a.txt
tail:  mostrar las N (por defecto 10)  ·ltimas lφneas de un archivo de texto  
Mostrar las diez ·ltimas lφneas del archivo  
  tail a.txt 
  
Mostrar las 20 ·ltimas lφneas del archivo 
  tail -20 a.txt
 wc:  contar el n·mero de lφneas, palabras y bytes de archivos de texto  
Mostrar el n·mero de las lφneas, palabras y bytes del archivo 
  wc a.txt  
  
Mostrar s≤lo el n·mero de lφneas 
  wc -l a
grep:  buscar en ficheros de texto las lφneas que contienen (o no contienen) un patr≤n dado  
Mostrar las lφneas que empiezan por la palabra Total   
  grep ^Total a.txt 
  
Mostrar las lφneas que contienen la palabra Total   
  grep Total a.txt 
  
Mostrar las lφneas que acaban con la palabra Total 
  grep Total$ a.txt 
  
Mostrar las lφneas que no contienen Total  (-v=negar)  
  grep -v Total a.txt  
  
Mostrar las lφneas que contienen la palabra total sin importar si se encuentra en may·sculas o en min·sculas 
  grep -i total a.txt 
  
Mostrar las lφneas que contienen la palabra total (sin distinguir may·sculas de min·sculas) seguidas por 0 o mßs caracteres (.*) y al menos un dφgito ([0-9]) 
  grep -i "total.*[0-9]" a.txt 
clear: borrar la pantalla de la terminal  
date: mostrar la fecha y hora del sistema  

exit: abandonar la ejecuci≤n del shell (si es el shell inicial de la sesi≤n, se termina tambiΘn la sesi≤n). El shell tambiΘn puede terminarse pulsando Ctrl-D. 

 
 
Item 2║   

Nivel: Superior 

Niveles: 

Insralacion , como crear un Sistema Irix , Configuraciones , Union con Kinux

Instalacion del Aix 

Requisitos
Para instalar AFS satisfactoriamente debe cumplir con los requisitos siguientes. 


Identidad de inicio de sesi≤n
Inicie una sesi≤n con la mßquina que estß instalando como superusuario root local. Cuando asφ se le indique, autentifφquese tambiΘn ante AFS como usuario de administraci≤n admin. 


Requisitos generales
Debe tener la Distribuci≤n de binarios de AFS para cada uno de los tipos de sistema que estΘ instalando. A no ser que se le indique lo contrario, la Distribuci≤n de binarios incluye software para mßquinas tanto servidor como cliente. Si estß utilizando la versi≤n en CD-ROM de la distribuci≤n, la mßquina que estß instalando tiene que poder acceder a los CD-ROM, ya sea mediante una unidad de CD local o por medio de un montaje NFS(R) de una unidad de CD conectada a una mßquina a la que la red pueda acceder. 
Todas las mßquinas AFS que pertenecen a una cΘlula deben tener acceso entre ellas a travΘs de la red. 
La mßquina tiene que estar ejecutando la versi≤n estßndar, suministrada por el proveedor, del sistema operativo soportado por la versi≤n actual de AFS. El sistema operativo ya tiene que estar instalado en la partici≤n raφz de la mßquina. 
El usuario debe estar familiarizado con el sistema operativo actual y con la configuraci≤n de discos de la mßquina que estß instalando. 
Todo el hardware y el software que no sea AFS de la mßquina debe estar funcionando con normalidad. 
No se puede estar ejecutando ning·n proceso crφtico en la mßquina que se estß instalando, puesto que habrß que rearrancarla durante la instalaci≤n. 

Requisitos de una mßquina servidor de archivos
La configuraci≤n de la cΘlula es mßs sencilla si la primera mßquina que se instale tiene la direcci≤n IP mßs baja de todas las mßquinas servidor de base de datos que actualmente piense instalar. Si mßs tarde configura una mßquina que tiene una direcci≤n IP inferior que una mßquina servidor de base de datos, antes de la instalaci≤n deberß actualizar el archivo /usr/vice/etc/CellServDB en todas las mßquinas cliente de la cΘlula. Para obtener una explicaci≤n adicional, consulte el apartado Instalaci≤n del funcionamiento de servidor de base de datos. 
La partici≤n montada en el directorio /usr debe tener como mφnimo 18 MB de espacio en disco disponible para almacenar binarios de servidor AFS (almacenados, por convenio, en el directorio /usr/afs/bin). Si la mßquina tambiΘn es cliente, tiene que haber espacio adicional disponible en el disco local, tal como se explica en el apartado Requisitos de una mßquina cliente. El juego completo de binarios de AFS todavφa necesita mßs espacio, pero normalmente se almacenan en un volumen AFS, en lugar de hacerlo en el disco local de una mßquina. 
Las bases de datos almacenadas en el directorio /usr/afs/db y los archivos de registro cronol≤gico de procesos de servidor almacenados en el directorio /usr/afs/logs necesitan cantidades de espacio mßs significativas en la partici≤n. Los requisitos exactos dependen de muchos factores, como por ejemplo el tama±o de la cΘlula y la frecuencia con que se truncan los archivos de registro cronol≤gico. 

Tiene que haber por lo menos una partici≤n (o un volumen l≤gico, en caso de que el sistema operativo y AFS lo soporten) dedicada exclusivamente a almacenar vol·menes AFS. El n·mero total y el tama±o de las particiones de servidor en todas las mßquinas servidor de archivos de la cΘlula determinan la cantidad de espacio que estß disponible para archivos AFS. 

Requisitos de una mßquina cliente
La partici≤n montada en el directorio /usr debe tener como mφnimo 4 MB de espacio en disco disponible para almacenar los binarios de cliente AFS y los archivos de bibliotecas del kernel (almacenados, por convenio, en el directorio /usr/vice/etc). El juego completo de binarios de AFS necesita mßs espacio, pero normalmente se almacenan en un volumen AFS, en lugar de hacerlo en el disco local de una mßquina. Para la mayorφa de tipos de sistema, las instrucciones hacen que s≤lo se copie el archivo de bibliotecas del kernel apropiado para la mßquina que se estß instalando. Si elige almacenar en el disco local todos los archivos de bibliotecas, el espacio necesario puede ser significativamente mayor. 
En una mßquina cliente que utiliza antememoria de disco, en la partici≤n de la antememoria (por convenio, montada en el directorio /usr/vice/cache) tiene que haber suficiente espacio libre para acomodar la antememoria. El tama±o mφnimo recomendado para la antememoria es de 10 MB, pero las antememorias todavφa mßs grandes suelen funcionar mejor. 
En una mßquina cliente que utiliza antememoria de memoria, tienen que haber como mφnimo 5 MB de memoria de mßquina para dedicarlos a la gesti≤n de la antememoria pero, de nuevo, si se dispone de mßs memoria se consigue un mejor rendimiento. Para obtener una explicaci≤n adicional, consulte los apartados del Instalaci≤n de mßquinas cliente adicionales que tratan sobre la configuraci≤n de la antememoria. 

--------------------------------------------------------------------------------

Tipos de sistema soportados
En las IBM AFS Release Notes para cada release de AFS se listan los tipos de sistema soportados. A menudo, entre distintos releases de AFS se dispone de soporte para revisiones posteriores de un sistema operativo. El grupo de soporte del producto AFS puede ofrecerle mßs detalles. 

El objetivo de los grupos de desarrollo y soporte del producto AFS es dar soporte a un amplio rango de tipos de sistema conocidos. Ademßs, cada vez que un proveedor de sistemas operativos entrega una nueva versi≤n de disponibilidad general de un sistema operativo soportado, su objetivo serß certificar que dicho sistema operativo da soporte a AFS durante un breve perφodo de tiempo. El soporte se puede retrasar un poco si es necesario generar binarios completamente nuevos. 

No siempre es posible dar soporte a AFS en cada una de las versiones intermedias de un sistema operativo o para determinados tipos de procesador. En algunos casos, las limitaciones de las plataformas hacen que determinados funcionamientos de AFS (como, por ejemplo, el funcionamiento de servidor de archivos o de conversor de NFS/AFS) no estΘn disponibles en una o mßs plataformas. Para obtener una lista de las limitaciones, consulte las IBM AFS Release Notes o solicφtela al grupo de soporte del producto AFS. 


--------------------------------------------------------------------------------

Acerca de la actualizaci≤n del sistema operativo
Siempre que se actualice una mßquina AFS con un sistema operativo distinto, se deben emprender varias acciones para mantener un funcionamiento correcto de AFS. Dichas acciones incluyen las siguientes, pero no estßn necesariamente limitadas a las mismas. 

Desmonte las particiones de servidor AFS (montadas en los directorios /vicepxx) de todas las mßquinas servidor de archivos, a fin de impedir que el programa fsck suministrado por el proveedor se ejecute en ellas cuando se rearranque la mßquina durante la instalaci≤n del nuevo sistema operativo. Antes de actualizar el sistema operativo, es prudente comentar los mandatos del archivo de inicializaci≤n de la mßquina que vuelven a montar las particiones de servidor, a fin de impedir que Θstas se vuelvan a montar hasta que se sustituya el programa fsck estßndar por la versi≤n modificada por AFS. Las instrucciones incluidas en esta guφa para instalar mßquinas servidor AFS explican c≤mo sustituir el programa fsck. 
Proteja las versiones modificadas por AFS de los mandatos y archivos de configuraci≤n, a fin de evitar que las versiones suministradas por el proveedor las sobregraben. Esto incluye vfsck (versi≤n de fsck para AFS), binarios para los servicios remotos de UNIX, como por ejemplo inetd, y archivos de configuraci≤n tales como el del M≤dulo de autentificaci≤n conectable (PAM). DespuΘs de haber instalado satisfactoriamente el sistema operativo, recuerde que debe devolver los mandatos y archivos modificados por AFS a las ubicaciones en las que se accede a ellos durante un funcionamiento normal. 
Vuelva a formatear las particiones de servidor para acomodar informaci≤n especφfica de AFS, en determinados casos. Las instrucciones de actualizaci≤n que acompa±an a los nuevos binarios de AFS para una plataforma afectada siempre detallan el procedimiento necesario. 

--------------------------------------------------------------------------------

La Distribuci≤n de binarios de AFS
La Distribuci≤n de binarios de AFS incluye un CD-ROM independiente para cada tipo de sistema soportado, que contiene todos los binarios y archivos de AFS para las mßquinas servidor y cliente. Las instrucciones de esta guφa especifican cußndo debe montarse el CD-ROM y quΘ archivos o directorios se deben copiar en el disco local o en el volumen de AFS. 


--------------------------------------------------------------------------------

C≤mo continuar
Si estß instalando la primera mßquina AFS de la cΘlula, prosiga en el Instalaci≤n de la primera mßquina AFS. 

Si estß instalando una mßquina servidor de archivos adicional, o si estß configurando o desautorizando una mßquina servidor de base de datos, prosiga en el Instalaci≤n de mßquinas servidor adicionales. 

Si estß instalando una mßquina cliente adicional, prosiga en el Instalaci≤n de mßquinas cliente adicionales


Guφa de iniciaci≤n rßpida


--------------------------------------------------------------------------------

Instalaci≤n de la primera mßquina AFS
En este capφtulo se describe c≤mo instalar la primera mßquina AFS en la cΘlula, configurßndola como mßquina servidor de archivos y como mßquina cliente. DespuΘs de completar todos los procedimientos descritos en este capφtulo puede eliminar, si lo desea, el funcionamiento de cliente tal como se describe en el apartado Eliminaci≤n del funcionamiento de cliente. 

Para instalar mßquinas servidor de archivos adicionales despuΘs de completar este capφtulo, vea el Instalaci≤n de mßquinas servidor adicionales. 

Para instalar mßquinas cliente adicionales despuΘs de completar este capφtulo, vea el Instalaci≤n de mßquinas cliente adicionales. 


--------------------------------------------------------------------------------

Requisitos y decisiones de configuraci≤n
En las instrucciones que contiene este capφtulo se da por supuesto que se cumple con los requisitos siguientes. 

El usuario estß conectado a la consola de la mßquina como superusuario root local 
En la mßquina se estß ejecutando una versi≤n estßndar de los sistemas operativos soportados por la versi≤n actual de AFS 
Se puede acceder a los datos contenidos en los CD-ROM de AFS, ya sea mediante una unidad de CD local o por medio de un montaje NFS de una unidad de CD conectada a una mßquina a la que la red puede acceder 
Mientras estΘ realizando la instalaci≤n de la primera mßquina AFS, deberß tomar las siguientes decisiones relativas a la configuraci≤n. Para acelerar la propia instalaci≤n, es mejor tomar las decisiones antes de empezar. Si desea directrices detalladas, consulte el capφtulo de la publicaci≤n IBM AFS Administration Guide que trata sobre la administraci≤n y configuraci≤n de cΘlulas. 

Seleccione la primera mßquina AFS 
Seleccione el nombre de cΘlula 
Decida quΘ particiones o vol·menes l≤gicos se configurarßn como particiones de servidor AFS, y elija los nombres de directorio en los que se montarßn 
Decida si se utilizarß el software estßndar de autorizaci≤n y autentificaci≤n de AFS o Kerberos, que se obtiene de otra fuente. En varios tipos de sistema, esta decisi≤n determina la forma en que se incorpora AFS al sistema de autentificaci≤n de la mßquina. Si desea utilizar Kerberos, p≤ngase ahora en contacto con el grupo de soporte del producto AFS para averiguar c≤mo debe modificar el procedimiento de instalaci≤n. 
Decida quΘ tama±o tendrß la antememoria de cliente 
Decida c≤mo se configurarßn los niveles superiores del espacio de archivos AFS de la cΘlula 
Este capφtulo se divide en tres amplios apartados que corresponden a las tres partes de que consta la instalaci≤n de la primera mßquina AFS. Lleve a cabo todos los pasos en el orden en que aparecen. Cada apartado funcional empieza por un resumen de los procedimientos a realizar. Los apartados son los siguientes: 

Instalaci≤n del funcionamiento de servidor (empieza en el apartado Visi≤n general: Instalaci≤n del funcionamiento de servidor) 
Instalaci≤n del funcionamiento de cliente (empieza en el apartado Visi≤n general: Instalaci≤n del funcionamiento de cliente) 
Configuraci≤n del espacio de archivos de la cΘlula, establecimiento de mecanismos adicionales de seguridad y habilitaci≤n del acceso a cΘlulas externas (empieza en el apartado Visi≤n general: Realizaci≤n de la instalaci≤n de la primera mßquina AFS) 

--------------------------------------------------------------------------------

Visi≤n general: Instalaci≤n del funcionamiento de servidor
En la primera fase de instalaci≤n de la primera mßquina de la cΘlula se instala el funcionamiento de servidor de archivos y de servidor de base de datos, realizando los procedimientos siguientes: 

Elija quΘ mßquina se instalarß como primera mßquina AFS 
Cree directorios relacionados con AFS en el disco local 
Incorpore las modificaciones de AFS en el kernel de la mßquina 
Configure las particiones o vol·menes l≤gicos para almacenar vol·menes AFS 
En algunos tipos de sistema, instale y configure una versi≤n modificada por AFS del programa fsck 
Si la mßquina va a permanecer como mßquina cliente, incorpore AFS al sistema de autentificaci≤n de la misma 
Inicie el Servidor Basic OverSeer (BOS) 
Defina el nombre de cΘlula y la calidad de miembro de la cΘlula por parte de la mßquina 
Inicie los procesos de servidor de base de datos: Servidor de autentificaci≤n, Servidor de copia de seguridad, Servidor de protecci≤n y Servidor de ubicaci≤n de vol·menes (VL) 
Configure los mecanismos iniciales de seguridad 
Inicie el proceso fs, que incorpora tres procesos componentes: Servidor de archivos, Servidor de vol·menes y Recuperador 
Inicie el Servidor de actualizaci≤n 
Inicie el proceso controlador (llamado runntp) para el Network Time Protocol Daemon, que sincroniza los relojes de las mßquinas 

--------------------------------------------------------------------------------

Elecci≤n de la primera mßquina AFS
La primera mßquina AFS que instale debe disponer de suficiente espacio en disco para almacenar vol·menes AFS. Para aprovecharse mejor de las posibilidades de AFS, almacene los binarios de la parte de cliente y los archivos del usuario en vol·menes. Mßs adelante, cuando instale mßquinas servidor de archivos adicionales en la cΘlula, podrß distribuir estos vol·menes entre las distintas mßquinas en que encajen. 

Estas instrucciones configuran la primera mßquina AFS como mßquina servidor de base de datos, la mßquina de distribuci≤n de binarios para el tipo de sistema correspondiente y la mßquina de control del sistema de la cΘlula. Para obtener una descripci≤n de estas funciones consulte la publicaci≤n IBM AFS Administration Guide. 

La instalaci≤n de mßquinas adicionales resulta mßs sencilla si la primera mßquina tiene la direcci≤n IP mßs baja de todas las mßquinas servidor de base de datos que actualmente piense instalar. Si mßs tarde instala el funcionamiento de servidor de base de datos en una mßquina que tiene una direcci≤n IP inferior, antes deberß actualizar el archivo /usr/vice/etc/CellServDB en todas las mßquinas cliente de la cΘlula. Para conocer mßs detalles, consulte el apartado Instalaci≤n del funcionamiento de servidor de base de datos. 


--------------------------------------------------------------------------------

Creaci≤n de directorios de AFS
Cree los directorios /usr/afs y /usr/vice/etc en el disco local para almacenar, respectivamente, archivos servidor y de cliente. Las instrucciones posteriores copian en ellos archivos procedentes del CD-ROM de AFS. Cree el directorio /cdrom como punto de montaje de los CD-ROM, en caso de que no exista todavφa. 

      
   # mkdir /usr/afs
      
   # mkdir /usr/vice
      
   # mkdir /usr/vice/etc
   
   # mkdir /cdrom 
     


--------------------------------------------------------------------------------

Realizaci≤n de procedimientos especφficos de la plataforma
Varios de los procedimientos iniciales para instalar una mßquina servidor de archivos difieren para cada tipo de sistema. Por razones de comodidad, en los apartados siguientes se agrupan para cada tipo de sistema: 

Incorpore las modificaciones de AFS en el kernel. 
El kernel de cada mßquina AFS servidor de archivos y cliente debe incorporar extensiones de AFS. En las mßquinas que utilizan un cargador dinßmico de m≤dulos del kernel, convencionalmente se altera el script de inicializaci≤n de la mßquina de forma que cargue las extensiones de AFS durante cada rearranque. 

Configure las particiones o vol·menes l≤gicos de servidor para alojar vol·menes AFS. 
Cada mßquina servidor de archivos AFS debe tener, como mφnimo, una partici≤n o un volumen l≤gico dedicados al almacenamiento de vol·menes AFS (por razones de comodidad, la documentaci≤n que se proporciona de ahora en adelante s≤lo hace referencia a particiones). Cada partici≤n de servidor se monta en un directorio denominado /vicepxx, siendo xx una o dos letras min·sculas. Por convenio, las 26 primeras particiones se montan en los directorios denominados de /vicepa a /vicepz, la n·mero 27 se monta en el directorio /vicepaa, y asφ sucesivamente hasta /vicepaz y /vicepba, continuando del mismo modo hasta el φndice correspondiente el n·mero mßximo de particiones de servidor soportadas en la versi≤n actual de AFS (que se especifica en las IBM AFS Release Notes). 

Los directorios /vicepxx deben residir en el directorio raφz de la mßquina servidor de archivos, y no en uno de los subdirectorios del mismo (por ejemplo, /usr/vicepa no es una ubicaci≤n de directorio aceptable). 

TambiΘn se pueden a±adir o eliminar particiones de servidor en una mßquina servidor de archivos existente. Si desea obtener instrucciones, consulte el capφtulo de la publicaci≤n IBM AFS Administration Guide que trata sobre el mantenimiento de mßquinas servidor. Nota: No todos los tipos de sistema de archivos soportados por un sistema operativo se soportan necesariamente como particiones de servidor AFS. Para conocer las posibles restricciones, consulte la publicaci≤n IBM AFS Release Notes.  


En algunos tipos de sistema, instale y configure un programa fsck modificado que reconozca las estructuras que utiliza el Servidor de archivos para organizar datos de vol·menes en particiones de servidor AFS. El programa fsck que se proporciona con el sistema operativo no entiende las estructuras de datos de AFS, por lo que las elimina trasladßndolas al directorio lost+found. 
Si la mßquina va a permanecer como mßquina cliente AFS, modifique el sistema de autentificaci≤n de la mßquina para que los usuarios obtengan una se±al de AFS al inicio de sesi≤n con el sistema de archivos local. La utilizaci≤n de AFS resulta mßs fßcil y conveniente para los usuarios si se efect·an las modificaciones en todas las mßquinas cliente. De no hacerlo, los usuarios deben realizar un procedimiento de inicio de sesi≤n en dos pasos (inicio de la sesi≤n con el sistema de archivos local y, a continuaci≤n, emisi≤n del mandato klog). Para obtener una explicaci≤n adicional de la autentificaci≤n de AFS, consulte el capφtulo de la publicaci≤n IBM AFS Administration Guide que trata los temas de configuraci≤n y administraci≤n de cΘlulas. 
Para continuar, siga con el apartado correspondiente: 

C≤mo empezar en sistemas AIX 
C≤mo empezar en sistemas Digital UNIX 
C≤mo empezar en sistemas HP-UX 
C≤mo empezar en sistemas IRIX 
C≤mo empezar en sistemas Linux 
C≤mo empezar en sistemas Solaris 

--------------------------------------------------------------------------------

C≤mo empezar en sistemas AIX
Empiece por ejecutar el script de inicializaci≤n de AFS para llamar al recurso de extensi≤n del kernel de AIX, el cual carga dinßmicamente las modificaciones de AFS en el kernel. A continuaci≤n, utilice el programa SMIT para configurar particiones en las que almacenar vol·menes AFS y sustituya el asistente de programas fsck de AIX por una versi≤n que maneje correctamente los vol·menes AFS. Si la mßquina va a permanecer como mßquina cliente AFS, incorpore AFS en el sistema de autentificaci≤n secundario de AIX. 


Carga de AFS en el kernel de AIX
El recurso de extensi≤n del kernel de AIX es el cargador dinßmico de kernel proporcionado por IBM Corporation. AIX no soporta la incorporaci≤n de modificaciones de AFS durante la creaci≤n de un kernel. 

Para que AFS funcione correctamente, se debe ejecutar el recurso de extensi≤n del kernel cada vez que se rearranque la mßquina, de forma que el script de inicializaci≤n de AFS (que se incluye en la distribuci≤n de AFS) lo invoque automßticamente. En este apartado se copia el script en la ubicaci≤n convencional y se edita para seleccionar las funciones adecuadas, en funci≤n de si tambiΘn se va a ejecutar NFS o no. 

DespuΘs de editar el script, lo debe ejecutar para incorporar AFS en el kernel. En apartados posteriores se verificarß que el script inicialice correctamente todos los componentes de AFS y luego se configurarß el archivo inittab de AIX de forma que el script se ejecute automßticamente en los rearranques. 

Monte el CD-ROM de AFS para AIX en el directorio local /cdrom. Para obtener instrucciones sobre c≤mo montar los CD-ROM (ya sea local o remotamente por medio de NFS), consulte la documentaci≤n de AIX. A continuaci≤n, cambie de directorio tal como se indica. 
   
   # cd  /cdrom/rs_aix42/root.client/usr/vice/etc
   

Copie los archivos de bibliotecas del kernel AFS en el directorio local /usr/vice/etc/dkload y el script de inicializaci≤n de AFS en el directorio /etc. 
   
   # cp -rp  dkload  /usr/vice/etc
   
   # cp -p  rc.afs  /etc/rc.afs
    

Edite el script /etc/rc.afs, estableciendo la variable NFS tal como se indica. 
Si la mßquina no va a funcionar como Conversor NFS/AFS, establezca la variable NFS de la forma siguiente: 

      
   NFS=$NFS_NONE

Si la mßquina va a funcionar como Conversor de NFS/AFS y estß ejecutando AIX 4.2.1 o posterior, establezca la variable NFS de la forma siguiente. Tenga en cuenta que NFS debe estar ya cargado en el kernel, lo que se lleva a cabo automßticamente en los sistemas que ejecutan AIX 4.1.1 y posterior, siempre que exista el archivo /etc/exports. 

   
   NFS=$NFS_IAUTH
   

Invoque al script /etc/rc.afs para cargar las modificaciones de AFS en el kernel. Puede hacer caso omiso de los mensajes de error relacionados con la imposibilidad de iniciar el Servidor BOS, el Gestor de antememoria o el cliente AFS. 
   
   # /etc/rc.afs
   


Configuraci≤n de particiones de servidor en sistemas AIX
Cada mßquina servidor de archivos AFS debe tener como mφnimo una partici≤n o un volumen l≤gico dedicados al almacenamiento de vol·menes AFS. Cada partici≤n de servidor se monta en un directorio denominado /vicepxx, siendo xx una o dos letras min·sculas. Los directorios /vicepxx deben residir en el directorio raφz de la mßquina servidor de archivos, y no en uno de los subdirectorios del mismo (por ejemplo, /usr/vicepa no es una ubicaci≤n de directorio aceptable). Para obtener informaci≤n adicional, consulte el apartado Realizaci≤n de procedimientos especφficos de la plataforma. 

Para configurar particiones de servidor en un sistema AIX, realice los procedimientos siguientes: 

Cree un directorio llamado /vicepxx para cada partici≤n de servidor AFS que estΘ configurando (tiene que haber por lo menos una). Repita el mandato para cada una de las particiones. 
   
   # mkdir /vicepxx
   

Utilice el programa SMIT para crear un sistema de archivos de diario en cada partici≤n que se vaya a configurar como partici≤n de servidor AFS. 
Monte cada una de las particiones en uno de los directorios /vicepxx. Elija uno de los tres mΘtodos siguientes: 
Utilice el programa SMIT 
Utilice el mandato mount -a para montar todas las particiones a la vez 
Utilice el mandato mount en cada una de las particiones, por turno 
Configure tambiΘn las particiones de forma que se monten automßticamente en cada rearranque. Para obtener mßs informaci≤n, consulte la documentaci≤n de AIX. 


Sustituci≤n del asistente de programas fsck en sistemas AIX
En este apartado se efect·an modificaciones para garantizar que se ejecute el programa fsck apropiado en las particiones de servidor AFS. El programa fsck proporcionado con el sistema operativo nunca se debe ejecutar en particiones de servidor AFS. Dado que no reconoce las estructuras que utiliza el Servidor de archivos para organizar datos de vol·menes, elimina todos los datos. Una vez mßs: 

Nunca se debe ejecutar el programa fsck estßndar en particiones de servidor AFS, porque descarta los vol·menes AFS. 

En los sistemas AIX no se sustituye el propio binario fsck, sino el archivo asistente de programas incluido en la distribuci≤n de AIX como /sbin/helpers/v3fshelper. 

Traslade el asistente de programas fsck de AIX a una ubicaci≤n segura e instale en su lugar la versi≤n de la distribuci≤n de ASF. El CD-ROM de AFS debe seguir montado en el directorio /cdrom. 
   
   # cd /sbin/helpers
   
   # mv v3fshelper v3fshelper.noafs
   
   # cp -p /cdrom/rs_aix42/root.server/etc/v3fshelper v3fshelper
   
 

Si piensa mantener el funcionamiento de cliente en esta mßquina despuΘs de completar la instalaci≤n, siga con el apartado Habilitaci≤n del inicio de sesi≤n de AFS en sistemas AIX. De lo contrario, siga con el apartado Inicio del Servidor BOS. 

Habilitaci≤n del inicio de sesi≤n de AFS en sistemas AIX
Nota: Si piensa eliminar el funcionamiento de cliente de esta mßquina despuΘs de completar la instalaci≤n, sßltese esta secci≤n y siga con el apartado Inicio del Servidor BOS.  

Siga las instrucciones indicadas en este apartado para incorporar las modificaciones de AFS al sistema de autentificaci≤n secundario de AIX. 

Emita el mandato ls para verificar que los programas afs_dynamic_auth y afs_dynamic_kerbauth estßn instalados en el directorio local /usr/vice/etc. 
   
   # ls /usr/vice/etc   

Si los archivos no existen, monte el CD-ROM de AFS para AIX (si a·n no estß montado), cambie de directorio de la forma indicada y c≤pielos. 

  
   # cd /cdrom/rs_aix42/root.client/usr/vice/etc
   
   # cp  -p  afs_dynamic*  /usr/vice/etc
   

Edite el archivo local /etc/security/user, efectuando cambios en las stanzas indicadas: 
En la stanza por omisi≤n, establezca el atributo registry en DCE (y no en AFS), de la forma siguiente: 
   
   registry = DCE
   

En la stanza por omisi≤n, establezca el atributo SYSTEM seg·n se indica. 
Si la mßquina s≤lo es un cliente AFS, establezca el valor siguiente: 

   
   SYSTEM = "AFS OR (AFS[UNAVAIL] AND compat[SUCCESS])"   

Si la mßquina es un cliente AFS y DCE, establezca el valor siguiente (que debe aparecer en una sola lφnea del archivo): 

   
   SYSTEM = "DCE OR DCE[UNAVAIL] OR AFS OR (AFS[UNAVAIL]  \
       AND compat[SUCCESS])"
   

En la stanza root, establezca el atributo registry tal como se indica a continuaci≤n. Este atributo permite que el superusuario local root inicie sesiones ·nicamente con el sistema de archivos local, en base a la contrase±a listada en el archivo de contrase±as local. 
   
   root:
         registry = files
   

Edite el archivo local /etc/security/login.cfg, creando o editando las stanzas indicadas: 
En la stanza DCE, establezca el atributo program tal como se indica a continuaci≤n. 
Si utiliza el Servidor de autentificaci≤n de AFS (proceso kaserver): 

   
   DCE:
        program = /usr/vice/etc/afs_dynamic_auth   

Si utiliza una implantaci≤n Kerberos de la autentificaci≤n de AFS: 

   
   DCE:
        program = /usr/vice/etc/afs_dynamic_kerbauth
   

En la stanza AFS, establezca el atributo program tal como se indica a continuaci≤n. 
Si utiliza el Servidor de autentificaci≤n de AFS (proceso kaserver): 

   
   AFS:
        program = /usr/vice/etc/afs_dynamic_auth   

Si utiliza una implantaci≤n Kerberos de la autentificaci≤n de AFS: 

   
   AFS:
        program = /usr/vice/etc/afs_dynamic_kerbauth
   

Siga con el apartado Inicio del Servidor BOS (o, si estß consultando estas instrucciones mientras instala una mßquina servidor de archivos adicional, regrese al apartado Inicio de los programas de servidor). 

--------------------------------------------------------------------------------

C≤mo empezar en sistemas Digital UNIX
Empiece por crear las modificaciones de AFS en un nuevo kernel estßtico; Digital UNIX no soporta la carga dinßmica. A continuaci≤n, cree particiones para almacenar vol·menes AFS y sustituya el programa fsck de Digital UNIX por una versi≤n que maneje correctamente los vol·menes AFS. Si la mßquina va a permanecer como mßquina cliente AFS, incorpore AFS en la matriz Arquitectura de integraci≤n de la seguridad (SIA). 


Creaci≤n de AFS en el kernel de Digital UNIX
Utilice las instrucciones siguientes para crear modificaciones de AFS en el kernel de un sistema Digital UNIX. 

Cree una copia llamada AFS del archivo bßsico de configuraci≤n del kernel incluido en la distribuci≤n de Digital UNIX como /usr/sys/conf/nombre_mßquina, siendo nombre_mßquina el nombre de sistema principal de la mßquina, todo Θl en may·sculas. 
   
   # cd /usr/sys/conf
   
   # cp nombre_mßquina AFS
   

A±ada AFS a la lista de opciones del archivo de configuraci≤n que ha creado en el paso anterior, de forma que el resultado sea parecido al siguiente: 
          .                   .
          .                   .
       options               UFS
       options               NFS
       options               AFS
          .                   .
          .                   .
   

A±ada una entrada para AFS en dos lugares del archivo /usr/sys/conf/files. 
A±ada una lφnea para AFS en la lista OPTIONS (opciones), de forma que el resultado sea parecido al siguiente: 
             .                .      .
             .                .      .
      OPTIONS/nfs          optional nfs
      OPTIONS/afs          optional afs 
      OPTIONS/nfs_server   optional nfs_server
             .                .      .
             .                .      .
   

A±ada una entrada para AFS en la lista MODULES (m≤dulos), de forma que el resultado sea parecido al siguiente: 
             .                  .        .          .
             .                  .        .          .
      #
      MODULE/nfs_server	    optional nfs_server Binary
      nfs/nfs_server.c      module nfs_server optimize -g3
      nfs/nfs3_server.c	    module nfs_server optimize -g3
      #
      MODULE/afs            optional afs Binary
      afs/libafs.c          module afs
      #
   

A±ada una entrada para AFS en dos lugares del archivo /usr/sys/vfs/vfs_conf.c. 
A±ada AFS a la lista de sistemas de archivos definidos, de forma que el resultado sea parecido al siguiente: 
        .       .              
        .       .              
     #include &lt;afs.h>
     #if defined(AFS) && AFS
            extern struct vfsops afs_vfsops;
     #endif  
        .       .              
        .       .              
   

Coloque una declaraci≤n de AFS en la ranura MOUNT_ADDON de la tabla vfssw[], de forma que el resultado sea parecido al siguiente: 
        .                          .              .
        .                          .              .
      &fdfs_vfsops,         "fdfs",   /* 12 = MOUNT_FDFS */
   #if	defined(AFS)
      &afs_vfsops,          "afs",
   #else
      (struct vfsops *)0,   "",       /* 13 = MOUNT_ADDON */
   #endif
   #if NFS && INFS_DYNAMIC   
       &nfs3_vfsops,        "nfsv3",  /* 14 = MOUNT_NFS3 */		
   

Monte el CD-ROM de AFS para Digital UNIX en el directorio local /cdrom. Para obtener instrucciones sobre c≤mo montar los CD-ROM (ya sea local o remotamente por medio de NFS), consulte la documentaci≤n de Digital UNIX. A continuaci≤n, cambie de directorio tal como se indica. 
   
   # cd /cdrom/alpha_dux40/root.client
   

Copie el script de inicializaci≤n de AFS en el directorio local para archivos de inicializaci≤n (por convenio, /sbin/init.d en las mßquinas Digital UNIX). Observe la eliminaci≤n de la extensi≤n .rc cuando se copia el script. 
   
   # cp usr/vice/etc/afs.rc  /sbin/init.d/afs
   

Copie el m≤dulo del kernel AFS en el directorio local /usr/sys/BINARY. 
Si el kernel de la mßquina soporta el funcionamiento de un servidor NFS: 

  
   # cp bin/libafs.o /usr/sys/BINARY/afs.mod   

Si el kernel de la mßquina no soporta el funcionamiento de un servidor NFS: 

  
   # cp bin/libafs.nonfs.o /usr/sys/BINARY/afs.mod
   

Configure y cree el kernel. Responda a las posibles solicitudes pulsando &lt;Intro>. El kernel resultante reside en el archivo /sys/AFS/vmunix. 
   
   # doconfig -c AFS
   

Cambie el nombre del archivo de kernel existente y copie el archivo nuevo, modificado por AFS, en la ubicaci≤n estßndar. 
   
   # mv /vmunix /vmunix_noafs
   
   # cp /sys/AFS/vmunix /vmunix
   

Rearranque la mßquina para empezar a utilizar el nuevo kernel y vuelva a iniciar una sesi≤n como superusuario root. 
   
   # cd /
   
   # shutdown -r now
   
   login: root
   Contrase±a: contrase±a_root
   


Configuraci≤n de particiones de servidor en sistemas Digital UNIX
Cada mßquina servidor de archivos AFS debe tener como mφnimo una partici≤n o un volumen l≤gico dedicados al almacenamiento de vol·menes AFS. Cada partici≤n de servidor se monta en un directorio denominado /vicepxx, siendo xx una o dos letras min·sculas. Los directorios /vicepxx deben residir en el directorio raφz de la mßquina servidor de archivos, y no en uno de los subdirectorios del mismo (por ejemplo, /usr/vicepa no es una ubicaci≤n de directorio aceptable). Para obtener informaci≤n adicional, consulte el apartado Realizaci≤n de procedimientos especφficos de la plataforma. 

Cree un directorio llamado /vicepxx para cada partici≤n de servidor AFS que estΘ configurando (tiene que haber por lo menos una). Repita el mandato para cada una de las particiones. 
   
   # mkdir /vicepxx
   

A±ada una lφnea en el archivo de registro de sistemas de archivos /etc/fstab con el formato siguiente, para cada uno de los directorios que acabe de crear. La entrada correlaciona el nombre de directorio con la partici≤n de disco que se deberß montar en Θl. 
   
   /dev/disco /vicepxx ufs rw 0 2

A continuaci≤n se muestra un ejemplo de la primera partici≤n que se configura. 

   
   /dev/rz3a /vicepa ufs rw 0 2
   

Cree un sistema de archivos en cada partici≤n que se vaya a montar en un directorio /vicepxx. Probablemente, el mandato siguiente resultarß apropiado, pero consulte mßs informaci≤n en la documentaci≤n de Digital UNIX. 
   
   # newfs -v /dev/disco
   

Monte cada partici≤n emitiendo el mandato mount -a, para montar todas las particiones a la vez, o el mandato mount, para montar cada partici≤n por turnos. 

Sustituci≤n del programa fsck en sistemas Digital UNIX
En este apartado se efect·an modificaciones para garantizar que se ejecute el programa fsck apropiado en las particiones de servidor AFS. El programa fsck proporcionado con el sistema operativo nunca se debe ejecutar en particiones de servidor AFS. Dado que no reconoce las estructuras que utiliza el Servidor de archivos para organizar datos de vol·menes, elimina todos los datos. Una vez mßs: 

Nunca se debe ejecutar el programa fsck estßndar en particiones de servidor AFS, porque descarta los vol·menes AFS. 

En sistemas Digital UNIX, los archivos /sbin/fsck y /usr/sbin/fsck son programas controladores. En lugar de sustituir cada uno de ellos, sustituya el binario real incluido en la distribuci≤n de Digital UNIX como /sbin/ufs_fsck y /usr/sbin/ufs_fsck. 

Instale el binario vfsck en los directorios /sbin y /usr/sbin. El CD-ROM de AFS debe seguir montado en el directorio /cdrom. 
   
   # cd /cdrom/alpha_dux40/root.server/etc
   
   # cp vfsck /sbin/vfsck
   
   # cp vfsck /usr/sbin/vfsck
   

Cambie el nombre de los binarios fsck de Digital UNIX y cree enlaces simb≤licos con el programa vfsck. 
   
   # cd /sbin
   
   # mv ufs_fsck ufs_fsck.noafs
   
   # ln -s vfsck ufs_fsck
   
   # cd /usr/sbin
   
   # mv ufs_fsck ufs_fsck.noafs
   
   # ln -s vfsck ufs_fsck
   

Si piensa mantener el funcionamiento de cliente en esta mßquina despuΘs de completar la instalaci≤n, siga con el apartado Habilitaci≤n del inicio de sesi≤n de AFS en sistemas Digital UNIX. De lo contrario, siga con el apartado Inicio del Servidor BOS. 

Habilitaci≤n del inicio de sesi≤n de AFS en sistemas Digital UNIX
Nota: Si piensa eliminar el funcionamiento de cliente de esta mßquina despuΘs de completar la instalaci≤n, sßltese esta secci≤n y siga con el apartado Inicio del Servidor BOS.  

En sistemas Digital UNIX, el script de inicializaci≤n de AFS incorpora automßticamente el archivo de bibliotecas de autentificaci≤n de AFS en la matriz Arquitectura de integraci≤n de seguridad (SIA) de la mßquina, de forma que los usuarios que tienen perfiles de AFS obtienen una se±al cuando inician una sesi≤n. En este apartado se copia el archivo de bibliotecas en la ubicaci≤n apropiada. 

Para obtener mßs informaci≤n sobre SIA, remφtase a la pßgina de consulta de Digital UNIX para matrix.conf, o bien consulte el apartado sobre seguridad en la documentaci≤n de Digital UNIX. Nota: Si la mßquina ejecuta software cliente DCE y AFS, AFS se debe iniciar despuΘs que DCE. Consulte el script de inicializaci≤n de AFS para ver los enlaces simb≤licos que se aconseja crear para obtener una clasificaci≤n correcta. Asimismo, el orden del script de arranque del sistema debe inicializar SIA antes que cualquier proceso de ejecuci≤n larga que utilice la autentificaci≤n.  


Lleva a cabo los pasos siguientes para habilitar el inicio de sesi≤n de AFS. 

Monte el CD-ROM de AFS para Digital UNIX en el directorio local /cdrom, si no se ha montado todavφa. Cambie de directorio tal como se indica. 
   
   # cd /cdrom/alpha_dux40/lib/afs
   

Copie el archivo de bibliotecas de autentificaci≤n de AFS apropiado en el directorio local /usr/shlib. 
Si utiliza el Servidor de autentificaci≤n de AFS (proceso kaserver) en la cΘlula: 

   
   # cp  libafssiad.so  /usr/shlib   

Si utiliza una implantaci≤n Kerberos de la autentificaci≤n de AFS, cambie el nombre del archivo de bibliotecas al copiarlo: 

   
   # cp  libafssiad.krb.so  /usr/shlib/libafssiad.so
   

Siga con el apartado Inicio del Servidor BOS (o, si estß consultando estas instrucciones mientras instala una mßquina servidor de archivos adicional, regrese al apartado Inicio de los programas de servidor). 

--------------------------------------------------------------------------------

C≤mo empezar en sistemas HP-UX
Empiece por crear las modificaciones de AFS en un nuevo kernel; HP-UX no soporta la carga dinßmica. A continuaci≤n, cree particiones para almacenar vol·menes AFS e instale y configure el programa fsck modificado por AFS para que se ejecute en las particiones de servidor AFS. Si la mßquina va a permanecer como mßquina cliente AFS, incorpore AFS al M≤dulo de autentificaci≤n conectable (PAM) de la mßquina. 


Creaci≤n de AFS en el kernel de HP-UX
Utilice las instrucciones siguientes para crear modificaciones de AFS en el kernel de un sistema HP-UX. 

Traslade los archivos relacionados con el kernel existentes a una ubicaci≤n segura. 
   
   # cp /stand/vmunix /stand/vmunix.noafs
   
   # cp /stand/system /stand/system.noafs
   

Monte el CD-ROM de HP-UX en el directorio local /cdrom. Para obtener instrucciones sobre c≤mo montar los CD-ROM (ya sea local o remotamente por medio de NFS), consulte la documentaci≤n de HP-UX. A continuaci≤n, cambie de directorio tal como se indica. 
   
   # cd /cdrom/hp_ux110/root.client
   

Copie el archivo de inicializaci≤n de AFS en el directorio local para archivos de inicializaci≤n (por convenio, /sbin/init.d en las mßquinas HP-UX). Observe la eliminaci≤n de la extensi≤n .rc cuando se copia el archivo. 
   
   # cp usr/vice/etc/afs.rc  /sbin/init.d/afs
   

Copie el archivo afs.driver en el directorio local /usr/conf/master.d, cambiando su nombre por afs a llevar a cabo la copia. 
     
   # cp  usr/vice/etc/afs.driver  /usr/conf/master.d/afs
   

Copie el m≤dulo del kernel AFS en el directorio local /usr/conf/lib. 
Si el kernel de la mßquina soporta el funcionamiento de servidor NFS: 

   
   # cp bin/libafs.a /usr/conf/lib   

Si el kernel de la mßquina no soporta el funcionamiento de servidor NFS, cambie el nombre del archivo al copiarlo: 

   
   # cp bin/libafs.nonfs.a /usr/conf/lib/libafs.a
   

Incorpore el controlador de AFS en el kernel, utilizando para ello el programa SAM o una serie de mandatos individuales. 
Para utilizar el programa SAM: 
Invoque al programa SAM, especificando el nombre de sistema principal de la mßquina local como nombre_sist_princ_local. Emergerß la interfaz grßfica de usuario SAM. 
   
   # sam -display nombre_sist_princ_local:0
   

Elija el icono Kernel Configuration y, a continuaci≤n, el icono Drivers. En la lista de controladores, seleccione afs. 
Abra el men· desplegable Actions y elija la opci≤n Add Driver to Kernel. 
Abra de nuevo el men· Actions y elija la opci≤n Create a New Kernel. 
Confirme las elecciones eligiendo Yes y OK cuando lo soliciten las ventanas emergentes posteriores. El programa SAM crea el kernel y rearranca el sistema. 
Inicie de nuevo una sesi≤n como superusuario root. 
   
   login: root
   Contrase±a: contrase±a_root
   

Para utilizar mandatos individuales: 
Edite el archivo /stand/system, a±adiendo una entrada para afs en la secci≤n Subsystems. 
Cambie al directorio /stand/build y emita el mandato mk_kernel para crear el kernel. 
   
   # cd /stand/build
      
   # mk_kernel
   

Traslade el nuevo kernel a la ubicaci≤n estßndar (/stand/vmunix), rearranque la mßquina para empezarlo a utilizar y vuelva a iniciar una sesi≤n como superusuario root. 
   
   # mv /stand/build/vmunix_test /stand/vmunix
      
   # cd /
      
   # shutdown -r now		
   
   login: root
   Contrase±a: contrase±a_root
   


Configuraci≤n de particiones de servidor en sistemas HP-UX
Cada mßquina servidor de archivos AFS debe tener como mφnimo una partici≤n o un volumen l≤gico dedicados al almacenamiento de vol·menes AFS. Cada partici≤n de servidor se monta en un directorio denominado /vicepxx, siendo xx una o dos letras min·sculas. Los directorios /vicepxx deben residir en el directorio raφz de la mßquina servidor de archivos, y no en uno de los subdirectorios del mismo (por ejemplo, /usr/vicepa no es una ubicaci≤n de directorio aceptable). Para obtener informaci≤n adicional, consulte el apartado Realizaci≤n de procedimientos especφficos de la plataforma. 

Cree un directorio llamado /vicepxx para cada partici≤n de servidor AFS que estΘ configurando (tiene que haber por lo menos una). Repita el mandato para cada una de las particiones. 
   
   # mkdir /vicepxx
   

Utilice el programa SAM para crear un sistema de archivos en cada partici≤n. Para obtener instrucciones, consulte la documentaci≤n de HP-UX. 
En algunos sistemas HP-UX que utilizan vol·menes l≤gicos, el programa SAM monta automßticamente las particiones. Si no lo ha hecho, monte cada una de las particiones emitiendo el mandato mount -a, para montar todas las particiones a la vez, o el mandato mount, para montar las particiones por turnos. 

Configuraci≤n del programa fsck modificado por AFS en sistemas HP-UX
En este apartado se efect·an modificaciones para garantizar que se ejecute el programa fsck apropiado en las particiones de servidor AFS. El programa fsck proporcionado con el sistema operativo nunca se debe ejecutar en particiones de servidor AFS. Dado que no reconoce las estructuras que utiliza el Servidor de archivos para organizar datos de vol·menes, elimina todos los datos. Una vez mßs: 

Nunca se debe ejecutar el programa fsck estßndar en particiones de servidor AFS, porque descarta los vol·menes AFS. 

En los sistemas HP-UX existen varios archivos de configuraci≤n que se deben instalar, ademßs del programa fsck modificado por AFS (binario vfsck). 

Cree el archivo de configuraci≤n de mandatos /sbin/lib/mfsconfig.d/afs. Utilice un editor de texto para colocar en Θl las dos lφneas indicadas: 
   
   format_revision 1
   fsck            0        m,P,p,d,f,b:c:y,n,Y,N,q,
   

Cree un directorio de mandatos especφfico de AFS llamado /sbin/fs/afs y cambie a Θl. 
   
   # mkdir /sbin/fs/afs
   
   # cd  /sbin/fs/afs
   

Copie la versi≤n modificada por AFS del programa fsck (binario vfsck) y los archivos relacionados del directorio de distribuci≤n en el nuevo directorio de mandatos especφfico de AFS. 
   
   # cp -p /cdrom/hp_ux110/root.server/etc/*  .
          

Cambie el nombre del binario vfsck por fsck y establezca de forma apropiada los bits de modalidad en todos los archivos del directorio /sbin/fs/afs. 
      
   # mv  vfsck  fsck
   
   # chmod  755  *
   

Edite el archivo /etc/fstab, cambiando el tipo de sistema de archivos para cada partici≤n de servidor AFS de hfs por afs. Asφ se asegurarß de que el programa fsck modificado por AFS se ejecute en las particiones apropiadas. 
La sexta lφnea del ejemplo siguiente de un archivo editado muestra una partici≤n de servidor AFS, /vicepa. 

   
   /dev/vg00/lvol1 / hfs defaults 0 1
   /dev/vg00/lvol4 /opt hfs defaults 0 2
   /dev/vg00/lvol5 /tmp hfs defaults 0 2
   /dev/vg00/lvol6 /usr hfs defaults 0 2
   /dev/vg00/lvol8 /var hfs defaults 0 2
   /dev/vg00/lvol9 /vicepa afs defaults 0 2
   /dev/vg00/lvol7 /usr/vice/cache hfs defaults 0 2
   

Si piensa mantener el funcionamiento de cliente en esta mßquina despuΘs de completar la instalaci≤n, siga con el apartado Habilitaci≤n del inicio de sesi≤n de AFS en sistemas HP-UX. De lo contrario, siga con el apartado Inicio del Servidor BOS. 

Habilitaci≤n del inicio de sesi≤n de AFS en sistemas HP-UX
Nota: Si piensa eliminar el funcionamiento de cliente de esta mßquina despuΘs de completar la instalaci≤n, sßltese esta secci≤n y siga con el apartado Inicio del Servidor BOS.  

En este punto se incorpora AFS al esquema del M≤dulo de autentificaci≤n conectable (PAM) del sistema operativo. PAM integra todos los mecanismos de autentificaci≤n en la mßquina, incluyendo el inicio de sesi≤n, con el fin de proporcionar la infraestructura de seguridad necesaria para un acceso autentificado a la mßquina y desde ella. 

La explicaci≤n de PAM queda fuera del ßmbito de este documento. Se supone que el usuario ya comprende la sintaxis y los significados de los valores del archivo de configuraci≤n de PAM (por ejemplo, c≤mo funciona la entrada other, el efecto de hacer que una entrada sea required, optional o sufficient, etc.). 

Las instrucciones siguientes explican c≤mo alterar las entradas del archivo de configuraci≤n de PAM para cada servicio en el que se desee utilizar la autentificaci≤n de AFS. Posiblemente otras configuraciones tambiΘn funcionarφan, pero las instrucciones especifican la configuraci≤n recomendada y comprobada. Nota: Las instrucciones especifican que se debe marcar cada entrada como optional. Sin embargo, el hecho de marcar algunos m≤dulos como opcionales puede significar que Θstos otorguen acceso al servicio correspondiente aunque el usuario no cumpla con todos los requisitos del m≤dulo. Por ejemplo, en algunas revisiones del sistema operativo, si se marca como opcional el m≤dulo que controla los inicios de sesi≤n mediante una conexi≤n de marcaci≤n, se permite a los usuarios iniciar sesiones sin proporcionar contrase±a alguna. Para obtener una explicaci≤n de las limitaciones que se aplican a este sistema operativo, consulte las IBM AFS Release Notes. 
Asimismo, con algunas versiones del sistema operativo se deben instalar parches para que PAM interact·e correctamente con determinados programas de autentificaci≤n. Para conocer los detalles, consulte las IBM AFS Release Notes. 
 


Las entradas relacionadas con AFS recomendadas en el archivo de configuraci≤n de PAM pueden hacer uso de uno o mßs de los tres atributos siguientes. 


try_first_pass 
Se trata de un atributo estßndar de PAM que se puede incluir en las entradas de un servicio posteriores a la primera; Θste dirige el m≤dulo que debe utilizar la contrase±a proporcionada al primer m≤dulo. Para el m≤dulo AFS, significa que la autentificaci≤n de AFS es satisfactoria si la contrase±a proporcionada al m≤dulo listado en primer lugar es la contrase±a de AFS correcta del usuario. Para obtener una explicaci≤n adicional de este atributo y de las alternativas del mismo, consulte la documentaci≤n sobre PAM del sistema operativo. 

ignore_root 
Este atributo, especφfico del m≤dulo PAM de AFS, le hace ignorar no s≤lo al superusuario root local, sino tambiΘn a cualquier usuario cuyo UID sea 0 (cero). 

setenv_password_expires 
Este atributo, especφfico del m≤dulo PAM de AFS, establece la variable de entorno PASSWORD_EXPIRES seg·n la fecha de caducidad de la contrase±a de AFS del usuario, que estß registrada en la Base de datos de autentificaci≤n. 
Lleve a cabo los pasos siguientes para habilitar el inicio de sesi≤n de AFS. 

Monte el CD-ROM de AFS para HP-UX en el directorio /cdrom, si no estß montado todavφa. A continuaci≤n, cambie de directorio tal como se indica. 
  
   # cd /usr/lib/security
   

Copie el archivo de bibliotecas de autentificaci≤n de AFS en el directorio /usr/lib/security. Luego, cree un enlace simb≤lico en cuyo nombre no se mencione la versi≤n. El hecho de omitir la versi≤n elimina la necesidad de editar el archivo de configuraci≤n de PAM si, mßs adelante, se actualiza el archivo de bibliotecas. 
Si utiliza el Servidor de autentificaci≤n de AFS (proceso kaserver) en la cΘlula: 

   
   # cp /cdrom/hp_ux110/lib/pam_afs.so.1  .
  
   # ln -s  pam_afs.so.1  pam_afs.so   

Si utiliza una implantaci≤n Kerberos de la autentificaci≤n de AFS: 

  
   # cp /cdrom/hp_ux110/lib/pam_afs.krb.so.1   .
  
   # ln -s pam_afs.krb.so.1 pam_afs.so
   

Edite la secci≤n Authentication management del archivo de configuraci≤n PAM de HP-UX, por convenio /etc/pam.conf. Las entradas de esta secci≤n tienen el valor auth en el segundo campo. 
En primer lugar, edite las entradas estßndar, que hacen referencia al m≤dulo PAM de HP-UX (habitualmente, el archivo /usr/lib/security/libpam_unix.1) en el cuarto campo. Para cada servicio en el que desee que se utilice la autentificaci≤n de AFS, edite el tercer campo de la entrada correspondiente de forma que contenga optional. El archivo pam.conf de la distribuci≤n de HP-UX suele incluir entradas estßndar, por ejemplo, para los servicios login y ftp. 

Si hay servicios en los que desea que se utilice la autentificaci≤n de AFS pero para los cuales el archivo pam.conf no incluye todavφa una entrada estßndar, debe crear dicha entrada y colocar el valor optional en el tercer campo de la misma. Por ejemplo, el archivo pam.conf de HP-UX no suele incluir entradas estßndar para los servicios remsh ni telnet. 

Seguidamente, cree una entrada relativa a AFS para cada servicio, colocßndola inmediatamente debajo de la entrada estßndar. El ejemplo siguiente muestra el aspecto de la secci≤n Authentication Management despuΘs de haber editado o creado entradas para los servicios mencionados anteriormente. Observe que las entradas para AFS del ejemplo aparecen en dos lφneas ·nicamente para que se puedan leer sin dificultad. 

   
   login   auth  optional  /usr/lib/security/libpam_unix.1
   login   auth  optional  /usr/lib/security/pam_afs.so      \
         try_first_pass  ignore_root  setenv_password_expires
   ftp     auth  optional  /usr/lib/security/libpam_unix.1
   ftp     auth  optional  /usr/lib/security/pam_afs.so      \
         try_first_pass  ignore_root
   remsh   auth  optional  /usr/lib/security/libpam_unix.1
   remsh   auth  optional  /usr/lib/security/pam_afs.so      \
         try_first_pass  ignore_root		
   telnet  auth  optional  /usr/lib/security/libpam_unix.1
   telnet  auth  optional  /usr/lib/security/pam_afs.so      \
         try_first_pass  ignore_root  setenv_password_expires
   

Si utiliza Common Desktop Environment (CDE) en la mßquina y desea que los usuarios obtengan una se±al de AFS al inicio de sesi≤n, a±ada o edite tambiΘn las cuatro entradas siguientes en la secci≤n Authentication management. Observe que las entradas relativas a AFS del ejemplo aparecen en dos lφneas ·nicamente para que se puedan leer sin dificultad. 
  
   dtlogin   auth  optional  /usr/lib/security/libpam_unix.1
   dtlogin   auth  optional  /usr/lib/security/pam_afs.so     \
         try_first_pass  ignore_root
   dtaction  auth  optional  /usr/lib/security/libpam_unix.1
   dtaction  auth  optional  /usr/lib/security/pam_afs.so     \
         try_first_pass  ignore_root
   

Siga con el apartado Inicio del Servidor BOS (o, si estß consultando estas instrucciones mientras instala una mßquina servidor de archivos adicional, regrese al apartado Inicio de los programas de servidor). 

--------------------------------------------------------------------------------

C≤mo empezar en sistemas IRIX
Para incorporar AFS en el kernel en sistemas IRIX, elija uno de los dos mΘtodos siguientes: 

Ejecute el script de inicializaci≤n de AFS para invocar al programa ml distribuido por Silicon Graphics, Incorporated (SGI), el cual carga dinßmicamente las modificaciones de AFS en el kernel 
Cree un nuevo kernel estßtico 
A continuaci≤n, cree particiones para almacenar vol·menes AFS. No es necesario que sustituya el programa fsck de IRIX, puesto que SGI ya lo ha modificado para que maneje correctamente los vol·menes AFS. Si la mßquina va a permanecer como mßquina cliente AFS, verifique que el programa de utilidad de inicio de sesi≤n IRIX instalado en la mßquina brinda una se±al de AFS. 

Como preparaci≤n para una carga dinßmica o para una creaci≤n del kernel, lleve a cabo los procedimientos siguientes: 

Monte el CD-ROM de AFS para IRIX en el directorio /cdrom. Para obtener instrucciones sobre c≤mo montar los CD-ROM (ya sea local o remotamente por medio de NFS), consulte la documentaci≤n de IRIX. A continuaci≤n, cambie de directorio tal como se indica. 
   
   # cd  /cdrom/sgi_65/root.client
   

Copie el script de inicializaci≤n de AFS en el directorio local para archivos de inicializaci≤n (por convenio, /etc/init.d en las mßquinas IRIX). Observe la eliminaci≤n de la extensi≤n .rc cuando se copia el script. 
   
   # cp -p   usr/vice/etc/afs.rc  /etc/init.d/afs
   

Emita el mandato uname -m para determinar el tipo de placa de CPU de la mßquina. El valor IPxx de la salida debe coincidir con uno de los tipos de placa de CPU listados en las IBM AFS Release Notes para la versi≤n actual de AFS. 
   
   # uname -m
    

Empiece en el apartado Carga de AFS en el kernel de IRIX o en el apartado Creaci≤n de AFS en el kernel de IRIX. 

Carga de AFS en el kernel de IRIX
El programa ml es el cargador dinßmico del kernel proporcionado por SGI para sistemas IRIX. Si lo utiliza en lugar de crear las modificaciones de AFS en un kernel estßtico, para que AFS funcione correctamente se deberß ejecutar el programa ml cada vez que se rearranque la mßquina. Por consiguiente, el script de inicializaci≤n de AFS (incluido en el CD-ROM de AFS) lo invoca automßticamente si la variable de configuraci≤n afsml estß activada. En este apartado se activa la variable y se ejecuta el script. 

En apartados posteriores se verificarß que el script inicialice correctamente todos los componentes de AFS y luego se crearßn los enlaces que incorporan AFS en la secuencia de arranque y cierre de IRIX. 

Cree el directorio local /usr/vice/etc/sgiload para alojar el archivo de bibliotecas del kernel AFS. 
   
   # mkdir /usr/vice/etc/sgiload
   

Copie el archivo de bibliotecas del kernel AFS adecuado en el directorio /usr/vice/etc/sgiload. La porci≤n IPxx del nombre del archivo de bibliotecas debe coincidir con el valor devuelto previamente por el mandato uname -m. Elija tambiΘn el archivo adecuado en funci≤n de si el kernel de la mßquina soporta el funcionamiento de servidor NFS (se debe soportar NFS para que la mßquina act·e como Conversor de NFS/AFS). Las mßquinas de un solo procesador y de varios procesadores utilizan el mismo archivo de bibliotecas. 
(Puede elegir que se copien todos los archivos de bibliotecas del kernel en el directorio /usr/vice/etc/sgiload, pero en este caso necesitarß una cantidad significativa de espacio). 

Si el kernel de la mßquina soporta el funcionamiento de servidor NFS: 

   
   # cp -p  usr/vice/etc/sgiload/libafs.IPxx.o  /usr/vice/etc/sgiload   

Si el kernel de la mßquina no soporta el funcionamiento de servidor NFS: 

   
   # cp -p  usr/vice/etc/sgiload/libafs.IPxx.nonfs.o   \
                   /usr/vice/etc/sgiload
   

Emita el mandato chkconfig para activar la variable de configuraci≤n afsml. 
   
   # /etc/chkconfig -f afsml on   

Si la mßquina va a funcionar como Conversor de NFS/AFS y el kernel soporta el funcionamiento de servidor NFS, active la variable afsxnfs. 

   
   # /etc/chkconfig -f afsxnfs on
   

Ejecute el script /etc/init.d/afs para cargar extensiones de AFS en el kernel. El script invoca al mandato ml, determinando automßticamente quΘ archivo de bibliotecas del kernel se debe utilizar en base al tipo de CPU de esta mßquina y al estado de activaci≤n de la variable afsxnfs. 
Puede hacer caso omiso de los mensajes de error relacionados con la imposibilidad de iniciar el Servidor BOS, el Gestor de antememoria o el cliente AFS. 

   
   # /etc/init.d/afs  start
   

Siga con el apartado Configuraci≤n de particiones de servidor en sistemas IRIX. 

Creaci≤n de AFS en el kernel de IRIX
Utilice las instrucciones siguientes para crear modificaciones de AFS en el kernel de un sistema IRIX. 

Copie el archivo de inicializaci≤n afs.sm del kernel en el directorio local /var/sysgen/system y el archivo maestro afs del kernel en el directorio local /var/sysgen/master.d. 
   
   # cp -p  bin/afs.sm  /var/sysgen/system
   
   # cp -p  bin/afs  /var/sysgen/master.d
   

Copie el archivo de bibliotecas del kernel AFS adecuado en el archivo loca /var/sysgen/boot/afs.al; la porci≤n IPxx del nombre del archivo de bibliotecas debe coincidir con el valor devuelto previamente por el mandato uname -m. Elija tambiΘn el archivo adecuado en funci≤n de si el kernel de la mßquina soporta el funcionamiento de servidor NFS (se debe soportar NFS para que la mßquina act·e como Conversor de NFS/AFS). Las mßquinas de un solo procesador y de varios procesadores utilizan el mismo archivo de bibliotecas. 
Si el kernel de la mßquina soporta el funcionamiento de servidor NFS: 

   
   # cp -p   bin/libafs.IPxx.a   /var/sysgen/boot/afs.a   

Si el kernel de la mßquina no soporta el funcionamiento de servidor NFS: 

   
   # cp -p  bin/libafs.IPxx.nonfs.a  /var/sysgen/boot/afs.a
   

Emita el mandato chkconfig para desactivar la variable de configuraci≤n afsml. 
   
   # /etc/chkconfig -f afsml off   

Si la mßquina va a funcionar como Conversor de NFS/AFS y el kernel soporta el funcionamiento de servidor NFS, active la variable afsxnfs. 

    
   # /etc/chkconfig -f afsxnfs on
   

Copie el archivo del kernel existente, /unix, en una ubicaci≤n segura. Compile el nuevo kernel, que se ha creado en el archivo /unix.install. Este archivo sobregrabarß el archivo /unix existente cuando se rearranque la mßquina en el paso siguiente. 
   
   # cp /unix /unix_noafs
   
   # autoconfig
   

Rearranque la mßquina para empezar a utilizar el nuevo kernel y vuelva a iniciar una sesi≤n como superusuario root. 
   
   # cd /
         
   # shutdown -i6 -g0 -y
   
   login: root
   Contrase±a: contrase±a_root
   


Configuraci≤n de particiones de servidor en sistemas IRIX
Cada mßquina servidor de archivos AFS debe tener como mφnimo una partici≤n o un volumen l≤gico dedicados al almacenamiento de vol·menes AFS. Cada partici≤n de servidor se monta en un directorio denominado /vicepxx, siendo xx una o dos letras min·sculas. Los directorios /vicepxx deben residir en el directorio raφz de la mßquina servidor de archivos, y no en uno de los subdirectorios del mismo (por ejemplo, /usr/vicepa no es una ubicaci≤n de directorio aceptable). Para obtener informaci≤n adicional, consulte el apartado Realizaci≤n de procedimientos especφficos de la plataforma. 

AFS soporta el uso de particiones tanto EFS como XFS para alojar vol·menes AFS. SGI alienta el uso de particiones XFS. 

Cree un directorio llamado /vicepxx para cada partici≤n de servidor AFS que estΘ configurando (tiene que haber por lo menos una). Repita el mandato para cada una de las particiones. 
   
   # mkdir /vicepxx
   

A±ada una lφnea en el archivo de registro de sistemas de archivos /etc/fstab con el formato siguiente, para cada una de las particiones (o vol·menes l≤gicos creados mediante el gestor de vol·menes XLV) que se deberßn montar en uno de los directorios creados en el paso anterior. 
Para un volumen l≤gico o partici≤n XFS: 

   
   /dev/dsk/disco  /vicepxx  xfs  rw,raw=/dev/rdsk/disco  0  0   

Para una partici≤n EFS: 

   
   /dev/dsk/disco  /vicepxx  efs  rw,raw=/dev/rdsk/disco  0  0   

A continuaci≤n, mostramos ejemplos de una entrada para cada tipo de sistema de archivos: 

   
   /dev/dsk/dks0d2s6 /vicepa  xfs rw,raw=/dev/rdsk/dks0d2s6  0 0
   /dev/dsk/dks0d3s1 /vicepb  efs rw,raw=/dev/rdsk/dks0d3s1  0 0
   

Cree un sistema de archivos en cada partici≤n que se vaya a montar en un directorio /vicepxx. Probablemente los mandatos siguientes resultarßn apropiados, pero consulte mßs informaci≤n en la documentaci≤n de IRIX. En ambos casos, dispositivo_puro es un nombre de dispositivo puro tal como /dev/rdsk/dks0d0s0 lo es para una partici≤n de un solo disco, o como lo es /dev/rxlv/xlv0 para un volumen l≤gico. 
Para sistemas de archivos XFS, incluya las opciones indicadas para configurar la partici≤n o el voumen l≤gico con inodos lo suficientemente grandes como para acomodar informaci≤n especφfica de AFS: 

   
   # mkfs -t xfs -i size=512 -l size=4000b dispositivo_puro   

Para sistemas de archivos EFS: 

   
   # mkfs -t efs dispositivo_puro
   

Monte cada una de las particiones, emitiendo el mandato mount -a para montar todas las particiones a la vez o el mandato mount para montar cada partici≤n por turnos. 
(Opcional) Si ha configurado particiones o vol·menes l≤gicos para utilizar XFS, emita el mandato siguiente con el fin de verificar que los inodos estΘn bien configurados (son suficientemente grandes para acomodar informaci≤n especφfica de AFS). Si la configuraci≤n es correcta, el mandato no devuelve ninguna salida. De lo contrario, especifica el mandato que se debe ejecutar para configurar cada partici≤n o volumen l≤gico adecuadamente. 
   
   # /usr/afs/bin/xfs_size_check
   

Si piensa mantener el funcionamiento de cliente en esta mßquina despuΘs de completar la instalaci≤n, siga con el apartado Habilitaci≤n del inicio de sesi≤n de AFS en sistemas IRIX. De lo contrario, siga con el apartado Inicio del Servidor BOS. 

Habilitaci≤n del inicio de sesi≤n de AFS en sistemas IRIX
Nota: Si piensa eliminar el funcionamiento de cliente de esta mßquina despuΘs de completar la instalaci≤n, sßltese esta secci≤n y siga con el apartado Inicio del Servidor BOS.  

El programa login estßndar de la lφnea de mandatos de IRIX y el programa de inicio de sesi≤n grßfico xdm otorgan automßticamente una se±al de AFS cuando se incorpora AFS en el kernel de la mßquina. Sin embargo, algunas distribuciones de IRIX utilizan, por omisi≤n, otro programa de utilidad de inicio de sesi≤n que no incorpora necesariamente las modificaciones de AFS requeridas. Si se da este caso, debe inhabilitar el programa de utilidad por omisi≤n si desea que los usuarios de AFS obtengan se±ales de AFS al inicio de sesi≤n. Para obtener una explicaci≤n adicional, consulte las IBM AFS Release Notes. 

Si se configura la mßquina de forma que utilice un programa de utilidad de inicio de sesi≤n modificado por AFS, los archivos afsauthlib.so y afskauthlib.so (incluidos en la distribuci≤n de AFS) deben residir en el directorio /usr/vice/etc. Emita el mandato ls para verificarlo. 

  
   # ls /usr/vice/etc   

Si los archivos no existen, monte el CD-ROM de AFS para IRIX (si no estß montado todavφa), cambie de directorio de la forma indicada y c≤pielos. 

  
   # cd /cdrom/sgi_65/root.client/usr/vice/etc
   
   # cp  -p  *authlib*  /usr/vice/etc   

DespuΘs de emprender las acciones necesarias, siga con el apartado Inicio del Servidor BOS. 


--------------------------------------------------------------------------------

C≤mo empezar en sistemas Linux
Empiece por ejecutar el script de inicializaci≤n de AFS que llamarß al programa insmod, el cual carga dinßmicamente las modificaciones de AFS en el kernel. A continuaci≤n, cree particiones para almacenar vol·menes AFS. No es necesario que sustituya el programa fsck de Linux. Si la mßquina va a permanecer como mßquina cliente AFS, incorpore AFS al M≤dulo de autentificaci≤n conectable (PAM) de la mßquina. 


Carga de AFS en el kernel de Linux
El programa insmod es el cargador dinßmico del kernel para Linux. Linux no soporta la incorporaci≤n de modificaciones de AFS durante la creaci≤n de un kernel. 

Para que AFS funcione correctamente se debe ejecutar el programa insmod cada vez que se rearranque la mßquina, de forma que el script de inicializaci≤n de AFS (que se incluye en el CD-ROM de AFS) lo invoque automßticamente. El script tambiΘn incluye mandatos que seleccionan automßticamente el archivo de bibliotecas de AFS apropiado. En este apartado se ejecuta el script. 

En apartados posteriores se verificarß que el script inicialice correctamente todos los componentes de AFS y luego se activarß una variable de configuraci≤n, que tiene como resultado la incorporaci≤n del script a la secuencia de arranque y cierre de Linux. 

Monte el CD-ROM de AFS para Linux en el directorio local /cdrom. Para obtener instrucciones sobre c≤mo montar los CD-ROM (ya sea local o remotamente por medio de NFS), consulte la documentaci≤n de Linux. A continuaci≤n, cambie de directorio tal como se indica. 
   
   # cd  /cdrom/i386_linux22/root.client/usr/vice/etc
   

Copie los archivos de bibliotecas del kernel AFS en el directorio local /usr/vice/etc/modload. Los nombres de archivo para las bibliotecas tienen el formato libafs-versi≤n.o, donde versi≤n indica el nivel de creaci≤n del kernel. La serie .mp de la versi≤n indica que el archivo es apropiado para mßquinas que ejecuten un kernel de varios procesadores. 
   
   # cp -rp  modload  /usr/vice/etc
   

Copie el script de inicializaci≤n de AFS en el directorio local para archivos de inicializaci≤n (por convenio, /etc/rc.d/init.d en las mßquinas Linux). Observe la eliminaci≤n de la extensi≤n .rc cuando se copia el script. 
   
   # cp -p   afs.rc  /etc/rc.d/init.d/afs 
    

Ejecute el script de inicializaci≤n de AFS para cargar extensiones de AFS en el kernel. Puede hacer caso omiso de cualquier mensaje de error sobre la imposibilidad de iniciar el Servidor BOS, el Gestor de antememoria o el cliente AFS. 
   
   # /etc/rc.d/init.d/afs  start
   


Configuraci≤n de particiones de servidor en sistemas Linux
Cada mßquina servidor de archivos AFS debe tener como mφnimo una partici≤n o un volumen l≤gico dedicados al almacenamiento de vol·menes AFS. Cada partici≤n de servidor se monta en un directorio denominado /vicepxx, siendo xx una o dos letras min·sculas. Los directorios /vicepxx deben residir en el directorio raφz de la mßquina servidor de archivos, y no en uno de los subdirectorios del mismo (por ejemplo, /usr/vicepa no es una ubicaci≤n de directorio aceptable). Para obtener informaci≤n adicional, consulte el apartado Realizaci≤n de procedimientos especφficos de la plataforma. 

Cree un directorio llamado /vicepxx para cada partici≤n de servidor AFS que estΘ configurando (tiene que haber por lo menos una). Repita el mandato para cada una de las particiones. 
   
   # mkdir /vicepxx
   

A±ada una lφnea en el archivo de registro de sistemas de archivos /etc/fstab con el formato siguiente, para cada uno de los directorios que acabe de crear. La entrada correlaciona el nombre de directorio con la partici≤n de disco que se deberß montar en Θl. 
   
   /dev/disco  /vicepxx  ext2  defaults  0  2   

A continuaci≤n se muestra un ejemplo de la primera partici≤n que se configura. 

   
   /dev/sda8 /vicepa ext2 defaults 0 2
   

Cree un sistema de archivos en cada partici≤n que se vaya a montar en un directorio /vicepxx. Probablemente el mandato siguiente resultarß apropiado, pero consulte mßs informaci≤n en la documentaci≤n de Linux. 
   
   # mkfs -v /dev/disco
   

Monte cada una de las particiones emitiendo el mandato mount -a para montar todas las particiones a la vez o el mandato mount para montar cada partici≤n por turnos. 
Si piensa mantener el funcionamiento de cliente en esta mßquina despuΘs de completar la instalaci≤n, siga con el apartado Habilitaci≤n del inicio de sesi≤n de AFS en sistemas Linux. De lo contrario, siga con el apartado Inicio del Servidor BOS. 

Habilitaci≤n del inicio de sesi≤n de AFS en sistemas Linux
Nota: Si piensa eliminar el funcionamiento de cliente de esta mßquina despuΘs de completar la instalaci≤n, sßltese esta secci≤n y siga con el apartado Inicio del Servidor BOS.  

En este punto se incorpora AFS al esquema del M≤dulo de autentificaci≤n conectable (PAM) del sistema operativo. PAM integra todos los mecanismos de autentificaci≤n en la mßquina, incluyendo el inicio de sesi≤n, con el fin de proporcionar la infraestructura de seguridad necesaria para un acceso autentificado a la mßquina y desde ella. 

La explicaci≤n de PAM queda fuera del ßmbito de este documento. Se supone que el usuario ya comprende la sintaxis y los significados de los valores del archivo de configuraci≤n de PAM (por ejemplo, c≤mo funciona la entrada other, el efecto de hacer que una entrada sea required, optional o sufficient, etc.). 

Las instrucciones siguientes explican c≤mo alterar las entradas del archivo de configuraci≤n de PAM para cada servicio en el que se desee utilizar la autentificaci≤n de AFS. Posiblemente otras configuraciones tambiΘn funcionarφan, pero las instrucciones especifican la configuraci≤n recomendada y comprobada. 

Las entradas relacionadas con AFS recomendadas en el archivo de configuraci≤n de PAM pueden hacer uso de uno o mßs de los tres atributos siguientes. 


try_first_pass 
Se trata de un atributo estßndar de PAM que se puede incluir en las entradas de un servicio posteriores a la primera; Θste dirige el m≤dulo que debe utilizar la contrase±a proporcionada al primer m≤dulo. Para el m≤dulo AFS, significa que la autentificaci≤n de AFS es satisfactoria si la contrase±a proporcionada al m≤dulo listado en primer lugar es la contrase±a de AFS correcta del usuario. Para obtener una explicaci≤n adicional de este atributo y de las alternativas del mismo, consulte la documentaci≤n sobre PAM del sistema operativo. 

ignore_root 
Este atributo, especφfico del m≤dulo PAM de AFS, le hace ignorar no s≤lo al superusuario root local, sino tambiΘn a cualquier usuario cuyo UID sea 0 (cero). 

setenv_password_expires 
Este atributo, especφfico del m≤dulo PAM de AFS, establece la variable de entorno PASSWORD_EXPIRES seg·n la fecha de caducidad de la contrase±a de AFS del usuario, que estß registrada en la Base de datos de autentificaci≤n. 
Lleve a cabo los pasos siguientes para habilitar el inicio de sesi≤n de AFS. 

Monte el CD-ROM de AFS para Linux en el directorio /cdrom, si no estß montado todavφa. A continuaci≤n, cambie al directorio para m≤dulos PAM, que depende de la distribuci≤n de Linux que estΘ utilizando. 
Si estß utilizando una distribuci≤n de Linux procedente de Red Hat Software: 

   
   # cd /lib/security   

Si estß utilizando otra distribuci≤n de Linux: 

   
   # cd /usr/lib/security
   

Copie el archivo de bibliotecas de autentificaci≤n de AFS apropiado en el directorio al que ha cambiado en el paso anterior. Cree un enlace simb≤lico en cuyo nombre no se mencione la versi≤n. El hecho de omitir la versi≤n elimina la necesidad de editar el archivo de configuraci≤n de PAM si, mßs adelante, actualiza el archivo de bibliotecas. 
Si utiliza el Servidor de autentificaci≤n de AFS (proceso kaserver): 

   
   # cp /cdrom/i386_linux22/lib/pam_afs.so.1  .
   
   # ln -s pam_afs.so.1 pam_afs.so   

Si utiliza una implantaci≤n Kerberos de la autentificaci≤n de AFS: 

   
   # cp /cdrom/i386_linux22/lib/pam_afs.krb.so.1   .
   
   # ln -s pam_afs.krb.so.1 pam_afs.so
   

Para cada servicio en el que desee utilizar la autentificaci≤n de AFS, inserte una entrada para el m≤dulo PAM de AFS en la secci≤n auth del archivo de configuraci≤n de PAM del servicio. (Linux utiliza un archivo de configuraci≤n independiente para cada servicio, a diferencia de otros sistemas operativos que listan todos los servicios en un ·nico archivo.) Marque la entrada como sufficient en el segundo campo. 
Coloque la entrada de AFS debajo de las entradas que impongan condiciones bajo las que desea que falle el servicio para un usuario que no cumpla con los requisitos de la entrada. Marque estas entradas como required. Coloque la entrada de AFS encima de las entradas que s≤lo se tengan que ejecutar si falla la autentificaci≤n de AFS. 

Si utiliza la distribuci≤n de Red Hat, inserte la entrada de AFS siguiente: 

   
   auth      sufficient /lib/security/pam_afs.so try_first_pass ignore_root   

Si utiliza otra distribuci≤n, inserte la entrada de AFS siguiente: 

   
   auth  sufficient  /usr/lib/security/pam_afs.so  try_first_pass  ignore_root   

El ejemplo siguiente ilustra la configuraci≤n recomendada para el archivo de configuraci≤n del servicio login (/etc/pam.d/login) en una mßquina que utiliza la distribuci≤n de Red Hat. 

   
   #%PAM-1.0
   auth      required   /lib/security/pam_securetty.so
   auth      required   /lib/security/pam_nologin.so
   auth      sufficient /lib/security/pam_afs.so try_first_pass ignore_root
   auth      required   /lib/security/pam_pwdb.so shadow nullok
   account   required   /lib/security/pam_pwdb.so
   password  required   /lib/security/pam_cracklib.so
   password  required   /lib/security/pam_pwdb.so shadow nullok use_authtok
   session   required   /lib/security/pam_pwdb.so
   

Siga con el apartado Inicio del Servidor BOS (o, si estß consultando estas instrucciones mientras instala una mßquina servidor de archivos adicional, regrese al apartado Inicio de los programas de servidor). 

--------------------------------------------------------------------------------

C≤mo empezar en sistemas Solaris
Empiece por ejecutar el script de inicializaci≤n de AFS que llamarß al programa modload distribuido por Sun Microsystems, el cual carga dinßmicamente las modificaciones de AFS en el kernel. A continuaci≤n, cree particiones para almacenar vol·menes AFS e instale y configure el programa fsck modificado por AFS para que se ejecute en las particiones de servidor AFS. Si la mßquina va a permanecer como mßquina cliente AFS, incorpore AFS al M≤dulo de autentificaci≤n conectable (PAM) de la mßquina. 


Carga de AFS en el kernel de Solaris
El programa modload es el cargador dinßmico del kernel proporcionado por Sun Microsystems para sistemas Solaris. Solaris no soporta la incorporaci≤n de modificaciones de AFS durante la creaci≤n de un kernel. 

Para que AFS funcione correctamente se debe ejecutar el programa modload cada vez que se rearranque la mßquina, de forma que el script de inicializaci≤n de AFS (que se incluye en el CD-ROM de AFS) lo invoque automßticamente. En este apartado se copia el archivo de bibliotecas de AFS apropiado en la ubicaci≤n en la que el programa modload accede a Θl y, a continuaci≤n, se ejecuta el script. 

En apartados posteriores se verificarß que el script inicialice correctamente todos los componentes de AFS y luego se crearßn los enlaces que incorporan AFS en la secuencia de arranque y cierre de Solaris. 

Monte el CD-ROM de AFS para Solaris en el directorio /cdrom. Para obtener instrucciones sobre c≤mo montar los CD-ROM (ya sea local o remotamente por medio de NFS), consulte la documentaci≤n de Solaris. A continuaci≤n, cambie de directorio tal como se indica. 
   
   # cd  /cdrom/sun4x_56/root.client/usr/vice/etc
   

Copie el script de inicializaci≤n de AFS en el directorio local para archivos de inicializaci≤n (por convenio, /etc/init.d en las mßquinas Solaris). Observe la eliminaci≤n de la extensi≤n .rc cuando se copia el script. 
   
   # cp -p  afs.rc  /etc/init.d/afs
   

Copie el archivo de bibliotecas del kernel AFS apropiado en el archivo /kernel/fs/afs local. 
Si en la mßquina se estß ejecutando Solaris 2.6 o la versi≤n de 32 bits de Solaris 7, el kernel soporta el funcionamiento de servidor NFS y se estß ejecutando el proceso nfsd: 

   
   # cp -p modload/libafs.o /kernel/fs/afs   

Si en la mßquina se estß ejecutando Solaris 2.6 o la versi≤n de 32 bits de Solaris 7 y el kernel no soporta el funcionamiento de servidor NFS o no se estß ejecutando el proceso nfsd: 

   
   # cp -p modload/libafs.nonfs.o /kernel/fs/afs   

Si en la mßquina se estß ejecutando la versi≤n de 64 bits de Solaris 7, el kernel soporta el funcionamiento de servidor NFS y se estß ejecutando el proceso nfsd: 

   
   # cp -p modload/libafs64.o /kernel/fs/sparcv9/afs   

Si en la mßquina se estß ejecutando la versi≤n de 64 bits de Solaris 7 y el kernel no soporta el funcionamiento de servidor NFS o no se estß ejecutando el proceso nfsd: 

   
   # cp -p modload/libafs64.nonfs.o /kernel/fs/sparcv9/afs
   

Ejecute el script de inicializaci≤n de AFS para cargar modificaciones de AFS en el kernel. Puede hacer caso omiso de cualquier mensaje de error sobre la imposibilidad de iniciar el Servidor BOS, el Gestor de antememoria o el cliente AFS. 
   
   # /etc/init.d/afs start   

Si no existe una entrada llamada afs en el archivo local /etc/nombre_a_n·msist, el script la crea automßticamente y rearranca la mßquina para empezar a utilizar la nueva versi≤n del archivo. De suceder asφ, inicie de nuevo una sesi≤n como supersusuario root despuΘs del rearranque y vuelva a ejecutar el script de inicializaci≤n. Esta vez ya existirß la entrada necesaria en el archivo /etc/nombre_a_n·msist y se ejecutarß el programa modload. 

   
   login: root
   Contrase±a: contrase±a_root
   
   # /etc/init.d/afs start
   


Configuraci≤n del programa fsck modificado por AFS en sistemas Solaris
En este apartado se efect·an modificaciones para garantizar que se ejecute el programa fsck apropiado en las particiones de servidor AFS. El programa fsck proporcionado con el sistema operativo nunca se debe ejecutar en particiones de servidor AFS. Dado que no reconoce las estructuras que utiliza el Servidor de archivos para organizar datos de vol·menes, elimina todos los datos. Una vez mßs: 

Nunca se debe ejecutar el programa fsck estßndar en particiones de servidor AFS, porque descarta los vol·menes AFS. 

Cree el directorio /usr/lib/fs/afs para alojar el programa fsck modificado por AFS y los archivos relacionados. 
  
   # mkdir /usr/lib/fs/afs
   
   # cd /usr/lib/fs/afs	
  

Copie el binario vfsck en el directorio reciΘn creado, cambißndole el nombre al llevar a cabo la copia. 
   
   # cp  /cdrom/sun4x_56/root.server/etc/vfsck  fsck
  

Trabajando en el directorio /usr/lib/fs/afs, cree los enlaces siguientes con las bibliotecas de Solaris: 
  
   # ln -s /usr/lib/fs/ufs/clri	
   # ln -s /usr/lib/fs/ufs/df
   # ln -s /usr/lib/fs/ufs/edquota
   # ln -s /usr/lib/fs/ufs/ff
   # ln -s /usr/lib/fs/ufs/fsdb	
   # ln -s /usr/lib/fs/ufs/fsirand
   # ln -s /usr/lib/fs/ufs/fstyp
   # ln -s /usr/lib/fs/ufs/labelit
   # ln -s /usr/lib/fs/ufs/lockfs
   # ln -s /usr/lib/fs/ufs/mkfs	
   # ln -s /usr/lib/fs/ufs/mount
   # ln -s /usr/lib/fs/ufs/ncheck
   # ln -s /usr/lib/fs/ufs/newfs
   # ln -s /usr/lib/fs/ufs/quot
   # ln -s /usr/lib/fs/ufs/quota
   # ln -s /usr/lib/fs/ufs/quotaoff
   # ln -s /usr/lib/fs/ufs/quotaon
   # ln -s /usr/lib/fs/ufs/repquota
   # ln -s /usr/lib/fs/ufs/tunefs
   # ln -s /usr/lib/fs/ufs/ufsdump
   # ln -s /usr/lib/fs/ufs/ufsrestore
   # ln -s /usr/lib/fs/ufs/volcopy
   

A±ada la lφnea siguiente al final del archivo /etc/dfs/fstypes. 
  
   afs AFS Utilities
  

Edite el archivo /sbin/mountall, efectuando dos cambios. 
A±ada una entrada para AFS en la sentencia case para la opci≤n 2, de forma que se lea lo siguiente: 
  
   case "$2" in
   ufs)    foptions="-o p"
           ;;
   afs)    foptions="-o p"
           ;;
   s5)     foptions="-y -t /var/tmp/tmp$$ -D"
           ;;
   *)      foptions="-y"
           ;;
  

Edite el archivo para que se comprueben todas las particiones de AFS y UFS en paralelo. Sustituya la secci≤n de c≤digo siguiente: 
  
   # For  fsck purposes, we make a distinction between ufs and
   # other file systems
   #
   if [ "$fstype" = "ufs" ]; then
        ufs_fscklist="$ufs_fscklist $fsckdev"
        saveentry $fstype "$OPTIONS" $special $mountp
        continue
   fi  

por esta secci≤n de c≤digo: 

  
   # For fsck purposes, we make a distinction between ufs/afs
   # and other file systems.
   #
   if [ "$fstype" = "ufs" -o "$fstype" = "afs" ]; then
        ufs_fscklist="$ufs_fscklist $fsckdev"
        saveentry $fstype "$OPTIONS" $special $mountp
        continue
   fi
  


Configuraci≤n de particiones de servidor en sistemas Solaris
Cada mßquina servidor de archivos AFS debe tener como mφnimo una partici≤n o un volumen l≤gico dedicados al almacenamiento de vol·menes AFS. Cada partici≤n de servidor se monta en un directorio denominado /vicepxx, siendo xx una o dos letras min·sculas. Los directorios /vicepxx deben residir en el directorio raφz de la mßquina servidor de archivos, y no en uno de los subdirectorios del mismo (por ejemplo, /usr/vicepa no es una ubicaci≤n de directorio aceptable). Para obtener informaci≤n adicional, consulte el apartado Realizaci≤n de procedimientos especφficos de la plataforma. 

Cree un directorio llamado /vicepxx para cada partici≤n de servidor AFS que estΘ configurando (tiene que haber por lo menos una). Repita el mandato para cada una de las particiones. 
   
   # mkdir /vicepxx
   

A±ada una lφnea en el archivo de registro de sistemas de archivos /etc/vfstab con el formato siguiente, para cada una de las particiones creadas en el paso anterior. Observe el valor afs en el cuarto campo, el cual indica a Solaris que se debe utilizar el programa fsck modificado por AFS en esta partici≤n. 
   
   /dev/dsk/disco   /dev/rdsk/disco   /vicepxx   afs  orden_arranque  yes  

A continuaci≤n se muestra un ejemplo de la primera partici≤n que se configura. 

  
   /dev/dsk/c0t6d0s1 /dev/rdsk/c0t6d0s1 /vicepa afs 3 yes
  

Cree un sistema de archivos en cada partici≤n que se vaya a montar en un directorio /vicepxx. Probablemente el mandato siguiente resultarß apropiado, pero consulte mßs informaci≤n en la documentaci≤n de Solaris. 
  
   # newfs -v /dev/rdsk/disco
  

Emita el mandato mountall para montar todas las particiones a la vez 
Si piensa mantener el funcionamiento de cliente en esta mßquina despuΘs de completar la instalaci≤n, siga con el apartado Habilitaci≤n del inicio de sesi≤n de AFS y edici≤n del script de borrado de sistemas de archivos en sistemas Solaris. De lo contrario, siga con el apartado Inicio del Servidor BOS. 

Habilitaci≤n del inicio de sesi≤n de AFS y edici≤n del script de borrado de sistemas de archivos en sistemas Solaris
Nota: Si piensa eliminar el funcionamiento de cliente de esta mßquina despuΘs de completar la instalaci≤n, sßltese esta secci≤n y siga con el apartado Inicio del Servidor BOS.  

En este punto se incorpora AFS al esquema del M≤dulo de autentificaci≤n conectable (PAM) del sistema operativo. PAM integra todos los mecanismos de autentificaci≤n en la mßquina, incluyendo el inicio de sesi≤n, con el fin de proporcionar la infraestructura de seguridad necesaria para un acceso autentificado a la mßquina y desde ella. 

La explicaci≤n de PAM queda fuera del ßmbito de este documento. Se supone que el usuario ya comprende la sintaxis y los significados de los valores del archivo de configuraci≤n de PAM (por ejemplo, c≤mo funciona la entrada other, el efecto de hacer que una entrada sea required, optional o sufficient, etc.). 

Las instrucciones siguientes explican c≤mo alterar las entradas del archivo de configuraci≤n de PAM para cada servicio en el que se desee utilizar la autentificaci≤n de AFS. Posiblemente otras configuraciones tambiΘn funcionarφan, pero las instrucciones especifican la configuraci≤n recomendada y comprobada. Nota: Las instrucciones especifican que se debe marcar cada entrada como optional. Sin embargo, el hecho de marcar algunos m≤dulos como opcionales puede significar que Θstos otorguen acceso al servicio correspondiente aunque el usuario no cumpla con todos los requisitos del m≤dulo. Por ejemplo, en algunas revisiones del sistema operativo, si se marca como opcional el m≤dulo que controla los inicios de sesi≤n mediante una conexi≤n de marcaci≤n, se permite a los usuarios iniciar sesiones sin proporcionar contrase±a alguna. Para obtener una explicaci≤n de las limitaciones que se aplican a este sistema operativo, consulte las IBM AFS Release Notes. 
Asimismo, con algunas versiones del sistema operativo se deben instalar parches para que PAM interact·e correctamente con determinados programas de autentificaci≤n. Para conocer los detalles, consulte las IBM AFS Release Notes. 
 


Las entradas relacionadas con AFS recomendadas en el archivo de configuraci≤n de PAM pueden hacer uso de uno o mßs de los tres atributos siguientes. 


try_first_pass 
Se trata de un atributo estßndar de PAM que se puede incluir en las entradas de un servicio posteriores a la primera; Θste dirige el m≤dulo que debe utilizar la contrase±a proporcionada al primer m≤dulo. Para el m≤dulo AFS, significa que la autentificaci≤n de AFS es satisfactoria si la contrase±a proporcionada al m≤dulo listado en primer lugar es la contrase±a de AFS correcta del usuario. Para obtener una explicaci≤n adicional de este atributo y de las alternativas del mismo, consulte la documentaci≤n sobre PAM del sistema operativo. 

ignore_root 
Este atributo, especφfico del m≤dulo PAM de AFS, le hace ignorar no s≤lo al superusuario root local, sino tambiΘn a cualquier usuario cuyo UID sea 0 (cero). 

setenv_password_expires 
Este atributo, especφfico del m≤dulo PAM de AFS, establece la variable de entorno PASSWORD_EXPIRES seg·n la fecha de caducidad de la contrase±a de AFS del usuario, que estß registrada en la Base de datos de autentificaci≤n. 
Lleve a cabo los pasos siguientes para habilitar el inicio de sesi≤n de AFS. 

Monte el CD-ROM de AFS para Solaris en el directorio /cdrom, si no estß montado todavφa. A continuaci≤n, cambie de directorio tal como se indica. 
  
   # cd /usr/lib/security
   

Copie el archivo de bibliotecas de autentificaci≤n de AFS en el directorio /usr/lib/security. Luego, cree un enlace simb≤lico en cuyo nombre no se mencione la versi≤n. El hecho de omitir la versi≤n elimina la necesidad de editar el archivo de configuraci≤n de PAM si, mßs adelante, se actualiza el archivo de bibliotecas. 
Si utiliza el Servidor de autentificaci≤n de AFS (proceso kaserver): 

  
   # cp /cdrom/sun4x_56/lib/pam_afs.so.1 .
  
   # ln -s pam_afs.so.1 pam_afs.so   

Si utiliza una implantaci≤n Kerberos de la autentificaci≤n de AFS: 

     
   # cp /cdrom/sun4x_56/lib/pam_afs.krb.so.1 .
  
   # ln -s pam_afs.krb.so.1 pam_afs.so
   

Edite la secci≤n Authentication management del archivo de configuraci≤n de PAM de Solaris, por convenio /etc/pam.conf. Las entradas de esta secci≤n tienen el valor auth en el segundo campo. 
En primer lugar, edite las entradas estßndar, que hacen referencia al m≤dulo PAM de Solaris (habitualmente, el archivo /usr/lib/security/pam_unix.so.1) en el cuarto campo. Para cada servicio en el que desee que se utilice la autentificaci≤n de AFS, edite el tercer campo de la entrada correspondiente de forma que contenga el valor optional. El archivo pam.conf de la distribuci≤n de Solaris suele incluir entradas estßndar, por ejemplo, para los servicios rlogin y rsh. 

Si hay servicios en los que desea que se utilice la autentificaci≤n de AFS pero para los cuales el archivo pam.conf no incluye todavφa una entrada estßndar, debe crear dicha entrada y colocar el valor optional en el tercer campo de la misma. Por ejemplo, el archivo pam.conf de Solaris no suele incluir entradas estßndar para los servicios ftp ni telnet. 

Seguidamente, cree una entrada relativa a AFS para cada servicio, colocßndola inmediatamente debajo de la entrada estßndar. El ejemplo siguiente muestra el aspecto de la secci≤n Authentication Management despuΘs de haber editado o creado entradas para los servicios mencionados anteriormente. Observe que las entradas de AFS del ejemplo aparecen en dos lφneas ·nicamente para que se puedan leer sin dificultad. 

  
   login   auth  optional  /usr/lib/security/pam_unix.so.1
   login   auth  optional  /usr/lib/security/pam_afs.so       \
         try_first_pass  ignore_root  setenv_password_expires
   rlogin  auth  optional  /usr/lib/security/pam_unix.so.1
   rlogin  auth  optional  /usr/lib/security/pam_afs.so       \
         try_first_pass  ignore_root  setenv_password_expires
   rsh     auth  optional  /usr/lib/security/pam_unix.so.1
   rsh     auth  optional  /usr/lib/security/pam_afs.so       \
         try_first_pass  ignore_root		
   ftp     auth  optional  /usr/lib/security/pam_unix.so.1
   ftp     auth  optional  /usr/lib/security/pam_afs.so       \
         try_first_pass  ignore_root
   telnet  auth  optional  /usr/lib/security/pam_unix.so.1
   telnet  auth  optional  /usr/lib/security/pam_afs.so       \
         try_first_pass  ignore_root  setenv_password_expires
   

Si utiliza Common Desktop Environment (CDE) en la mßquina y desea que los usuarios obtengan una se±al de AFS al inicio de sesi≤n, a±ada o edite tambiΘn las cuatro entradas siguientes de la secci≤n Authentication management. Observe que las entradas relativas a AFS del ejemplo aparecen en dos lφneas ·nicamente para que se puedan leer sin dificultad. 
   
   dtlogin   auth  optional  /usr/lib/security/pam_unix.so.1
   dtlogin   auth  optional  /usr/lib/security/pam_afs.so     \
         try_first_pass  ignore_root
   dtsession  auth  optional /usr/lib/security/pam_unix.so.1
   dtsession  auth  optional /usr/lib/security/pam_afs.so     \
         try_first_pass  ignore_root
   

Algunas distribuciones de Solaris incluyen un script que localiza y elimina los archivos innecesarios de diversos sistemas de archivos. Su ubicaci≤n convencional es /usr/lib/fs/nfs/nfsfind. Generalmente, el script utiliza un argumento del mandato find para definir en quΘ sistemas de archivos se debe buscar. En este paso se modifica dicho mandato para excluir el directorio /afs. De no hacerlo, el mandato recorre el espacio de archivos AFS de cada una de las cΘlulas a las que se puede acceder desde la mßquina, operaci≤n que puede tardar muchas horas. Las alteraciones siguientes constituyen posibilidades, pero debe verificar que son apropiadas para su cΘlula. 
La primera alteraci≤n posible consiste en a±adir el distintivo -local al mandato existente, de forma que tenga el aspecto siguiente: 

  
   find $dir -local -name .nfs\* -mtime +7 -mount -exec rm -f {} \;   

Otra alternativa consiste en excluir los directorios cuyos nombres empiecen por la letra a min·scula o un carßcter no alfabΘtico. 

  
   find /[A-Zb-z]*  resto del mandato existente

No utilice el mandato siguiente, que contin·a buscando en el directorio /afs un subdirectorio de tipo 4.2. 

  
   find / -fstype 4.2     /* no utilizar */
   

Siga con el apartado Inicio del Servidor BOS (o, si estß consultando estas instrucciones mientras instala una mßquina servidor de archivos adicional, regrese al apartado Inicio de los programas de servidor). 

--------------------------------------------------------------------------------

Inicio del Servidor BOS
Ahora ya estß preparado para iniciar los procesos de servidor AFS en esta mßquina. Empiece por copiar los binarios de servidor AFS del CD-ROM en la ubicaci≤n de disco local convencional, el directorio /usr/afs/bin. Las instrucciones siguientes tambiΘn crean archivos en otros subdirectorios del directorio /usr/afs. 

A continuaci≤n, emita el mandato bosserver para inicializar el Servidor Basic OverSeer (BOS), que supervisa y controla otros procesos de servidor AFS en su mßquina servidor. Incluya el distintivo -noauth para inhabilitar la comprobaci≤n de la autorizaci≤n. Dado que todavφa no ha configurado los mecanismos de autentificaci≤n y autorizaci≤n de AFS en la cΘlula, el Servidor BOS no puede realizar una comprobaci≤n de la autorizaci≤n tal como lo hace durante un funcionamiento normal. En modalidad sin autorizaci≤n, no verifica la identidad ni el privilegio del emisor de un mandato bos, por lo que realiza cualquier operaci≤n para cualquier emisor. 

Una inhabilitaci≤n de la comprobaci≤n de la autorizaci≤n compromete seriamente la seguridad de la cΘlula. Debe completar todos los pasos posteriores en una pasada ininterrumpida y no debe dejar la mßquina desatendida hasta que reinicie el Servidor BOS habilitando la comprobaci≤n de la seguridad, tal como se indica en el apartado Verificaci≤n del script de inicializaci≤n de AFS. 

Cuando realiza una inicializaci≤n por primera vez, el Servidor BOS crea los directorios y archivos siguientes, estableciendo como propietario el superusuario local root, asφ como bits de modalidad para limitar las posibilidades de grabaci≤n (y, en determinados casos, de lectura) de los mismos. Para obtener una descripci≤n del contenido y de las funciones de estos directorios y archivos, consulte el capφtulo de la publicaci≤n IBM AFS Administration Guide que trata sobre la administraci≤n de mßquinas servidor. Para obtener una explicaci≤n adicional de los valores de los bits de modalidad, consulte el apartado Protecci≤n de directorios delicados de AFS. 

/usr/afs/db 
/usr/afs/etc/CellServDB 
/usr/afs/etc/ThisCell 
/usr/afs/local 
/usr/afs/logs 
El Servidor BOS tambiΘn crea enlaces simb≤licos denominados /usr/vice/etc/ThisCell y /usr/vice/etc/CellServDB con los archivos correspondientes del directorio /usr/afs/etc. Los intΘrpretes de mandatos de AFS consultan los archivos CellServDB y ThisCell del directorio /usr/vice/etc porque generalmente se ejecutan en mßquinas cliente. En las mßquinas que s≤lo son servidores AFS (tal como es esta mßquina actualmente), los archivos s≤lo residen en el directorio /usr/afs/etc; los enlaces permiten que los intΘrpretes de mandatos recuperen la informaci≤n que necesitan. Las instrucciones posteriores para instalar el funcionamiento de cliente sustituyen los enlaces por archivos reales. 

En el directorio local /cdrom, monte el CD-ROM de AFS para el tipo de sistema de esta mßquina, si no estß montado todavφa. Para obtener instrucciones sobre c≤mo montar los CD-ROM (ya sea local o remotamente por medio de NFS), consulte la documentaci≤n del sistema operativo. 
Copie archivos del CD-ROM en el directorio local /usr/afs. 
   
   # cd /cdrom/nombre_sist/root.server/usr/afs
   
   # cp -rp  *  /usr/afs
   

Emita el mandato bosserver. Incluya el distintivo -noauth para inhabilitar la comprobaci≤n de la autorizaci≤n. 

   
   # /usr/afs/bin/bosserver -noauth &
   

Verifique que el Servidor BOS haya creado /usr/vice/etc/ThisCell y /usr/vice/etc/CellServDB como enlaces simb≤licos con los archivos correspondientes del directorio /usr/afs/etc. 
   
   # ls -l  /usr/vice/etc

Si /usr/vice/etc/ThisCell o /usr/vice/etc/CellServDB no existen, o si no son enlaces, emita los mandatos siguientes. 

   
   # cd /usr/vice/etc
   
   # ln -s /usr/afs/etc/ThisCell
   
   # ln -s /usr/afs/etc/CellServDB 
    


--------------------------------------------------------------------------------

Definici≤n del nombre de cΘlula y de la calidad de miembro para procesos de servidor
Asigne ahora el nombre de la cΘlula. El capφtulo de la publicaci≤n IBM AFS Administration Guide que trata sobre la configuraci≤n y administraci≤n de cΘlulas explica las consideraciones importantes, expone porquΘ resulta difφcil cambiar el nombre y perfila las restricciones sobre el formato de los nombres. Dos de las restricciones mßs importantes son que el nombre no puede incluir letras may·sculas ni mßs de 64 caracteres. 

Utilice el mandato bos setcellname para asignar el nombre de cΘlula. Este mandato crea dos archivos: 

/usr/afs/etc/ThisCell, que define la calidad de miembro de la cΘlula de esta mßquina 
/usr/afs/etc/CellServDB, que lista las mßquinas servidor de base de datos de la cΘlula; la mßquina mencionada en la lφnea de mandatos se coloca automßticamente en la lista 
Nota: En las instrucciones siguientes, y en todas las contenidas en esta guφa, sustituya el argumento nombre mßquina por el nombre de sistema principal completamente cualificado de la mßquina que estß instalando (por ejemplo, fs1.abc.com). Sustituya el argumento nombre cΘlula por el nombre completo de la cΘlula (por ejemplo, abc.com).  

Emita el mandato bos setcellname para establecer el nombre de cΘlula. 
   
   # cd /usr/afs/bin
      
   # ./bos setcellname &lt;nombre mßquina> &lt;nombre cΘlula> -noauth

Dado que no se ha autentificado y que estß inhabilitada la comprobaci≤n de la autorizaci≤n, el intΘrprete de mandatos bos posiblemente generarß mensajes de error sobre la imposibilidad de obtener certificados y de funcionar si no se ha autentificado. Puede hacer caso omiso de los mensajes. 

Emita el mandato bos listhosts para verificar que la mßquina que estß instalando estß ahora registrada como primera mßquina servidor de base de datos de la cΘlula. 
   
   # ./bos listhosts &lt;nombre mßquina> -noauth
   Cell name is nombre_cΘlula
       Host 1 is nombre_mßquina
   


--------------------------------------------------------------------------------

Inicio de los procesos de servidor de base de datos
A continuaci≤n, utilice el mandato bos create para crear entradas para los cuatro procesos de servidor de base de datos en el archivo /usr/afs/local/BosConfig y empiece a ejecutarlos. Los cuatro procesos s≤lo se ejecutan en mßquinas servidor de base de datos: 

El Servidor de autentificaci≤n (proceso kaserver) mantiene la Base de datos de autentificaci≤n 
El Servidor de copia de seguridad (proceso buserver) mantiene la Base de datos de copia de seguridad 
El Servidor de protecci≤n (proceso ptserver) mantiene la Base de datos de protecci≤n 
El Servidor de ubicaci≤n de vol·menes (VL) (proceso vlserver) mantiene la Base de datos de ubicaci≤n de vol·menes (VLDB) 
Nota: El software de autentificaci≤n y autorizaci≤n de AFS se basa en algoritmos y otros procedimientos conocidos como Kerberos, desarrollados originalmente por Project Athena en el Massachusetts Institute of Technology. En algunas cΘlulas se elige sustituir el Servidor de autentificaci≤n de AFS y otros protocolos relativos a la seguridad por Kerberos, tal como se obtiene directamente de Project Athena o de otras fuentes. Si asφ lo desea, p≤ngase ahora en contacto con el grupo de soporte del producto AFS para averiguar las modificaciones que es necesario efectuar en la instalaci≤n.  

Las instrucciones restantes de este capφtulo incluyen el argumento -cell en todos los mandatos pertinentes. Proporcione el nombre de cΘlula que ha asignado en el apartado Definici≤n del nombre de cΘlula y de la calidad de miembro para procesos de servidor. Si un mandato aparece en varias lφneas, s≤lo es asφ para que se pueda leer sin dificultad. 

Emita el mandato bos create para iniciar el Servidor de autentificaci≤n. El directorio de trabajo actual sigue siendo /usr/afs/bin. 
   
   # ./bos create &lt;nombre mßquina> kaserver simple /usr/afs/bin/kaserver  \
                   -cell &lt;nombre cΘlula>  -noauth   

Puede hacer caso omiso de los mensajes que le indiquen que a±ada Kerberos al archivo /etc/services; AFS utiliza un valor por omisi≤n que hace que dicha adici≤n sea innecesaria. TambiΘn puede hacer caso omiso de los mensajes relativos a una anomalφa en la autentificaci≤n. 

Emita el mandato bos create para iniciar el Servidor de copia de seguridad. 
   
   # ./bos create &lt;nombre mßquina> buserver simple /usr/afs/bin/buserver  \
                   -cell &lt;nombre cΘlula>  -noauth
   

Emita el mandato bos create para iniciar el Servidor de protecci≤n. 
   
   # ./bos create &lt;nombre mßquina> ptserver simple /usr/afs/bin/ptserver  \
                   -cell &lt;nombre cΘlula>  -noauth
   

Emita el mandato bos create para iniciar el Servidor de VL. 
   
   # ./bos create &lt;nombre mßquina> vlserver simple /usr/afs/bin/vlserver  \
                   -cell &lt;nombre cΘlula>  -noauth
   


--------------------------------------------------------------------------------

Inicializaci≤n de la seguridad de la cΘlula
Inicialice ahora los mecanismos de seguridad de la cΘlula. Empiece por crear las dos entradas iniciales siguientes en la Base de autentificaci≤n: 

Un perfil de administraci≤n genΘrico, llamado por convenio admin. Si decide asignarle otro nombre, sustit·yalo en el resto de este documento. 
DespuΘs de completar la instalaci≤n de la primera mßquina, puede continuar haciendo que todos los administradores utilicen el perfil admin, o puede crear un perfil de administraci≤n independiente para cada uno de ellos. El ·ltimo esquema implica algo mßs de actividad general, pero proporciona un seguimiento de comprobaci≤n mßs informativo para las operaciones administrativas. 

La entrada para los procesos de servidor AFS, llamada afs. Ning·n usuario inicia sesiones bajo esta identidad, pero el m≤dulo Servicio de otorgamiento de certificados (TGS) del Servidor de autentificaci≤n utiliza la clave asociada para cifrar los certificados de servidor que otorga a los clientes AFS para su presentaci≤n a procesos de servidor durante una autentificaci≤n mutua. (El capφtulo de la publicaci≤n IBM AFS Administration Guide que trata sobre la configuraci≤n y administraci≤n de cΘlulas describe la funci≤n de las claves de cifrado de servidor en la autentificaci≤n mutua.) 
En el paso 7, coloque tambiΘn la clave de cifrado inicial del servidor AFS en el archivo /usr/afs/etc/KeyFile. Los procesos de servidor AFS consultan este archivo para averiguar la clave de cifrado del servidor cuando necesitan descifrar certificados de servidor. 

TambiΘn se emiten varios mandatos que permiten que el nuevo usuario admin emita mandatos privilegiados de todos los juegos de AFS. 

Las instrucciones siguientes no configuran todos los mecanismos de seguridad relacionadas con el Sistema de copia de seguridad de AFS. Consulte el capφtulo de la publicaci≤n IBM AFS Administration Guide que trata sobre la configuraci≤n del Sistema de copia de seguridad. 

Entre en la modalidad interactiva kas. Dado que la mßquina estß en una modalidad en que no se comprueba la autorizaci≤n, incluya el distintivo -noauth para suprimir el mensaje de solicitud habitual de contrase±a del Servidor de autentificaci≤n. 
   
   # kas  -cell &lt;nombre cΘlula>  -noauth
   ka>
  

Emita el mandato kas create para crear, en la Base de datos de autentificaci≤n, las entradas denominadas admin y afs. 
No proporcione ninguna contrase±a en la lφnea de mandatos. En lugar de esto, proporci≤nelas como contrase±a_afs y contrase±a_admin en respuesta a los mensajes de solicitud del intΘrprete de mandatos kas tal como se muestra, de forma que no aparezcan en la corriente de salida estßndar. 

S≤lo es necesario entrar la serie contrase±a_afs en este paso y en el paso 7, por lo que debe proporcionar un valor que sea tan largo y complejo como sea posible, que preferentemente incluya n·meros, signos de puntuaci≤n y letras may·sculas y min·sculas. Elabore tambiΘn una contrase±a_admin tan larga y compleja como sea posible, pero recuerde que los administradores la tendrßn que entrar con frecuencia. Ambas contrase±as deben tener una longitud mφnima de seis caracteres. 

   
   ka> create afs 
   initial_password:  contrase±a_afs
   Verifying, please re-enter initial_password: contrase±a_afs
    
   ka> create admin
   initial_password: contrase±a_admin
   Verifying, please re-enter initial_password: contrase±a_admin
   

Emita el mandato kas examine para visualizar la entrada afs. La salida incluye una suma de comprobaci≤n generada por el cifrado de una constante con la clave de cifrado del servidor deducida de la serie contrase±a_afs. En el paso 8 se emite el mandato bos listkeys para verificar que la suma de comprobaci≤n incluida en la salida coincide con la suma de comprobaci≤n de esta salida. 
   
   ka> examine afs
   User data for afs
    key (0) cksum is suma_comprobaci≤n . . .
   

Emita el mandato kas setfields para activar el distintivo ADMIN en la entrada admin. Esto permite que el usuario admin emita mandatos privilegiados kas. A continuaci≤n, emita el mandato kas examine para verificar que el distintivo ADMIN aparece entre parΘntesis en la primera lφnea de salida, tal como se muestra en el ejemplo. 
   
   ka> setfields admin -flags admin
   
   ka> examine admin 
   User data for admin (ADMIN) . . .
     

Emita el mandato kas quit para salir de la modalidad interactiva de kas. 
   
   ka> quit
   

Emita el mandato bos adduser para a±adir el usuario admin al archivo /usr/afs/etc/UserList. Esto permite que el usuario admin emita mandatos privilegiados bos y vos. 
   
   # ./bos adduser &lt;nombre mßquina> admin -cell &lt;nombre cΘlula> -noauth
   

Emita el mandato bos addkey para definir la clave de cifrado de servidor AFS en el archivo /usr/afs/etc/KeyFile. 
No proporcione la contrase±a en la lφnea de mandatos. En lugar de ello, proporci≤nela como contrase±a_afs en respuesta a los mensajes de solicitud del intΘrprete de mandatos bos, tal como se muestra. Proporcione la misma serie que en el paso 2. 

   
   # ./bos addkey &lt;nombre mßquina> -kvno 0 -cell &lt;nombre cΘlula>  -noauth
   Input key: contrase±a_afs
   Retype input key: contrase±a_afs
   

Emita el mandato bos listkeys para verificar que la suma de comprobaci≤n de la nueva clave en el archivo KeyFile es igual que la suma de comprobaci≤n de la clave en la entrada afs de la Base de datos de autentificaci≤n, que ha visualizado en el paso 3. 
   
   # ./bos listkeys &lt;nombre mßquina> -cell &lt;nombre cΘlula> -noauth 
   key 0 has cksum suma_comprobaci≤n    

Puede hacer caso omiso de los mensajes de error que indiquen que bos no ha podido obtener certificados o que la autentificaci≤n ha fallado. 

Si las claves son diferentes, emita los mandatos siguientes asegurßndose de que la serie contrase±a_afs sea igual en todos los casos. Las series suma_comprobaci≤n informadas por los mandatos kas examine y bos listkeys deben coincidir; de no ser asφ, repita estas instrucciones hasta que lo consiga, utilizando el argumento -kvno para incrementar cada vez el n·mero de versi≤n de la clave. 

   
   # ./kas  -cell &lt;nombre cΘlula>  -noauth
       
   ka> setpassword afs -kvno 1 
   new_password:  contrase±a_afs
   Verifying, please re-enter initial_password: contrase±a_afs
   
   ka> examine afs
   User data for afs
    key (1) cksum is suma_comprobaci≤n . . .
  
   ka> quit
  
   # ./bos addkey &lt;nombre mßquina> -kvno 1 -cell &lt;nombre cΘlula> -noauth
   Input key: contrase±a_afs
   Retype input key: contrase±a_afs
   
   # ./bos listkeys &lt;nombre mßquina> -cell &lt;nombre cΘlula> -noauth 
   key 1 has cksum suma_comprobaci≤n
   

Emita el mandato pts createuser para crear, en la Base de datos de protecci≤n, una entrada para el usuario admin. 
Por omisi≤n, el Servidor de protecci≤n asigna el UID 1 (uno) de AFS al usuario admin, puesto que es la primera entrada de usuario que se crea. Si el archivo de contrase±as local (/etc/passwd o equivalente) ya contiene una entrada para admin que le asigna un UID de UNIX distinto de 1, es mejor utilizar el argumento -id con el mandato pts createuser para hacer que el nuevo UID de AFS coincida con el UID de UNIX existente. De no hacerlo asφ, es mejor aceptar el valor por omisi≤n. 

   
   # ./pts createuser -name admin -cell &lt;nombre cΘlula> [-id &lt;AFS UID>]  -noauth
   User admin has id AFS UID
   

Emita el mandato pts adduser, para hacer que el usuario admin sea miembro del grupo system:administrators, y el mandato pts membership, para verificar la calidad de nuevo miembro. La calidad de miembro del grupo permite que el usuario admin emita mandatos privilegiados pts y algunos mandatos privilegiados fs. 
   
   # ./pts adduser admin system:administrators -cell &lt;nombre cΘlula> -noauth
   
   # ./pts membership admin -cell  &lt;nombre cΘlula>  -noauth
   Groups admin (id: 1) is a member of:
     system:administrators
   

Emita el mandato bos restart con el distintivo -all para reiniciar los procesos de servidor de base de datos, de forma que empiecen a utilizar la nueva clave de cifrado de servidor. 
   
   # ./bos restart &lt;nombre mßquina> -all -cell &lt;nombre cΘlula> -noauth
   


--------------------------------------------------------------------------------

Inicio del Servidor de archivos, del Servidor de vol·menes y del Recuperador
Inicie el proceso fs, que consta del Servidor de archivos, el Servidor de vol·menes y el Recuperador (procesos fileserver, volserver y salvager). 

Emita el mandato bos create para iniciar el proceso fs. El mandato aparece aquφ en varias lφneas ·nicamente para que se pueda leer sin dificultad. 
   
   # ./bos create  &lt;nombre mßquina> fs fs /usr/afs/bin/fileserver   \
                   /usr/afs/bin/volserver /usr/afs/bin/salvager  \
                   -cell &lt;nombre cΘlula>  -noauth   

Algunas veces aparece un mensaje de inicializaci≤n de la Base de datos de ubicaci≤n de vol·menes (VLDB), junto con una o mßs instancias de un mensaje de error parecido al siguiente: 

   
   FSYNC_clientInit temporary failure (will retry)   

Este mensaje aparece este cuando el proceso volserver intenta comenzar antes de que el proceso fileserver haya finalizado su inicializaci≤n. Antes de continuar, espere unos minutos despuΘs del ·ltimo de dichos mensajes a fin de garantizar que ambos procesos se hayan iniciado satisfactoriamente. 

Puede verificar que el proceso fs se ha iniciado satisfactoriamente emitiendo el mandato bos status. La salida del mismo menciona dos proc starts. 

  
   # ./bos status &lt;nombre mßquina> fs -long -noauth
   

La acci≤n que se debe emprender seguidamente dependerß de si alguna vez ha ejecutado mßquinas servidor de archivos AFS en la cΘlula: 
Si estß instalando la primera mßquina servidor AFS que ha existido en la cΘlula (es decir, si no estß actualizando el software de AFS a partir de una versi≤n anterior), cree el primer volumen AFS, root.afs. 
Sustituya el argumento nombre partici≤n por el nombre de una de las particiones de servidor AFS de la mßquina (por ejemplo, /vicepa). 

  
   # ./vos create  &lt;nombre mßquina> &lt;nombre partici≤n> root.afs   \
                   -cell &lt;nombre cΘlula>  -noauth   

El Servidor de vol·menes produce un mensaje que confirma que ha creado el volumen en la partici≤n especificada. Puede hacer caso omiso de los mensajes de error que indiquen que faltan se±ales o que la autentificaci≤n ha fallado. 

Si en la cΘlula existen vol·menes y mßquinas servidor de archivos AFS, emita los mandatos vos syncvldb y vos syncserv para sincronizar la VLDB con el estado real de los vol·menes de la mßquina local. Para seguir el proceso de la operaci≤n de sincronizaci≤n, que puede tardar varios minutos, utilice el distintivo -verbose. 
  
   # ./vos syncvldb &lt;nombre mßquina> -cell &lt;nombre cΘlula> -verbose  -noauth 
  
   # ./vos syncserv &lt;nombre mßquina> -cell &lt;nombre cΘlula> -verbose  -noauth   

Puede hacer caso omiso de los mensajes de error que indiquen que faltan se±ales o que la autentificaci≤n ha fallado. 


--------------------------------------------------------------------------------

Inicio de la porci≤n de servidor del Servidor de actualizaci≤n
Inicie la porci≤n de servidor del Servidor de actualizaci≤n (proceso upserver) para distribuir el contenido de los directorios de esta mßquina a otras mßquinas servidor de la cΘlula. Se activa cuando se configura la porci≤n de cliente del Servidor de actualizaci≤n en mßquinas servidor adicionales. 

La distribuci≤n del contenido del directorio /usr/afs/etc hace de esta mßquina la mßquina de control del sistema de la cΘlula. Las otras mßquinas servidor de la cΘlula ejecutan el proceso upclientetc (una instancia de la porci≤n de cliente del Servidor de actualizaci≤n) para recuperar los archivos de configuraci≤n. Utilice el argumento -crypt del mandato de inicializaci≤n upserver para especificar que el Servidor de actualizaci≤n s≤lo distribuya el contenido del directorio /usr/afs/etc en formato cifrado, tal como se muestra en la instrucci≤n siguiente. Varios de los archivos del directorio, especialmente el archivo KeyFile, resultan cruciales para la seguridad de la cΘlula y, por consiguiente, nunca deben cruzar la red sin estar cifrados. 

(Puede elegir no configurar una mßquina de control del sistema, en cuyo caso debe actualizar los archivos de configuraci≤n del directorio /usr/afs/etc de cada mßquina servidor individualmente. Los mandatos bos utilizados para este prop≤sito cifran los datos antes de enviarlos por la red.) 

La distribuci≤n del contenido del directorio /usr/afs/bin a otras mßquinas servidor del mismo tipo de sistema hace de esta mßquina una mßquina de distribuci≤n de binarios. Las otras mßquinas servidor del mismo tipo de sistema ejecutan el proceso upclientbin (una instancia de la porci≤n de cliente del Servidor de actualizaci≤n) para recuperar los binarios. 

Los binarios del directorio /usr/afs/bin no son delicados, por lo que no es necesario cifrarlos antes de transferirlos por la red. Incluya el argumento -clear en el mandato de inicializaci≤n upserver para especificar que el Servidor de actualizaci≤n distribuye el contenido del directorio /usr/afs/bin en formato descifrado a no ser que un proceso upclientbin solicite una transferencia cifrada. 

Observe que las porciones de servidor y cliente del Servidor de actualizaci≤n siempre se autentifican mutuamente, aunque utilice los argumentos -clear o -crypt. Esto protege en cierta medida sus comunicaciones frente a escuchas escondidas. 

Para obtener mßs informaci≤n sobre los procesos upclient y upserver, remφtase a las pßginas de consulta correspondientes a los mismos en la publicaci≤n IBM AFS Administration Reference. Los mandatos aparecen aquφ en varias lφneas ·nicamente para que se puedan leer sin dificultad. 

Emita el mandato bos create para iniciar el proceso upserver. 
   
   # ./bos create  &lt;nombre mßquina upserver simple  \
             "/usr/afs/bin/upserver  -crypt /usr/afs/etc    \
             -clear /usr/afs/bin" -cell &lt;nombre cΘlula>  -noauth 
   


--------------------------------------------------------------------------------

Inicio del controlador para NTPD
El hecho de mantener sincronizados los relojes de todas las mßquinas servidor y cliente de la cΘlula resulta crucial para varias funciones, y en especial para un funcionamiento correcto de la tecnologφa de bases de datos distribuidas de AFS, Ubik. El capφtulo de la publicaci≤n IBM AFS Administration Guide que trata sobre la administraci≤n de mßquinas servidor explica c≤mo un desvφo en el tiempo puede alterar el rendimiento de Ubik y ocasionar interrupciones del servicio en la cΘlula. 

La distribuci≤n de AFS incluye una versi≤n del Network Time Protocol Daemon (NTPD) para sincronizar los relojes en mßquinas servidor. Si en la mßquina todavφa no hay un programa de sincronizaci≤n de horas en ejecuci≤n, en este apartado se inicia el proceso runntp para configurar NTPD para utilizarlo con AFS. Nota: No ejecute el proceso runntp si en la mßquina ya se estß ejecutando NTPD u otro protocolo de sincronizaci≤n de horas. Algunas versiones de sistemas operativos ejecutan, por omisi≤n, un programa de sincronizaci≤n de horas, tal como se detalla en las IBM AFS Release Notes. 
Un intento de ejecutar varias instancias de NTPD genera un error. El hecho de ejecutar NTPD junto con otro protocolo de sincronizaci≤n de horas resulta innecesario y puede ocasionar inestabilidad en el establecimiento del reloj. 
 


Si ejecuta el proceso runntp y la cΘlula tiene una conectividad de red fiable con mßquinas que se encuentran fuera de la cΘlula, lo convencional es configurar la primera mßquina AFS de forma que consulte una fuente horaria externa a la cΘlula. Mßs adelante, cuando se instala el programa runntp en otras mßquinas servidor de la cΘlula, Θste configura NTPD para elegir una fuente horaria al azar entre las mßquinas servidor de base de datos listadas en el archivo /usr/afs/etc/CellServDB. Por esta raz≤n, la sincronizaci≤n de horas funciona de manera encadenada: esta mßquina servidor de base de datos consulta una fuente horaria externa a la cΘlula, las mßquinas servidor de base de datos consultan a la mßquina, de entre todas, que tiene acceso a la hora mßs exacta (el propio NTPD incluye c≤digo para determinar este aspecto) y cada mßquina servidor que no lo es de base de datos consulta una mßquina servidor de base de datos local aleatoria del archivo /usr/afs/etc/CellServDB. Si en alg·n momento decide eliminar de esta mßquina el funcionamiento de servidor de base de datos, es mejor transferir la responsabilidad de consultar una fuente horaria externa a una mßquina servidor de base de datos que siga funcionando. 

Si la cΘlula no tiene conectividad de red con mßquinas externas, o si la conectividad no es fiable, incluya el distintivo -localclock en el mandato runntp, tal como se indica en las instrucciones siguientes. Este distintivo indica a NTPD que confφe en el reloj interno de la mßquina cuando todas las fuentes horarias externas sean inaccesibles. El mandato runntp tiene otros argumentos que posiblemente resultarßn ·tiles dada la configuraci≤n de la cΘlula; consulte la publicaci≤n IBM AFS Administration Reference. 

La elecci≤n de una fuente horaria externa apropiada es importante, pero implica mßs consideraciones que las que se pueden tratar aquφ. Si necesita ayuda para seleccionar una fuente, p≤ngase en contacto con el grupo de soporte del producto AFS. 

Puesto que el proceso runntp inicializa NTPD, algunas veces aparecen mensajes de rastreo en la corriente de salida estßndar. Puede hacer caso omiso de ellos, pero pueden resultar informativos si se conoce el funcionamiento de NTPD. 

Emita el mandato bos create para iniciar el proceso runntp. Sustituya el argumento sist_princ por el nombre de sistema principal completamente cualificado, o la direcci≤n IP, de una o mßs mßquinas que se encuentren fuera de la cΘlula y vayan a servir de fuentes horarias. Separe los nombres mediante un espacio. 
Si la cΘlula suele tener una conectividad de red fiable con una fuente horaria externa, utilice el mandato siguiente: 
   
   # ./bos create  &lt;nombre mßquina>  runntp simple   \
        "/usr/afs/bin/runntp &lt;sist_princ>+"  -cell &lt;nombre cΘlula>  -noauth
   

Si la cΘlula no tiene una conectividad de red fiable con una fuente horaria externa, utilice el mandato siguiente: 
   
   # ./bos create   &lt;nombre mßquina>   runntp simple   \
        "/usr/afs/bin/runntp -localclock"  -cell &lt;nombre cΘlula>  -noauth
   

Si la cΘlula tiene conectividad de red con una fuente horaria externa pero la conexi≤n de la red se interrumpe con frecuencia, utilice el mandato siguiente: 
   
   # ./bos create   &lt;nombre mßquina>   runntp simple   \
         "/usr/afs/bin/runntp -localclock &lt;sist_princ>+"  \
                   -cell &lt;nombre cΘlula>  -noauth
   


--------------------------------------------------------------------------------

Visi≤n general: Instalaci≤n del funcionamiento de cliente
La mßquina que estß instalando es ahora una mßquina servidor de archivos AFS, una mßquina servidor de base de datos y una mßquina de distribuci≤n de binarios. Haga de ella una mßquina cliente realizando las tareas siguientes: 

Defina la calidad de miembro de la cΘlula por parte de la mßquina para procesos cliente 
Cree la versi≤n de cliente del archivo CellServDB 
Defina la ubicaci≤n y el tama±o de la antememoria 
Cree el directorio /afs e inicie el Gestor de antememoria 

--------------------------------------------------------------------------------

Copia de archivos cliente en el disco local
Antes de instalar y configurar el cliente AFS, copie los archivos necesarios desde el CD-ROM de AFS en el directorio local /usr/vice/etc. 

En el directorio local /cdrom, monte el CD-ROM de AFS para el tipo de sistema de esta mßquina, si no estß montado todavφa. Para obtener instrucciones sobre c≤mo montar los CD-ROM (ya sea local o remotamente por medio de NFS), consulte la documentaci≤n del sistema operativo. 
Copie archivos en el directorio local /usr/vice/etc. 
Este paso coloca una copia del script de inicializaci≤n de AFS (y de los archivos relacionados, si es pertinente) en el directorio /usr/vice/etc. En las instrucciones precedentes para incorporar AFS en el kernel, se ha copiado el script directamente en la ubicaci≤n convencional del sistema operativo para archivos de inicializaci≤n. Cuando incorpore AFS en la secuencia de arranque de la mßquina, en un paso posterior, podrß enlazar los dos archivos. 

En algunos tipos de sistema que utilizan un programa cargador dinßmico de kernel, previamente habrß copiado los archivos de bibliotecas de AFS en un subdirectorio del directorio /usr/vice/etc. En otros tipos de sistema, habrß copiado el archivo de bibliotecas de AFS apropiado directamente en el directorio al cual accede el sistema operativo. Los mandatos siguientes no copian ni vuelven a copiar los archivos de bibliotecas de AFS en el directorio /usr/vice/etc, puesto que en algunos tipos de sistema los archivos de bibliotecas consumen una gran cantidad de espacio. Si desea copiarlos, a±ada el distintivo -r al primer mandato cp y sßltese el segundo mandato cp. 

   
   # cd /cdrom/nombre_sist/root.client/usr/vice/etc
   
   # cp -p  *  /usr/vice/etc
  
   # cp -rp  C  /usr/vice/etc
   


--------------------------------------------------------------------------------

Definici≤n de la calidad de miembro de la cΘlula para procesos de cliente
Cada mßquina cliente AFS tiene una copia del archivo /usr/vice/etc/ThisCell en su disco local para definir la calidad de miembro de la cΘlula por parte de la mßquina para los programas de cliente AFS que se ejecuten en ella. El archivo ThisCell que ha creado en el directorio /usr/afs/etc (en el apartado Definici≤n del nombre de cΘlula y de la calidad de miembro para procesos de servidor) s≤lo lo utilizan los procesos de servidor. 

Entre otras funciones, el archivo ThisCell de una mßquina cliente determina lo siguiente: 

La cΘlula en la que se autentifican los usuarios cuando inician una sesi≤n en la mßquina, suponiendo que Θsta utilice un programa de utilidad de inicio de sesi≤n modificado por AFS 
La cΘlula en la que se autentifican por omisi≤n los usuarios cuando emiten el mandato klog 
La calidad de miembro de la cΘlula por parte de los procesos de servidor AFS con los que los intΘrpretes de mandatos de AFS de esta mßquina establecen contacto por omisi≤n 
Cambie al directorio /usr/vice/etc y elimine el enlace simb≤lico creado en el apartado Inicio del Servidor BOS. 
      
   # cd /usr/vice/etc
   
   # rm ThisCell
   

Cree el archivo ThisCell como copia del archivo /usr/afs/etc/ThisCell. El hecho de definir la misma cΘlula local para ambos procesos, de servidor y de cliente, conduce al rendimiento mßs coherente posible de AFS. 
   
   # cp  /usr/afs/etc/ThisCell  ThisCell
   


--------------------------------------------------------------------------------

Creaci≤n del archivo CellServDB de cliente
El archivo /usr/vice/etc/CellServDB del disco local de una mßquina cliente lista las mßquinas servidor de base de datos para cada una de las cΘlulas con las que el Gestor de antememoria puede contactar. Si en el archivo no existe ninguna entrada para una cΘlula, o si la lista de mßquinas servidor de base de datos es incorrecta, los usuarios que trabajen en esta mßquina no podrßn acceder a la cΘlula. El capφtulo de la publicaci≤n IBM AFS Administration Guide que trata sobre la administraci≤n de mßquinas cliente explica c≤mo mantener el archivo despuΘs de crearlo. 

Puesto que el programa afsd inicializa el Gestor de antememoria, copia el contenido del archivo CellServDB en la memoria del kernel. El Gestor de antememoria siempre consulta la lista de la memoria del kernel, en lugar de consultar el propio archivo CellServDB. Entre rearranques de la mßquina, puede utilizar el mandato fs newcell para actualizar directamente la lista de la memoria del kernel; consulte el capφtulo de la publicaci≤n IBM AFS Administration Guide que trata sobre la administraci≤n de mßquinas cliente. 

La distribuci≤n de AFS incluye el archivo CellServDB.sample y ya lo ha copiado en el directorio /usr/vice/etc. Este archivo incluye una entrada para todas las cΘlulas AFS que han accedido a compartir la informaci≤n de su mßquina servidor de base de datos en el momento de crear el CD-ROM de AFS. El grupo de soporte del producto AFS tambiΘn mantiene una copia del archivo, actualizßndolo en caso necesario. Si estß interesado en participar en el espacio de nombres global de AFS, una buena polφtica consiste en consultar el archivo ocasionalmente para ver si ha sufrido actualizaciones. Solicite un puntero para la ubicaci≤n del mismo al grupo de soporte del producto AFS. 

El archivo CellServDB.sample puede ser una buena base para el archivo CellServDB de cliente, puesto que todas las entradas del mismo utilizan el formato correcto. Puede a±adir o eliminar entradas de cΘlula tal como encajen. Mßs adelante (en el apartado Habilitaci≤n del acceso a cΘlulas externas) realizarß pasos adicionales que permitirßn al Gestor de antememoria llegar realmente a las cΘlulas. 

En este apartado se a±ade una entrada para la cΘlula local al archivo CellServDB local. El directorio de trabajo actual sigue siendo /usr/vice/etc. 

Elimine el enlace simb≤lico creado en el apartado Inicio del Servidor BOS y cambie el nombre del archivo CellServDB.sample por CellServDB. 
   
   # rm CellServDB
  
   # mv CellServDB.sample CellServDB
      

A±ada una entrada para la cΘlula local en el archivo CellServDB. Un mΘtodo fßcil consiste en utilizar el mandato cat para a±adir el contenido del archivo /usr/afs/etc/CellServDB de servidor a la versi≤n de cliente. 
   
    # cat  /usr/afs/etc/CellServDB >>  CellServDB   

A continuaci≤n, abra el editor de texto para verificar que no existen lφneas en blanco y que todas las entradas tienen el formato requerido, que se describe a continuaci≤n. La ordenaci≤n de la cΘlulas no es significativa, pero puede ser conveniente tener la cΘlula inicial de la mßquina cliente al principio; si lo desea, traslßdela ahora a ese lugar. 

La primera lφnea de la entrada de una cΘlula tiene el formato siguiente: 
   
   >nombre_cΘlula      #organizaci≤n   

donde nombre_cΘlula es el nombre de dominio de Internet completo de la cΘlula (por ejemplo, abc.com) y organizaci≤n es un campo opcional que sigue a cualquier n·mero de espacios y al signo numΘrico (#). Por convenio, denomina la organizaci≤n a la que corresponde la cΘlula (por ejemplo, ABC Corporation). 

DespuΘs de la primera lφnea viene una lφnea independiente para cada mßquina servidor de base de datos. Cada una de las lφneas tiene el formato siguiente: 
   
   direcci≤n_IP   #nombre_mßquina   

donde direcci≤n_IP es la direcci≤n IP de la mßquina en formato decimal con puntos (por ejemplo, 192.12.105.3). A continuaci≤n de cualquier n·mero de espacios y del signo numΘrico (#) estß nombre_mßquina, el nombre de sistema principal completamente cualificado de la mßquina (por ejemplo, db1.abc.com). En este caso, el signo numΘrico no indica un comentario; nombre_mßquina es un campo obligatorio. 

Si el archivo incluye cΘlulas a las que no desea que accedan los usuarios de esta mßquina, elimine las entradas de las mismas. 
En el ejemplo siguiente se muestran entradas para dos cΘlulas, cada una de las cuales tiene tres mßquinas servidor de base de datos: 


   
   >abc.com       #ABC Corporation (cΘlula inicial)
   192.12.105.3      #db1.abc.com
   192.12.105.4      #db2.abc.com
   192.12.105.55     #db3.abc.com
   >stateu.edu    #State University cell
   138.255.68.93     #serverA.stateu.edu
   138.255.68.72     #serverB.stateu.edu
   138.255.33.154    #serverC.stateu.edu
   


--------------------------------------------------------------------------------

Configuraci≤n de la antememoria
El Gestor de antememoria utiliza una antememoria en el disco local o en la memoria de la mßquina para almacenar copias locales de los archivos captados de las mßquinas servidor de archivos. Puesto que el programa afsd inicializa el Gestor de antememoria, establece los parßmetros bßsicos de configuraci≤n de la antememoria de acuerdo con las definiciones contenidas en el archivo /usr/vice/etc/cacheinfo local. Este archivo tiene tres campos: 

El primer campo menciona el directorio local en el que se montarß el espacio de archivos AFS. La ubicaci≤n convencional es el directorio /afs. 
El segundo campo define el directorio del disco local que se utilizarß para la antememoria de disco. La ubicaci≤n convencional es el directorio /usr/vice/cache, pero se puede especificar un directorio alternativo si hay mßs espacio disponible en otra partici≤n. En este campo siempre tiene que haber un valor, pero el Gestor de antememoria lo ignora si la mßquina utiliza una antememoria de memoria. 
El tercer campo especifica el n·mero de bloques de kilobytes (1024 bytes) que se deben asignar a la antememoria. 
Los valores que defina deben cumplir con los requisitos siguientes. 

En una mßquina que utiliza una antememoria de disco, el Gestor de antememoria siempre espera que podrß utilizar la cantidad de espacio especificada en el tercer campo. Si no se cumple con este requisito se pueden ocasionar graves problemas, algunos de los cuales s≤lo se pueden reparar mediante un rearranque. Debe evitar que los procesos que no sean de AFS llenen la partici≤n de antememoria. La manera mßs sencilla consiste en dedicar una partici≤n, exclusivamente, a la antememoria. 
La cantidad de espacio disponible en la memoria, o en la partici≤n que aloja el directorio de antememoria del disco, impone un lφmite absoluto en el tama±o de la antememoria. 
El tama±o mßximo soportado para la antememoria puede variar en cada release de AFS; consulte las IBM AFS Release Notes correspondientes a la versi≤n actual. 
Para una antememoria de disco, no se puede especificar en el tercer campo un valor que supere el 95% del espacio disponible en la partici≤n montada en el directorio mencionado en el segundo campo. Si se infringe esta restricci≤n, el programa afsd sale sin iniciar el Gestor de antememoria y se imprimirß un mensaje apropiado en la corriente de salida estßndar. El valor mßs apropiado en la mayorφa de mßquinas es el 90%. Algunos sistemas operativos (como, por ejemplo, AIX) no reservan automßticamente espacio para evitar que la partici≤n se llene por completo; para estos sistemas, resulta mßs apropiado un valor mßs peque±o (digamos del 80% al 85% del espacio disponible). 
Para una antememoria de memoria, debe dejar suficiente memoria para que se ejecuten otros procesos y aplicaciones. Si se intenta asignar mßs memoria de la que estß realmente disponible, se finalizarß el programa afsd sin inicializar el Gestor de antememoria y se generarß el mensaje siguiente en la corriente de salida estßndar. 
   
   afsd: memCache allocation failure at n·mero KB

El valor de n·mero indica cußntos kilobytes se habφan asignado justo antes de la anomalφa y, por lo tanto, indica la cantidad aproximada de memoria disponible. 

Dentro de estos lφmites rφgidos, los factores que determinan un tama±o de antememoria apropiado incluyen el n·mero de usuarios que trabajan en la mßquina, el tama±o de los archivos con los que trabajan y (para una antememoria de memoria) el n·mero de procesos que se ejecutan en la mßquina. Cuanto mayor es la demanda de estos factores, mayor tiene que ser la antememoria para mantener un buen rendimiento. 

Las antememorias de disco menores de 10 MB no suelen funcionar bien. Las mßquinas que sirven a muchos usuarios suelen funcionar mejor con una antememoria mφnima de entre 60 y 70 MB. El punto en el que un aumento de la antememoria no mejorarß realmente el rendimiento depende de los factores mencionados anteriormente y resulta difφcil de predecir. 

Las antememorias de memoria menores de 1 MB no son funcionales, y el rendimiento de las antememorias menores de 5 MB no suele ser satisfactorio. Los lφmites superiores adecuados son parecidos a los de las antememorias de disco, pero probablemente se determinan mßs por las demandas de memoria por parte de otras fuentes de la mßquina (n·mero de usuarios y procesos). Las mßquinas que s≤lo ejecuten unos cuantos procesos podrßn, posiblemente, utilizar una antememoria de memoria mßs peque±a. 


Configuraci≤n de una antememoria de disco
Nota: No todos los tipos de sistema de archivos que un sistema operativo soporta se pueden necesariamente utilizar como partici≤n de antememoria. Para conocer las posibles restricciones, consulte las IBM AFS Release Notes.  

Para configurar la antememoria de disco, lleve a cabo los procedimientos siguientes: 

Cree el directorio local que se utilizarß para gestionar la antememoria. La instrucci≤n siguiente muestra la ubicaci≤n convencional, /usr/vice/cache. Si dedica una partici≤n exclusivamente a la gesti≤n de la antememoria, tal como recomendamos, tambiΘn la debe configurar, crear un sistema de archivos en ella y montarlo en el directorio que se crea en este paso. 
   
   # mkdir /usr/vice/cache
   

Cree el archivo cacheinfo para definir los parßmetros de configuraci≤n que hemos tratado anteriormente. La instrucci≤n siguiente muestra la ubicaci≤n estßndar de montaje, /afs, y la ubicaci≤n estßndar de la antememoria, /usr/vice/cache. 
   
   # echo "/afs:/usr/vice/cache:#bloques" > /usr/vice/etc/cacheinfo

En el ejemplo siguiente se define el tama±o de la antememoria de disco como de 50.000 KB: 

   
   # echo "/afs:/usr/vice/cache:50000" > /usr/vice/etc/cacheinfo


Configuraci≤n de una antememoria de memoria
Para configurar una antememoria de memoria, cree el archivo cacheinfo para definir los parßmetros de configuraci≤n que hemos tratado anteriormente. La instrucci≤n siguiente muestra la ubicaci≤n estßndar de montaje, /afs, y la ubicaci≤n estßndar de la antememoria, /usr/vice/cache (aunque el valor exacto de la ·ltima es irrelevante para una antememoria de memoria) 

   
   # echo "/afs:/usr/vice/cache:#bloques" > /usr/vice/etc/cacheinfo

En el ejemplo siguiente se asignan 25.000 KB de memoria para la antememoria. 

   
   # echo "/afs:/usr/vice/cache:25000" > /usr/vice/etc/cacheinfo


--------------------------------------------------------------------------------

Configuraci≤n del Gestor de antememoria
Por convenio, el Gestor de antememoria monta el espacio de archivos AFS en el directorio local /afs. En este apartado se crea dicho directorio. 

El programa afsd establece varios parßmetros de configuraci≤n de la antememoria cuando inicializa el Gestor de antememoria, e inicia daemons que mejoran el rendimiento. Puede utilizar los argumentos del mandato afsd para alterar temporalmente los valores por omisi≤n de los parßmetros y para cambiar el n·mero de algunos de los daemons. En funci≤n del tama±o de la antememoria de la mßquina, de la cantidad de RAM y de la manera en que el personal trabaja con ella, algunas veces se puede mejorar el rendimiento del Gestor de antememoria alterando temporalmente los valores por omisi≤n. Para obtener una explicaci≤n de todos los argumentos del mandato afsd, vea la pßgina de consulta de este mandato en la publicaci≤n IBM AFS Administration Reference. 

La lφnea del mandato afsd en el script de inicializaci≤n de AFS de cada tipo de sistema incluye una variable OPTIONS. La puede utilizar para establecer valores que no sean valores por omisi≤n para los argumentos del mandato, de una de las maneras siguientes: 

Puede crear un archivo de opciones de afsd que establezca valores para los argumentos del mandato afsd. Si el archivo ya existe, su contenido se sustituye automßticamente por la variable OPTIONS del script de inicializaci≤n de AFS. La distribuci≤n de AFS para algunos tipos de sistema incluye un archivo de opciones; en otros tipos de sistema, hay que crearlo. 
En el script de inicializaci≤n de AFS se utilizan dos variables para especificar la vφa al archivo de opciones: CONFIG y AFSDOPT. En los tipos de sistema que definen un directorio convencional para archivos de configuraci≤n, la variable CONFIG lo indica por omisi≤n; en caso contrario, la variable indica una ubicaci≤n apropiada. 

Liste las opciones de afsd que desee en una ·nica lφnea del archivo de opciones, separßndolas mediante uno o mßs espacios. El ejemplo siguiente establece el argumento -stat en 2500, el argumento -daemons en 4 y el argumento -volumes en 100. 

   
   -stat 2500 -daemons 4 -volumes 100   
   

En una mßquina que utilice una antememoria de disco, puede establecer la variable OPTIONS del script de inicializaci≤n de AFS en uno de los valores $SMALL, $MEDIUM o $LARGE. El script de inicializaci≤n de AFS utiliza uno de estos valores si no existe el archivo de opciones de afsd mencionado por la variable AFSDOPT. En el script, tal como se distribuye, la variable OPTIONS estß establecida con el valor $MEDIUM. Nota: No establezca la variable OPTIONS con los valores $SMALL, $MEDIUM o $LARGE en una mßquina que utilice una antememoria de memoria. Los argumentos que establece s≤lo son apropiados en una mßquina que utilice una antememoria de disco.  

El script (o, en algunos tipos de sistema, el archivo de opciones de afsd mencionado por la variable AFSDOPT) define un valor para cada uno de los valores SMALL, MEDIUM y LARGE que establecen los argumentos del mandato afsd de forma apropiada para mßquinas cliente de distintos tama±os: 

SMALL es adecuado para una mßquina peque±a que sirve a uno o dos usuarios y tiene, aproximadamente, 8 MB de RAM y una antememoria de 20 MB 
MEDIUM es adecuado para una mßquina de tama±o medio que sirve a entre dos y seis usuarios y tiene 16 MB de RAM y una antememoria de 40 MB 
LARGE es adecuado para una mßquina de tama±o grande que sirve a entre cinco y diez usuarios y tiene 32 MB de RAM y una antememoria de 100 MB 
Puede elegir que no se cree un archivo de opciones de afsd y establecer la variable OPTIONS en el script de inicializaci≤n con un valor nulo en lugar del valor por omisi≤n, que es $MEDIUM. Luego puede establecer los argumentos directamente en la lφnea del mandato afsd del script, o no establecer ning·n argumento (aceptando, por lo tanto, los valores por omisi≤n para todos los parßmetros del Gestor de antememoria). 
Cree el directorio local en el que se montarß el espacio de archivos AFS, que es por convenio /afs. Si el directorio ya existe, compruebe que estΘ vacφo. 
   
   # mkdir /afs
   

En sistemas AIX, a±ada la lφnea siguiente en el archivo /etc/vfs. Esto permite que AIX desmonte AFS correctamente durante el cierre. 
   
   afs     4     none     none
   

En sistemas Linux, copie el archivo de opciones afsd del directorio /usr/vice/etc en el directorio /etc/sysconfig, eliminando al hacerlo la extensi≤n .conf. 
   
   # cp /usr/vice/etc/afs.conf /etc/sysconfig/afs
   

Edite el script de inicializaci≤n de AFS o el archivo de opciones de afsd de la mßquina para establecer valores adecuados para los parßmetros del mandato afsd. El script reside en la ubicaci≤n indicada de cada tipo de sistema: 
En sistemas AIX, /etc/rc.afs 
En sistemas Digital UNIX, /sbin/init.d/afs 
En sistemas HP-UX, /sbin/init.d/afs 
En sistemas IRIX, /etc/init.d/afs 
En sistemas Linux, /etc/sysconfig/afs (archivo de opciones afsd) 
En sistemas Solaris, /etc/init.d/afs 
Utilice uno de los mΘtodos descritos en la introducci≤n de este apartado para a±adir los distintivos siguientes a la lφnea del mandato afsd. Si pretende que la mßquina permanezca como cliente AFS, establezca tambiΘn los argumentos relativos al rendimiento que desee. 

A±ada el distintivo -nosettime, puesto que Θsta es una mßquina servidor de archivos que tambiΘn es cliente. Este distintivo impide que la mßquina discrimine una mßquina servidor de archivos de la cΘlula como fuente horaria correcta, cosa que normalmente hacen las mßquinas cliente. En lugar de ello, las mßquinas servidor utilizan NTPD (controlado por el proceso runntp) u otro protocolo para sincronizar sus relojes. 
A±ada el distintivo -memcache si la mßquina va a utilizar una antememoria de memoria. 
A±ada el distintivo -verbose para visualizar un seguimiento de la inicializaci≤n del Gestor de antememoria en la corriente de salida estßndar. 

--------------------------------------------------------------------------------

Visi≤n general: Realizaci≤n de la instalaci≤n de la primera mßquina AFS
Ahora, la mßquina estß configurada como mßquina cliente y mßquina servidor de archivos AFS. En esta fase final de la instalaci≤n, se inicializa el Gestor de antememoria y luego se crean los niveles superiores del espacio de archivos AFS, entre otros procedimientos. Los procedimientos son: 

Verificaci≤n de que el script de inicializaci≤n funciona correctamente e incorporaci≤n del mismo a la secuencia de arranque y cierre del sistema operativo 
Creaci≤n y montaje de vol·menes de nivel superior 
Creaci≤n y montaje de vol·menes para almacenar binarios del sistema en AFS 
Habilitaci≤n del acceso a cΘlulas externas 
Instituci≤n de medidas de seguridad adicionales 
Eliminaci≤n, si se desea, del funcionamiento de cliente 

--------------------------------------------------------------------------------

Verificaci≤n del script de inicializaci≤n de AFS
En este punto se ejecuta el script de inicializaci≤n de AFS para verificar que invoca correctamente a todos los programas y procesos de AFS necesarios, asφ como que Θstos se inician correctamente. Los mandatos oportunos son los siguientes: 

El mandato que carga dinßmicamente las modificaciones de AFS en el kernel, en algunos tipos de sistema (no es aplicable si el kernel tiene incorporadas las modificaciones de AFS) 
El mandato bosserver, que inicia el Servidor BOS; el cual, a su vez, inicia los procesos de servidor para los que se han creado entradas en el archivo /usr/afs/local/BosConfig 
El mandato afsd, que inicializa el Gestor de antememoria 
En los tipos de sistema que utilizan un programa cargador dinßmico, debe rearrancar la mßquina antes de ejecutar el script de inicializaci≤n, de forma que Θste pueda cargar de nuevo las modificaciones de AFS en el kernel. 

Si surgen problemas durante la inicializaci≤n, intente resolverlos. De ser necesario, el grupo de soporte del producto AFS puede ofrecerle ayuda. 

Emita el mandato bos shutdown para cerrar los procesos de servidor AFS que no sean el Servidor BOS. Incluya el distintivo -wait para retardar el retorno del mensaje de solicitud del shell de mandatos hasta que se hayan cerrado completamente todos los procesos. 
      
   # /usr/afs/bin/bos shutdown &lt;nombre mßquina> -wait
   

Emita el mandato ps para averiguar el n·mero de ID de proceso (PID) del proceso bosserver y, a continuaci≤n, el mandato kill para detenerlo. 
   
   # ps opciones_ps_apropiadas  | grep bosserver
   
   # kill PID_servidor_bos
   

Emita los mandatos adecuados para ejecutar el script de inicializaci≤n de AFS para este tipo de sistema. 
En sistemas AIX: 

Rearranque la mßquina e inicie de nuevo una sesi≤n como superusuario root local. 
   
   # cd /
   
   # shutdown -r now
   
   login: root
   Contrase±a: contrase±a_root
   

Ejecute el script de inicializaci≤n de AFS. 
   
   # /etc/rc.afs
   

En sistemas Digital UNIX: 

Ejecute el script de inicializaci≤n de AFS. 
   
   # /sbin/init.d/afs  start
   

En sistemas HP-UX: 

Ejecute el script de inicializaci≤n de AFS. 
   
   # /sbin/init.d/afs  start
   

En sistemas IRIX: 

Si ha configurado la mßquina para utilizar el programa cargador dinßmico ml, rearranque la mßquina y vuelva a iniciar una sesi≤n como superusuario root local. 
   
   # cd /
   
   # shutdown -i6 -g0 -y
   
   login: root
   Contrase±a: contrase±a_root
   

Emita el mandato chkconfig para activar las variables de configuraci≤n afsserver y afsclient. 
   
   # /etc/chkconfig -f afsserver on
   
   # /etc/chkconfig -f afsclient on 
   

Ejecute el script de inicializaci≤n de AFS. 
   
   # /etc/init.d/afs  start
   

En sistemas Linux: 

Rearranque la mßquina e inicie de nuevo una sesi≤n como superusuario root local. 
  
   # cd /
         
   # shutdown -r now
   
   login: root
   Contrase±a: contrase±a_root
   

Ejecute el script de inicializaci≤n de AFS. 
   
   # /etc/rc.d/init.d/afs  start
   

En sistemas Solaris: 

Rearranque la mßquina e inicie de nuevo una sesi≤n como superusuario root local. 
   
   # cd /
      
   # shutdown -i6 -g0 -y
   
   login: root
   Contrase±a: contrase±a_root
   

Ejecute el script de inicializaci≤n de AFS. 
   
   # /etc/init.d/afs start
   

Espere al mensaje que confirma que la inicializaci≤n del Gestor de antememoria se ha completado. 
En las mßquinas que utilizan una antememoria de disco, la inicializaci≤n del Gestor de antememoria por primera vez puede tardar un poco, puesto que el programa afsd tiene que crear todos los archivos Vn en el directorio de la antememoria. Las posteriores inicializaciones del Gestor de antememoria no tardarßn tanto, puesto que los archivos Vn ya existirßn. 

Como prueba bßsica de un funcionamiento correcto de AFS, emita el mandato klog para autentificarse como usuario admin. Proporcione la contrase±a (contrase±a_admin) que ha definido en el apartado Inicializaci≤n de la seguridad de la cΘlula. 

   
   # /usr/afs/bin/klog admin
   Contrase±a:  contrase±a_admin
   

Emita el mandato tokens para verificar que el mandato klog ha funcionado correctamente. Si es asφ, la salida es parecida al ejemplo siguiente para la cΘlula abc.com, donde el UID de admin para AFS es 1. Si la salida no parece correcta, resuelva el problema. Posiblemente tenga que efectuar cambios en el script de inicializaci≤n de AFS. De ser necesario, el grupo de soporte del producto AFS puede ofrecerle ayuda. 
   
   # /usr/afs/bin/tokens
   Tokens held by the Cache Manager:
  
   User's (AFS ID 1) tokens for afs@abc.com [Expires May 22 11:52]
       --End of list--
   

Emita el mandato bos status para verificar que la salida de cada proceso indica Currently running normally. 
   
   # /usr/afs/bin/bos status &lt;nombre mßquina>
   

Cambie al directorio del sistema de archivos raφz local (/) y emita el mandato fs checkvolumes. 
   
   # cd /
   
   # /usr/afs/bin/fs checkvolumes
   


--------------------------------------------------------------------------------

Activaci≤n del script de inicializaci≤n de AFS
Ahora que ya ha confirmado que el script de inicializaci≤n de AFS funciona correctamente, emprenda la acci≤n necesaria para que se ejecute automßticamente en cada rearranque. Siga con las instrucciones correspondientes a su tipo de sistema: 

Activaci≤n del script en sistemas AIX 
Activaci≤n del script en sistemas Digital UNIX 
Activaci≤n del script en sistemas HP-UX 
Activaci≤n del script en sistemas IRIX 
Activaci≤n del script en sistemas Linux 
Activaci≤n del script en sistemas Solaris 

Activaci≤n del script en sistemas AIX
Edite el archivo de inicializaci≤n de AIX, /etc/inittab, a±adiendo la lφnea siguiente para invocar al script de inicializaci≤n de AFS. Coloque esta lφnea justo detrßs de la lφnea que inicia los daemons de NFS. 
   
   rcafs:2:wait:/etc/rc.afs > /dev/console 2>&1 # Start AFS services
   

(Opcional) Ahora existen copias del archivo de inicializaci≤n de AFS en los directorios /usr/vice/etc y /etc. Si desea evitar posibles confusiones, garantizando que siempre sean iguales, cree un enlace entre ellos. Si es necesario, siempre podrß recuperar el script original del CD-ROM de AFS. 
   
   # cd  /usr/vice/etc
   
   # rm  rc.afs
  
   # ln -s  /etc/rc.afs
   

Siga con el apartado Configuraci≤n de los niveles superiores del espacio de archivos AFS. 

Activaci≤n del script en sistemas Digital UNIX
Cambie al directorio /sbin/init.d y emita el mandato ln -s para crear enlaces simb≤licos que incorporen el script de inicializaci≤n de AFS a la secuencia de arranque y cierre de Digital UNIX. 
   
   # cd  /sbin/init.d
   
   # ln -s  ../init.d/afs  /sbin/rc3.d/S67afs
   
   # ln -s  ../init.d/afs  /sbin/rc0.d/K66afs
   

(Opcional) Ahora existen copias del archivo de inicializaci≤n de AFS en los directorios /usr/vice/etc y /sbin/init.d. Si desea evitar posibles confusiones, garantizando que siempre sean iguales, cree un enlace entre ellos. Si es necesario, siempre podrß recuperar el script original del CD-ROM de AFS. 
   
   # cd  /usr/vice/etc
   
   # rm afs.rc
  
   # ln -s  /sbin/init.d/afs  afs.rc
   

Siga con el apartado Configuraci≤n de los niveles superiores del espacio de archivos AFS. 

Activaci≤n del script en sistemas HP-UX
Cambie al directorio /sbin/init.d y emita el mandato ln -s para crear enlaces simb≤licos que incorporen el script de inicializaci≤n de AFS a la secuencia de arranque y cierre de HP-UX. 
   
   # cd /sbin/init.d
   
   # ln -s ../init.d/afs /sbin/rc2.d/S460afs
  
   # ln -s ../init.d/afs /sbin/rc2.d/K800afs
   

(Opcional) Ahora existen copias del archivo de inicializaci≤n de AFS en los directorios /usr/vice/etc y /sbin/init.d. Si desea evitar posibles confusiones, garantizando que siempre sean iguales, cree un enlace entre ellos. Si es necesario, siempre podrß recuperar el script original del CD-ROM de AFS. 
   
   # cd /usr/vice/etc
   
   # rm afs.rc
  
   # ln -s  /sbin/init.d/afs  afs.rc
   

Siga con el apartado Configuraci≤n de los niveles superiores del espacio de archivos AFS. 

Activaci≤n del script en sistemas IRIX
Cambie al directorio /etc/init.d y emita el mandato ln -s para crear enlaces simb≤licos que incorporen el script de inicializaci≤n de AFS a la secuencia de arranque y cierre de IRIX. 
   
   # cd /etc/init.d
   
   # ln -s ../init.d/afs /etc/rc2.d/S35afs
  
   # ln -s ../init.d/afs /etc/rc0.d/K35afs
   

(Opcional) Ahora existen copias del archivo de inicializaci≤n de AFS en los directorios /usr/vice/etc y /etc/init.d. Si desea evitar posibles confusiones, garantizando que siempre sean iguales, cree un enlace entre ellos. Si es necesario, siempre podrß recuperar el script original del CD-ROM de AFS. 
   
   # cd /usr/vice/etc
   
   # rm afs.rc
  
   # ln -s  /etc/init.d/afs  afs.rc
   

Siga con el apartado Configuraci≤n de los niveles superiores del espacio de archivos AFS. 

Activaci≤n del script en sistemas Linux
Emita el mandato chkconfig para activar la variable de configuraci≤n afs. En base a la instrucci≤n del archivo de inicializaci≤n de AFS que empieza por la serie #chkconfig, el mandato crea automßticamente los enlaces simb≤licos que incorporan el script a la secuencia de arranque y cierre de Linux. 
   
   # /sbin/chkconfig  --add afs
   

(Opcional) Ahora existen copias del archivo de inicializaci≤n de AFS en los directorios /usr/vice/etc y etc/rc.d/init.d, asφ como copias del archivo de opciones afsd en los directorios /usr/vice/etc y /etc/sysconfig. Si desea evitar posibles confusiones, garantizando que las dos copias de cada archivo siempre sean iguales, cree un enlace entre ellas. Si es necesario, siempre podrß recuperar el script o el archivo de opciones original del CD-ROM de AFS. 
   
   # cd /usr/vice/etc
   
   # rm afs.rc afs.conf
    
   # ln -s  /etc/rc.d/init.d/afs  afs.rc
   
   # ln -s  /etc/sysconfig/afs  afs.conf
   

Siga con el apartado Configuraci≤n de los niveles superiores del espacio de archivos AFS. 

Activaci≤n del script en sistemas Solaris
Cambie al directorio /etc/init.d y emita el mandato ln -s para crear enlaces simb≤licos que incorporen el script de inicializaci≤n de AFS a la secuencia de arranque y cierre de Solaris. 
   
   # cd /etc/init.d
  
   # ln -s ../init.d/afs /etc/rc3.d/S99afs
  
   # ln -s ../init.d/afs /etc/rc0.d/K66afs
   

(Opcional) Ahora existen copias del archivo de inicializaci≤n de AFS en los directorios /usr/vice/etc y /etc/init.d. Si desea evitar posibles confusiones, garantizando que siempre sean iguales, cree un enlace entre ellos. Si es necesario, siempre podrß recuperar el script original del CD-ROM de AFS. 
   
   # cd /usr/vice/etc
   
   # rm afs.rc
  
   # ln -s  /etc/init.d/afs  afs.rc
   


--------------------------------------------------------------------------------

Configuraci≤n de los niveles superiores del espacio de archivos AFS
Si previamente no ha ejecutado AFS en la cΘlula, configure ahora los niveles superiores del espacio de archivos AFS de la misma. Si ha ejecutado una versi≤n anterior de AFS, el espacio de archivos ya estarß configurado. Siga con el apartado Almacenamiento de binarios de AFS en AFS. 

Ha creado el volumen root.afs en el apartado Inicio del Servidor de archivos, del Servidor de vol·menes y del Recuperador, y el Gestor de antememoria lo ha montado automßticamente en el directorio local /afs al ejecutar el script de inicializaci≤n de AFS en el apartado Verificaci≤n del script de inicializaci≤n de AFS. Establezca ahora la lista de control de acceso (ACL) en el directorio /afs; creaci≤n, montaje y establecimiento de la ACL son los tres pasos necesarios al crear cualquier volumen. 

DespuΘs de establecer la ACL en el volumen root.afs, cree el volumen root.cell de la cΘlula, m≤ntelo como subdirectorio del directorio /afs y establezca la ACL. Cree un punto de montaje de lectura/grabaci≤n y uno normal para el volumen root.cell. El punto de montaje de lectura/grabaci≤n le permite acceder a la versi≤n de lectura/grabaci≤n de los vol·menes duplicados cuando sea necesario. Esencialmente, la creaci≤n de ambos puntos de montaje crea copias independientes de s≤lo lectura y de lectura/grabaci≤n del espacio de archivos, y permite que el Gestor de antememoria recorra el espacio de archivos por una vφa de s≤lo lectura o de lectura/grabaci≤n, seg·n sea oportuno. Para obtener una explicaci≤n adicional de estos conceptos, consulte el capφtulo de la publicaci≤n IBM AFS Administration Guide que trata sobre la administraci≤n de vol·menes. 

A continuaci≤n, duplique los vol·menes root.afs y root.cell. Esto es necesario si desea duplicar cualquier otro volumen de la cΘlula, puesto que todos los vol·menes montados por encima de un volumen duplicado tambiΘn se deben duplicar para que el Gestor de antememoria acceda a la duplicaci≤n. 

Cuando el volumen root.afs estß duplicado, el Gestor de antememoria estß programado para acceder a la versi≤n de s≤lo lectura del mismo (root.afs.readonly) siempre que sea posible. Para efectuar cambios en el contenido del volumen root.afs (por ejemplo, cuando se monta el volumen root.cell de otra cΘlula en el segundo nivel del espacio de archivos), debe montar el volumen root.afs temporalmente, efectuar los cambios, liberar el volumen y eliminar el punto de montaje temporal. Si desea obtener instrucciones, consulte el apartado Habilitaci≤n del acceso a cΘlulas externas. 

Emita el mandato fs setacl para editar la ACL del directorio /afs. A±ada una entrada que otorgue los permisos l (lookup) y r (read) al grupo system:anyuser, a fin de permitir que todos los usuarios de AFS que puedan llegar a la cΘlula atraviesen el directorio. Si prefiere habilitar el acceso ·nicamente de los usuarios autentificados localmente, sustituya el grupo system:authuser. 
Observe que ya existe una entrada de ACL que otorga los siete derechos de acceso al grupo system:administrators. Se trata de una entrada por omisi≤n que AFS coloca en el directorio raφz de cada nuevo volumen. 

   
   # /usr/afs/bin/fs setacl /afs system:anyuser rl
   

Emita el mandato vos create para crear el volumen root.cell. A continuaci≤n, emita el mandato fs mkmount para montarlo como subdirectorio del directorio /afs, en el que sirve de raφz del espacio de archivos AFS local de la cΘlula. Finalmente, emita el mandato fs setacl para crear una entrada de ACL para el grupo system:anyuser (o para el grupo system:authuser). 
Sustituya el argumento nombre partici≤n por el nombre de una de las particiones de servidor AFS de la mßquina (como, por ejemplo, /vicepa). Sustituya el argumento nombre_cΘlula por el nombre de dominio de Internet completamente cualificado de la cΘlula (como, por ejemplo, abc.com). 

   
   # /usr/afs/bin/vos create  &lt;nombre mßquina> &lt;nombre partici≤n> root.cell
   
   # /usr/afs/bin/fs mkmount /afs/nombre_cΘlula  root.cell
   
   # /usr/afs/bin/fs setacl /afs/nombre_cΘlula  system:anyuser rl
   

(Opcional) Cree un enlace simb≤lico con un nombre de cΘlula acortado, a fin de reducir la longitud de los nombres de vφa para los usuarios de la cΘlula local. Por ejemplo, en la cΘlula abc.com, /afs/abc es un enlace con /afs/abc.com. 
     
   # cd /afs
   
   # ln -s  nombre_cΘlula_completo nombre_cΘlula_corto
   

Emita el mandato fs mkmount para crear un punto de montaje de lectura/grabaci≤n para el volumen root.cell (ha creado un punto de montaje normal en el paso 2). 
Por convenio, el nombre de un punto de montaje de lectura/grabaci≤n empieza por un punto, tanto para distinguirlo de un punto de montaje normal como para hacer que s≤lo sea visible cuando se utilice el distintivo -a en el mandato ls. 

Cambie al directorio /usr/afs/bin para facilitar el acceso a los binarios de mandatos. 

   
   # cd /usr/afs/bin
   
   # ./fs mkmount   /afs/.nombre_cΘlula  root.cell -rw
   

Emita el mandato vos addsite para definir un sitio de duplicaci≤n para los vol·menes root.afs y root.cell. En cada caso, sustituya el argumento nombre partici≤n por la partici≤n en que reside la versi≤n de lectura/grabaci≤n del volumen. Cuando se instalan mßquinas servidor de archivos adicionales, es buena idea crear tambiΘn sitios de duplicaci≤n en ellas. 
   
   # ./vos addsite &lt;nombre mßquina> &lt;nombre partici≤n> root.afs
   
   # ./vos addsite &lt;nombre mßquina> &lt;nombre partici≤n> root.cell
   

Emita el mandato fs examine para verificar que el Gestor de antememoria puede acceder a los dos vol·menes root.afs y root.cell, antes de intentar duplicarlos. La salida lista el nombre, el n·mero de ID de volumen, el cupo y el tama±o de cada volumen, asφ como el tama±o de la partici≤n que los aloja. Si en lugar de esta salida obtiene un mensaje de error, no prosiga sin emprender antes una acci≤n correctora. 
 
   # ./fs examine /afs
   
   # ./fs examine /afs/nombre_cΘlula
   

Emita el mandato vos release para liberar una duplicaci≤n de los vol·menes root.afs y root.cell en los sitios que ha definido en el paso 5. 
   
   # ./vos release root.afs
   
   # ./vos release root.cell
   

Emita el mandato fs checkvolumes para imponer que el Gestor de antememoria observe que ha liberado las versiones de s≤lo lectura de los vol·menes; a continuaci≤n, emita de nuevo el mandato fs examine. Esta vez, la salida menciona la versi≤n de s≤lo lectura de los vol·menes (root.afs.readonly y root.cell.readonly) en lugar de las versiones de lectura/grabaci≤n, debido al error sistemßtico del Gestor de antememoria al acceder a la versi≤n de s≤lo lectura del volumen root.afs, en caso de que exista. 
   
   # ./fs checkvolumes
   
   # ./fs examine /afs
   
   # ./fs examine /afs/nombre_cΘlula
   


--------------------------------------------------------------------------------

Almacenamiento de binarios de AFS en AFS
En una configuraci≤n convencional, los binarios de cliente AFS y los archivos de configuraci≤n se ponen disponibles en los subdirectorios del directorio /usr/afsws de las mßquinas cliente (afsws es un acr≤nimo de AFS workstation). Puede conservar espacio en el disco local creando /usr/afsws como enlace con un volumen AFS que aloje los binarios de cliente AFS y los archivos de configuraci≤n para este tipo de sistema. 

En este apartado se crean los vol·menes necesarios. La ubicaci≤n convencional con la que enlazar /usr/afsws es /afs/nombre_cΘlula/nombre_sist/usr/afsws, donde nombre_sist es el nombre de tipo de sistema apropiado especificado en las IBM AFS Release Notes. En las instrucciones contenidas en el Instalaci≤n de mßquinas cliente adicionales se supone que se han seguido las instrucciones indicadas en este apartado. 

Si previamente ha ejecutado AFS en la cΘlula, posiblemente los vol·menes ya existirßn. De ser asφ, s≤lo tendrß que llevar a cabo el paso 8. 

El directorio de trabajo actual sigue siendo /usr/afs/bin, que aloja los binarios de los juegos de mandatos fs y vos. En los mandatos siguientes, es posible que siga teniendo que especificar el nombre de vφa a los mandatos, en funci≤n de c≤mo se haya establecido la variable de entorno PATH. 

Emita el mandato vos create para crear vol·menes en los que almacenar los binarios de clientes AFS para este tipo de sistema. La instrucci≤n del ejemplo siguiente crea los vol·menes llamados nombre_sist, nombre_sist.usr y nombre_sist.usr.afsws. Consulte las IBM AFS Release Notes para averiguar el valor de nombre_sist adecuado para este tipo de sistema. 
    
   # vos create &lt;nombre mßquina> &lt;nombre partici≤n> nombre_sist
     
   # vos create &lt;nombre mßquina> &lt;nombre partici≤n> nombre_sist.usr
     
   # vos create &lt;nombre mßquina> &lt;nombre partici≤n> nombre_sist.usr.afsws
    

Emita el mandato fs mkmount para montar los vol·menes reciΘn creados. Puesto que el volumen root.cell estß duplicado, debe anteponer un punto a la parte nombre_cΘlula del nombre de vφa para especificar el punto de montaje de lectura/grabaci≤n, tal como se muestra. A continuaci≤n, emita el mandato vos release, para liberar una nueva duplicaci≤n del volumen root.cell, y el mandato fs checkvolumes, para imponer que el Gestor de antememoria local acceda a ellos. 
   
   # fs mkmount -dir /afs/.nombre_cΘlula/nombre_sist -vol nombre_sist
   
   # fs mkmount -dir /afs/.nombre_cΘlula/nombre_sist/usr -vol nombre_sist.usr
   
   # fs mkmount -dir /afs/.nombre_cΘlula/nombre_sist/usr/afsws -vol\
             nombre_sist.usr.afsws
   
   # vos release root.cell
   
   # fs checkvolumes
   

Emita el mandato fs setacl para otorgar los permisos l (lookup) y r (read) al grupo system:anyuser en la ACL de cada nuevo directorio. 
   
   # cd /afs/.nombre_cΘlula/nombre_sist
   
   # fs setacl  -dir  .  usr  usr/afsws  -acl  system:anyuser rl 
   

Emita el mandato fs setquota para establecer un cupo ilimitado en el volumen montado en el directorio /afs/nombre_cΘlula/nombre_sist/usr/afsws. Esto le permitirß copiar todos los archivos apropiados del CD-ROM en el volumen sin sobrepasar el cupo del volumen. 
Si lo desea, puede establecer el cupo del volumen en un valor finito despuΘs de completar la operaci≤n de copia. En este punto, utilice el mandato vos examine para determinar cußnto espacio estß ocupando el volumen. A continuaci≤n, emita el mandato fs setquota para establecer un cupo que sea ligeramente mayor. 

   
   # fs setquota /afs/.nombre_cΘlula/nombre_sist/usr/afsws  0
   

Monte el CD-ROM de AFS para el tipo de sistema de esta mßquina en el directorio local /cdrom, si no se ha montado todavφa. Para obtener instrucciones sobre c≤mo montar los CD-ROM (ya sea local o remotamente por medio de NFS), consulte la documentaci≤n del sistema operativo. 
Copie el contenido de los directorios indicados desde el CD-ROM en el directorio /afs/nombre_cΘlula/nombre_sist/usr/afsws. 
   
   # cd /afs/.nombre_cΘlula/nombre_sist/usr/afsws
   
   # cp -rp /cdrom/nombre_sist/bin  .
   
   # cp -rp /cdrom/nombre_sist/etc  .
   
   # cp -rp /cdrom/nombre_sist/include  .
   
   # cp -rp /cdrom/nombre_sist/lib  .
   

Emita el mandato fs setacl para establecer la ACL en cada directorio de la forma apropiada. Para cumplir con los tΘrminos del contrato de Licencia de AFS, debe impedir que los usuarios no autorizados accedan al software de AFS. Para permitir ·nicamente el acceso de los usuarios autentificados localmente, establezca la ACL en los subdirectorios etc, include y lib a fin de otorgar los permisos l y r al grupo system:authuser, en lugar de otorgarlos al grupo system:anyuser. El grupo system:anyuser debe conservar los permisos l y r en el subdirectorio bin para permitir que los usuarios no autentificados accedan al binario de klog. Para asegurarse de que los usuarios no autorizados no acceden al software de AFS, compruebe peri≤dicamente que las ACL contenidas en estos directorios estßn bien establecidas. 
     
   # cd  /afs/.nombre_cΘlula/nombre_sist/usr/afsws
   
   # fs setacl  -dir etc include lib  -acl  system:authuser rl  \
              system:anyuser none
   

Cree /usr/afsws en el disco local como enlace simb≤lico con el directorio /afs/nombre_cΘlula/@sys/usr/afsws. Si lo desea, puede especificar el nombre real del sistema en lugar de @sys, pero la ventaja de utilizar @sys es que sigue siendo vßlido si se actualiza esta mßquina para un tipo de sistema distinto. 
   
   # ln -s /afs/nombre_cΘlula/@sys/usr/afsws  /usr/afsws
   

(Opcional) Para permitir que los usuarios emitan mandatos de los juegos de AFS (como, por ejemplo, fs) sin tener que especificar un nombre de vφa a los binarios correspondientes, incluya los directorios /usr/afsws/bin y /usr/afsws/etc en la variable de entorno PATH que defina en el archivo de inicializaci≤n del shell de cada usuario (como por ejemplo .cshrc). 

--------------------------------------------------------------------------------

Almacenamiento de documentos de AFS en AFS
La distribuci≤n de AFS incluye los documentos siguientes: 

IBM AFS Release Notes 
IBM AFS Guφa de iniciaci≤n rßpida 
IBM AFS User Guide 
IBM AFS Administration Reference 
IBM AFS Administration Guide 
El CD-ROM de AFS para cada tipo de sistema tiene un directorio Documentation en el nivel superior, con un subdirectorio para cada formato de documento proporcionado. Los distintos formatos son adecuados para su visualizaci≤n y/o impresi≤n. 

En este apartado se explica c≤mo crear y montar un volumen para alojar los documentos, poniΘndolos a disposici≤n de los usuarios. El punto de montaje recomendado para el volumen es /afs/nombre_cΘlula/afsdoc. Si lo desea, puede crear un enlace con el punto de montaje del disco local de cada mßquina cliente, llamado /usr/afsdoc. Como alternativa, puede crear un enlace con el punto de montaje del directorio inicial de cada usuario. TambiΘn puede elegir que s≤lo se permita a los usuarios acceder a determinados documentos (muy probablemente, a la publicaci≤n IBM AFS User Guide) creando distintos puntos de montaje o estableciendo ACL diferentes en distintos directorios de documentos. 

El directorio de trabajo actual sigue siendo /usr/afs/bin, que aloja los binarios de los juegos de mandatos fs y vos que se utilizan para crear y montar vol·menes. En los mandatos siguientes, es posible que siga teniendo que especificar el nombre de vφa a los mandatos, en funci≤n de c≤mo se haya establecido la variable de entorno PATH. 

Emita el mandato vos create para crear un volumen en el que almacenar la documentaci≤n de AFS. Incluya el argumento -maxquota para establecer un cupo ilimitado en el volumen. Esto le permitirß copiar todos los archivos apropiados desde el CD-ROM en el volumen sin sobrepasar el cupo del volumen. 
Si lo desea, puede establecer el cupo del volumen en un valor finito despuΘs de completar las operaciones de copia. En este punto, utilice el mandato vos examine para determinar cußnto espacio estß ocupando el volumen. A continuaci≤n, emita el mandato fs setquota para establecer un cupo que sea ligeramente mayor. 

   
   # vos create  &lt;nombre mßquina> &lt;nombre partici≤n>  afsdoc  -maxquota  0
     

Emita el mandato fs mkmount para montar el nuevo volumen. Puesto que el volumen root.cell estß duplicado, debe anteponer un punto al nombre_cΘlula para especificar el punto de montaje de lectura/grabaci≤n, tal como se muestra. A continuaci≤n, emita el mandato vos release, para liberar una nueva duplicaci≤n del volumen root.cell, y el mandato fs checkvolumes, para imponer que el Gestor de antememoria local acceda a ellos. 
     
   # fs mkmount -dir /afs/.nombre_cΘlula/afsdoc -vol afsdoc
   
   # vos release root.cell
   
   # fs checkvolumes
    

Emita el mandato fs setacl para otorgar los permisos rl al grupo system:anyuser en la ACL del nuevo directorio. 
       
   # cd /afs/.nombre_cΘlula/afsdoc 
    
   # fs setacl  .  system:anyuser rl 
   

Monte el CD-ROM de AFS para el tipo de sistema deseado en el directorio local /cdrom, si no se ha montado todavφa. Para obtener instrucciones sobre c≤mo montar los CD-ROM (ya sea local o remotamente por medio de NFS), consulte la documentaci≤n del sistema operativo. 
Copie los documentos de AFS en uno o mßs formatos desde el CD-ROM a subdirectorios del directorio /afs/nombre_cΘlula/afsdoc. Repita los mandatos para cada uno de los formatos. 
    
   # mkdir nombre_formato
  
   # cd nombre_formato
  
   # cp -rp /cdrom/Documentation/formato  .

Si decide almacenar la versi≤n HTML de los documentos en AFS, observe que, ademßs de un subdirectorio para cada documento, hay varios archivos que tienen la extensi≤n .gif y que permiten que los lectores se muevan con facilidad entre las secciones de un documento. El archivo llamado index.htm es una pßgina de introducci≤n de HTML que contiene un hiperenlace con cada uno de los documentos. Para que la visualizaci≤n en lφnea funcione correctamente, estos archivos deben permanecer en el directorio HTML de nivel superior (llamado /afs/nombre_cΘlula/afsdoc/html). 

(Opcional) Si piensa que a sus usuarios les serß de utilidad acceder a los documentos de AFS en un formato determinado a travΘs de un directorio del disco local, cree /usr/afsdoc en el disco local como enlace simb≤lico con el directorio de documentaci≤n de AFS (/afs/nombre_cΘlula/afsdoc/nombre_formato). 

   
   # ln -s /afs/nombre_cΘlula/afsdoc/nombre_formato /usr/afsdoc

Una alternativa consiste en crear, en el directorio inicial de cada usuario, un enlace con el directorio /afs/nombre_cΘlula/afsdoc/nombre_formato. 


--------------------------------------------------------------------------------

Almacenamiento de binarios del sistema en AFS
TambiΘn puede elegir almacenar otros binarios del sistema en vol·menes AFS, como por ejemplo los programas estßndar de UNIX, convencionalmente ubicados en directorios del disco local tales como /etc, /bin y /lib. El almacenamiento de estos binarios en un volumen AFS no s≤lo libera espacio en el disco local, sino que tambiΘn facilita la actualizaci≤n de binarios en todas las mßquinas cliente. 

A continuaci≤n se muestra un esquema sugerido para almacenar binarios del sistema en AFS. Dicho esquema no incluye instrucciones, pero puede utilizar como patr≤n las que se indican en el apartado Almacenamiento de binarios de AFS en AFS (que son para binarios especφficos de AFS). 

Algunos archivos deben permanecer en el disco local para utilizarlos cuando AFS no estΘ accesible (durante arranques e interrupciones del servidor de archivos o de la red). Los binarios requeridos incluyen los siguientes: 

Un editor de texto, mandatos de red, etcΘtera 
Archivos utilizados durante la secuencia de arranque y antes de que se ejecute el programa afsd, como por ejemplo archivos de inicializaci≤n y configuraci≤n, y binarios para mandatos que montan sistemas de archivos 
Archivos utilizados por los programas cargadores dinßmicos del kernel 
En la mayorφa de casos, resulta mßs seguro permitir que s≤lo los usuarios con autentificaci≤n local accedan a los binarios del sistema, otorgando los permisos l (lookup) y r (read) al grupo system:authuser en las ACL de los directorios que contienen los binarios. Sin embargo, si hay usuarios que necesitan acceder a un binario sin disponer de autentificaci≤n, la ACL del directorio correspondiente debe otorgar dichos permisos al grupo system:anyuser. 

El diagrama siguiente resume el nombre de volumen y el punto de montaje sugeridos para almacenar binarios del sistema. Se utiliza un volumen independiente para cada directorio. Ya ha creado un volumen llamado nombre_sist para el tipo de sistema de esta mßquina al seguir las instrucciones indicadas en el apartado Almacenamiento de binarios de AFS en AFS. 

Puede denominar los vol·menes de la forma que quiera y montarlos en ubicaciones distintas de las sugeridas aquφ. Sin embargo, este esquema tiene varias ventajas: 

Los nombres de volumen identifican con claridad el contenido del volumen 
La utilizaci≤n del prefijo nombre_sist en cada volumen facilita la obtenci≤n de una copia de seguridad de todos los vol·menes juntos, puesto que el Sistema de copia de seguridad de AFS le permite definir series de vol·menes basados en una serie incluida en todos sus nombres 
Facilita un seguimiento de los vol·menes relacionados, manteniΘndolos juntos en la misma mßquina servidor de archivos si asφ se desea 
Hay una relaci≤n clara entre el nombre del volumen y el nombre del punto de montaje 

Nombre de volumen  Punto de montaje  
nombre_sist  /afs/nombre_cΘlula/nombre_sist  
nombre_sist.bin  /afs/nombre_cΘlula/nombre_sist/bin  
nombre_sist.etc  /afs/nombre_cΘlula/nombre_sist/etc  
nombre_sist.usr  /afs/nombre_cΘlula/nombre_sist/usr  
nombre_sist.usr.afsws  /afs/nombre_cΘlula/nombre_sist/usr/afsws  
nombre_sist.usr.bin  /afs/nombre_cΘlula/nombre_sist/usr/bin  
nombre_sist.usr.etc  /afs/nombre_cΘlula/nombre_sist/usr/etc  
nombre_sist.usr.inc  /afs/nombre_cΘlula/nombre_sist/usr/include  
nombre_sist.usr.lib  /afs/nombre_cΘlula/nombre_sist/usr/lib  
nombre_sist.usr.loc  /afs/nombre_cΘlula/nombre_sist/usr/local  
nombre_sist.usr.man  /afs/nombre_cΘlula/nombre_sist/usr/man  
nombre_sist.usr.sys  /afs/nombre_cΘlula/nombre_sist/usr/sys  



--------------------------------------------------------------------------------

Habilitaci≤n del acceso a cΘlulas externas
En este apartado se crea un punto de montaje en el espacio de archivos AFS para el volumen root.cell de cada cΘlula externa a la que se desea permitir el acceso por parte de los usuarios. Para que los usuarios que trabajan en una mßquina cliente accedan a la cΘlula, tambiΘn deben tener una entrada para la misma en el archivo local /usr/vice/etc/CellServDB de la mßquina cliente. (Las instrucciones que contiene el apartado Creaci≤n del archivo CellServDB de cliente sugieren que se utilice el archivo CellServDB.sample, incluido en la distribuci≤n de AFS, como base para el archivo CellServDB cliente de la cΘlula. El archivo de ejemplo lista todas las cΘlulas que han accedido a participar en el espacio de nombres global de AFS en el momento de crear el CD-ROM de AFS. Tal como se ha mencionado en dicho apartado, el grupo de soporte del producto AFS tambiΘn conserva una copia del archivo, actualizßndolo en caso necesario.) 

El capφtulo de la publicaci≤n IBM AFS Administration Guide que trata sobre temas de administraci≤n y configuraci≤n explica las implicaciones de participar en el espacio de nombres global de AFS. El capφtulo que trata sobre la administraci≤n de mßquinas cliente explica c≤mo mantener el conocimiento de cΘlulas externas en las mßquinas cliente e incluye sugerencias para mantener una versi≤n central del archivo en AFS. 

Emita el mandato fs mkmount para montar el volumen root.cell de cada cΘlula externa en un directorio denominado /afs/cΘlula_externa. Puesto que el volumen root.afs estß duplicado, debe crear un punto de montaje temporal para la versi≤n de lectura/grabaci≤n del mismo en un directorio para el que tenga acceso de grabaci≤n (como, por ejemplo, el directorio /afs/.nombre_cΘlula de la cΘlula). Cree los puntos de montaje, emita el mandato vos release para liberar nuevas duplicaciones en los sitios de s≤lo lectura para el volumen root.afs y emita el mandato fs checkvolumes para hacer que el Gestor de antememoria local acceda a la nueva duplicaci≤n. 
Nota: S≤lo tendrß que emitir el mandato fs mkmount una vez para el volumen root.cell de cada cΘlula externa. No es necesario que repita este mandato en cada mßquina cliente.  


Sustituya nombre_cΘlula por el nombre de la cΘlula. 

   
   # cd /afs/.nombre_cΘlula
   
   # /usr/afs/bin/fs  mkmount  temp  root.afs   

Repita el mandato fs mkmount para cada cΘlula externa que desee montar en este momento. 

   
   # /usr/afs/bin/fs mkmount temp/cΘlula_externa root.cell -c cΘlula_externa   

Emita los mandatos siguientes una sola vez. 

     
   # /usr/afs/bin/fs rmmount temp
   
   # /usr/afs/bin/vos release root.afs
   
   # /usr/afs/bin/fs checkvolumes
   

Si esta mßquina va a permanecer como cliente AFS despuΘs de completar la instalaci≤n, verifique que el archivo local /usr/vice/etc/CellServDB incluya una entrada para cada cΘlula externa. 
Para cada cΘlula que todavφa no tenga una entrada, lleve a cabo las instrucciones siguientes: 

Cree una entrada en el archivo CellServDB. Aseg·rese de cumplir las instrucciones de formateo que se indican en el apartado Creaci≤n del archivo CellServDB de cliente. 
Emita el mandato fs newcell para a±adir una entrada para la cΘlula directamente en la lista que el Gestor de antememoria mantiene en la memoria del kernel. Proporcione el nombre de sistema principal completamente cualificada de cada una de las mßquinas servidor de base de datos. 
   
   # /usr/afs/bin/fs newcell &lt;cΘlula_externa> < servidor_base_datos1>    \
            [&lt;servidor_base_datos2>] [&lt;servidor_base_datos3>]
   

Si piensa conservar una versi≤n central del archivo CellServDB (la ubicaci≤n convencional es /afs/nombre_cΘlula/common/etc/CellServDB), crΘela ahora como copia del archivo local /usr/vice/etc/CellServDB. Verifique que incluye una entrada para cada una de las cΘlulas externas a las que desea que los usuarios puedan acceder. 
   
   # mkdir common
   
   # mkdir common/etc
   
   # cp  /usr/vice/etc/CellServDB  common/etc
   
   # /usr/afs/bin/vos release root.cell
   

Emita el mandato ls para verificar que el punto de montaje de la nueva cΘlula es visible en el espacio de archivos. La salida lista los directorios de nivel superior del espacio de archivos AFS de la nueva cΘlula. 
   
   # ls /afs/cΘlula_externa
   

Registre la cΘlula en el grupo de soporte del producto AFS en este momento. Si no desea participar en el espacio de nombres global de AFS, liste su cΘlula en un archivo CellServDB privado que no estΘ disponible para otras cΘlulas AFS. 

--------------------------------------------------------------------------------

Mejora de la seguridad de la cΘlula
En este apartado se explican maneras de mejorar la seguridad de los datos de AFS en la cΘlula. Consulte tambiΘn el capφtulo de la publicaci≤n IBM AFS Administration Guide que trata temas de configuraci≤n y administraci≤n. 


Control de acceso del usuario root
Como en cualquier mßquina, es importante impedir que los usuarios no autorizados inicien sesiones con una mßquina cliente o servidor AFS como superusuario local root. Tenga el cuidado de mantener en secreto la contrase±a del usuario root. 

El superusuario local root no tiene un acceso especial a los datos de AFS a travΘs del Gestor de antememoria (como lo tienen los miembros del grupo system:administrators), pero tiene los privilegios siguientes: 

En las mßquinas cliente, la posibilidad de emitir mandatos del juego de mandatos fs que afectan al rendimiento de AFS 
En las mßquinas servidor, la posibilidad de inhabilitar la comprobaci≤n de la autorizaci≤n o de instalar binarios de procesos pillos 

Control de acceso del administrador del sistema
A continuaci≤n se muestran sugerencias para gestionar el privilegio administrativo de AFS: 

Cree, para cada administrador, un perfil de administraci≤n denominado algo asφ como nombreusuario.admin. Los administradores s≤lo se autentifican bajo estas identidades cuando realizan tareas administrativas, y destruyen las se±ales administrativas inmediatamente despuΘs de terminar la tarea (ya sea emitiendo el mandato unlog o emitiendo el mandato klog para adoptar su identidad normal). 
Establezca un tiempo de vida del certificado que sea breve para los perfiles de administrador (por ejemplo, 20 minutos) utilizando el argumento -lifetime en el mandato kas setfields, que se describe en la publicaci≤n IBM AFS Administration Reference. Sin embargo, no debe utilizar un tiempo de vida breve para los usuarios que emiten mandatos backup de larga ejecuci≤n. 
Limite el n·mero de administradores del sistema en la cΘlula, especialmente el de aquΘllos que pertenecen al grupo system:administrators. Por omisi≤n, tienen todos los derechos de ACL sobre todos los directorios del espacio de archivos locales AFS y, por consiguiente, se debe confiar en que no examinarßn archivos privados. 
Limite el uso de perfiles de administrador del sistema en mßquinas que se encuentren en ßreas p·blicas. Es especialmente importante no dejar tales mßquinas desatendidas sin antes destruir las se±ales administrativas. 
Limite el uso, por parte de los administradores, de mandatos estßndar de UNIX que efect·en conexiones con mßquinas remotas (como, por ejemplo, el programa de utilidad telnet). Muchos de estos programas envφan contrase±as por la red sin cifrarlas. 

Protecci≤n de directorios delicados de AFS
Algunos subdirectorios del directorio /usr/afs contienen archivos que son cruciales para la seguridad de la cΘlula. Los usuarios no autorizados no deben leer ni grabar dichos archivos debido a la posibilidad de un mal uso de la informaci≤n que contienen. 

Puesto que el Servidor BOS se inicializa por primera vez en una mßquina servidor, crea varios archivos y directorios (tal como se ha mencionado en el apartado Inicio del Servidor BOS). TambiΘn establece el propietario de los mismos como el superusuario local root y establece los bits de modalidad de forma que se permita la grabaci≤n ·nicamente por parte del propietario; en algunos casos, tambiΘn restringe la lectura. 

En cada rearranque posterior, el Servidor BOS comprueba que el propietario y los bits de modalidad de estos archivos siguen estando establecidos de manera apropiada. Si no es asφ, graba el mensaje siguiente en el archivo /usr/afs/logs/BosLog: 

   
   Bosserver reports inappropriate access on server directories   

El Servidor BOS no restablece los bits de modalidad, lo cual permite al usuario establecer valores alternativos en caso de que lo desee. 

El diagrama siguiente lista los valores esperados en los bits de modalidad. Un interrogante indica que el Servidor BOS no comprueba ese bit de modalidad. 
/usr/afs  drwxr?xr-x  
/usr/afs/backup  drwx???---  
/usr/afs/bin  drwxr?xr-x  
/usr/afs/db  drwx???---  
/usr/afs/etc  drwxr?xr-x  
/usr/afs/etc/KeyFile  -rw????---  
/usr/afs/etc/UserList  -rw?????--  
/usr/afs/local  drwx???---  
/usr/afs/logs  drwxr?xr-x  




--------------------------------------------------------------------------------

Eliminaci≤n del funcionamiento de cliente
┌nicamente debe seguir las instrucciones de este apartado si no desea que esta mßquina permanezca como cliente AFS. Una eliminaci≤n del funcionamiento de cliente significa que no se puede utilizar esta mßquina para acceder a archivos AFS. 

Elimine los archivos del directorio /usr/vice/etc. El mandato no elimina del directorio los archivos utilizados por el programa cargador dinßmico del kernel, en caso de que existan en este tipo de sistema. Dichos archivos siguen siendo necesarios en una mßquina que s≤lo funcione como servidor. 
    
   # cd /usr/vice/etc
   
   # rm  * 
   
   # rm -rf  C
   

Cree enlaces simb≤licos con los archivos ThisCell y CellServDB del directorio /usr/afs/etc. Esto posibilita la emisi≤n de mandatos de los juegos de mandatos de AFS (tales como bos y fs) en esta mßquina. 
     
   # ln -s /usr/afs/etc/ThisCell ThisCell
   
   # ln -s /usr/afs/etc/CellServDB CellServDB
   

En sistemas IRIX, emita el mandato chkconfig para desactivar la variable de configuraci≤n afsclient. 
   
   # /etc/chkconfig -f afsclient off
   

Rearranque la mßquina. La mayorφa de tipos de sistema utilizan el mandato shutdown, pero las opciones apropiadas varφan. 
   
   # cd /
   
   # shutdown opciones_apropiadas
   


Compilacion De Datos cx|c0x^

Fuentes: IBM , All Teams , Aix Ibm system 

Para Mz ezines edition n║3
http://www.merzenarioz.org 

Cx|c0x^

```

</div>
