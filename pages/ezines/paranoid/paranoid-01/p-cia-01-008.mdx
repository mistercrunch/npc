---
title: "P_CIA-01"
ezine: "paranoid"
---

# P_CIA-01

**Ezine:** paranoid

<div className="ascii-content">

```
                                                       Buenos Aires, Argentina
                                                                  Mayo de 1997







                            Como hackear en Windows
                            ======================= 

                                  por Hackeka

                              hackeka@hotmail.com
                                member of C.I.A.

                           The X BBS: (54-1) 750-8957







Introduccion
------------

Sin codigos de acceso, sin permisos en archivos, sin problemas...

Los sistemas operativos de Microbosta son lo mejor que podia pasar al mundo
hackin'. Para que aprender a hackear VMS/HP-UX/etc, si todas las terminales
son tipo windows? Hasta en lugares en los que la seguridad es muy
importante, como en los bancos, el 99% de las terminales PC tienen windows!

En este file no se va a hablar de el crackeo de la lista de passwd del NT,
para eso lean Phrack 50.

Por ultimo se va a ver como funciona una DLL que usa/abusa de los mensajes de
teclado, para capturar los passwords de alguna aplicacion.


Como se comunican los procesos y como espiarlos
-----------------------------------------------

En windows todo input del usuario (teclado, mouse, etc.) es interpretado por
sistema y se convierte en un MENSAJE. Este mensaje es enviado al proceso
destino segun lo determine la interfaz grafica, de acuerdo a donde se
posicionaba el mouse, el cursor, o que proceso esta en foreground.

Una de las formas mas faciles del hackeo es interceptar la cola de mensajes
antes de que lleguen a destino, instalando un HOOK. Hay dos tipos de hooks,
los que son system-wide y los task hooks (hacia un proceso). Para esto hay
que abusar de las funciones de Kernel siguientes:

HHOOK SetWindowsHookEx( int idHook, HOOKPROC hkprc,
                        HINSTANCE hinst, HTASK htask)

LRESULT CallNextHookEx( HHOOK hHook, int nCode,
                        WPARAM wParam, LPARAM lparam)

BOOL UnhookWindowsHookEx( HHOOK hhook)

FARPROC GetProcAddress( HINSTANCE hInst, LPCSTR lpszProcName)

HINSTANCE LoadLibrary ( LPCSTR dllName)


Empezando por SetWindowsHookEX, esta funcion instala un hook ("gancho") en
la cola de mensajes. Es la mas importante para nuestros propositos. El
primer parametro es el tipo de hook a implementar, siendo los que mas nos
interesan: WH_KEYBOARD, WH_SHELL y WH_SYSMSGFILTER. Todos estos son numeros
enteros que estan definidos en windows.h. El segundo parametro es la dir del
proceso a hookear. El tercero es la direccion del modulo en la que se
encuentra el proceso a hookear. Y por ultimo que alcance de hook: si se pasa
NULL se toman todos los mensajes de sistema, y si se pasa el HTASK de un
proceso ya existente solo levanta los mensajes de ese proceso.

CallNextHookEx llama al siguiente hook. No siempre es necesario
especificarla.

UnhookWindowsHookEx desengancha la funcion previamente enganchada, tomando
como parametro lo que devolvio SetWindowsHookEx al instalarlo.

Loadlibrary es la funcion que carga DLLs, por ejemplo para cargar la DLL que
esta en c:\windows\system\hack.dll se llama asi:

hinstancedll = LoadLibrary("\\WINDOWS\SYSTEM\HACK.DLL");

La variable hinstancedll tiene que ser del tipo HINSTANCE, que vendria a
contener el equivalente al pid en unix (Process ID).

GetProcAddress devuelve la direccion en memoria de una funcion dentro de un
modulo (bloques de memoria donde estan los procesos y librerias). Por
ejemplo se puede utilizar para buscar la direccion de la funcion
"capturapassword" dentro de una DLL que tiene por HINSTANCE el numero 370:

dircapt = GetProcAddress(370, "capturapassword");


WinKeylog
---------

Junto a este archivo viene la version Beta del Winkeylog, es una dll que
graba las teclas que se presionan. Se carga con un loader, o con cualquier
programa que la cargue, o sea que tenga:

LoadLibrary("xxxx.dll");

Como es beta, no tiene muchas opciones, y ademas puede colgar el teclado si
se cierra de maera no natural. Esto se previene utilizandola version que
loguea las teclas para una aplicacion determinada. Para mas info, mandame un
mail o llama a The X BBS 750-8957. El source no es publico, pero para los
que lo ameriten se los voy a dar ( Estoy embolado de que otros se hagan los
cancheros con algo que descubri/hice yo, por mas simple que sea).


Comentario Final
----------------

Este tipo de abuso de la cola de mensajes de windows es solo una faceta. Se
podrian utilizar muchas otras formas de tampering, inclusive interferir en
las interacciones de una aplicacion de gestion...


GRACIAS BILL !!!!



EOF
```

</div>
